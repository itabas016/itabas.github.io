<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2019总结</title>
      <link href="/2020/01/01/life/event-2019/"/>
      <url>/2020/01/01/life/event-2019/</url>
      
        <content type="html"><![CDATA[<blockquote><p>今年的元旦虽然过的跟平常的日子几乎一样，但总觉得这个 20 世纪 10 年代赋予了它深刻的意义，就像说的 2019 年是往年来最差的一年，但却是未来十年最好的一年。这谁又知道呢？总结还是要一如既往的回顾一下，才能打鸡血冲向未来，你说不是吗？</p></blockquote><a id="more"></a><p>言归正传，翻着这一年做的笔记，看看做的这些项目，遇到的这些人，碰到的这些事，一个人的日子多少有些凄凉，生活照旧多少有点让人焦虑。</p><h3 id="Technical-stuff"><a href="#Technical-stuff" class="headerlink" title="Technical stuff"></a>Technical stuff</h3><p>年初又买了新域名 - <a href="https://www.homeless.group" target="_blank" rel="noopener">homeless.group</a>, 当时很想着做点有用的事情，后面一忙就搁置了，后面有了些时间就搞了一下。</p><ul><li>Timeline</li></ul><blockquote><p>购买新域名 homeless.group<br>自学 Vue/React 前端<br>搞了 PVE, 玩转虚拟机<br>申请到了免费的 Oracle Cloud<br>双十一购买了良心云<br>因云服务器购买新域名 ebanbox.com<br>第一次备案<br>试运行一个完整的项目</p></blockquote><ul><li>Missed</li></ul><blockquote><p>以前的同事介绍的项目放弃了<br>撸了一段时间 Golang,但没深入<br>Flutter 没开始<br>云服务器吃灰</p></blockquote><h3 id="Mess-up-of-my-life"><a href="#Mess-up-of-my-life" class="headerlink" title="Mess up of my life"></a>Mess up of my life</h3><ul><li>Timeline</li></ul><p>年初定下来的很多目标今年都没有实现，很是惭愧。</p><blockquote><p>老爸二度来上海<br>交大自考的 CET-4 顺利过关<br>徽杭古道之行<br>买花盆开始种花(最后只有薄荷，秋葵活了下来)<br>空心户外之行<br>交大顺利毕业<br>GOT LAST SEASON<br>有段时间沉迷于 PKart<br>尝试剃了次“光头”(2-3mm)<br>朋友介绍的对象，还没开始就结束了<br>返乡祭祖<br>年底了锤子还摔了<br>今年入的装备 - DELL2417M, PVE Host, Smartisan R1<br>今年很是养生了隔三岔五的熬粥打豆浆吃素菜</p></blockquote><ul><li>Missed</li></ul><blockquote><p>吉他放弃了<br>骑行放弃了<br>徒步旅行没有坚持下来<br>野营没有踏出门<br>社交放弃了<br>玩游戏上瘾了<br>以前的坏毛病一样没有改掉</p></blockquote><h3 id="Plan"><a href="#Plan" class="headerlink" title="Plan"></a>Plan</h3><blockquote><p>中小型架构一把梭<br>想合伙搞个产品/合伙人？<br>学车<br>死瘦宅能脱单吗?</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
            <tag> 2019 </tag>
            
            <tag> 2020 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2017总结</title>
      <link href="/2018/01/21/life/event-2017/"/>
      <url>/2018/01/21/life/event-2017/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前两天正好赶上新公司的年会，自己去年的总结一直没有写，到现在才开始写。去年一年有点像空白，年龄一大脑袋不太记事儿了。。。</p></blockquote><a id="more"></a><p>Many times focus on personal stuff that some small and simple projects, meanwhile, about these project demos, I didn’t make well, I wish I will do well and keep going on it in 2018.</p><h3 id="Work-Things"><a href="#Work-Things" class="headerlink" title="Work Things"></a>Work Things</h3><ul><li>Projects</li></ul><blockquote><p>[Work]Change work team(Performance -&gt; Panda)(Apr)<br>[Work]projects on MNC and Support<br>Host a wiki site project(Apr) - <a href="https://wiki.itabas.com/" target="_blank" rel="noopener">Base on Simiki</a><br>Change new version for personal site nav(Jun) - <a href="https://itabas.com/" target="_blank" rel="noopener">iNav</a><br>Change theme even for tech project(Aug) - <a href="https://tech.itabas.com/">Tech</a><br>Question2Answer cover project(Aug) - q2a<br>Bing wallpaper simple project(Sep) - <a href="https://github.com/itabas016/bing-wallpaper-cli" target="_blank" rel="noopener">wallpaper</a><br>Simple Chat room(Aug) - <a href="https://github.com/itabas016/chat" target="_blank" rel="noopener">Chat</a><br>doc &amp; wiki(Sphinx) roadmap(Oct) - <code>progress: 20%</code><br>Vote project(Aug) - <code>progress: 10%</code><br>memories project(Oct) - <code>progress: 10%</code><br>vocab project(Jul) - <code>progres: 5%</code><br>bing wallpaper web version(Nov) - <code>progress: 0%</code><br>upload file(like: sm) share cloud(Oct) - <code>progress: 0%</code><br>Land Game base on Java(Nov) - <code>progress: 0%</code></p></blockquote><ul><li>Python</li></ul><blockquote><p>Python trip is done!<br>new plan, continue and go on<br>2018 part on flask, celery and django</p></blockquote><ul><li><p>Java</p><blockquote><p>go through Spring framework and such as other Integration framework.<br>tutorial - big data? android?<br>Kotlin, groovy(2018)<br>many many tasks in 2018</p></blockquote></li><li><p>Scripts</p><blockquote><p>Space-Vim(Dec)<br>Zsh(Dec)<br>work fun with chromebook<br>customize ide?</p></blockquote></li></ul><h3 id="Life-Things"><a href="#Life-Things" class="headerlink" title="Life Things"></a>Life Things</h3><ul><li>Timeline</li></ul><blockquote><p>guitar cover(few songs) - <a href="http://www.meipai.com/user/22093459" target="_blank" rel="noopener">Meipai</a><br>TeamBuilding - Disney(Jan)<br>English wallstreet training(Aug-Sep)<br>biking(Apr-Jul)</p><ul><li><a href="http://www.imxingzhe.com/xing/24540083/" target="_blank" rel="noopener">周庄锦溪</a></li><li><a href="http://www.imxingzhe.com/im/GJmYetoZidm/" target="_blank" rel="noopener">潇信风</a><br>hiking plan - <code>progress 0%</code><br>running plan - <code>stopped</code><br>tour - <code>removed</code><br>mom’s stuff(May-Aug)<br>Nexus6p relive(Sep)<br>Leave Hsn(Nov)<br>FreeTime(Nov-Dec)<br>nowhere<br>sports<br>library<br>interview<br>Join TCSoft(Jan)</li></ul></blockquote><ul><li>List</li></ul><blockquote><p>Smartsain Pro1(18th Jun)<br>Chromebook Samsung Plus(Black Friday)<br>Bluetooth earphone(bose)?<br>New Dell Screen?<br>Bike?</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
            <tag> 2017 </tag>
            
            <tag> 2018 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再安利一款命令行下载工具</title>
      <link href="/2017/11/27/tools/youget-download-tool/"/>
      <url>/2017/11/27/tools/youget-download-tool/</url>
      
        <content type="html"><![CDATA[<p>流媒体视频下载号称覆盖各大主流网站<code>Youtube</code>,<code>Twitter</code>, <code>TED</code>,<code>Bilibili</code>,<code>iQIYI</code>等等。<a href="https://you-get.org/#supported-sites" target="_blank" rel="noopener">Supported-sites</a><br>拿当前的几个网站测试玩玩~</p><a id="more"></a><h2 id="Install-安装"><a href="#Install-安装" class="headerlink" title="Install(安装)"></a>Install(安装)</h2><p>我是Windows下使用，需要<code>python3</code>,<code>FFmpeg</code>(转码)和<code>VLC</code>(播放器)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过choco来安装 FFmpeg, vlc</span></span><br><span class="line">choco install ffmpeg vlc -y</span><br><span class="line"></span><br><span class="line">pip install you-get</span><br></pre></td></tr></table></figure><p><strong>PS: <code>choco</code>第三方安装包参照<a href="https://chocolatey.org/installs" target="_blank" rel="noopener">这里</a></strong></p><h2 id="Command-命令"><a href="#Command-命令" class="headerlink" title="Command(命令)"></a>Command(命令)</h2><p>使用很简单，<code>you-get [params] &lt;url&gt;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ you-get -h</span><br><span class="line">you-get: version 0.4.964, a tiny downloader that scrapes the web.</span><br><span class="line">usage: you-get [OPTION]... URL...</span><br><span class="line"></span><br><span class="line">A tiny downloader that scrapes the web</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -V, --version         Print version and <span class="built_in">exit</span></span><br><span class="line">  -h, --<span class="built_in">help</span>            Print this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">Dry-run options:</span><br><span class="line">  (no actual downloading)</span><br><span class="line"></span><br><span class="line">  -i, --info            Print extracted information</span><br><span class="line">  -u, --url             Print extracted information with URLs</span><br><span class="line">  --json                Print extracted URLs <span class="keyword">in</span> JSON format</span><br><span class="line"></span><br><span class="line">Download options:</span><br><span class="line">  -n, --no-merge        Do not merge video parts</span><br><span class="line">  --no-caption          Do not download captions (subtitles, lyrics, danmaku,</span><br><span class="line">                        ...)</span><br><span class="line">  -f, --force           Force overwriting existing files</span><br><span class="line">  -F STREAM_ID, --format STREAM_ID</span><br><span class="line">                        Set video format to STREAM_ID</span><br><span class="line">  -O FILE, --output-filename FILE</span><br><span class="line">                        Set output filename</span><br><span class="line">  -o DIR, --output-dir DIR</span><br><span class="line">                        Set output directory</span><br><span class="line">  -p PLAYER, --player PLAYER</span><br><span class="line">                        Stream extracted URL to a PLAYER</span><br><span class="line">  -c COOKIES_FILE, --cookies COOKIES_FILE</span><br><span class="line">                        Load cookies.txt or cookies.sqlite</span><br><span class="line">  -t SECONDS, --timeout SECONDS</span><br><span class="line">                        Set socket timeout</span><br><span class="line">  -d, --debug           Show traceback and other debug info</span><br><span class="line">  -I FILE, --input-file FILE</span><br><span class="line">                        Read non-playlist URLs from FILE</span><br><span class="line">  -P PASSWORD, --password PASSWORD</span><br><span class="line">                        Set video visit password to PASSWORD</span><br><span class="line">  -l, --playlist        Prefer to download a playlist</span><br><span class="line"></span><br><span class="line">Proxy options:</span><br><span class="line">  -x HOST:PORT, --http-proxy HOST:PORT</span><br><span class="line">                        Use an HTTP proxy <span class="keyword">for</span> downloading</span><br><span class="line">  -y HOST:PORT, --extractor-proxy HOST:PORT</span><br><span class="line">                        Use an HTTP proxy <span class="keyword">for</span> extracting only</span><br><span class="line">  --no-proxy            Never use a proxy</span><br><span class="line">  -s HOST:PORT, --socks-proxy HOST:PORT</span><br><span class="line">                        Use an SOCKS5 proxy <span class="keyword">for</span> downloading</span><br></pre></td></tr></table></figure><p>测试结果: 家里是20M移动，外网挂代理速度还是很不错，国内的几个站点，速度不是太理想，爱奇艺下都下不完，难道姿势不对？不过就这样吧。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># youtube test result(use proxy, download quality 1280x720)</span></span><br><span class="line">$  you-get --itag=247 <span class="string">'https://www.youtube.com/watch?v=cECkQWunAro'</span> -x 127.0.0.1:1080</span><br><span class="line">site:                YouTube</span><br><span class="line">title:               LEE Chong Wei vs CHEN Long 2017 Hong Kong Open Final</span><br><span class="line">stream:</span><br><span class="line">    - itag:          247</span><br><span class="line">      container:     webm</span><br><span class="line">      quality:       1280x720</span><br><span class="line">      size:          250.7 MiB (262915265 bytes)</span><br><span class="line">    <span class="comment"># download-with: you-get --itag=247 [URL]</span></span><br><span class="line"></span><br><span class="line">Downloading LEE Chong Wei vs CHEN Long 2017 Hong Kong Open Final.webm ...</span><br><span class="line"> 100% (250.7/250.7MB) ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒[2/2]    2 MB/s</span><br><span class="line">Merging video parts... Merged into LEE Chong Wei vs CHEN Long 2017 Hong Kong Open Final.webm</span><br><span class="line"></span><br><span class="line">Saving LEE Chong Wei vs CHEN Long 2017 Hong Kong Open Final.en.srt ... Done.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TED test result</span></span><br><span class="line">$ you-get <span class="string">'https://www.ted.com/talks/mandy_len_catron_a_better_way_to_talk_about_love'</span> -x 127.0.0.1:1080</span><br><span class="line">Site:       TED.com</span><br><span class="line">Title:      A better way to talk about love</span><br><span class="line">Type:       MPEG-4 video (video/mp4)</span><br><span class="line">Size:       101.95 MiB (106899473 Bytes)</span><br><span class="line"></span><br><span class="line">Downloading A better way to talk about love.mp4 ...</span><br><span class="line"> 100% (101.9/101.9MB) ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒[1/1]    2 MB/s</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bilibili test</span></span><br><span class="line">$ you-get --format=mp4 <span class="string">'https://bangumi.bilibili.com/anime/5977/play#103970'</span></span><br><span class="line">site:                Bilibili</span><br><span class="line">title:               ▒▒Ŀ▒▒▒▒▒▒ ½ [7 ▒▒▒ֵĶ▒▒▒]</span><br><span class="line">stream:</span><br><span class="line">    - format:        mp4</span><br><span class="line">      container:     mp4</span><br><span class="line">      size:          98.3 MiB (103063182 bytes)</span><br><span class="line">    <span class="comment"># download-with: you-get --format=mp4 [URL]</span></span><br><span class="line"></span><br><span class="line">Downloading ▒▒Ŀ▒▒▒▒▒▒ ½ (7 ▒▒▒ֵĶ▒▒▒).mp4 ...</span><br><span class="line"> 100% ( 98.3/ 98.3MB) ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒[1/1]  755 kB/s</span><br><span class="line"></span><br><span class="line">Downloading ▒▒Ŀ▒▒▒▒▒▒ ½ (7 ▒▒▒ֵĶ▒▒▒).cmt.xml ...</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iQIYI test</span></span><br><span class="line">$ you-get --format=TD <span class="string">'http://www.iqiyi.com/v_19rrok801k.html'</span></span><br><span class="line">ffmpeg version 3.4 Copyright (c) 2000-2017 the FFmpeg developers</span><br><span class="line">  built with gcc 7.2.0 (GCC)</span><br><span class="line">  configuration: --<span class="built_in">enable</span>-gpl --<span class="built_in">enable</span>-version3 --<span class="built_in">enable</span>-sdl2 --<span class="built_in">enable</span>-bzlib --<span class="built_in">enable</span>-fontconfig --<span class="built_in">enable</span>-gnutls --<span class="built_in">enable</span>-iconv --<span class="built_in">enable</span>-libass --<span class="built_in">enable</span>-libbluray --<span class="built_in">enable</span>-libfreetype --<span class="built_in">enable</span>-libmp3lame --<span class="built_in">enable</span>-libopenjpeg --<span class="built_in">enable</span>-libopus --<span class="built_in">enable</span>-libshine --<span class="built_in">enable</span>-libsnappy --<span class="built_in">enable</span>-libsoxr --<span class="built_in">enable</span>-libtheora --<span class="built_in">enable</span>-libtwolame --<span class="built_in">enable</span>-libvpx --<span class="built_in">enable</span>-libwavpack --<span class="built_in">enable</span>-libwebp --<span class="built_in">enable</span>-libx264 --<span class="built_in">enable</span>-libx265 --<span class="built_in">enable</span>-libxml2 --<span class="built_in">enable</span>-libzimg --<span class="built_in">enable</span>-lzma --<span class="built_in">enable</span>-zlib --<span class="built_in">enable</span>-gmp --<span class="built_in">enable</span>-libvidstab --<span class="built_in">enable</span>-libvorbis --<span class="built_in">enable</span>-cuda --<span class="built_in">enable</span>-cuvid --<span class="built_in">enable</span>-d3d11va --<span class="built_in">enable</span>-nvenc --<span class="built_in">enable</span>-dxva2 --<span class="built_in">enable</span>-avisynth --<span class="built_in">enable</span>-libmfx</span><br><span class="line">  libavutil      55. 78.100 / 55. 78.100</span><br><span class="line">  libavcodec     57.107.100 / 57.107.100</span><br><span class="line">  libavformat    57. 83.100 / 57. 83.100</span><br><span class="line">  libavdevice    57. 10.100 / 57. 10.100</span><br><span class="line">  libavfilter     6.107.100 /  6.107.100</span><br><span class="line">  libswscale      4.  8.100 /  4.  8.100</span><br><span class="line">  libswresample   2.  9.100 /  2.  9.100</span><br><span class="line">  libpostproc    54.  7.100 / 54.  7.100</span><br><span class="line">[hls,applehttp @ 000002603fea2460] Opening <span class="string">'http://dx.data.video.qiyi.com/videos/v0/20160531/72/41/8f1463dced2d029eb624aa8357863660.ts?qdv=1&amp;qypid=385577300_04022000001000000000_4&amp;start=0&amp;end=1774490&amp;hsize=1894&amp;tag=0&amp;v=&amp;contentlength=1375784&amp;qd_uid=&amp;qd_vip=0&amp;qd_src=3_31_312&amp;qd_tm=1511792844379&amp;qd_ip=b7c177e5&amp;qd_p=b7c177e5&amp;qd_k=0ce99ea79e7124c9adf063c9ec40cecc&amp;qd_sc=818a00f02607bad3fcf841a2cb399f22'</span> <span class="keyword">for</span> reading</span><br><span class="line">Input <span class="comment">#0, hls,applehttp, from 'http://cache.m.iqiyi.com/mus/202861101/21e7451d956c0102975c361c8c6f1d10/afbe8fd3d73448c9//20160531/72/41/bbaf27dca1cc5742c13a761e67a82ade.m3u8?qd_originate=tmts_py&amp;tvid=385577300&amp;bossStatus=0&amp;qd_vip=0&amp;px=&amp;qd_src=3_31_312&amp;prv=&amp;previewType=&amp;previewTime=&amp;from=&amp;qd_time=1511792843835&amp;qd_p=b7c177e5&amp;qd_asc=b23206a0facb3fcc3854c89ca63fda45&amp;qypid=385577300_04022000001000000000_4&amp;qd_k=0ce99ea79e7124c9adf063c9ec40cecc&amp;isdol=0&amp;code=2&amp;qd_s=otv&amp;vf=2c976281fee262e999cd40862078c8ff&amp;np_tag=nginx_part_tag':</span></span><br><span class="line">  Duration: 00:23:25.00, start: 0.000000, bitrate: N/A</span><br><span class="line">  Program 0</span><br><span class="line">    Metadata:</span><br><span class="line">      variant_bitrate : 0</span><br><span class="line">    Stream <span class="comment">#0:0: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(tv, bt709), 1280x720, 23.98 fps, 23.98 tbr, 90k tbn, 47.95 tbc</span></span><br><span class="line">    Metadata:</span><br><span class="line">      variant_bitrate : 0</span><br><span class="line">    Stream <span class="comment">#0:1: Audio: aac (LC) ([15][0][0][0] / 0x000F), 44100 Hz, stereo, fltp</span></span><br><span class="line">    Metadata:</span><br><span class="line">      variant_bitrate : 0</span><br><span class="line">Output <span class="comment">#0, mp4, to '航海王第312集.mp4':</span></span><br><span class="line">  Metadata:</span><br><span class="line">    encoder         : Lavf57.83.100</span><br><span class="line">    Stream <span class="comment">#0:0: Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709), 1280x720, q=2-31, 23.98 fps, 23.98 tbr, 90k tbn, 90k tbc</span></span><br><span class="line">    Metadata:</span><br><span class="line">      variant_bitrate : 0</span><br><span class="line">    Stream <span class="comment">#0:1: Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp</span></span><br><span class="line">    Metadata:</span><br><span class="line">      variant_bitrate : 0</span><br><span class="line">Stream mapping:</span><br><span class="line">  Stream <span class="comment">#0:0 -&gt; #0:0 (copy)</span></span><br><span class="line">  Stream <span class="comment">#0:1 -&gt; #0:1 (copy)</span></span><br><span class="line">Press [q] to stop, [?] <span class="keyword">for</span> <span class="built_in">help</span></span><br><span class="line">[mp4 @ 000002603fee37a0] Timestamps are <span class="built_in">unset</span> <span class="keyword">in</span> a packet <span class="keyword">for</span> stream 0. This is deprecated and will stop working <span class="keyword">in</span> the future. Fix your code to <span class="built_in">set</span> the timestamps properly</span><br><span class="line">[mp4 @ 000002603fee37a0] pts has no valueB time=00:00:02.96 bitrate=   0.1kbits/s speed=0.778x</span><br><span class="line">[http @ 000002603feb3ac0] Stream ends prematurely at 681976, should be 1375784s/s speed=0.162x</span><br><span class="line">[hls,applehttp @ 000002603fea2460] Opening <span class="string">'http://dx.data.video.qiyi.com/videos/v0/20160531/72/41/8f1463dced2d029eb624aa8357863660.ts?qdv=1&amp;qypid=385577300_04022000001000000000_4&amp;start=614670&amp;end=1885760&amp;hsize=1894&amp;tag=1&amp;v=&amp;contentlength=468120&amp;qd_uid=&amp;qd_vip=0&amp;qd_src=3_31_312&amp;qd_tm=1511792844379&amp;qd_ip=b7c177e5&amp;qd_p=b7c177e5&amp;qd_k=0ce99ea79e7124c9adf063c9ec40cecc&amp;qd_sc=818a00f02607bad3fcf841a2cb399f22'</span> <span class="keyword">for</span> reading</span><br><span class="line">[mpegts @ 000002603ffee840] PES packet size mismatch</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Command Line </tag>
            
            <tag> Download </tag>
            
            <tag> Tools </tag>
            
            <tag> You-Get </tag>
            
            <tag> 流媒体 </tag>
            
            <tag> 下载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安利一款百度云盘下载工具</title>
      <link href="/2017/11/25/tools/baidu-pan-download-tool/"/>
      <url>/2017/11/25/tools/baidu-pan-download-tool/</url>
      
        <content type="html"><![CDATA[<p>首先这款工具是在找<code>Aira2-RPC</code>网盘下载时才发现的，原来的chrome插件<a href="https://github.com/acgotaku/BaiduExporter" target="_blank" rel="noopener">BaiduExporter</a>，去年用过一段时间，我自己感觉不是很好，不知道是不是用法不对还是怎么，<code>Aria2</code>老半天才弹出来，现在大家普遍反应百度云对此类连接做了限制，所以找了找其它的就发现了这个。初步试了试感觉还不错，可以继续把百度云上的东西搬到自己的<code>NAS</code>上。一来摆脱百度云盘这个毒瘤应用程序，二来在<code>Rasp</code>上直接搞就行了。</p><a id="more"></a><h2 id="Install-安装"><a href="#Install-安装" class="headerlink" title="Install(安装)"></a>Install(安装)</h2><ul><li>支持多线程下载和下载时断点续传。</li><li>支持快速上传和多线程分片上传。</li><li>支持线程限速。具体查看<code>pcs set</code>和<code>pcs context</code>命令的说明。</li><li>支持<code>AES-CBC-128</code>, <code>AES-CBC-192</code>, <code>AES-CBC-256</code>加密。</li></ul><p>工具地址-&gt;<a href="https://github.com/GangZhuo/BaiduPCS" target="_blank" rel="noopener">BaiduPCS</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我用的`Debian`, 作者说程序依赖 libcurl</span></span><br><span class="line">sudo apt-get install build-essential libcurl4-openssl-dev libssl-dev</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/GangZhuo/BaiduPCS.git ~/Programs/pan</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make</span></span><br><span class="line"><span class="built_in">cd</span> ~/Programs/pan</span><br><span class="line">./configure &amp;&amp; make</span><br><span class="line"></span><br><span class="line">sudo cp ./baidupcs /usr/bin</span><br></pre></td></tr></table></figure><p>如果是路由器层(如果刷的是Openwrt)可以参照<a href="https://github.com/GangZhuo/BaiduPCS#编译-openwrt" target="_blank" rel="noopener">作者教科书Openwrt</a>。</p><h2 id="Command-命令"><a href="#Command-命令" class="headerlink" title="Command(命令)"></a>Command(命令)</h2><p>先来看一下help:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~ $ baidupcs -h</span><br><span class="line">pcs v0.3.1 (API v1.1.5)baidupcs</span><br><span class="line"></span><br><span class="line">Usage: baidupcs <span class="built_in">command</span> [options] [arg1|arg2...]</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  The baidupcs is client of baidu net disk. It supplied many <span class="built_in">functions</span>,</span><br><span class="line">  <span class="built_in">which</span> can manage baidu net disk on terminal, such as ls, cp, rm,</span><br><span class="line">  mv, rename, download, upload, search and so on.</span><br><span class="line">  The baidupcs provided AES encryption, <span class="built_in">which</span> can protected your data.</span><br><span class="line">  The baidupcs is open <span class="built_in">source</span>, and published on MIT.</span><br><span class="line">  Please see https://github.com/GangZhuo/baidupcs.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --context=&lt;file path&gt;  Specify context.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  cat      Print the file content</span><br><span class="line">  <span class="built_in">cd</span>       Change the work directory</span><br><span class="line">  copy     Copy the file|directory</span><br><span class="line">  compare  Print the differents between <span class="built_in">local</span> and net disk</span><br><span class="line">  context  Print the context</span><br><span class="line">  download Download the file</span><br><span class="line">  <span class="built_in">echo</span>     Write the text into net disk file</span><br><span class="line">  encode   Encrypt/decrypt the file</span><br><span class="line">  fix      Fix file base md5 and scrap</span><br><span class="line">  <span class="built_in">help</span>     Print the usage</span><br><span class="line">  list     List the directory</span><br><span class="line">  login    Login</span><br><span class="line">  <span class="built_in">logout</span>   Logout</span><br><span class="line">  meta     Print the file|directory meta information</span><br><span class="line">  mkdir    Make a new directory</span><br><span class="line">  move     Move the file|directory into other file|directory</span><br><span class="line">  <span class="built_in">pwd</span>      Print the current work directory</span><br><span class="line">  quota    Print the quota</span><br><span class="line">  remove   Remove the file|directory</span><br><span class="line">  rename   Rename the file|directory</span><br><span class="line">  <span class="built_in">set</span>      Change the context, you can <span class="built_in">print</span> the context by <span class="string">'context'</span> <span class="built_in">command</span></span><br><span class="line">  search   Search the files <span class="keyword">in</span> the specify directory</span><br><span class="line">  synch    Synch between <span class="built_in">local</span> and net disk. You can <span class="string">'compare'</span> first.</span><br><span class="line">  upload   Upload the file</span><br><span class="line">  version  Print the version</span><br><span class="line">  who      Print the current user</span><br><span class="line">Use <span class="string">'baidupcs &lt;command&gt; -h'</span> to <span class="built_in">print</span> <span class="built_in">command</span> usage.</span><br><span class="line">Sample:</span><br><span class="line">  baidupcs <span class="built_in">help</span></span><br><span class="line">  baidupcs <span class="built_in">help</span> cat</span><br><span class="line">  baidupcs cat -h</span><br><span class="line">  baidupcs cat /note.txt</span><br><span class="line">  baidupcs <span class="built_in">cd</span> /temp</span><br><span class="line">  baidupcs cat /note.txt --context=/home/gang/.pcs_context</span><br></pre></td></tr></table></figure><p>下面我就列几个我常用的几个：<code>login</code>, <code>context</code>, <code>list</code>, <code>cat</code>, <code>compare</code>, <code>download</code>, <code>mkdir</code>, <code>synch</code>, <code>search</code>其它的命令都可参照help文档。<br><code>context</code>里面存储是登陆后的<code>cookie</code>和其它一些基本配置信息(下载线程数，磁盘缓存等)，目前都是使用的默认值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># login</span></span><br><span class="line">baidupcs login [--username=&lt;username&gt;] [--password=&lt;password&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># login success, current directory is /</span></span><br><span class="line">baidupcs <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check drive list, default directory is /</span></span><br><span class="line">baidupcs list [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat single file content</span></span><br><span class="line">baidupcs cat /Document/README.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是比较常用的命令同步，下载和比较</span></span><br><span class="line"><span class="comment"># sync folder local &lt;-&gt; remote</span></span><br><span class="line"><span class="comment"># -c compare, -d download -u upload, -r recursive(递归目录)</span></span><br><span class="line"><span class="comment"># -n only print DONT execute down/upload, -e print same file/folder</span></span><br><span class="line">baidupcs synch [-cdenru] &lt;<span class="built_in">local</span> path&gt; &lt;remote path&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我的同步文件夹命令[目前只有下载，考虑下载限速后面可能不会再上传百度云]</span></span><br><span class="line">baidupcs synch -cdr /media/pi/ITABAS/Image /Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单个文件的下载或上传(单个文件不包括目录)</span></span><br><span class="line"><span class="comment"># -f force(强制替换)</span></span><br><span class="line">baidupcs download [-f] &lt;remote file&gt; &lt;<span class="built_in">local</span> file&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件查找</span></span><br><span class="line"><span class="comment"># search -r recursive dir to search</span></span><br><span class="line">baidupcs search [-r] [dir] &lt;key&gt;</span><br><span class="line">pi@raspberrypi:~ $ baidupcs search -r /Music 刘德华</span><br><span class="line">D     Size  Modify Date Time  File Name</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">- 10463262  2014-04-24 21:54:04  /Music/国语老歌/国语老歌·男人篇/16 忘情水（刘德华）.mp3</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Total: 9.98MB, File Count: 1, Directory Count: 0</span><br></pre></td></tr></table></figure><p>下面配图两张: 下载速度刚开始还不错，时间长了百度云也限速[摊手~]<br><img src="../../../../../screenshots/baidupcs.jpg" alt="baidupan"><br><img src="../../../../../screenshots/baidupcs-1.jpg" alt="baidupan-1"></p><p>另外还有一个问题没解决，就是在下载单个大文件(size&gt;2G)时会报磁盘空间不足，后面会试着看看能不能解决，下载大文件速度是个问题。<br><a href="https://github.com/GangZhuo/BaiduPCS/issues/201" target="_blank" rel="noopener">在32位Linux平台上无法下载大文件 #201</a></p><p><strong>Tips：运行时间较长的任务使用<code>tmux</code>或<code>screen</code>命令</strong></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> Linux </tag>
            
            <tag> Command Line </tag>
            
            <tag> Download </tag>
            
            <tag> BaiduYun </tag>
            
            <tag> Tools </tag>
            
            <tag> 百度云盘 </tag>
            
            <tag> 网盘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 打造无线中继服务器</title>
      <link href="/2017/11/13/raspberry/raspberry-pi3-wireless-repeater-server/"/>
      <url>/2017/11/13/raspberry/raspberry-pi3-wireless-repeater-server/</url>
      
        <content type="html"><![CDATA[<p>既然rasp又活了一开始想着用它来搞个WIFI中继。之前对这个原理不是很懂，也不知道具体是怎么实现的，这次搞一搞。</p><p>后来摸索着不妨就单开个热点做梯子用，其实中继模式和桥接模式很类似，表面上看可以简单的说只是无线SSID广播不同的信号，实际在实现上还是有诸多区别，这里就记一下所趟的坑。</p><a id="more"></a><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>主要参考了网上的教程</p><p>我的是一个板子(包含内置的有线网卡eth0和无线网卡wlan0)，一根网线，一个无线网卡wlan1(用来做梯子用)。</p><h3 id="Static-IP"><a href="#Static-IP" class="headerlink" title="Static IP"></a>Static IP</h3><p>之前已经准备好了eth0静态ip, wlan0动态获取。主要是有线网卡比较稳定适合用静态ip。</p><p>静态ip设置参照<a href="https://tech.itabas.com/2016/06/10/raspberry/raspberry-pi3-config/#Configure-static-IP-amp-WIFI">这里</a></p><p>后面修改 <code>/etc/network/interfaces</code> 和 <code>/etc/dhcpcd.conf</code> 分别添加以下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify /etc/network/interfaces</span></span><br><span class="line">sudo vim /etc/network/interfaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># add wlan1 configuration</span></span><br><span class="line">allow-hotplug wlan1</span><br><span class="line">auto wlan1</span><br><span class="line">iface wlan1 inet manual</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify /etc/dhcpcd.conf</span></span><br><span class="line">sudo vim /etc/dhcpcd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># add wlan1 dhcp configuration</span></span><br><span class="line">interface wlan1</span><br><span class="line">static ip_address=192.168.20.1/24</span><br><span class="line">static routers=192.168.11.1</span><br><span class="line">static domain_name_servers=114.114.114.114 119.29.29.29</span><br></pre></td></tr></table></figure><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>然后修改 <code>/etc/dnsmasq.conf</code>配置wlan1网段(192.168.20.0/24)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify /etc/dnsmasq.conf</span></span><br><span class="line">sudo vim /etc/dnsmasq.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomments add configuration</span></span><br><span class="line">no-resolv</span><br><span class="line">server=202.38.93.153</span><br><span class="line">server=202.141.162.123</span><br><span class="line">server=114.114.114.114</span><br><span class="line">server=119.29.29.29</span><br><span class="line"></span><br><span class="line">listen-address=127.0.0.1,192.168.20.1</span><br><span class="line">dhcp-range=192.168.20.50,192.168.20.150,12h</span><br></pre></td></tr></table></figure><h3 id="Forward"><a href="#Forward" class="headerlink" title="Forward"></a>Forward</h3><p>开启包转发 <code>sudo vim /etc/sysctl.conf</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncomment</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># run</span></span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># add iptables rule (nat rule for wlan0)</span></span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE</span><br></pre></td></tr></table></figure><p><strong>PS.Tips:</strong> 使用<code>iptables-persistent</code>将防火墙rules保存至<code>/etc/iptables/rules.v4</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># save current rules</span></span><br><span class="line">sudo service netfilter-persistent save</span><br><span class="line"><span class="comment">#read current rules</span></span><br><span class="line">sudo service netfilter-persistent reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># reload rules when restart rasp</span></span><br><span class="line">sudo vim /etc/rc.local</span><br><span class="line"><span class="comment"># add configuration</span></span><br><span class="line">iptables-restore &lt; /etc/iptables/rules.v4</span><br></pre></td></tr></table></figure><h3 id="Hostapd"><a href="#Hostapd" class="headerlink" title="Hostapd"></a>Hostapd</h3><p>首先需要确保当前网卡wlan1是否具有APmode或用来做中继或桥接的功能。<code>iw list|grep -A10 &#39;Supported interface modes&#39;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install hostapd</span></span><br><span class="line">sudo apt-get install hostapd</span><br><span class="line"></span><br><span class="line"><span class="comment"># check wlan adapter support current driver</span></span><br><span class="line">lsusb</span><br><span class="line"></span><br><span class="line"><span class="comment"># currently, my driver need use r8712u</span></span><br><span class="line"><span class="comment"># Bus 001 Device 005: ID 0bda:8171 Realtek Semiconductor Corp. RTL8188SU 802.11n WLAN Adapter</span></span><br><span class="line"><span class="comment"># if hostapd doesn't support current dirver, need find driver related hostapd and manually make it</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modify hostapd configuration</span></span><br><span class="line">sudo /etc/hostapd/hostapd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># add configuration</span></span><br><span class="line">interface=wlan1</span><br><span class="line">driver=r8712udrv</span><br><span class="line">ssid=My_SSID_Name</span><br><span class="line">channel=10</span><br><span class="line">wmm_enabled=1</span><br><span class="line">wpa=2</span><br><span class="line">wpa_passphrase=MYPASSWORD</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP</span><br><span class="line">rsn_pairwise=CCMP</span><br><span class="line">auth_algs=1</span><br><span class="line">macaddr_acl=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># test hostadp </span></span><br><span class="line">sudo hostapd -d /etc/hostapd/hostapd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># change DAEMON_CONF path</span></span><br><span class="line">sudo /etc/default/hostapd</span><br><span class="line"></span><br><span class="line">DAEMON_CONF=<span class="string">"/etc/hostapd/hostapd.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start SSID</span></span><br><span class="line">sudo service hostapd start</span><br></pre></td></tr></table></figure><h2 id="梯子部分"><a href="#梯子部分" class="headerlink" title="梯子部分"></a>梯子部分</h2><h3 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h3><p>使用<code>redsocks + shadowsocks</code>, 直接<code>sudo pip install shadowsocks</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create shadowsocks json configuration</span></span><br><span class="line">sudo vim /etc/shadowsocks.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># add json content</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"xxx.xxx.xxx.xxx"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:8989,</span><br><span class="line">    <span class="string">"local_address"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"password"</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:600,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">sudo sslocal -c /etc/shadowsocks.json -d start</span><br><span class="line"></span><br><span class="line"><span class="comment"># add autostart</span></span><br><span class="line">sudo sh -c <span class="string">"sslocal -c /etc/shadowsocks.conf -d start &gt;&gt; /etc/rc.local"</span></span><br></pre></td></tr></table></figure><h3 id="Redsocks"><a href="#Redsocks" class="headerlink" title="Redsocks"></a>Redsocks</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo apt-get install redsocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify /etc/redsocks.conf</span></span><br><span class="line">sudo vim /etc/redsocks.conf</span><br><span class="line"></span><br><span class="line">redsocks &#123;  </span><br><span class="line">    local_ip = 0.0.0.0;</span><br><span class="line">    local_port = 12345; </span><br><span class="line">    ip = 127.0.0.1;</span><br><span class="line">    port = 1080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># start</span></span><br><span class="line">sudo service redsocks start</span><br></pre></td></tr></table></figure><h3 id="IPset-Rule"><a href="#IPset-Rule" class="headerlink" title="IPset Rule"></a>IPset Rule</h3><p><em>凡是国外ip都采用shadowsocks</em>, 其实这条规则有点大，如果下载BT的话风险会很大。目前先按<a href="https://story.tonylee.name" target="_blank" rel="noopener">tony1016</a>的配置来。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># execute command</span></span><br><span class="line">curl <span class="string">'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest'</span> | grep ipv4 | grep CN | awk -F\| <span class="string">'&#123; printf("%s/%d\n", $4, 32-log($5)/log(2)) &#125;'</span> &gt; chnroute.txt  </span><br><span class="line"></span><br><span class="line"><span class="comment"># export ip to ipset</span></span><br><span class="line">sudo ipset create chnroute <span class="built_in">hash</span>:net  </span><br><span class="line">cat chnroute.txt | sudo xargs -I ip ipset add chnroute ip </span><br><span class="line"></span><br><span class="line"><span class="comment"># set autostart</span></span><br><span class="line">sudo sh -c <span class="string">"ipset save chnroute &gt; /etc/chnroute.ipset"</span></span><br><span class="line"></span><br><span class="line">sudo vim /etc/rc.local</span><br><span class="line"><span class="comment"># add configuration</span></span><br><span class="line">iptables-restore &lt; /etc/iptables/rules.v4</span><br></pre></td></tr></table></figure><h3 id="Firewall-Rule"><a href="#Firewall-Rule" class="headerlink" title="Firewall Rule"></a>Firewall Rule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># general rule for wlan0 wlan1</span></span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE</span><br><span class="line">sudo iptables -A FORWARD -i wlan0 -o wlan1 -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">sudo iptables -A FORWARD -i wlan1 -o wlan0 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># shadowsocks rule</span></span><br><span class="line">sudo iptables -t nat -N SHADOWSOCKS</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 67.216.202.107 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 0.0.0.0/8 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 10.0.0.0/8 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 127.0.0.0/8 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 169.254.0.0/16 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 172.16.0.0/12 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 192.168.0.0/16 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 224.0.0.0/4 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -d 240.0.0.0/4 -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -m <span class="built_in">set</span> --match-set chnroute dst -j RETURN</span><br><span class="line">sudo iptables -t nat -A SHADOWSOCKS -p tcp -j REDIRECT --to-ports 12345</span><br><span class="line">sudo iptables -t nat -A OUTPUT -p tcp -j SHADOWSOCKS</span><br><span class="line">sudo iptables -t nat -A PREROUTING -p tcp -j SHADOWSOCKS</span><br><span class="line"></span><br><span class="line"><span class="comment"># save rules to /etc/iptables/rules.v4</span></span><br><span class="line">sudo sh -c <span class="string">"iptables-save &gt; /etc/iptables/rules.v4"</span></span><br></pre></td></tr></table></figure><p>Reference: </p><p><a href="https://story.tonylee.name/2016/03/31/yong-shu-mei-pai-da-zao-wu-xian-zhong-ji-ke-xue-shang-wang-lu-you-qi/" target="_blank" rel="noopener">用树莓派打造无线中继科学上网路由器</a><br><a href="https://wangye.org/blog/archives/845/" target="_blank" rel="noopener">将树莓派Raspberry Pi设置为无线路由器(WiFi热点AP,RTL8188CUS芯片)</a><br><a href="https://www.tongfu.info/build-wireless-router-cross-china-firewall-use-raspberrypi-and-realtek-8192cu-usb-dongle/" target="_blank" rel="noopener">树莓派打造科学上网无线路由器(基于Realtek 8192cu网卡)</a></p>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> Wireless </tag>
            
            <tag> Wireless Repeater </tag>
            
            <tag> Wireless Bridger </tag>
            
            <tag> Router </tag>
            
            <tag> 无线中继 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 有趣玩法</title>
      <link href="/2017/11/10/raspberry/raspberry-pi3-funny-service/"/>
      <url>/2017/11/10/raspberry/raspberry-pi3-funny-service/</url>
      
        <content type="html"><![CDATA[<p>前两天又看到了用树莓派可以做FM射频广播，感觉挺好玩的。另外简单的还有网络音频播放器，如果实现语音播报功能的话，类似的可以实现正点报时，闹钟提醒还有智能语音对话，当然咯这些的实现后面有时间的话一个一个来玩~</p><a id="more"></a><h2 id="FM射频广播"><a href="#FM射频广播" class="headerlink" title="FM射频广播"></a>FM射频广播</h2><p><a href="https://github.com/ma6174/fmpi" target="_blank" rel="noopener">项目来源参照</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download package</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/ma6174/fmpi.git ~/Programs/fmpi</span><br><span class="line"></span><br><span class="line"><span class="comment"># setup.sh have duplicate step</span></span><br><span class="line"><span class="comment"># manually install dependency</span></span><br><span class="line">sudo apt-get install python-setuptools mpg123 -y</span><br><span class="line">sudo easy_install web.py</span><br><span class="line">sudo easy_install wsgilog</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy main application</span></span><br><span class="line"><span class="built_in">cd</span> fmpi-master</span><br><span class="line">sudo cp pifm /usr/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># run start.sh</span></span><br><span class="line">. start.sh</span><br></pre></td></tr></table></figure><p>源程序<code>fmpi.py</code>主要是豆瓣FM，后期可以介入网易云或喜马拉雅电台。</p><h2 id="网络播放器"><a href="#网络播放器" class="headerlink" title="网络播放器"></a>网络播放器</h2><p><a href="https://github.com/yaphone/RasWxNeteaseMusic" target="_blank" rel="noopener">项目来源参照</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download source code</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/yaphone/RasWxNeteaseMusic.git ~/Programs/pi-netease</span><br><span class="line"></span><br><span class="line"><span class="comment"># install dependency</span></span><br><span class="line">sudo apt-get install python-dev</span><br><span class="line">sudo pip install requests future crypto bs4 pycrypto</span><br><span class="line"></span><br><span class="line"><span class="comment"># run</span></span><br><span class="line"><span class="built_in">cd</span> ~/Programs/pi-netease</span><br><span class="line">python run.py</span><br></pre></td></tr></table></figure><p>数据源采用网易云音乐，微信二维码扫描登陆，测试结果并不理想。</p>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> FM射频 </tag>
            
            <tag> 网络播放器 </tag>
            
            <tag> 网易云音乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python - 实例方法，类方法，静态方法和抽象方法区别</title>
      <link href="/2017/09/23/python/difference-with-various-methods/"/>
      <url>/2017/09/23/python/difference-with-various-methods/</url>
      
        <content type="html"><![CDATA[<p>Python的<code>instance</code>方法，<code>class</code>方法，<code>static</code>方法和<code>abstract</code>方法。<br>实例方法的声明只需将第一个参数指定为<code>self</code>, 静态方法无参数要求。而类方法需将第一个参数指定为类<code>cls</code>。抽象方法是定义在基类中的一种方法，不提供任何实现。</p><a id="more"></a><p>下面来看方法实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Material</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, cheese=<span class="string">''</span>, vegetables=<span class="string">''</span>, meat=<span class="string">''</span>)</span>:</span></span><br><span class="line">        self.cheese = cheese</span><br><span class="line">        self.vegetables = vegetables</span><br><span class="line">        self.meat = meat</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cheese</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.cheese</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_vegetables</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.vegetables</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_meat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.meat</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">         self.size = size</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_size</span><span class="params">(self)</span>:</span></span><br><span class="line">         <span class="keyword">return</span> self.size</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pure_material</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Pure Pizza: %s'</span> % x</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mix_material</span><span class="params">(x, y)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Mix Pizza: %s + %s'</span> % (x, y)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cook_vegetable</span><span class="params">(cls, material)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.pure_material(material.get_vegetables())</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cook_meat</span><span class="params">(cls, material)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.mix_material(material.get_cheese(), material.get_meat())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">material = Material(<span class="string">'Cheese'</span>, <span class="string">'Tomatoes'</span>, <span class="string">'Beaf'</span>)</span><br><span class="line">p = Pizza(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pizza size'</span>, p.get_size())</span><br><span class="line">print(Pizza.cook_vegetable(material))</span><br><span class="line">print(Pizza.cook_meat(material))</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">Pizza size <span class="number">30</span></span><br><span class="line">Pure Pizza: Tomatoes</span><br><span class="line">Mix Pizza: Cheese + Beaf</span><br></pre></td></tr></table></figure><p>抽象方法，我们可以通过一个<code>BasePizza</code>来实现。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePizza</span><span class="params">(object)</span>:</span></span><br><span class="line">    </span><br><span class="line">    __abstract__  = <span class="literal">True</span></span><br><span class="line">    __metaclass__  = abc.ABCMeta</span><br><span class="line"></span><br><span class="line">    default_material = [<span class="string">'wheat'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_material</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.default_material</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdvancePizza</span><span class="params">(BasePizza)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, size)</span>:</span></span><br><span class="line">        self.size = size</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_size</span><span class="params">(self)</span>:</span></span><br><span class="line">         <span class="keyword">return</span> self.size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_material</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">'egg'</span>] + [<span class="string">'meat'</span>] + [<span class="string">'friut'</span>] + super(AdvancePizza, self).get_material()</span><br><span class="line"></span><br><span class="line">p = AdvancePizza(<span class="number">30</span>)</span><br><span class="line">print(p.get_material())</span><br></pre></td></tr></table></figure><p>References:</p><p><a href="https://julien.danjou.info/blog/2013/guide-python-static-class-abstract-methods" target="_blank" rel="noopener">The definitive guide on how to use static, class or abstract methods in Python</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 静态方法 </tag>
            
            <tag> 类方法 </tag>
            
            <tag> 抽象方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python - 迭代器和生成器区别(Iterator vs Generator)</title>
      <link href="/2017/09/17/python/iterator-difference-with-generator/"/>
      <url>/2017/09/17/python/iterator-difference-with-generator/</url>
      
        <content type="html"><![CDATA[<p>下面简单说一下迭代器和生成器的区别：</p><p>通常生成器是通过调用一个或多个<code>yield</code>表达式构成的函数。每个生成器都是迭代器。<br>而迭代器是一个抽象的概念，包括了<code>iterable</code>和<code>iterator</code>这两种实现。</p><a id="more"></a><h3 id="Iterator-amp-Generator"><a href="#Iterator-amp-Generator" class="headerlink" title="Iterator &amp; Generator"></a>Iterator &amp; Generator</h3><ul><li><code>iterable</code>: 它表示了一个可以重复迭代的对象，判断一个对象是否可以<code>iterable</code>, 是否可以<code>for</code>循环, 是否定义了<code>__getitem__</code>方法, 是否定义了<code>__iter__</code>方法返回一个<code>iterator</code> </li><li><code>iterator</code>: 特殊之处是只能迭代一次，判断一个对象是否是<code>iterator</code>，是否定义了<code>__iter__</code>方法，并且必须返回自身，是否定义了<code>__next__</code>方法</li></ul><p><strong>PS. <code>str</code>和<code>list</code>都是典型的<code>iterable</code>而不是<code>iterator</code></strong></p><p>用一个公交车的例子再来看一遍：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bus</span><span class="params">(object)</span>:</span>   <span class="comment"># 只是iterable而不是iterator</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args)</span>:</span></span><br><span class="line">        self.stops = list(args)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>  <span class="comment"># 并没有返回自身</span></span><br><span class="line">        <span class="keyword">return</span> BusStopIterator(self)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BusStopIterator</span><span class="params">(object)</span>:</span>  <span class="comment"># iterator</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, bus)</span>:</span></span><br><span class="line">        self.stops = bus.stops</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.index == len(self.stops):</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        stop = self.stops[self.index]</span><br><span class="line">        self.index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> stop</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    bus = Bus(<span class="string">'XinZhuang RailWay Station'</span>, <span class="string">'WaiHuan Road'</span>, <span class="string">'LianHua Road'</span>, <span class="string">'JinJiangLeYuan'</span>)</span><br><span class="line">    <span class="keyword">for</span> stop <span class="keyword">in</span> bus:</span><br><span class="line">        print(stop)</span><br></pre></td></tr></table></figure><ul><li><code>generator</code>: 看如下表达式，两者是等价的。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">squares</span><span class="params">(length)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">        <span class="keyword">yield</span> i*i</span><br><span class="line"></span><br><span class="line">squares = [i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure><p>用<code>yield</code>实现斐波那契数列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">()</span>:</span></span><br><span class="line">    a=b=<span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> a</span><br><span class="line">    <span class="keyword">yield</span> b</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a,b = b,a+b</span><br><span class="line">        <span class="keyword">yield</span> b</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Iterator </tag>
            
            <tag> Generator </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 之旅 - 开篇</title>
      <link href="/2017/09/09/python/python-tutorial/"/>
      <url>/2017/09/09/python/python-tutorial/</url>
      
        <content type="html"><![CDATA[<p>Python基础还是照着<a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000" target="_blank" rel="noopener">廖雪峰的教程</a>撸了一遍。<br>教程的学习路线开始太过平缓，后期直线上升很容易扯着蛋~</p><a id="more"></a><h2 id="基础-趟一遍"><a href="#基础-趟一遍" class="headerlink" title="基础(趟一遍)"></a>基础(趟一遍)</h2><p><strong>PS. Basic on python 3.5</strong> (所有源码 –&gt; <a href="https://github.com/itabas016/PythonTrip/tree/master/course_liao" target="_blank" rel="noopener">source code</a>)</p><h3 id="Func-函数"><a href="#Func-函数" class="headerlink" title="Func(函数)"></a>Func(函数)</h3><ul><li>递归函数 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/recur_func.py" target="_blank" rel="noopener">recur_func.py</a>]</li><li>Map/Reduce [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/map_reduce.py" target="_blank" rel="noopener">map_reduce.py</a>]</li><li>过滤器 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/filter.py" target="_blank" rel="noopener">filter.py</a>]</li><li>排序 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/sorted.py" target="_blank" rel="noopener">sorted.py</a>]</li><li>格式化 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/format_input.py" target="_blank" rel="noopener">format_input.py</a>]</li><li>装饰器 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/decorator.py" target="_blank" rel="noopener">decorator.py</a>]</li><li>偏函数 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/function/partial_func.py" target="_blank" rel="noopener">partial_func.py</a>]</li><li>高阶函数 - 迭代器 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/advance/ex_iterator.py" target="_blank" rel="noopener">ex_iterator.py</a>]</li><li>高阶函数 - 生成器 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/advance/ex_generator.py" target="_blank" rel="noopener">ex_generator.py</a>]</li><li>高阶函数 - 切片与列表 [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/advance/ex_slice.py" target="_blank" rel="noopener">ex_slice.py</a>, <a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/advance/ex_list.py" target="_blank" rel="noopener">ex_list.py</a>]</li></ul><h4 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h4><p>如上面的例子，装饰如果嵌套太多容易混。没有参数的装饰器比较容易理解，但是有参数的比如一个函数参数是一个返回函数然后这个函数返回结果做为参数传递给另一个函数。<code>Fun(A)(p1=Func(B)(p2=Func(C)(p3=&#39;&#39;)))</code><br>装饰器函数也可以简单理解成闭包。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">            print(<span class="string">'%s %s():'</span> % (text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure><h3 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h3><p><code>Class</code>: [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/oop/ex_element.py" target="_blank" rel="noopener">ex_element.py</a>], <code>Instance</code>: [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/oop/ex_instance.py" target="_blank" rel="noopener">ex_instance.py</a>], <code>Property</code>: [<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/oop/ex_property.py" target="_blank" rel="noopener">ex_property.py</a>]以及类的初始化，封装继承[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/oop/ex_extend.py" target="_blank" rel="noopener">ex_extend.py</a>]与多态。</p><p><strong>PS:</strong> <code>__init__</code>初始化的第一个参数永远是<code>self</code>，表示创建的实例本身。如果属性的变量名是以<code>__</code>开头，那么这是一个私有(private)变量，只允许类内部访问。如果获取一个对象的所有属性和方法，使用<code>dir()</code>函数，判断对象是哪种类型使用<code>isinstance(object, Type)</code></p><h3 id="IO-文件操作和序列化"><a href="#IO-文件操作和序列化" class="headerlink" title="IO(文件操作和序列化)"></a>IO(文件操作和序列化)</h3><p>文件操作<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/io/operation_file.py" target="_blank" rel="noopener">operation_file.py</a>, 引入<code>with</code>的好处是默认调用<code>close</code>方法，因为实现<code>try...finally</code>语句块，无论文件操作出现任何异常最后都能关闭文件操作。</p><p>序列化简单用<code>pickle</code>模块<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/io/ex_pickle.py" target="_blank" rel="noopener">ex_pickle.py</a>和<code>json</code>模块<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/io/ex_json.py" target="_blank" rel="noopener">ex_json.py</a></p><p><strong>PS:</strong> <code>pickle</code>主要用于Python特定二进制格式之间的转换，<code>json</code>对象反序列化成<code>instance</code>对象，编写转换函数(见上述例子)即可实现。后面会介绍其它的反序列化方法。</p><h3 id="Thread-线程"><a href="#Thread-线程" class="headerlink" title="Thread(线程)"></a>Thread(线程)</h3><p>首先python的多线程多适用于<code>IO</code>密集型，如果是<code>CPU</code>密集型，python的多线程不如单线程效率高。如果在<code>CPU</code>密集型中使用<code>concurrent</code>需要导入<code>multiprocessing</code>库，这个库是基于<code>multi process</code>实现了类<code>multi thread</code>的API接口，并且用<code>pickle</code>部分地实现了变量共享。</p><p>基本用法：[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/ex_thread.py" target="_blank" rel="noopener">ex_thread.py</a>]<br>进程：[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/ex_process.py" target="_blank" rel="noopener">ex_process.py</a>]<br>队列及锁：[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/ex_queue.py" target="_blank" rel="noopener">ex_queue.py</a>, <a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/ex_lock.py" target="_blank" rel="noopener">ex_lock.py</a>]<br>分布式进程：[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/task_master.py" target="_blank" rel="noopener">task_master.py</a>, <a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/thread/task_worker.py" target="_blank" rel="noopener">task_worker.py</a>]</p><h3 id="Async-异步"><a href="#Async-异步" class="headerlink" title="Async(异步)"></a>Async(异步)</h3><p>异步<code>IO</code>的核心是协程(Coroutine)，协程没有线程的安全问题，一个进程可以同时存在多个协程，但同时只有一个协程是激活的，而且协程的激活和休眠又通过程序来控制，而不是操作系统控制的。<br>并且最大的优势就是协程极高的执行效率。因为子程序切换不是线程切换，因此没有线程切换的开销，和多线程比线程数量越多，协程的性能优势就越明显。<br>第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</p><p>通常用法是多进程+协程，生产者-消费者模型：[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/async/coroutine.py" target="_blank" rel="noopener">coroutine.py</a>]</p><p><code>asynicio</code>类库是python3.4支持异步IO的标准库。教程里有两个简单例子[<a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/async/async_hello.py" target="_blank" rel="noopener">async_hello.py</a>, <a href="https://github.com/itabas016/PythonTrip/blob/master/course_liao/async/async_wget.py" target="_blank" rel="noopener">async_wget.py</a>]需要重点理解下<code>@asyncio.coroutine</code>, 另外在python3.5后引入了<code>async</code>和<code>await</code>等价于<code>@asyncio.coroutine &lt;=&gt; async</code>, <code>yield from &lt;=&gt; await</code></p><p>线程和异步这一块，看的时候就头大，后面还会再研究~</p><p>References:<br><a href="http://www.dabeaz.com/coroutines/index.html" target="_blank" rel="noopener">A Curious Course on Coroutines and Concurrency</a><br><a href="http://www.jianshu.com/p/0e4ff7c856d3" target="_blank" rel="noopener">python多线程</a><br><a href="https://www.zhihu.com/question/23474039" target="_blank" rel="noopener">为什么有人说 Python 的多线程是鸡肋呢？</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Iterator </tag>
            
            <tag> Generator </tag>
            
            <tag> Decorator </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vps开启bbr加速</title>
      <link href="/2017/08/29/vps/vps_bbr/"/>
      <url>/2017/08/29/vps/vps_bbr/</url>
      
        <content type="html"><![CDATA[<h2 id="One-Step"><a href="#One-Step" class="headerlink" title="One-Step"></a>One-Step</h2><blockquote><p>Quick installation(懒人一键安装)</p></blockquote><a id="more"></a><p><strong>PS:</strong> Requirments</p><ul><li>OS: CentOS 6+，Debian 7+，Ubuntu 12+</li><li>Virtual platform: Except OpenVZ, such as KVM, Xen, VMware etc.</li><li>Memory: ≥128M</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class="line">chmod +x bbr.sh</span><br><span class="line">./bbr.sh</span><br></pre></td></tr></table></figure><h2 id="Check-BBR"><a href="#Check-BBR" class="headerlink" title="Check-BBR"></a>Check-BBR</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check linux kernel version</span></span><br><span class="line">[root@vps<span class="_">-d</span> ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux vps<span class="_">-d</span> 4.10.4-1.el7.elrepo.x86_64 <span class="comment">#1 SMP Sat Mar 18 12:50:10 EDT 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check network info</span></span><br><span class="line">[root@vps<span class="_">-d</span> ~]<span class="comment"># sysctl net.ipv4.tcp_available_congestion_control</span></span><br><span class="line">net.ipv4.tcp_available_congestion_control = bbr cubic reno</span><br><span class="line">[root@vps<span class="_">-d</span> ~]<span class="comment"># sysctl net.ipv4.tcp_congestion_control</span></span><br><span class="line">net.ipv4.tcp_congestion_control = bbr</span><br><span class="line">[root@vps<span class="_">-d</span> ~]<span class="comment"># sysctl net.core.default_qdisc</span></span><br><span class="line">net.core.default_qdisc = fq</span><br><span class="line"></span><br><span class="line"><span class="comment"># check bbr module is load</span></span><br><span class="line">[root@vps<span class="_">-d</span> ~]<span class="comment"># lsmod | grep bbr</span></span><br><span class="line">tcp_bbr                16384  24</span><br></pre></td></tr></table></figure><p><strong>PS:</strong> If the kernel version less than 4.12, you need upgrade.</p><h2 id="Upgrade-Kernel"><a href="#Upgrade-Kernel" class="headerlink" title="Upgrade-Kernel##"></a>Upgrade-Kernel##</h2><p>Sample with CentOS 7:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add repo and install</span></span><br><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-ml kernel-ml-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># check kernel install</span></span><br><span class="line">rpm -qa | grep kernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># update grub system</span></span><br><span class="line">egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \<span class="string">'</span></span><br><span class="line"><span class="string"># default 0</span></span><br><span class="line"><span class="string"># Run by the first core(表示第一个内核设置为默认运行)</span></span><br><span class="line"><span class="string">grub2-set-default 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># restart</span></span><br><span class="line"><span class="string">reboot</span></span><br></pre></td></tr></table></figure><p>Reference: </p><p><a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AFTCP-BBR%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">开启TCP BBR拥塞控制算法</a></p><p><a href="https://teddysun.com/489.html" target="_blank" rel="noopener">一键安装最新内核并开启 BBR 脚本</a></p>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Vps </tag>
            
            <tag> Wiki </tag>
            
            <tag> Vps BBR </tag>
            
            <tag> 加速 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vps性能检测</title>
      <link href="/2017/08/27/vps/vps_performance-check/"/>
      <url>/2017/08/27/vps/vps_performance-check/</url>
      
        <content type="html"><![CDATA[<blockquote><p>折腾了两天Vps, 真可恨呢~</p></blockquote><p>几个月前挂了个hello-world在gce上, 也忘记关了. 今天一看账单扣了我60多刀, 我滴个神呢. 白花花的银子就这么没了. </p><p>可是手贱又把gcp的内存从1.7改成了0.6, 想着能省就省点吧. 鬼知道重新分配了个ip, 原来直联日本, 现在搞得要绕美国了, 延迟老高了. 哎~</p><a id="more"></a><p><img src="../../../../../screenshots/wiki/vps-trace-detail-1.png" alt="detail-trace"></p><p><img src="../../../../../screenshots/wiki/vps-trace-detail-2.png" alt="trace-gui"></p><blockquote><p>不管怎么说gcp好是好，可还是太贵了, 于是又想着以前的Bandwagon Vps内存256还是OVZ的, 反正也快到期了, 要不换一个大点内存的. 就选了个年付LA直联中国的.</p></blockquote><blockquote><p>鬼知道测试下来的指标太不满意了. 广大同胞们都把Bandwagon玩坏了. 哎~</p></blockquote><p><img src="../../../../../screenshots/wiki/vps-d-trace-detail-3.png" alt="detail-trace"></p><p><img src="../../../../../screenshots/wiki/vps-d-trace-detail-4.png" alt="trace-gui"></p><h2 id="Vps-指标"><a href="#Vps-指标" class="headerlink" title="Vps 指标"></a>Vps 指标</h2><h3 id="Bench-Detail"><a href="#Bench-Detail" class="headerlink" title="Bench Detail"></a>Bench Detail</h3><p>直接用<a href="https://teddysun.com/444.html" target="_blank" rel="noopener">秋水逸冰</a>的<a href="https://github.com/teddysun/across/blob/master/bench.sh" target="_blank" rel="noopener">bench.sh</a>脚本跑出的结果很是一般:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- bench.sh | bash</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line">curl -Lso- bench.sh | bash</span><br></pre></td></tr></table></figure><p><img src="../../../../../screenshots/wiki/vps-d-bench-detail.png" alt="bench-detail"></p><p>于是又单独查看了Cpu, Memory, Disk等各项参数, swap也没开, 硬盘读写简直了…</p><h3 id="Cpu"><a href="#Cpu" class="headerlink" title="Cpu"></a>Cpu</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo</span><br></pre></td></tr></table></figure><p><img src="../../../../../screenshots/wiki/vps-d-cpu.png" alt="vps-d-cpu"></p><h3 id="Disk-IO"><a href="#Disk-IO" class="headerlink" title="Disk IO"></a>Disk IO</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=<span class="built_in">test</span> bs=64k count=4k oflag=dsync</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=<span class="built_in">test</span> bs=8k count=256k conv=fdatasync</span><br></pre></td></tr></table></figure><p><img src="../../../../../screenshots/wiki/vps-d-io.png" alt="vps-d-io"></p><p>相比之前的vps简直差太多了, LA机房直联中国严重超售了: </p><p><img src="../../../../../screenshots/wiki/vps-io.png" alt="vps-io"></p><h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><p>首先测试vps的download和upload, <a href="https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py" target="_blank" rel="noopener">speedtest.py</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py</span><br><span class="line">chmod +x speedtest.py</span><br><span class="line">./speedtest.py</span><br></pre></td></tr></table></figure><p><img src="../../../../../screenshots/wiki/vps-d-speedtest.png" alt="vps-d-speedtest"></p><p>然后用mtr分别测试联通和电信：</p><p><img src="../../../../../screenshots/wiki/vps-d-mtr.png" alt="vps-d-mtr"></p><h3 id="Unix-Bench-Score"><a href="#Unix-Bench-Score" class="headerlink" title="Unix Bench Score"></a>Unix Bench Score</h3><p>最后用<a href="https://teddysun.com/245.html" target="_blank" rel="noopener">秋水逸冰</a>的<a href="https://github.com/teddysun/across/raw/master/unixbench.sh" target="_blank" rel="noopener">unixbench.sh</a>脚本跑分测试了一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/unixbench.sh</span><br><span class="line">chmod +x unixbench.sh</span><br><span class="line">./unixbench.sh</span><br></pre></td></tr></table></figure><p><img src="../../../../../screenshots/wiki/vps-d-unix-bench.png" alt="vps-d-unix-bench"></p><p>跑分倒还可以，只是这个磁盘读写不能让人满意. 现在倒是不知道该如何取舍了~</p>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Vps </tag>
            
            <tag> Wiki </tag>
            
            <tag> Vps Performance </tag>
            
            <tag> 性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用Google Drive备份Vps数据</title>
      <link href="/2017/08/26/tools/gdrive_backup/"/>
      <url>/2017/08/26/tools/gdrive_backup/</url>
      
        <content type="html"><![CDATA[<p>Recently, I have a plan to order a new vps service, but some data need migration and backup to google drive. So I found a tool <a href="https://github.com/prasmussen/gdrive" target="_blank" rel="noopener">gdrive</a>, Let’s begin!</p><a id="more"></a><h2 id="Install-GDrive-Client"><a href="#Install-GDrive-Client" class="headerlink" title="Install GDrive Client"></a>Install GDrive Client</h2><p>This tool can be used across multiple platform, Linux, Raspberry pi, Windows…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O https://docs.google.com/uc?id=0B3X9GlR6EmbnQ0FtZmJJUXEyRTA&amp;<span class="built_in">export</span>=download</span><br></pre></td></tr></table></figure><p><strong>PS: Find a client from <a href="https://github.com/prasmussen/gdrive#downloads" target="_blank" rel="noopener">here</a>, I used CentOS x64, select <a href="https://docs.google.com/uc?id=0B3X9GlR6EmbnQ0FtZmJJUXEyRTA&export=download" target="_blank" rel="noopener">gdrive-linux-x64 v2.1.0</a></strong></p><p>Then, executable cli script</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x gdrive</span><br></pre></td></tr></table></figure><p>And move scipt <code>mv gdrive /usr/local/bin/</code></p><h2 id="Access-Google-Token"><a href="#Access-Google-Token" class="headerlink" title="Access Google Token"></a>Access Google Token</h2><p>Run command <code>gdrive about</code>, If this is your first run gdrive command, it prompt you to link your google drive account and acess token, so copy link to any browser(Chrome) login to your account. It will return a string like <code>Enter verification code: 4/9hsRWERSTsds17gGHS12dpoSJhhslkNMsnkSk41se1gxfB</code>, this token will store <code>~/.gdrive/</code>.</p><h2 id="Backup-Data"><a href="#Backup-Data" class="headerlink" title="Backup Data"></a>Backup Data</h2><p>Totally basic on your bussiness, if you want backup database data, or your website source file or some environment configurations, all of these can be write a script to do this work.</p><p><em>Below, it’s a sample:</em></p><h3 id="Backup-Docker-Data"><a href="#Backup-Docker-Data" class="headerlink" title="Backup Docker Data"></a>Backup Docker Data</h3><p>Create a bash script <code>backup-docker.sh</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/docker/compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># stop the containers</span></span><br><span class="line">docker-compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># if you are not install p7zip, you can first run yum install p7zip, whether you can use tar command to compress</span></span><br><span class="line"><span class="comment"># zip them up encrypted (yes, the password has to be after the -p switch with no space)</span></span><br><span class="line">yum install p7zip</span><br><span class="line">7za a -t7z -mx2 -pPassword1234!@<span class="comment">#$ /tmp/docker-backup-$(date '+%Y-%m-%d').7z /var/docker/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start the containers</span></span><br><span class="line">docker-compose start</span><br><span class="line"></span><br><span class="line"><span class="comment"># upload to google drive, if you upload to parent folder must add [-p | --parent] id set</span></span><br><span class="line">gdrive upload -f /tmp/docker-backup-$(date <span class="string">'+%Y-%m-%d'</span>).7z -p 09KVkjJK83exTfkQ3cEJKFDSkjvadkdghJKDGKnRGJKVD932jkaknvKDVR28 --delete /tmp/docker-backup-$(date <span class="string">'+%Y-%m-%d'</span>).7z</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>If you use <code>tar</code> command, other part is same:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># tar the dokuwiki directory</span></span><br><span class="line">tar -zcf <span class="string">"docker-backup-<span class="variable">$(date '+%Y-%m-%d')</span>.tar.gz"</span> /var/docker/</span><br><span class="line"><span class="comment"># encrypt the tar</span></span><br><span class="line">openssl aes-256-cbc -a -salt -<span class="keyword">in</span> <span class="string">"docker-backup-<span class="variable">$(date '+%Y-%m-%d')</span>.tar.gz"</span> -out <span class="string">"docker-backup-<span class="variable">$(date '+%Y-%m-%d')</span>.tar.gz.enc"</span> -pass <span class="string">'pass:Password1234!@#$'</span></span><br></pre></td></tr></table></figure><p>Then, create a <code>crontab</code> job:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x backup-docker.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"0 1 * * * root ~/backup-docker.sh"</span> &gt;&gt; /etc/crontab</span><br></pre></td></tr></table></figure><h3 id="Backup-Database-Data"><a href="#Backup-Database-Data" class="headerlink" title="Backup Database Data"></a>Backup Database Data</h3><p>See the dump sql script(eg. use mysqldump):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dump all databases</span></span><br><span class="line">mysqldump --all-databases &gt; /tmp/dump.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># dump only specify databases</span></span><br><span class="line">mysqldump --databases blog wordpress q2a &gt; /tmp/dump.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># dump specify tables from database</span></span><br><span class="line">mysqldump blog bg_user bg_post bg_comment &gt; /tmp/dump.sql</span><br></pre></td></tr></table></figure><p>Then, compress dump file and encrypt file:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zcf /tmp/mysql-backup-$(date <span class="string">'+%Y-%m-%d'</span>).tar.gz /tmp/dump.sql</span><br><span class="line">openssl aes-256-cbc -a -salt -<span class="keyword">in</span> /tmp/mysql-backup-$(date <span class="string">'+%Y-%m-%d'</span>).tar.gz -out /tmp/mysql-backup-$(date <span class="string">'+%Y-%m-%d'</span>).tar.gz.enc -pass <span class="string">'pass:Password1234!@#$'</span></span><br></pre></td></tr></table></figure><p>In the end, run gdrive upload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdrive upload -f /tmp/mysql-backup-$(date <span class="string">'+%Y-%m-%d'</span>).tar.gz.enc -p 09KVkjJK83exTfkQ3cEJKFDSkjvadkdghJKDGKnRGJKVD932jkaknvKDVR28 --delete /tmp/mysql-backup-$(date <span class="string">'+%Y-%m-%d'</span>).tar.gz</span><br></pre></td></tr></table></figure><h2 id="Upload-File"><a href="#Upload-File" class="headerlink" title="Upload File"></a>Upload File</h2><p>From the sample, you know how to use upload command, It’s very simple, the detail command parameter see <a href="#gdrive-command">here</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdrive upload -f /var/www/html/*</span><br></pre></td></tr></table></figure><h2 id="Download-File"><a href="#Download-File" class="headerlink" title="Download File"></a>Download File</h2><p>First, run <code>gdrive list</code>, it will show GDrive file list:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Id                              Title                              Size      Created</span><br><span class="line">0B-Jkp8Bk3zNcTkQxeGxZaFRiMzA    vps-backup-2017-08-26.tar.gz.enc   55.3 MB   2017-08-26 10:36:15</span><br><span class="line">0B-Jkp8Bk3zNcMXJBQ0tUdk5XOVU    tools                              0.0 B     2017-08-26 09:21:40</span><br><span class="line">0B-Jkp8Bk3zNcQnozOWV5OFRyNWs    temp                               0.0 B     2017-08-26 09:21:25</span><br><span class="line">0B-Jkp8Bk3zNcc3RhcnRlcl9maWxl   Getting started                    1.6 MB    2016-03-30 01:48:28</span><br></pre></td></tr></table></figure><p>And then, select your file <code>Id</code> and run download command, thats it!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdrive download -i 0B-Jkp8Bk3zNcc3RhcnRlcl9maWxl</span><br></pre></td></tr></table></figure><h2 id="Share-File"><a href="#Share-File" class="headerlink" title="Share File"></a>Share File</h2><p>It’s simliar with download command <code>gdrive share -i 0B-Jkp8Bk3zNcc3RhcnRlcl9maWxl</code></p><h2 id="GDrive-Commands"><a href="#GDrive-Commands" class="headerlink" title="GDrive Commands"></a>GDrive Commands</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Usage: gdrive [global options] &lt;verb&gt; [verb options]</span><br><span class="line"></span><br><span class="line">Global options:</span><br><span class="line">        -a, --advanced     Advanced Mode -- lets you specify your own oauth client id and secret on setup</span><br><span class="line">        -c, --config       Set application path <span class="built_in">where</span> config and token is stored. Defaults to ~/.gdrive</span><br><span class="line">        -v, --version      Print version</span><br><span class="line">        -h, --<span class="built_in">help</span>         Show this <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Verbs:</span><br><span class="line">    delete:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">    download:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">            --format       Download file <span class="keyword">in</span> a specified format (needed <span class="keyword">for</span> google docs)</span><br><span class="line">        -s, --stdout       Write file content to stdout</span><br><span class="line">            --force        Overwrite existing file</span><br><span class="line">            --pop          Download latest file, and remove it from google drive</span><br><span class="line">    folder:</span><br><span class="line">        -t, --title        Folder to create (*)</span><br><span class="line">        -p, --parent       Parent Id of the folder</span><br><span class="line">            --share        Share created folder</span><br><span class="line">    info:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">            --bytes        Show size <span class="keyword">in</span> bytes</span><br><span class="line">    list:</span><br><span class="line">        -m, --max          Max results</span><br><span class="line">            --include-docs Include google docs <span class="keyword">in</span> listing</span><br><span class="line">        -t, --title        Title filter</span><br><span class="line">        -q, --query        Query (see https://developers.google.com/drive/search-parameters)</span><br><span class="line">        -s, --shared       Show shared status (Note: this will generate 1 http req per file)</span><br><span class="line">        -n, --noheader     Do not show the header</span><br><span class="line">            --bytes        Show size <span class="keyword">in</span> bytes</span><br><span class="line">    quota:</span><br><span class="line">            --bytes        Show size <span class="keyword">in</span> bytes</span><br><span class="line">    share:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">    unshare:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">    upload:</span><br><span class="line">        -f, --file         File or directory to upload (*)</span><br><span class="line">        -s, --stdin        Use stdin as file content (*)</span><br><span class="line">        -t, --title        Title to give uploaded file. Defaults to filename</span><br><span class="line">        -p, --parent       Parent Id of the file</span><br><span class="line">            --share        Share uploaded file</span><br><span class="line">            --mimetype     The MIME <span class="built_in">type</span> (default will try to figure it out)</span><br><span class="line">            --convert      File will be converted to Google Docs format</span><br><span class="line">        -C, --chunksize    Set chunk size <span class="keyword">in</span> bytes. Minimum is 262144, default is 4194304. Recommended to be a power of two.</span><br><span class="line">    url:</span><br><span class="line">        -i, --id           File Id (*)</span><br><span class="line">        -p, --preview      Generate preview url (default)</span><br><span class="line">        -d, --download     Generate download url</span><br></pre></td></tr></table></figure><p>Reference:</p><p><a href="https://timothy-quinn.com/backing-up-files-to-google-drive-via-the-cli/" target="_blank" rel="noopener">Backing up Files to Google Drive via the CLI</a></p><p><a href="http://bashworkz.com/google-drive-linux-client-upload-download-share-a-file/" target="_blank" rel="noopener">Install Gdrive Google Drive Linux Client – Upload/Download/Share a file</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Google Drive </tag>
            
            <tag> Drive </tag>
            
            <tag> Vps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git command补漏</title>
      <link href="/2017/04/08/tools/git_tips/"/>
      <url>/2017/04/08/tools/git_tips/</url>
      
        <content type="html"><![CDATA[<h2 id="Git容易忘的command"><a href="#Git容易忘的command" class="headerlink" title="Git容易忘的command"></a>Git容易忘的command</h2><a id="more"></a><h3 id="git-xxx-–bare"><a href="#git-xxx-–bare" class="headerlink" title="git xxx –bare"></a>git xxx –bare</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git init empty repo only with .git element</span></span><br><span class="line">git init --bare</span><br><span class="line"></span><br><span class="line"><span class="comment"># git clone repo with all the git related revision history</span></span><br><span class="line">git <span class="built_in">clone</span> --bare wiki wiki.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># previous step git clone with bare equals the below command</span></span><br><span class="line">cp -Rf wiki/.git wiki.git</span><br></pre></td></tr></table></figure><h3 id="git-remote-xxx"><a href="#git-remote-xxx" class="headerlink" title="git remote xxx"></a>git remote xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git remote add new repo address with specific port</span></span><br><span class="line">git remote add origin ssh://git@mydomain.com:12345/home/git/repo.git/</span><br></pre></td></tr></table></figure><h3 id="git-diff-xxx"><a href="#git-diff-xxx" class="headerlink" title="git diff xxx"></a>git diff xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  git diff [&lt;options&gt;] [&lt;commit&gt; [&lt;commit&gt;]] [--] [&lt;path&gt;...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># various ways to check working tree</span></span><br><span class="line">git diff</span><br><span class="line">git diff --cached</span><br><span class="line">git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># comparing with arbitrary commits</span></span><br><span class="line">git diff <span class="built_in">test</span></span><br><span class="line">git diff HEAD -- ./<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># comparing branches</span></span><br><span class="line">git diff xxbranch master</span><br><span class="line">git diff xxbranch..master</span><br><span class="line">git diff xxbranch...master</span><br></pre></td></tr></table></figure><h3 id="git-tag-xxx"><a href="#git-tag-xxx" class="headerlink" title="git tag xxx"></a>git tag xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create tag</span></span><br><span class="line">git tag -a v1.0 -m <span class="string">"tag message detail"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show someone tag</span></span><br><span class="line">git show v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># push local tags to origin branch</span></span><br><span class="line"><span class="comment"># just one tag</span></span><br><span class="line">git push origin v1.0</span><br><span class="line"><span class="comment"># all the local tags</span></span><br><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure><h3 id="git-merge-xxx"><a href="#git-merge-xxx" class="headerlink" title="git merge xxx"></a>git merge xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  git merge [&lt;options&gt;] [&lt;commit&gt;...]</span></span><br><span class="line"><span class="comment">#  or: git merge [&lt;options&gt;] &lt;msg&gt; HEAD &lt;commit&gt;</span></span><br><span class="line"></span><br><span class="line">git merge hotfix</span><br><span class="line">git merge fixes enhancements</span><br><span class="line">git merge --no-commit tempbranch</span><br><span class="line"></span><br><span class="line"><span class="comment"># if has conflict, use mergetool command</span></span><br><span class="line">git mergetool</span><br><span class="line">git <span class="built_in">log</span> --merge -p&lt;path&gt;</span><br><span class="line">git show :1:filename</span><br></pre></td></tr></table></figure><h3 id="git-reset-xxx"><a href="#git-reset-xxx" class="headerlink" title="git reset xxx"></a>git reset xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  git reset [--mixed | --soft | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</span></span><br><span class="line"><span class="comment">#  or: git reset [-q] &lt;tree-ish&gt; [--] &lt;paths&gt;...</span></span><br><span class="line"><span class="comment">#  or: git reset --patch [&lt;tree-ish&gt;] [--] [&lt;paths&gt;...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reset work tree to the last commit</span></span><br><span class="line">git reset --bard HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># just reset specific files</span></span><br><span class="line">git chechout -- &lt;specific.flie&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># How to fix the issue when after you commit</span></span><br><span class="line"><span class="comment"># The better way is create new commit to cover issue use revert</span></span><br><span class="line">git revert HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># if reset next-to-last commit</span></span><br><span class="line">git revert HEAD^</span><br></pre></td></tr></table></figure><h3 id="git-commit-xxx"><a href="#git-commit-xxx" class="headerlink" title="git commit xxx"></a>git commit xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -a parameter contains git add and git commit</span></span><br><span class="line">git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># -v parameter will display all the diff messages</span></span><br><span class="line">git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># --amend will use the latest commit instead before commit</span></span><br><span class="line">git commit --amend -m <span class="string">"the latest commit with forgot files"</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Git </tag>
            
            <tag> Wiki </tag>
            
            <tag> Tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH Key相关问题</title>
      <link href="/2017/04/08/tools/ssh_key/"/>
      <url>/2017/04/08/tools/ssh_key/</url>
      
        <content type="html"><![CDATA[<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>SSH Key分公钥和私钥, 私钥请自己妥善保管, 不要外泄。<br>另外采用ssh public key authentication是提升服务器安全与快捷措施之一。</p><a id="more"></a><h3 id="Generate-ssh-key"><a href="#Generate-ssh-key" class="headerlink" title="Generate ssh key"></a>Generate ssh key</h3><p>以github为例使用ssh-keygen生成相对应的key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># please make sure .ssh folder is exist</span></span><br><span class="line"><span class="built_in">cd</span> ~/</span><br><span class="line">mkdir .ssh</span><br><span class="line"><span class="built_in">cd</span> /.ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># use ssh-keygen generate key</span></span><br><span class="line"><span class="comment"># if you want sign key name please add -f parameter, default is id_rsa</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/git/.ssh/id_rsa):</span><br><span class="line"></span><br><span class="line"><span class="comment"># please input your password for private key, default is empty</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br></pre></td></tr></table></figure><h3 id="Configure-public-key-to-Server"><a href="#Configure-public-key-to-Server" class="headerlink" title="Configure public key to Server"></a>Configure public key to Server</h3><p>上传公钥到server有很多种方式了, 推荐使用<code>ssh-copy-id</code></p><ul><li><code>ssh-copy-id -i ~/.ssh/id_rsa.pub git@ip -p xx</code></li></ul><p>有可能会遇到一些问题比如说: <code>Permission denied (publickey).</code> 或者<code>bash: ssh-copy-id: command not found</code></p><p>If it’s permission problem, please check current user whether has execute privilege to <code>.ssh</code> folder</p><p>Else if you use windows command line, maybe you didn’t install this tiny script, please execute the below script:</p><p>Maybe is works, good luck for you!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET_ID=<span class="string">"cat <span class="variable">$&#123;ID_FILE&#125;</span>"</span></span><br><span class="line">&#123; <span class="built_in">eval</span> <span class="string">"<span class="variable">$GET_ID</span>"</span> ; &#125; | ssh <span class="variable">$&#123;1%:&#125;</span> <span class="string">"umask 077; test -d .ssh || mkdir .ssh ; cat &gt;&gt; .ssh/authorized_keys"</span> || <span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><ul><li><code>scp ~/.ssh/ ~/.ssh/id_rsa.pub -p xx user@ip:</code></li></ul><p>Attention please <code>:</code>, then login server execute:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">rm ~/.ssh/id_rsa.pub</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><h3 id="Keep-safe-authorized-keys"><a href="#Keep-safe-authorized-keys" class="headerlink" title="Keep safe authorized_keys"></a>Keep safe authorized_keys</h3><p>为了保证安全，您应该阻止其他用户添加新的公钥。<br>将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><h3 id="Disable-password-authentication"><a href="#Disable-password-authentication" class="headerlink" title="Disable password authentication"></a>Disable password authentication</h3><p>采用公钥登录server后, 最好禁用密码登录.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># set PasswordAuthentication value is no</span></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br><span class="line">PasswordAuthentication no</span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="comment"># restart sshd service</span></span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><h3 id="How-to-use-in-the-tool"><a href="#How-to-use-in-the-tool" class="headerlink" title="How to use in the tool"></a>How to use in the tool</h3><ul><li>使用 alias</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.bash_profile</span><br><span class="line"><span class="built_in">alias</span> ssh vps-gce =<span class="string">'ssh itabas016@xxx.xxx.xxx.xxx'</span></span><br></pre></td></tr></table></figure><ul><li>在 ssh client端import public key,这个就比较简单了。常用的客户端比如Putty, SecureCRT, XShell, Mobile client推荐JuiceSSH</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Vps </tag>
            
            <tag> Wiki </tag>
            
            <tag> SSH </tag>
            
            <tag> SSH key </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Hooks快捷使用</title>
      <link href="/2017/04/06/tools/git_hooks/"/>
      <url>/2017/04/06/tools/git_hooks/</url>
      
        <content type="html"><![CDATA[<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><p>通过git hooks快速将blog push到vps, 懒人必备。</p><a id="more"></a><h3 id="Prepare-vps"><a href="#Prepare-vps" class="headerlink" title="Prepare vps"></a>Prepare vps</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add git user and grant sudo</span></span><br><span class="line">addusr git</span><br><span class="line"></span><br><span class="line"><span class="comment"># if your OS is debian/ubuntu</span></span><br><span class="line">gpasswd -a git sudo</span><br><span class="line"></span><br><span class="line"><span class="comment"># else centos (precondition: enable wheel group have sudo privileges)</span></span><br><span class="line">usermod -aG wheel git</span><br><span class="line"></span><br><span class="line"><span class="comment"># upload your ssh key</span></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub git@ip(xxx.xxx.xxx.xxx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare git and nginx env</span></span><br><span class="line">sudo apt-get install git-core nginx</span><br></pre></td></tr></table></figure><h3 id="Configure-repo"><a href="#Configure-repo" class="headerlink" title="Configure repo"></a>Configure repo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configure git repo</span></span><br><span class="line">mkdir /home/git/wiki.git</span><br><span class="line"><span class="built_in">cd</span> /home/git/wiki.git/</span><br><span class="line">git init --bare</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure wiki site</span></span><br><span class="line">mkdir /var/www/wiki</span><br><span class="line"></span><br><span class="line"><span class="comment"># chown folder owner to git</span></span><br><span class="line">chown git:git -R /var/www/wiki</span><br></pre></td></tr></table></figure><h3 id="Configure-git-hooks"><a href="#Configure-git-hooks" class="headerlink" title="Configure git hooks"></a>Configure git hooks</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim post-receive file</span></span><br><span class="line"><span class="built_in">cd</span> /home/git/wiki.git/hooks</span><br><span class="line">vim post-receive</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">GIT_REPO=/home/git/wiki.git</span><br><span class="line">TMP_GIT_CLONE=/tmp/wiki</span><br><span class="line">PUBLIC_WWW=/var/www/wiki</span><br><span class="line">rm -rf <span class="variable">$&#123;TMP_GIT_CLONE&#125;</span></span><br><span class="line">git <span class="built_in">clone</span> <span class="variable">$GIT_REPO</span> <span class="variable">$TMP_GIT_CLONE</span></span><br><span class="line">rm -rf <span class="variable">$&#123;PUBLIC_WWW&#125;</span>/*</span><br><span class="line">cp -rf <span class="variable">$&#123;TMP_GIT_CLONE&#125;</span>/* <span class="variable">$&#123;PUBLIC_WWW&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grant execute privileges</span></span><br><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure><h3 id="Configure-nginx"><a href="#Configure-nginx" class="headerlink" title="Configure nginx"></a>Configure nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/conf.d/wiki.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen         80 ;</span><br><span class="line">  root /var/www/wiki;</span><br><span class="line">  server_name wiki.itabas.com;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/wiki_access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/wiki_error.log;</span><br><span class="line">  location ~* ^.+\.(ico|gif|jpg|jpeg|png)$ &#123;</span><br><span class="line">    root /var/www/wiki;</span><br><span class="line">    access_log   off;</span><br><span class="line">    expires      1d;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~* ^.+\.(css|js|txt|xml|swf|wav)$ &#123;</span><br><span class="line">    root /var/www/wiki;</span><br><span class="line">    access_log   off;</span><br><span class="line">    expires      10m;</span><br><span class="line">  &#125;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root /var/www/wiki;</span><br><span class="line">    <span class="keyword">if</span> (-f <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">    rewrite ^/(.*)$  /<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Restart-service"><a href="#Restart-service" class="headerlink" title="Restart service"></a>Restart service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><h3 id="Configure-blog-yml"><a href="#Configure-blog-yml" class="headerlink" title="Configure blog yml"></a>Configure blog yml</h3><p>无论你使用哪个静态博客框架, 基本上都支持一键部署, 详细参数参照<code>_config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@wiki.itabas.com:wiki.git</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
            <tag> Shortcut </tag>
            
            <tag> Git </tag>
            
            <tag> Git Hooks </tag>
            
            <tag> Wiki </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2016大事记</title>
      <link href="/2016/12/31/life/event-2016/"/>
      <url>/2016/12/31/life/event-2016/</url>
      
        <content type="html"><![CDATA[<blockquote><p>转眼间2016就结束了，这一年发生了太多的事。有些感慨就写下来做个纪念吧。</p></blockquote><a id="more"></a><h3 id="技术那点事"><a href="#技术那点事" class="headerlink" title="技术那点事"></a>技术那点事</h3><blockquote><p>我是一个容易冲动的人，经常会冒出来一些奇怪的想法。但是随着时间的增长，如果现在不去做将来可能就没有机会再去做了。<br>简单盘点一下：</p></blockquote><blockquote><ul><li><strong>我与RaspberryPi</strong><br>搭建自己的NAS server, 共享硬盘的文件云，虽然中间断断续续碰到了好多的小插曲，所用的技术可能不是当下最新潮的，诸如外网穿透、云端下载、自建VPN, WebServer, GitServer, FileServer, 但是学习了很多。</li><li><strong>我与Vps</strong><br>这个梯子15年的时候就买了，当时脑袋还一热，还买了域名，可就一直放着了，太懒了什么都没弄。后来有了些时间，又想折腾一下，到目前为止仍然没有发挥最大的作用，明年继续搞起。<br>准备让webServer实现HTTPS, 空闲的硬盘想写个Spider script爬些资源, 有时间可以再搞一个梯子流量的后台系统。并且现在由Hexo驱动的blog是GitHub在托管，还没有想好是不是hook到Vps上，目前WordPress blog server快搭完了。</li><li><strong>我与Web负载均衡</strong><br>可以说是工作原因才能接触到HAProxy, 虽然会用Nginx做反向代理和负载均衡，但是时间久了还得要重新拾起来，顺便一起温故了一遍。</li><li><strong>我与Python</strong><br>说起Python就很惭愧，入门很简单，可断断续续写了那么多小脚本，可还是只会一些皮毛，没做过实战，很多项目因为偷懒，Python不熟又怕遇到问题，所以都直接用C#解决了。明年一定要朝这个方向继续努力！！！做一个真正的pythoner~</li><li><strong>我与.NetCore</strong><br>这是一个没有完成的任务，虽然是自学的.Net开发，因为windows平台开发的局限性，起初想转Java，毕竟还是很相似的。但如今.NetCore横空出世，我相信搞定这个以后跨平台开发游刃有余~</li><li><strong>我与AngularJS</strong><br>可以说这也是工作的原因，新项目用到了AngularJS并且还是比较坑的1.x，但是就自己而言，JavaScript根本是一窍不通，还有Css, 通过项目算是入门了，后面会后续自学下其它的框架吧，当前最火的React还有Vue, 还有一批数不胜数的小众框架~</li><li><strong>我与Hexo</strong><br>Blog系统这是一直想搞好久的东西了，一直懒得要死，碰到点问题就搁那了，可以说这是一块心病了。本来我就比较喜欢记录自己的一些事情，杂七杂八的地方，东一点西一点。后来凡是技术相关的全都用Evernote来维护了，虽然Hexo前几年就知道了说静态博客多么的轻，多么的火，那会又沉迷于游戏哪有这个功夫折腾这个，哎~<br>现在Hexo驱动的blog就做技术博客，有机会可以尝试下Jekyll还有Simiki。虽然WordPress很冗余，但是没有真正上手过，现在正通过Vps做这件事~</li><li><strong>我与CI</strong><br>也是因为入坑前端，才了解了除了TeamCity还有Travis, Appveyor, Circle等CI管理工具，公司的CI是用的企业版TeamCity, 断断续续的把自己的几个项目都搞了下，自我感觉还不错~</li><li><strong>我与Redis</strong><br>Nosql接触的倒是蛮早的，差不多12 13年，那会只是用来做缓存，并且还不是很精通，当然Memcached完全可以替代Redis，但是到后来的项目一些新的需求才意识到redis的真正强大和便捷之处。并且最早的时候用的是2.3.x的版本，目前4.x的版本都已快release, 一些新的功能都不怎么了解，诸如集群，主从互备，哨兵模式…所以技术真是学到老，用到老。</li><li><strong>我与DBA</strong><br>可以说开发者一直会与database打交道，但是距离真正的DBA真是相差太多，因team变动, 工作JD转变为Engineer&amp;DBA当然这是一件好事，对于目前的自己，这一块也正是自己欠缺的一大部分，明年撸起袖子，为自己的全栈之行铺平道路~</li></ul></blockquote><h3 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h3><blockquote><ul><li><strong>Stack Skills</strong> - tutorialspoint<br>Next step follow: Python, Golang, Flask, React, Docker…</li><li><strong>.Net Core</strong> - zablo<br>Such of APIs: life, post, song, task…</li><li><strong>Public WeChat ID</strong><br>Add new solution, like a robot, example - ItChat<br>And mainly source part from spider or web API.</li><li><strong>Framework</strong> - onepiece<br>Next step want to support .net core, and make a demo blog system base on this.</li><li><strong>Spider</strong> - scrapy-examples<br>Crawl data such as douban, zhihu and collect to rasp or vps.</li><li><strong>Pythonic</strong> - pythontrip<br>Have a algorithm trip on leecode</li></ul></blockquote><h3 id="我的生活"><a href="#我的生活" class="headerlink" title="我的生活"></a>我的生活</h3><blockquote><p>幸好年初去南非的出差搁浅，外面太乱不想出去<br>去livehouse看了李志的巡演<br>木吉他有所小成，准备入坑指弹<br>太湖迷笛，迷上了rock<br>谈了对象，最后吹了~<br>嘉盛外汇爆仓，错过了英镑黑天鹅<br>开始了上海交大继续深造<br>里约奥运会基本看满了游泳和羽毛球赛事，明年想学会游泳<br>合租换了两个室友，找新房客真是一件麻烦的事<br>东海音乐节没去成，遗憾<br>追完了GameOfTheThrone共 7 seasons<br>迷上了桶哥, Buckethead the king of guitar solo<br>English learning<br>人生第一次大病，左耳差点废掉，还没有改掉熬夜的坏习惯<br>黄山之行搁浅<br>今年入的装备 - XboxOne,Nexus6P,AKG K450,Filco,VT-10DGX</p></blockquote><blockquote><p>Contribution -  </p><blockquote><p>A day 10000 steps, A week 3 times running, A week 2 times badminton<br>Totally 11 times cut hair by myself this year<br>Just one time Midi Festival and frist time camping<br>3 times livehouse concert by favioute singers<br>guitar cover 20 songs<br>first archery</p></blockquote></blockquote><blockquote><p>Plan - </p><blockquote><p>Climbing or hiking each 2-3 months in 2-3 years<br>口琴/手鼓<br>MBP?</p></blockquote></blockquote>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Session, Users, Profiles Management</title>
      <link href="/2016/12/20/database/oralce-script-maintaince/"/>
      <url>/2016/12/20/database/oralce-script-maintaince/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This article is about oracle daily maintaince, mainly contains <code>dba_users</code>, <code>v$session</code> and <code>dba_profiles</code> the three parts.</p></blockquote><a id="more"></a><h3 id="Manage-oracle-users"><a href="#Manage-oracle-users" class="headerlink" title="Manage oracle users"></a>Manage oracle users</h3><blockquote><p>Each Oracle database has a list of valid database users. To access a database, a user must run a database application and connect to the database instance using a valid user name defined in the database.</p></blockquote><blockquote><p>See the below example:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">DEFINE USERNAME = 'BD_ROGER'</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop user completely</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> &amp;USERNAME <span class="keyword">CASCADE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create user completely</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &amp;USERNAME</span><br><span class="line">  <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> &amp;USERNAME</span><br><span class="line">  <span class="keyword">DEFAULT</span> <span class="keyword">TABLESPACE</span> DATAUSR</span><br><span class="line">  <span class="keyword">TEMPORARY</span> <span class="keyword">TABLESPACE</span> TEMP</span><br><span class="line">  PROFILE <span class="keyword">DEFAULT</span></span><br><span class="line">  <span class="keyword">ACCOUNT</span> <span class="keyword">UNLOCK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 Roles for &amp;USERNAME </span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">RESOURCE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CONNECT</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &amp;USERNAME <span class="keyword">DEFAULT</span> <span class="keyword">ROLE</span> <span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 12 System Privileges for &amp;USERNAME </span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ANY</span> <span class="keyword">INDEX</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">LOCK</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ANY</span> <span class="keyword">TRIGGER</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> MANAGE <span class="keyword">TABLESPACE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UNLIMITED</span> <span class="keyword">TABLESPACE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> JOB <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">DROP</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALTER</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2 Object Privileges for &amp;USERNAME </span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">ON</span> SYS.DBMS_CRYPTO <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">ON</span> SYS.DBMS_REDEFINITION <span class="keyword">TO</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">on</span> DBMS_AQADM <span class="keyword">to</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">on</span> DBMS_AQ <span class="keyword">to</span> &amp;USERNAME;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">to</span> &amp;USERNAME;</span><br></pre></td></tr></table></figure><h3 id="Users-and-Profiles-overview"><a href="#Users-and-Profiles-overview" class="headerlink" title="Users and Profiles overview"></a>Users and Profiles overview</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TABLE NAME DESCRIPTION</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">DBA_USERSDescribes all users of the database</span><br><span class="line">ALL_USERSLists users visible to the current user, but does not describe them</span><br><span class="line">USER_USERSDescribes only the current user</span><br><span class="line">DBA_TS_QUOTAS/USER_TS_QUOTASDescribes tablespace quotas for users</span><br><span class="line">USER_PASSWORD_LIMITSDescribes the password profile parameters that are assigned to the user</span><br><span class="line">USER_RESOURCE_LIMITSDisplays the resource limits for the current user</span><br><span class="line">DBA_PROFILESDisplays all profiles and their limits</span><br><span class="line">RESOURCE_COSTLists the cost for each resource</span><br><span class="line">V$SESSIONLists session information for each current session, includes user name</span><br><span class="line">V$SESSTATLists user session statistics</span><br><span class="line">V$STATNAMEDisplays decoded statistic names for the statistics shown in the V$SESSTAT view</span><br><span class="line">PROXY_USERSDescribes users who can assume the identity of other users</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--list all users with account status and profile</span></span><br><span class="line"><span class="keyword">SELECT</span> USERNAME, PROFILE, ACCOUNT_STATUS <span class="keyword">FROM</span> DBA_USERS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- list expired user and combine sql to execute</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">'alter user '</span> || username || <span class="string">' identified by '</span> || username || <span class="string">' account unlock;'</span> </span><br><span class="line"><span class="keyword">from</span> dba_users </span><br><span class="line"><span class="keyword">where</span> account_status <span class="keyword">like</span> <span class="string">'%EXPIRED%'</span> <span class="keyword">and</span> Username <span class="keyword">like</span> <span class="string">'%ROGER'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- list currently database profiles</span></span><br><span class="line"><span class="keyword">select</span> profile, resource_name, resource_type, <span class="keyword">limit</span> <span class="keyword">from</span> dba_profiles;</span><br><span class="line"></span><br><span class="line">PROFILE RESOURCE NAMETYPE LIMIT</span><br><span class="line"><span class="comment">---------------------------------------------------</span></span><br><span class="line">DEFAULTCOMPOSITE_LIMITKERNELUNLIMITED</span><br><span class="line">DEFAULTSESSIONS_PER_USERKERNELUNLIMITED</span><br><span class="line">DEFAULTCPU_PER_SESSIONKERNELUNLIMITED</span><br><span class="line">DEFAULTCPU_PER_CALLKERNELUNLIMITED</span><br><span class="line">DEFAULTLOGICAL_READS_PER_SESSIONKERNELUNLIMITED</span><br><span class="line">DEFAULTLOGICAL_READS_PER_CALLKERNELUNLIMITED</span><br><span class="line">DEFAULTIDLE_TIMEKERNELUNLIMITED</span><br><span class="line">DEFAULTCONNECT_TIMEKERNELUNLIMITED</span><br><span class="line">DEFAULTPRIVATE_SGAKERNELUNLIMITED</span><br><span class="line">DEFAULTFAILED_LOGIN_ATTEMPTSPASSWORD10</span><br><span class="line">DEFAULTPASSWORD_LIFE_TIMEPASSWORDUNLIMITED</span><br><span class="line">DEFAULTPASSWORD_REUSE_TIMEPASSWORDUNLIMITED</span><br><span class="line">DEFAULTPASSWORD_REUSE_MAXPASSWORDUNLIMITED</span><br><span class="line">DEFAULTPASSWORD_VERIFY_FUNCTIONPASSWORDNULL</span><br><span class="line">DEFAULTPASSWORD_LOCK_TIMEPASSWORD1</span><br><span class="line">DEFAULTPASSWORD_GRACE_TIMEPASSWORD7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- PS. EXPIRED(GRACE) - 宽限期限已过期</span></span><br><span class="line"><span class="comment">-- modify profile password never expired</span></span><br><span class="line"><span class="keyword">ALTER</span> PROFILE <span class="keyword">DEFAULT</span> <span class="keyword">LIMIT</span> PASSWORD_LIFE_TIME <span class="keyword">UNLIMITED</span>;</span><br></pre></td></tr></table></figure><blockquote><p>see the example:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Profile Resource Limits</span></span><br><span class="line"><span class="keyword">CREATE</span> PROFILE app_user <span class="keyword">LIMIT</span> </span><br><span class="line">   <span class="keyword">SESSIONS_PER_USER</span>          <span class="keyword">UNLIMITED</span> </span><br><span class="line">   <span class="keyword">CPU_PER_SESSION</span>            <span class="keyword">UNLIMITED</span> </span><br><span class="line">   <span class="keyword">CPU_PER_CALL</span>               <span class="number">3000</span> </span><br><span class="line">   <span class="keyword">CONNECT_TIME</span>               <span class="number">45</span> </span><br><span class="line">   LOGICAL_READS_PER_SESSION  <span class="keyword">DEFAULT</span> </span><br><span class="line">   <span class="keyword">LOGICAL_READS_PER_CALL</span>     <span class="number">1000</span> </span><br><span class="line">   <span class="keyword">PRIVATE_SGA</span>                <span class="number">15</span>K</span><br><span class="line">   <span class="keyword">COMPOSITE_LIMIT</span>            <span class="number">5000000</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Profile Password Limits</span></span><br><span class="line"><span class="keyword">CREATE</span> PROFILE app_user2 <span class="keyword">LIMIT</span></span><br><span class="line">   <span class="keyword">FAILED_LOGIN_ATTEMPTS</span> <span class="number">5</span></span><br><span class="line">   PASSWORD_LIFE_TIME <span class="number">60</span></span><br><span class="line">   <span class="keyword">PASSWORD_REUSE_TIME</span> <span class="number">60</span></span><br><span class="line">   <span class="keyword">PASSWORD_REUSE_MAX</span> <span class="number">5</span></span><br><span class="line">   <span class="keyword">PASSWORD_VERIFY_FUNCTION</span> verify_function</span><br><span class="line">   <span class="keyword">PASSWORD_LOCK_TIME</span> <span class="number">1</span>/<span class="number">24</span></span><br><span class="line">   <span class="keyword">PASSWORD_GRACE_TIME</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- list all session with status, os run user, machine name, and which program</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sid</span>, <span class="built_in">serial</span><span class="comment">#, username, status, osuser, machine, program, module  from v$session;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- kill session by sid &amp; serial# value</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">KILL</span> <span class="keyword">SESSION</span> <span class="string">'6, 16409'</span> <span class="keyword">IMMEDIATE</span>;</span><br></pre></td></tr></table></figure><h3 id="Privilege-and-Role-overview"><a href="#Privilege-and-Role-overview" class="headerlink" title="Privilege and Role overview"></a>Privilege and Role overview</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Table Name - Description</span></span><br><span class="line"></span><br><span class="line">DBA_COL_PRIVS</span><br><span class="line">ALL_COL_PRIVS</span><br><span class="line">USER_COL_PRIVS</span><br><span class="line"><span class="comment"># DBA view describes all column object grants in the database. </span></span><br><span class="line"><span class="comment"># ALL view describes all column object grants for which the current user or PUBLIC is the object owner, grantor, or grantee. # USER view describes column object grants for which the current user is the object owner, grantor, or grantee.</span></span><br><span class="line"></span><br><span class="line">ALL_COL_PRIVS_MADE</span><br><span class="line">USER_COL_PRIVS_MADE</span><br><span class="line"><span class="comment"># ALL view lists column object grants for which the current user is object owner or grantor. </span></span><br><span class="line"><span class="comment"># USER view describes column object grants for which the current user is the grantor.</span></span><br><span class="line"></span><br><span class="line">ALL_COL_PRIVS_RECD</span><br><span class="line">USER_COL_PRIVS_RECD</span><br><span class="line"><span class="comment"># ALL view describes column object grants for which the current user or PUBLIC is the grantee. </span></span><br><span class="line"><span class="comment"># USER view describes column object grants for which the current user is the grantee.</span></span><br><span class="line"></span><br><span class="line">DBA_TAB_PRIVS</span><br><span class="line">ALL_TAB_PRIVS</span><br><span class="line">USER_TAB_PRIVS</span><br><span class="line"><span class="comment"># DBA view lists all grants on all objects in the database. </span></span><br><span class="line"><span class="comment"># ALL view lists the grants on objects where the user or PUBLIC is the grantee. </span></span><br><span class="line"><span class="comment"># USER view lists grants on all objects where the current user is the grantee.</span></span><br><span class="line"></span><br><span class="line">ALL_TAB_PRIVS_MADE</span><br><span class="line">USER_TAB_PRIVS_MADE</span><br><span class="line"><span class="comment"># ALL view lists the all object grants made by the current user or made on the objects owned by the current user. </span></span><br><span class="line"><span class="comment"># USER view lists grants on all objects owned by the current user.</span></span><br><span class="line"></span><br><span class="line">ALL_TAB_PRIVS_RECD</span><br><span class="line">USER_TAB_PRIVS_RECD</span><br><span class="line"><span class="comment"># ALL view lists object grants for which the user or PUBLIC is the grantee. </span></span><br><span class="line"><span class="comment"># USER view lists object grants for which the current user is the grantee.</span></span><br><span class="line"></span><br><span class="line">DBA_ROLES</span><br><span class="line"><span class="comment"># This view lists all roles that exist in the database.</span></span><br><span class="line"></span><br><span class="line">DBA_ROLE_PRIVS</span><br><span class="line">USER_ROLE_PRIVS</span><br><span class="line"><span class="comment"># DBA view lists roles granted to users and roles. </span></span><br><span class="line"><span class="comment"># USER view lists roles granted to the current user.</span></span><br><span class="line"></span><br><span class="line">DBA_SYS_PRIVS</span><br><span class="line">USER_SYS_PRIVS</span><br><span class="line"><span class="comment"># DBA view lists system privileges granted to users and roles. </span></span><br><span class="line"><span class="comment"># USER view lists system privileges granted to the current user.</span></span><br><span class="line"></span><br><span class="line">ROLE_ROLE_PRIVS</span><br><span class="line"><span class="comment"># This view describes roles granted to other roles. </span></span><br><span class="line"><span class="comment"># Information is provided only about roles to which the user has access.</span></span><br><span class="line"></span><br><span class="line">ROLE_SYS_PRIVS</span><br><span class="line"><span class="comment"># This view contains information about system privileges granted to roles. </span></span><br><span class="line"><span class="comment"># Information is provided only about roles to which the user has access.</span></span><br><span class="line"></span><br><span class="line">ROLE_TAB_PRIVS</span><br><span class="line"><span class="comment"># This view contains information about object privileges granted to roles. </span></span><br><span class="line"><span class="comment"># Information is provided only about roles to which the user has access.</span></span><br><span class="line"></span><br><span class="line">SESSION_PRIVS</span><br><span class="line"><span class="comment"># This view lists the privileges that are currently enabled for the user.</span></span><br><span class="line"></span><br><span class="line">SESSION_ROLES</span><br><span class="line"><span class="comment"># This view lists the roles that are currently enabled to the user.</span></span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://kannan-oracle.blogspot.com/2012/06/how-to-show-user-profile-and-change-its.html" target="_blank" rel="noopener">http://kannan-oracle.blogspot.com/2012/06/how-to-show-user-profile-and-change-its.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DataBase </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Restore Point &amp; Flash Back</title>
      <link href="/2016/12/12/database/oracle-script-restore-point-flash-back/"/>
      <url>/2016/12/12/database/oracle-script-restore-point-flash-back/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Sometimes, varity business data need create restore point for differ performance test. So how to manange restore point and how to flashback, see the below -&gt;</p></blockquote><a id="more"></a><h3 id="Restore-Point"><a href="#Restore-Point" class="headerlink" title="Restore Point"></a>Restore Point</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Login sqlplus use sysdba</span></span><br><span class="line">Sqlplus / as sysdba</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--list all restore points:</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>, <span class="keyword">SCN</span>, <span class="built_in">TIME</span>, DATABASE_INCARNATION<span class="comment">#, GUARANTEE_FLASHBACK_DATABASE, STORAGE_SIZE </span></span><br><span class="line"><span class="keyword">FROM</span> V$RESTORE_POINT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- also simple syntax</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">scn</span>, GUARANTEE_FLASHBACK_DATABASE,<span class="built_in">TIME</span>,<span class="keyword">name</span> <span class="keyword">from</span> v$restore_point;</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop old restore point:</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">RESTORE</span> POINT ICC_20160824;</span><br><span class="line"></span><br><span class="line"><span class="comment">--create new restore point:</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">RESTORE</span> POINT ICC_20160830 <span class="keyword">GUARANTEE</span> <span class="keyword">FLASHBACK</span> <span class="keyword">DATABASE</span>;</span><br></pre></td></tr></table></figure><h3 id="Flash-Back"><a href="#Flash-Back" class="headerlink" title="Flash Back"></a>Flash Back</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- flashback.sql</span></span><br><span class="line"></span><br><span class="line">spool flashback.log</span><br><span class="line">startup mount;</span><br><span class="line">flashback database to <span class="keyword">restore</span> point <span class="string">"ICC_20161014"</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">open</span> <span class="keyword">resetlogs</span>;</span><br><span class="line">spool off</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># file name: flashback.sh</span></span><br><span class="line"><span class="comment"># author: itabas</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">ORACLE_UNQNAME=perfcli</span><br><span class="line">ORACLE_SID=perfcli2</span><br><span class="line"><span class="built_in">echo</span> stopping RAC database</span><br><span class="line">srvctl stop database -d perfcli</span><br><span class="line">srvctl status database -d perfcli</span><br><span class="line">rm -f flashback.log</span><br><span class="line"><span class="built_in">echo</span> starting sqlplus</span><br><span class="line">sqlplus <span class="string">"/ as sysdba"</span> @flashback.sql</span><br><span class="line">cat flashback.log</span><br><span class="line">srvctl start instance -d perfcli -i <span class="string">"perfcli1"</span></span><br><span class="line">srvctl status database -d perfcli</span><br><span class="line"><span class="built_in">echo</span> stopping  oracle services</span><br><span class="line">srvctl stop service -d perfcli</span><br><span class="line"><span class="built_in">echo</span> starting oracle services</span><br><span class="line">srvctl start service -d perfcli</span><br><span class="line">srvctl status service -d perfcli</span><br></pre></td></tr></table></figure><blockquote><p>Of course, if your oracle is ASM cluster, maybe have many instances, just modify related instance script, will be all right.</p></blockquote><h4 id="other-node-example"><a href="#other-node-example" class="headerlink" title="other node example"></a>other node example</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># file name: flashback.sh</span></span><br><span class="line"><span class="comment"># author: itabas</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Node1:</span></span><br><span class="line">ORACLE_UNQNAME=perfcdb</span><br><span class="line">ORACLE_SID=perfcdb1</span><br><span class="line"><span class="built_in">echo</span> `date`</span><br><span class="line"><span class="built_in">echo</span> stopping RAC database</span><br><span class="line">srvctl stop database -d perfcdb</span><br><span class="line">srvctl status database -d perfcdb</span><br><span class="line">rm -f flashback.log</span><br><span class="line"><span class="built_in">echo</span> starting sqlplus</span><br><span class="line">sqlplus <span class="string">"/ as sysdba"</span> @flashback.sql</span><br><span class="line">cat flashback.log</span><br><span class="line"><span class="built_in">echo</span> starting instance 2</span><br><span class="line">srvctl start instance -d perfcdb -i <span class="string">"perfcdb2"</span></span><br><span class="line">srvctl status database -d perfcdb</span><br><span class="line"><span class="built_in">echo</span> stopping  oracle services</span><br><span class="line">srvctl stop service -d perfcdb</span><br><span class="line"><span class="built_in">echo</span> starting oracle services</span><br><span class="line">srvctl start service -d perfcdb</span><br><span class="line">srvctl status service -d perfcdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Node2:</span></span><br><span class="line">ORACLE_UNQNAME=perfcdb</span><br><span class="line">ORACLE_SID=perfcdb2</span><br><span class="line"><span class="built_in">echo</span> stopping RAC database</span><br><span class="line">srvctl stop database -d perfcdb</span><br><span class="line">srvctl status database -d perfcdb</span><br><span class="line">rm -f flashback.log</span><br><span class="line"><span class="built_in">echo</span> starting sqlplus</span><br><span class="line">sqlplus <span class="string">"/ as sysdba"</span> @flashback.sql</span><br><span class="line">cat flashback.log</span><br><span class="line">srvctl start instance -d perfcdb -i <span class="string">"perfcdb1"</span></span><br><span class="line">srvctl status database -d perfcdb</span><br><span class="line"><span class="built_in">echo</span> stopping  oracle services</span><br><span class="line">srvctl stop service -d perfcdb</span><br><span class="line"><span class="built_in">echo</span> starting oracle services</span><br><span class="line">srvctl start service -d perfcdb</span><br><span class="line">srvctl status service -d perfcdb</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> Script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - ILM</title>
      <link href="/2016/11/09/database/oracle-kt-ilm/"/>
      <url>/2016/11/09/database/oracle-kt-ilm/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>ILM</code> is mean Information Lifecycle Management. It’s practice of applying policies for effective management of information throughout its useful life.</p></blockquote><blockquote><p><strong>Implementing ILM Using Oracle Database</strong><br>The offical documentation see <strong><a href="https://docs.oracle.com/cd/B28359_01/server.111/b32024/part_lifecycle.htm" target="_blank" rel="noopener">here</a></strong></p></blockquote><a id="more"></a><blockquote><p>And mainly four steps:</p></blockquote><blockquote><ul><li><code>Define the Data Classes</code></li><li><code>Create Storage Tiers for the Data Classes</code></li><li><code>Create Data Access and Migration Policies</code></li><li><code>Define and Enforce Compliance Policies</code></li></ul></blockquote><blockquote><p>In fact, in our production, I need to handle a unpartition table to <code>ILM</code>, so I should <code>archive data</code> and <code>create partition</code> and <code>add customize policy</code>.<br>See the below steps:</p></blockquote><h3 id="Archive-Database"><a href="#Archive-Database" class="headerlink" title="Archive Database"></a>Archive Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@IBSArch.par</span><br><span class="line"><span class="keyword">set</span> serveroutput <span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">verify</span> <span class="keyword">off</span>;</span><br><span class="line"></span><br><span class="line">spool IBSArchive.log</span><br><span class="line"></span><br><span class="line">prompt</span><br><span class="line">prompt Attempting to <span class="keyword">create</span> the <span class="keyword">user</span> used <span class="keyword">for</span> <span class="keyword">archived</span> <span class="keyword">data</span> ....</span><br><span class="line">@@scripts/createarchuser</span><br><span class="line"></span><br><span class="line"><span class="keyword">prompt</span></span><br><span class="line"><span class="keyword">prompt</span> <span class="keyword">Create</span> objects <span class="keyword">in</span> BD <span class="keyword">schema</span></span><br><span class="line">@@scripts/createBDobjects</span><br><span class="line"></span><br><span class="line"><span class="keyword">prompt</span></span><br><span class="line"><span class="keyword">prompt</span> Attempting <span class="keyword">to</span> <span class="keyword">create</span> <span class="keyword">private</span> synonyms <span class="keyword">for</span> BD <span class="keyword">database</span> objects <span class="keyword">in</span> the arch <span class="keyword">schema</span></span><br><span class="line">@@scripts/createsynonyms</span><br><span class="line"></span><br><span class="line"><span class="keyword">prompt</span></span><br><span class="line"><span class="keyword">prompt</span> Attempting <span class="keyword">to</span> <span class="keyword">add</span> <span class="keyword">new</span> DSN <span class="keyword">for</span> <span class="keyword">archived</span> <span class="keyword">data</span></span><br><span class="line"><span class="comment">--create new DSN for archived data</span></span><br><span class="line">@@scripts/createDSN</span><br><span class="line"></span><br><span class="line"><span class="keyword">prompt</span></span><br><span class="line"><span class="keyword">prompt</span> Attempting <span class="keyword">to</span> <span class="keyword">create</span> a scheduler job <span class="keyword">to</span> run the partitioning <span class="keyword">of</span> Businessdata</span><br><span class="line"><span class="comment">--create new DSN for archived data</span></span><br><span class="line">@@scripts/createPartitionJob</span><br><span class="line"></span><br><span class="line">spool <span class="keyword">off</span>;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure><h3 id="VPD-Virtual-Private-Database"><a href="#VPD-Virtual-Private-Database" class="headerlink" title="VPD - Virtual Private Database"></a>VPD - Virtual Private Database</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@IBSArch.par</span><br><span class="line"><span class="keyword">set</span> serveroutput <span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">verify</span> <span class="keyword">off</span>;</span><br><span class="line"></span><br><span class="line">spool IBSVPD.log</span><br><span class="line"></span><br><span class="line">prompt</span><br><span class="line">prompt Attempting to <span class="keyword">create</span> the VPD <span class="keyword">profiles</span></span><br><span class="line">@@scripts/createvpdprofiles</span><br></pre></td></tr></table></figure><blockquote><p>These resource files see <a href="https://github.com/itabas016/ilm-script" target="_blank" rel="noopener">here</a>.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Materialized View</title>
      <link href="/2016/11/09/database/oracle-kt-materialized-view/"/>
      <url>/2016/11/09/database/oracle-kt-materialized-view/</url>
      
        <content type="html"><![CDATA[<blockquote><p>A <code>materialized view</code>, or <code>snapshot</code> as they were previously known, is a table segment whose contents are periodically refreshed based on a query, either against a local or remote table. Using materialized views against remote tables is the simplest way to achieve replication of data between sites.</p></blockquote><a id="more"></a><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><blockquote><p>Oracle uses <code>materialized views</code> (also known as <strong>snapshots</strong> in prior releases) to replicate data to non-master sites in a replication environment and to cache <strong>expensive queries</strong> in a data warehouse environment. </p></blockquote><blockquote><p>A <code>materialized view</code> is a replica of a target master from a <strong>single point</strong> in time. The master can be either a master table at a master site or a master materialized view at a materialized view site. Whereas in multi-master replication tables are continuously updated by other master sites, materialized views are updated from one or more masters through individual batch updates, known as a refreshes, from a single master site or master materialized view site.<br><img src="/../../../../ref/oracle-mv-view.png" alt="oracle-mv-view.png"></p></blockquote><h3 id="Create-Materialized-View"><a href="#Create-Materialized-View" class="headerlink" title="Create Materialized View"></a>Create Materialized View</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Master Database Site</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DBA_MVIEW_LOGS <span class="keyword">WHERE</span> <span class="keyword">MASTER</span>=<span class="string">'&lt;BASE TABLE NAME&gt;'</span>,</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">LOG</span> <span class="keyword">ON</span> &lt;BASE <span class="keyword">TABLE</span>&gt; <span class="keyword">TABLESPACE</span> &lt;<span class="keyword">TABLESPACE</span> <span class="keyword">NAME</span>&gt; <span class="keyword">WITH</span> &lt;PRIMARY <span class="keyword">KEY</span>&gt;/&lt;<span class="keyword">ROWID</span>&gt;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">LOG</span> <span class="keyword">ON</span> &lt;<span class="keyword">Schema</span>&gt;.&lt;Table_Name&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MView Database Site</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> &lt;<span class="keyword">NAME</span>&gt; <span class="keyword">CONNECT</span> <span class="keyword">TO</span> &lt;<span class="keyword">Master</span> DB <span class="keyword">Schema</span> <span class="keyword">Name</span>&gt; </span><br><span class="line"><span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> &lt; <span class="keyword">Master</span> DB <span class="keyword">Schema</span> <span class="keyword">Password</span>&gt; <span class="keyword">USING</span> <span class="string">'&lt;Master DB TNS&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="string">"USERNAME"</span>.<span class="string">"MVIEW_NAME"</span></span><br><span class="line"><span class="keyword">ORGANIZATION</span> <span class="keyword">HEAP</span> PCTFREE <span class="number">10</span> <span class="keyword">PCTUSED</span> <span class="number">0</span> <span class="keyword">INITRANS</span> <span class="number">2</span> <span class="keyword">MAXTRANS</span> <span class="number">255</span> <span class="keyword">NOCOMPRESS</span> NOLOGGING</span><br><span class="line"><span class="keyword">STORAGE</span>(<span class="keyword">INITIAL</span> <span class="number">1048576</span> <span class="keyword">NEXT</span> <span class="number">1048576</span> <span class="keyword">MINEXTENTS</span> <span class="number">1</span> <span class="keyword">MAXEXTENTS</span> <span class="number">2147483645</span></span><br><span class="line"><span class="keyword">PCTINCREASE</span> <span class="number">0</span> <span class="keyword">FREELISTS</span> <span class="number">1</span> <span class="keyword">FREELIST</span> <span class="keyword">GROUPS</span> <span class="number">1</span> <span class="keyword">BUFFER_POOL</span> <span class="keyword">DEFAULT</span>)</span><br><span class="line"><span class="keyword">TABLESPACE</span> <span class="string">"&lt;Tablespace Name&gt;"</span></span><br><span class="line"><span class="keyword">BUILD</span> <span class="keyword">IMMEDIATE</span></span><br><span class="line"><span class="keyword">USING</span> <span class="keyword">INDEX</span> PCTFREE <span class="number">10</span> <span class="keyword">INITRANS</span> <span class="number">2</span> <span class="keyword">MAXTRANS</span> <span class="number">255</span></span><br><span class="line"><span class="keyword">STORAGE</span>(<span class="keyword">INITIAL</span> <span class="number">1048576</span> <span class="keyword">NEXT</span> <span class="number">1048576</span> <span class="keyword">MINEXTENTS</span> <span class="number">1</span> <span class="keyword">MAXEXTENTS</span> <span class="number">2147483645</span></span><br><span class="line"><span class="keyword">PCTINCREASE</span> <span class="number">0</span> <span class="keyword">FREELISTS</span> <span class="number">1</span> <span class="keyword">FREELIST</span> <span class="keyword">GROUPS</span> <span class="number">1</span> <span class="keyword">BUFFER_POOL</span> <span class="keyword">DEFAULT</span>)</span><br><span class="line"><span class="keyword">TABLESPACE</span> <span class="string">""</span>&lt;<span class="keyword">Tablespace</span> <span class="keyword">Name</span>&gt;<span class="string">"</span></span><br><span class="line"><span class="string">REFRESH FAST ON DEMAND START WITH sysdate+0 NEXT TRUNC(SYSDATE+1)+6/24 -- Morning 6 AM</span></span><br><span class="line"><span class="string">-- REFRESH FAST ON DEMAND START WITH sysdate+0 NEXT SYSDATE + 5/(60*24)  -- Every 5 Mins</span></span><br><span class="line"><span class="string">-- REFRESH COMPLETE ON DEMAND START WITH sysdate+0 NEXT SYSDATE + 30/(60*24) -- Every 30 Mins</span></span><br><span class="line"><span class="string">-- REFRESH COMPLETE ON DEMAND START WITH sysdate+0 NEXT SYSDATE + 1</span></span><br><span class="line"><span class="string">WITH PRIMARY KEY USING DEFAULT LOCAL ROLLBACK SEGMENT</span></span><br><span class="line"><span class="string">DISABLE QUERY REWRITE</span></span><br><span class="line"><span class="string">--WITH ROWID USING DEFAULT LOCAL ROLLBACK SEGMENT</span></span><br><span class="line"><span class="string">DISABLE QUERY REWRITE</span></span><br><span class="line"><span class="string">AS SELECT</span></span><br><span class="line"><span class="string">COLUMN_1 Col_Alias_Name ,</span></span><br><span class="line"><span class="string">COLUMN_2 Col_Alias_Name,</span></span><br><span class="line"><span class="string">COLUMN_3 Col_Alias_Name,</span></span><br><span class="line"><span class="string">--NULL Col_Alias_Name,,</span></span><br><span class="line"><span class="string">--CAST(NULL as varchar2(1)) Col_Alias_Name,,</span></span><br><span class="line"><span class="string">FROM &lt;Master Schema&gt;.&lt;Master Base Table&gt;@&lt;DB_LINK Name&gt;;</span></span><br></pre></td></tr></table></figure><h3 id="ALTER-DROP-Materialized-View"><a href="#ALTER-DROP-Materialized-View" class="headerlink" title="ALTER/DROP Materialized View"></a>ALTER/DROP Materialized View</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> &lt;MVIEW_NAME&gt;</span><br><span class="line"><span class="keyword">REFRESH</span> <span class="keyword">COMPLETE</span> <span class="keyword">ON</span> <span class="keyword">DEMAND</span> <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="keyword">sysdate</span>+<span class="number">0</span> <span class="keyword">NEXT</span> <span class="keyword">SYSDATE</span> + <span class="number">30</span>/(<span class="number">60</span>*<span class="number">24</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">LOG</span> <span class="keyword">ON</span> &lt;MVIEW_NAME&gt;;</span><br></pre></td></tr></table></figure><h3 id="Query-Materialized-View"><a href="#Query-Materialized-View" class="headerlink" title="Query Materialized View"></a>Query Materialized View</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Find All JOBs/MViews Related to Master DB</span></span><br><span class="line">col JOB FOR 9999</span><br><span class="line">col OWNER for a8</span><br><span class="line">col MASTER_LINK for a15</span><br><span class="line">col HOST for a10</span><br><span class="line">col FAST_REFRESHABLE for a8</span><br><span class="line">col STALENESS for a9</span><br><span class="line">col COMPILE_STATE for a8</span><br><span class="line">col MVIEW_NAME for a20</span><br><span class="line">col "REFRH MOD-METHOD BLD_MOD" for a22</span><br><span class="line">col INTERVAL FOR a24</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  JOB</span><br><span class="line"> ,a.OWNER,MVIEW_NAME</span><br><span class="line"> ,UPDATABLE</span><br><span class="line"> ,REWRITE_ENABLED</span><br><span class="line"> ,MASTER_LINK</span><br><span class="line"> ,c.HOST</span><br><span class="line"> ,REFRESH_MODE||<span class="string">'-'</span>||REFRESH_METHOD||<span class="string">'-'</span>||BUILD_MODE <span class="string">"REFRH MOD-METHOD BLD_MOD"</span></span><br><span class="line"> ,FAST_REFRESHABLE</span><br><span class="line"> ,LAST_REFRESH_TYPE</span><br><span class="line"> ,to_char(LAST_REFRESH_DATE,<span class="string">'dd-Mon-yy hh24:mi:ss'</span>) LAST_REFRESH_DATE</span><br><span class="line"> ,COMPILE_STATE</span><br><span class="line"> ,<span class="built_in">INTERVAL</span></span><br><span class="line"> ,USE_NO_INDEX</span><br><span class="line"><span class="keyword">FROM</span>  DBA_MVIEWS a, DBA_REFRESH_CHILDREN b, DBA_DB_LINKS c</span><br><span class="line"><span class="keyword">WHERE</span> a.MVIEW_NAME=b.NAME</span><br><span class="line"><span class="keyword">AND</span>  a.OWNER=b.OWNER</span><br><span class="line"><span class="keyword">And</span>  MASTER_LINK <span class="keyword">in</span> (<span class="keyword">SELECT</span> <span class="string">'@'</span>||DB_LINK <span class="keyword">from</span> dba_db_links <span class="keyword">where</span> <span class="keyword">UPPER</span>(HOST) =<span class="string">'&lt;Master DB Name&gt;'</span>)</span><br><span class="line"><span class="keyword">AND</span>  <span class="keyword">SUBSTR</span>(a.MASTER_LINK,<span class="number">2</span>) = c.DB_LINK</span><br><span class="line"><span class="keyword">AND</span>  <span class="keyword">UPPER</span>(c.HOST) =<span class="string">'&lt;Master DB Name&gt;'</span></span><br><span class="line"><span class="keyword">Order</span> <span class="keyword">by</span> MASTER_LINK, MVIEW_NAME;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Query Materialized View Log in Master DB Site</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DBA_MVIEW_LOGS <span class="keyword">WHERE</span> <span class="keyword">MASTER</span>=<span class="string">'&lt;BASE TABLE NAME&gt;'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://durga-kar.blogspot.com/2015/02/materialized-view.html" target="_blank" rel="noopener">http://durga-kar.blogspot.com/2015/02/materialized-view.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Advanced Queue &amp; Job</title>
      <link href="/2016/11/04/database/oracle-kt-advanced-queue-job/"/>
      <url>/2016/11/04/database/oracle-kt-advanced-queue-job/</url>
      
        <content type="html"><![CDATA[<h3 id="Advanced-Queueing"><a href="#Advanced-Queueing" class="headerlink" title="Advanced Queueing"></a>Advanced Queueing</h3><blockquote><p><code>Oracle Advanced Queueing (AQ)</code>, AQ provides a message queuing infrastructure as integral part of the Oracle server engine. It provides an API for enqueing messages to database queues. These messages can later be dequeued for asynchronous processing.<br><code>Oracle AQ</code> also provides functionality to preserve, track, document, correlate, and query messages in queues.</p></blockquote><a id="more"></a><h4 id="How-to-Implement"><a href="#How-to-Implement" class="headerlink" title="How to Implement"></a>How to Implement</h4><blockquote><p>AQ implementation of workflows: A-&gt;B-&gt;C-&gt;D<br><img src="/../../../ref/oracle-aq-workflows.gif" alt="aq-workflow"></p></blockquote><blockquote><p>AQ implementation of Publish/Subscribe:</p></blockquote><blockquote><ul><li><strong>point-point:</strong><br><img src="/../../../ref/oracle-aq-p-p.gif" alt></li></ul></blockquote><blockquote><ul><li><strong>publish/subscribe:</strong><br><img src="/../../../ref/oracle-aq-ps.gif" alt></li></ul></blockquote><blockquote><ul><li><strong>publish/subscribe with rule:</strong><br><img src="/../../../ref/oracle-aq-ps-rule.gif" alt></li></ul></blockquote><h4 id="Related-packages"><a href="#Related-packages" class="headerlink" title="Related packages"></a>Related packages</h4><blockquote><p>From a <code>PL/SQL</code> standpoint, <code>Oracle AQ</code> is made available through two packages: <code>DBMS_AQADM</code> and <code>DBMS_AQ</code>. The <code>DBMS_AQADM</code> package is the interface to the administrative tasks of Oracle AQ.</p></blockquote><blockquote><p><code>DBMS_AQADM</code> tasks include:</p><ul><li>Creating or dropping queue tables, which contain one or more queues </li><li>Creating, dropping, and altering queues, which are stored in a queue table</li></ul></blockquote><blockquote><p>Starting and stopping queues in accepting message creation or consumption<br>Most users of the Oracle AQ facility will not work with <code>DBMS_AQADM</code>. The DBA will most likely initialize all needed queue tables and queues. PL/SQL developers will instead work with the <code>DBMS_AQ</code>.</p></blockquote><blockquote><p><code>DBMS_AQ</code> tasks include:</p><ul><li>Creating a message to the specified queue</li><li>Consuming a message from the specified queue</li></ul></blockquote><h4 id="AQ-Example"><a href="#AQ-Example" class="headerlink" title="AQ Example"></a>AQ Example</h4><h5 id="Prepare-database-user"><a href="#Prepare-database-user" class="headerlink" title="Prepare database user"></a>Prepare database user</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONN / AS SYSDBA</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> testq <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">connect</span>, <span class="keyword">resource</span>, dba <span class="keyword">TO</span> testq;</span><br><span class="line"><span class="keyword">GRANT</span> aq_administrator_role, aq_user_role  <span class="keyword">TO</span> testq;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">create</span> <span class="keyword">type</span> <span class="keyword">TO</span> testq;</span><br></pre></td></tr></table></figure><h5 id="Create-a-queue"><a href="#Create-a-queue" class="headerlink" title="Create a queue"></a>Create a queue</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CONN testq/x@ora10gtest</span><br><span class="line"><span class="keyword">SET</span> SERVEROUTPUT <span class="keyword">ON</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">TYPE</span> event_msg_type <span class="keyword">AS</span> <span class="keyword">OBJECT</span> (</span><br><span class="line">  <span class="keyword">name</span>            <span class="built_in">VARCHAR2</span>(<span class="number">10</span>),</span><br><span class="line">  current_status  <span class="built_in">NUMBER</span>(<span class="number">5</span>),</span><br><span class="line">  next_status     <span class="built_in">NUMBER</span>(<span class="number">5</span>)</span><br><span class="line">);</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span> DBMS_AQADM.create_queue_table( -</span><br><span class="line">   queue_table        =&gt;  <span class="string">'testq.event_queue_tab'</span>, -</span><br><span class="line">   queue_payload_type =&gt;  <span class="string">'testq.event_msg_type'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span> DBMS_AQADM.create_queue( -</span><br><span class="line">   queue_name         =&gt;  <span class="string">'testq.event_queue'</span>, -</span><br><span class="line">   queue_table        =&gt;  <span class="string">'testq.event_queue_tab'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXECUTE</span> DBMS_AQADM.start_queue( -</span><br><span class="line">   queue_name         =&gt; <span class="string">'testq.event_queue'</span>, -</span><br><span class="line">   <span class="keyword">enqueue</span>            =&gt; <span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure><h5 id="Test-Enqueue"><a href="#Test-Enqueue" class="headerlink" title="Test Enqueue"></a>Test Enqueue</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_enqueue_options    DBMS_AQ.enqueue_options_t;</span><br><span class="line">  l_message_properties DBMS_AQ.message_properties_t;</span><br><span class="line">  l_message_handle     RAW(16);</span><br><span class="line">  l_event_msg          TESTQ.event_msg_type;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  l_event_msg := TESTQ.event_msg_type(<span class="string">'REPORTER'</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  DBMS_AQ.enqueue(queue_name         =&gt; 'testq.event_queue',</span><br><span class="line">                  enqueue_options    =&gt; l_enqueue_options,</span><br><span class="line">                  message_properties =&gt; l_message_properties,</span><br><span class="line">                  payload            =&gt; l_event_msg,</span><br><span class="line">                  msgid              =&gt; l_message_handle);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><h5 id="Test-Dequeue"><a href="#Test-Dequeue" class="headerlink" title="Test Dequeue"></a>Test Dequeue</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_dequeue_options    DBMS_AQ.dequeue_options_t;</span><br><span class="line">  l_message_properties DBMS_AQ.message_properties_t;</span><br><span class="line">  l_message_handle     RAW(16);</span><br><span class="line">  l_event_msg          TESTQ.event_msg_type;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_AQ.dequeue(queue_name         =&gt; <span class="string">'testq.event_queue'</span>,</span><br><span class="line">                  dequeue_options    =&gt; l_dequeue_options,</span><br><span class="line">                  message_properties =&gt; l_message_properties,</span><br><span class="line">                  payload            =&gt; l_event_msg,</span><br><span class="line">                  msgid              =&gt; l_message_handle);</span><br><span class="line">  DBMS_OUTPUT.put_line('Event Name    : ' || l_event_msg.name);</span><br><span class="line">  DBMS_OUTPUT.put_line('Current Status: ' || l_event_msg.current_status);</span><br><span class="line">  DBMS_OUTPUT.put_line('Next Status   : ' || l_event_msg.next_status);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><blockquote><p>Starting with Oracle Database <strong>10g</strong>, the Oracle scheduler was greatly improved with the <code>dbms_scheduler</code> package.  Replacing the <code>dbms_job</code> with <code>dbms_scheduler</code> offers additional features by adding the ability to tie jobs with specific <code>user-type</code> privileges and roles:</p></blockquote><h4 id="What’s-the-different"><a href="#What’s-the-different" class="headerlink" title="What’s the different"></a>What’s the different</h4><h5 id="Create-job"><a href="#Create-job" class="headerlink" title="Create job"></a>Create job</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Old using dbms_job scheduler.</span></span><br><span class="line">VARIABLE l_job NUMBER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_JOB.submit (</span><br><span class="line">    job       =&gt; :l_job,</span><br><span class="line">    what      =&gt; <span class="string">'BEGIN NULL; /* Do Nothing */ END;'</span>,</span><br><span class="line">    next_date =&gt; <span class="keyword">SYSDATE</span>,</span><br><span class="line">    <span class="built_in">interval</span>  =&gt; <span class="string">'SYSDATE + 1 /* 1 Day */'</span>);</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line">PRINT l_job</span><br><span class="line"></span><br><span class="line"><span class="comment">-- New with dbms_scheduler scheduler.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_SCHEDULER.create_job (</span><br><span class="line">    job_name        =&gt; <span class="string">'dummy_job'</span>,</span><br><span class="line">    job_type        =&gt; <span class="string">'PLSQL_BLOCK'</span>,</span><br><span class="line">    job_action      =&gt; <span class="string">'BEGIN NULL; /* Do Nothing */ END;'</span>,</span><br><span class="line">    start_date      =&gt; SYSTIMESTAMP,</span><br><span class="line">    repeat_interval =&gt; <span class="string">'SYSTIMESTAMP + 1 /* 1 Day */'</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><blockquote><ul><li>Define a meaningful <code>job_name</code> for the new job.</li><li>Assign a <code>job_action</code> of <code>PLSQL_BLOCK</code>.</li><li>Use the what value from the old job as the <code>job_action</code> value in the new job.</li><li>Use <code>SYSTIMESTAMP</code> for the start_date value.</li><li>Use the interval value from the old job as the <code>repeat_interval</code> value in the new job, making sure the result of the expression is a <code>TIMESTAMP</code> not a <code>DATE</code>.</li></ul></blockquote><blockquote><p>Once this conversion has been completed for all jobs, there is freedom from using the old scheduler, so the <code>job_queue_processes</code> parameter can now be set to zero.</p></blockquote><h5 id="Alter-job"><a href="#Alter-job" class="headerlink" title="Alter job"></a>Alter job</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Old using dbms_job scheduler.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"> DBMS_JOB.WHAT(<span class="number">31</span>, <span class="string">'INSERT INTO employees VALUES (7935, ''TOM'', ''DOGAN'', </span></span><br><span class="line"><span class="string">   ''tom.dogan@examplecorp.com'', NULL, SYSDATE,''AD_PRES'', NULL,</span></span><br><span class="line"><span class="string">   NULL, NULL, NULL);'</span>,</span><br><span class="line"> <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="comment">-- New with dbms_scheduler scheduler.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"> DBMS_SCHEDULER.SET_ATTRIBUTE(</span><br><span class="line">   <span class="keyword">name</span>          =&gt; <span class="string">'JOB1'</span>,</span><br><span class="line">   <span class="keyword">attribute</span>     =&gt; <span class="string">'job_action'</span>,</span><br><span class="line">   <span class="keyword">value</span>         =&gt; <span class="string">'INSERT INTO employees VALUES (7935, ''TOM'', ''DOGAN'', </span></span><br><span class="line"><span class="string">      ''tom.dogan@examplecorp.com'', NULL, SYSDATE, ''AD_PRES'', NULL,</span></span><br><span class="line"><span class="string">      NULL, NULL, NULL);'</span>,</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><h5 id="Remove-job-from-queue"><a href="#Remove-job-from-queue" class="headerlink" title="Remove job from queue"></a>Remove job from queue</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Old using dbms_job scheduler.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   DBMS_JOB.REMOVE(<span class="number">14144</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="comment">-- New with dbms_scheduler scheduler.</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   DBMS_SCHEDULER.DROP_JOB(<span class="string">'myjob1'</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">/</span><br></pre></td></tr></table></figure><h4 id="Related-tables"><a href="#Related-tables" class="headerlink" title="Related tables"></a>Related tables</h4><blockquote><ul><li><code>DBA_SCHEDULER_SCHEDULES</code> - provides me with information about the schedules that are in effect in the database.</li><li><code>DBA_SCHEDULER_PROGRAMS</code> - shows all program objects and their attributes, while view <code>DBA_SCHEDULER_PROGRAM_ARGS</code> shows all program arguments for programs that have them. </li><li><code>DBA_SCHEDULER_JOBS</code> - shows all job objects and their attributes.</li></ul></blockquote><p>Resources:</p><blockquote><p><a href="https://docs.oracle.com/cd/E11882_01/server.112/e11013/aq_intro.htm#ADQUE0100" target="_blank" rel="noopener">https://docs.oracle.com/cd/E11882_01/server.112/e11013/aq_intro.htm#ADQUE0100</a><br><a href="http://www.orafaq.com/wiki/Advanced_Queueing" target="_blank" rel="noopener">http://www.orafaq.com/wiki/Advanced_Queueing</a><br><a href="https://docs.oracle.com/cd/E11882_01/server.112/e25494/scheduse.htm#ADMIN12392" target="_blank" rel="noopener">https://docs.oracle.com/cd/E11882_01/server.112/e25494/scheduse.htm#ADMIN12392</a><br><a href="http://www.dba-oracle.com/t_dbms_job_scheduler.htm" target="_blank" rel="noopener">http://www.dba-oracle.com/t_dbms_job_scheduler.htm</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Package Manager - Yarn vs NPM</title>
      <link href="/2016/11/01/tools/yarn-vs-npm/"/>
      <url>/2016/11/01/tools/yarn-vs-npm/</url>
      
        <content type="html"><![CDATA[<p>Yarn is a fast, reliable, and secure dependency management tool. Open Source —&gt; <a href="https://github.com/yarnpkg/yarn" target="_blank" rel="noopener">Github</a><br>Offical Documentation: <a href="https://yarnpkg.com/en/docs" target="_blank" rel="noopener">https://yarnpkg.com/en/docs</a></p><blockquote><p>Almost From Functional and CLI two parts to compare, see the below: </p></blockquote><a id="more"></a><h2 id="Functional-Differences"><a href="#Functional-Differences" class="headerlink" title="Functional Differences"></a>Functional Differences</h2><p>In <code>package.json</code>, the file where both npm as Yarn keep track of the project’s dependencies, version numbers aren’t always exact. </p><blockquote><p>To avoid package version mis-matches, an exact installed version is pinned down in a lock file.<br>Every time a module is added, Yarn creates (or updates) a <code>yarn.lock</code> file.<br>This way you can guarantee another machine installs the exact same package, while still having a range of allowed versions defined in <code>package.json</code>.</p></blockquote><p>In npm, the <code>npm shrinkwrap</code> command generates a lock file as well, and <code>npm install</code> reads that file before reading <code>package.json</code>, much like how Yarn reads <code>yarn.lock</code> first. </p><p><a href="https://yarnpkg.com/en/docs/configuration#toc-use-yarn-lock-to-pin-your-dependencies" target="_blank" rel="noopener">yarn.lock documentation</a><br><a href="https://docs.npmjs.com/cli/shrinkwrap" target="_blank" rel="noopener">npm shrinkwrap documentation</a></p><h2 id="CLI-Differences"><a href="#CLI-Differences" class="headerlink" title="CLI Differences"></a>CLI Differences</h2><p>Other than some functional differences, Yarn also has different commands.<br>Some npm commands were removed, others modified and a couple of interesting commands were added.</p><h5 id="yarn-global"><a href="#yarn-global" class="headerlink" title="yarn global"></a><a href="https://yarnpkg.com/en/docs/cli/global" target="_blank" rel="noopener"><code>yarn global</code></a></h5><h5 id="yarn-install"><a href="#yarn-install" class="headerlink" title="yarn install"></a><a href="https://yarnpkg.com/en/docs/cli/install" target="_blank" rel="noopener"><code>yarn install</code></a></h5><h5 id="yarn-add-–dev"><a href="#yarn-add-–dev" class="headerlink" title="yarn add [–dev]"></a><a href="https://yarnpkg.com/en/docs/cli/add" target="_blank" rel="noopener"><code>yarn add [–dev]</code></a></h5><h5 id="yarn-licenses-ls-generate-disclaimer"><a href="#yarn-licenses-ls-generate-disclaimer" class="headerlink" title="yarn licenses [ls|generate-disclaimer]"></a><a href="https://yarnpkg.com/en/docs/cli/licenses" target="_blank" rel="noopener"><code>yarn licenses [ls|generate-disclaimer]</code></a></h5><h5 id="yarn-why"><a href="#yarn-why" class="headerlink" title="yarn why"></a><a href="https://yarnpkg.com/en/docs/cli/why" target="_blank" rel="noopener"><code>yarn why</code></a></h5><h5 id="yarn-upgrade-package"><a href="#yarn-upgrade-package" class="headerlink" title="yarn upgrade [package]"></a><a href="https://yarnpkg.com/en/docs/cli/upgrade" target="_blank" rel="noopener"><code>yarn upgrade [package]</code></a></h5><h5 id="yarn-generate-lock-entry"><a href="#yarn-generate-lock-entry" class="headerlink" title="yarn generate-lock-entry"></a><a href="https://yarnpkg.com/en/docs/cli/generate-lock-entry" target="_blank" rel="noopener"><code>yarn generate-lock-entry</code></a></h5><p>Resources:<br><a href="https://www.sitepoint.com/yarn-vs-npm/" target="_blank" rel="noopener">https://www.sitepoint.com/yarn-vs-npm/</a><br><a href="https://www.berriart.com/blog/2016/10/npm-yarn-benchmark/" target="_blank" rel="noopener">https://www.berriart.com/blog/2016/10/npm-yarn-benchmark/</a><br><a href="https://github.com/appleboy/npm-vs-yarn" target="_blank" rel="noopener">https://github.com/appleboy/npm-vs-yarn</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
            <tag> package </tag>
            
            <tag> Yarn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Instance - RAC, Memory - SGA, PGA</title>
      <link href="/2016/10/30/database/oracle-kt-instance-rac-memory/"/>
      <url>/2016/10/30/database/oracle-kt-instance-rac-memory/</url>
      
        <content type="html"><![CDATA[<p>An Oracle database server consists of an Oracle database and an Oracle instance. Every time a database is started, a system global area (<strong>SGA</strong>) is allocated and Oracle background processes are started. The combination of the background processes and memory buffers is called an Oracle instance.</p><a id="more"></a><h3 id="Real-Application-Clusters-RAC"><a href="#Real-Application-Clusters-RAC" class="headerlink" title="Real Application Clusters(RAC)"></a>Real Application Clusters(RAC)</h3><blockquote><p>Multiple Instance Systems, Real Application Clusters (RAC) takes advantage of such architecture by running multiple instances that share a single physical database. In most applications, RAC enables access to a single database by users on multiple computers with increased performance.</p></blockquote><p><img src="/../../../ref/oracle-rac-structure.jpg" alt="oracle-rac-structre"></p><blockquote><p>At a very high level, <code>RAC architecture</code> consists of these components:</p><ul><li>Physical Nodes or Hosts</li><li>Physical Interconnects and interconnect protocols</li><li>Cluster Manager Software and Cluster Ready Services</li><li>Oracle Instances and Cache Fusion</li><li>Shared Disk System</li><li>Clustered File System, Raw Devices, Automatic Storage Management</li><li>Network Services</li><li>Workload Management Services ? Virtual IP configuration</li></ul></blockquote><h3 id="Memory-Structures"><a href="#Memory-Structures" class="headerlink" title="Memory Structures"></a>Memory Structures</h3><blockquote><p>For example, memory stores program code being run and data shared among users. Two basic memory structures are associated with Oracle: the system global area and the program global area. The following subsections explain each in detail.</p></blockquote><p><img src="/../../../ref/oracle-memory-structure.gif" alt="oracle-mem-structure"></p><h4 id="System-Global-Area-SGA"><a href="#System-Global-Area-SGA" class="headerlink" title="System Global Area(SGA)"></a>System Global Area(SGA)</h4><blockquote><p>The <code>System Global Area (SGA)</code> is a shared memory region that contains data and control information for one Oracle instance. Oracle allocates the <code>SGA</code> when an instance starts and deallocates it when the instance shuts down. Each instance has its own <code>SGA</code>.</p></blockquote><blockquote><p>The information stored in the SGA is divided into several types of memory structures, including the <code>database buffers</code>, <code>redo log buffer</code>, and <code>the shared pool</code>.</p></blockquote><h5 id="Database-Buffer-Cache-of-the-SGA"><a href="#Database-Buffer-Cache-of-the-SGA" class="headerlink" title="Database Buffer Cache of the SGA"></a>Database Buffer Cache of the SGA</h5><blockquote><p><code>Database buffers</code> store the most recently used blocks of data. The set of database buffers in an instance is the database buffer cache. The buffer cache contains modified as well as unmodified blocks. Because the most recently (and often, the most frequently) used data is kept in memory, less disk I/O is necessary, and performance is improved.</p></blockquote><blockquote><p>With automatic SGA management, you can simply set the <code>SGA_TARGET</code> initialization parameter to <code>1G</code>. If an application needs more shared pool memory, it can obtain that memory by acquiring it from the free memory in the buffer cache.</p></blockquote><h5 id="Redo-Log-Buffer-of-the-SGA"><a href="#Redo-Log-Buffer-of-the-SGA" class="headerlink" title="Redo Log Buffer of the SGA"></a>Redo Log Buffer of the SGA</h5><blockquote><p>The <code>redo log buffer</code> stores redo entries—a log of changes made to the database. The redo entries stored in the redo log buffers are written to an online redo log, which is used if database recovery is necessary. The size of the redo log is static.</p></blockquote><h5 id="Shared-Pool-of-the-SGA"><a href="#Shared-Pool-of-the-SGA" class="headerlink" title="Shared Pool of the SGA"></a>Shared Pool of the SGA</h5><blockquote><p>The <code>shared pool</code> contains shared memory constructs, such as shared SQL areas. A shared SQL area is required to process every unique SQL statement submitted to a database. A shared SQL area contains information such as the parse tree and execution plan for the corresponding statement. A single shared SQL area is used by multiple applications that issue the same statement, leaving more shared memory for other uses.</p></blockquote><blockquote><p><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14220/memory.htm#i10093" target="_blank" rel="noopener">The detail plain see here</a></p></blockquote><h4 id="Program-Global-Area-PGA"><a href="#Program-Global-Area-PGA" class="headerlink" title="Program Global Area(PGA)"></a>Program Global Area(PGA)</h4><blockquote><p>The <code>Program Global Area (PGA)</code> is a memory buffer that contains data and control information for a server process. A PGA is created by Oracle when a server process is started. The information in a PGA depends on the Oracle configuration.</p></blockquote><blockquote><p>It is a <strong>nonshared memory</strong> created by Oracle when a server process is started. Access to it is exclusive to that server process and is read and written only by Oracle code acting on behalf of it. The total PGA memory allocated by each server process attached to an Oracle instance is also referred to as the aggregated PGA memory allocated by the instance.</p></blockquote><blockquote><p>Resources:<br><a href="https://docs.oracle.com/cd/E11882_01/rac.112/e41960/admcon.htm#RACAD1111" target="_blank" rel="noopener">https://docs.oracle.com/cd/E11882_01/rac.112/e41960/admcon.htm#RACAD1111</a><br><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14220/memory.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B19306_01/server.102/b14220/memory.htm</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Trouble Shooting &amp; performance monitor by OEM</title>
      <link href="/2016/10/30/database/oracle-kt-troubleshooting-performance-monitor/"/>
      <url>/2016/10/30/database/oracle-kt-troubleshooting-performance-monitor/</url>
      
        <content type="html"><![CDATA[<blockquote><p>The goals of Oracle troubleshooting include:</p><ul><li>Learn a troubleshooting methodology for use in analyzing any Oracle database</li><li>Understand <strong>ratio-based</strong> and <strong>bottleneck troubleshooting analysis</strong></li><li>Learn troubleshooting techniques for <strong>monitoring and optimizing</strong> memory usage </li><li>Know how to quickly pinpoint and resolve <strong>I/O</strong> hotspots at the database, storage and object level </li><li>Using scripts to uncover <strong>session-related</strong> bottlenecks </li><li>Understand techniques for locating and fixing problem SQL</li></ul></blockquote><a id="more"></a><h3 id="Oracle-Stored-Procedures-Tips"><a href="#Oracle-Stored-Procedures-Tips" class="headerlink" title="Oracle Stored Procedures Tips"></a>Oracle Stored Procedures Tips</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- prototype defines the syntax for compiling or decompiling a procedure.</span></span><br><span class="line"><span class="keyword">Alter</span> <span class="keyword">procedure</span> &lt;procedure_name&gt; compile | decompile;</span><br></pre></td></tr></table></figure><h3 id="Monitor-oracle-performance-by-OEM"><a href="#Monitor-oracle-performance-by-OEM" class="headerlink" title="Monitor oracle performance by OEM"></a>Monitor oracle performance by OEM</h3><h4 id="Proactive-Database-Tuning"><a href="#Proactive-Database-Tuning" class="headerlink" title="Proactive Database Tuning"></a>Proactive Database Tuning</h4><h4 id="Reactive-Database-Tuning"><a href="#Reactive-Database-Tuning" class="headerlink" title="Reactive Database Tuning"></a>Reactive Database Tuning</h4><h4 id="SQL-Tuning"><a href="#SQL-Tuning" class="headerlink" title="SQL Tuning"></a>SQL Tuning</h4><blockquote><p>Resources:<br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28275/toc.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B28359_01/server.111/b28275/toc.htm</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm package下载超级慢有没有</title>
      <link href="/2016/10/29/tools/slove-npm-package-slow-speed/"/>
      <url>/2016/10/29/tools/slove-npm-package-slow-speed/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近一直在学nodeJS, npm package manager 这是必不可少的。原因挺简单，在国内访问外网太慢。。。大家都懂得~<br>两种解决方案:</p></blockquote><a id="more"></a><h3 id="solution-1-replace-registry-url"><a href="#solution-1-replace-registry-url" class="headerlink" title="solution 1 replace registry url"></a>solution 1 replace registry url</h3><blockquote><p>用其它registry url 来加速npm，有<code>cnpm</code>, <code>taobao npm</code>, 具体还要看包的完整性及所需要的依赖。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry http://registry.cnpmjs.org  npm info underscore</span><br><span class="line"></span><br><span class="line">#vim node_modules\npm.npmrc</span><br><span class="line">registry = http://registry.cnpmjs.org</span><br></pre></td></tr></table></figure><blockquote><p>cnpm offical configuration, 一键完成</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=http://r.cnpmjs.org</span><br></pre></td></tr></table></figure><blockquote><p>其它registry-url: <code>https://registry.npm.taobao.org</code></p></blockquote><h3 id="solution-2-use-proxy"><a href="#solution-2-use-proxy" class="headerlink" title="solution 2 use proxy"></a>solution 2 use proxy</h3><blockquote><p>close npm https</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set strict-ssl false</span><br></pre></td></tr></table></figure><blockquote><p>configure npm proxy address</p></blockquote><blockquote><p>如果有ss代理的话，推荐这种方式。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy=http://127.0.0.1:8087</span><br><span class="line">npm config set registry=http://registry.npmjs.org</span><br></pre></td></tr></table></figure><blockquote><p>if clean proxy</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete http-proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure><p>Resource：<a href="http://www.uedbox.com/npm-install-slow-solution/" target="_blank" rel="noopener">http://www.uedbox.com/npm-install-slow-solution/</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node </tag>
            
            <tag> Package </tag>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo + Next 踩坑提醒</title>
      <link href="/2016/10/21/web/hexo-next-tutorial/"/>
      <url>/2016/10/21/web/hexo-next-tutorial/</url>
      
        <content type="html"><![CDATA[<p>这几年NodeJS太火了，就准备把之前记录的blog用Hexo重构以下。网上的教程真是太多了，参照官方的文档<a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a><br>本打算自己写主题的，现在还是用现成的吧<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">Next</a> | <a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">yilia</a>, Yilia是基于webpack构建的其性能比Next要高。目前我采用的Next, 比较容易踩坑的地方记一下。</p><a id="more"></a><h3 id="How-to-create-new-menu"><a href="#How-to-create-new-menu" class="headerlink" title="How to create new menu"></a>How to create new menu</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page tags</span><br><span class="line"></span><br><span class="line">#修改`/tag/index.md`, type为tags, 禁用comments将value改为false</span><br><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">date: 2016-xx-xx 12:38:22</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">comments: false</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h3 id="How-to-change-social-icon"><a href="#How-to-change-social-icon" class="headerlink" title="How to change social icon"></a>How to change social icon</h3><p>对于缺少的icon可用globe代替，也可以通过<a href="http://fontawesome.io/icons/" target="_blank" rel="noopener">FontAwesome</a>搜索你喜欢的来替换</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">social_icons:</span><br><span class="line">  enable: true</span><br><span class="line">  # Icon Mappings.</span><br><span class="line">  # KeyMapsToSocalItemKey: NameOfTheIconFromFontAwesome</span><br><span class="line">  GitHub: github</span><br><span class="line">  Twitter: twitter</span><br><span class="line">  Facebook: facebook</span><br><span class="line">  Telegram: telegram</span><br><span class="line">  Instagram: instagram</span><br><span class="line">  Weibo: weibo</span><br></pre></td></tr></table></figure><h3 id="How-to-active-search-function"><a href="#How-to-active-search-function" class="headerlink" title="How to active search function"></a>How to active search function</h3><p>安装<code>hexo-generator-search</code>plugin, 生成blog content index. 更多详细配置参照<a href="https://github.com/PaicHyperionDev/hexo-generator-search" target="_blank" rel="noopener">hexo-generator-search</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-search --save</span><br><span class="line"></span><br><span class="line">#modify _config.yml 增加以下内容</span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br></pre></td></tr></table></figure><h3 id="How-to-generate-feed-xml"><a href="#How-to-generate-feed-xml" class="headerlink" title="How to generate feed xml"></a>How to generate feed xml</h3><p>安装<code>hexo-generator-feed</code>plugin, 更多详细配置参照<a href="https://github.com/itabas016/hexo-generator-feed" target="_blank" rel="noopener">hexo-generator-feed</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-feed</span><br><span class="line"></span><br><span class="line">#modify _config.yml 增加以下内容</span><br><span class="line">#Feed Atom</span><br><span class="line">feed:</span><br><span class="line">  type: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  limit: 20</span><br></pre></td></tr></table></figure><h3 id="How-to-improve-SEO-by-sitemap"><a href="#How-to-improve-SEO-by-sitemap" class="headerlink" title="How to improve SEO by sitemap"></a>How to improve SEO by sitemap</h3><p>安装<code>hexo-generator-sitemap</code>plugin, 更多详细配置参照<a href="https://github.com/hexojs/hexo-generator-sitemap" target="_blank" rel="noopener">hexo-generator-sitemap</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-sitemap</span><br><span class="line"></span><br><span class="line">#modify _config.yml 增加以下内容</span><br><span class="line"></span><br><span class="line">#sitemap</span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br></pre></td></tr></table></figure><h3 id="How-to-deploy-to-github"><a href="#How-to-deploy-to-github" class="headerlink" title="How to deploy to github"></a>How to deploy to github</h3><p>安装<code>hexo-deployer-git</code>plugin, 更多详细配置参照<a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="noopener">hexo-deployer-git</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h3 id="How-to-bind-a-personal-domain"><a href="#How-to-bind-a-personal-domain" class="headerlink" title="How to bind a personal domain"></a>How to bind a personal domain</h3><p>cd source目录下，添加CNAME文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd source/</span><br><span class="line">$ touch CNAME</span><br><span class="line">$ vim CNAME # input you personal domain</span><br><span class="line">$ git add CNAME</span><br><span class="line">$ git commit -m &quot;add CNAME&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - What&#39;s the different between Traditional Export/Import and Datapump</title>
      <link href="/2016/10/16/database/oracle-kt-different-exp-imp-datapump/"/>
      <url>/2016/10/16/database/oracle-kt-different-exp-imp-datapump/</url>
      
        <content type="html"><![CDATA[<h3 id="Datapump"><a href="#Datapump" class="headerlink" title="Datapump"></a>Datapump</h3><blockquote><p><code>Datapump</code> is an ORACLE database external utility, which is used to transfer objects between databases. This utility is coming from <strong>ORACLE 10g</strong> database. It has more enhancements than the traditional <code>exp/imp</code> utilities. This utility also makes dump files, which are in binary formats with database objects, object metadata and their control information. The <code>expdp</code> and <code>impdp</code> commands can be executed in three ways,</p></blockquote><blockquote><ul><li><strong>Command line interface</strong> (specify <code>expdp/impdp</code> parameters in command line)</li><li><strong>Parameter file interface</strong> (specify <code>expdp/impdp</code> parameters in a separate file)</li><li><strong>Interactive-command interface</strong> (entering various commands in export prompt)</li></ul></blockquote><a id="more"></a><blockquote><p>There are five different modes of data unloading using expdp. They are,</p></blockquote><blockquote><ul><li><strong>Full Export Mode</strong> (entire database is unloaded)</li><li><strong>Schema Mode</strong> (this is the default mode, specific schemas are unloaded)</li><li><strong>Table Mode</strong> (specified set of tables and their dependent objects are unloaded)</li><li><strong>Tablespace Mode</strong> (the tables in the specified tablespace are unloaded)</li><li><strong>Transportable Tablespace Mode</strong> (only the metadata for the tables and their dependent objects within a specified set of tablespaces are unloaded)</li></ul></blockquote><h4 id="Create-database-directories"><a href="#Create-database-directories" class="headerlink" title="Create database directories"></a>Create database directories</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su - oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">sqlplus / as sysdba</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- unlock user</span></span><br><span class="line">SQL&gt; ALTER USER scott IDENTIFIED BY tiger ACCOUNT UNLOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create dir</span></span><br><span class="line">SQL&gt; CREATE OR REPLACE DIRECTORY test_dir AS '/u01/app/oracle/oradata/orcl';</span><br><span class="line"></span><br><span class="line"><span class="comment">-- grant privilage</span></span><br><span class="line">SQL&gt; GRANT READ, WRITE ON DIRECTORY test_dir TO scott;</span><br><span class="line"><span class="keyword">Grant</span> succeeded.</span><br><span class="line"><span class="comment">-- select</span></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">SELECT</span> directory_path <span class="keyword">FROM</span> dba_directories <span class="keyword">WHERE</span> directory_name = <span class="string">'DATA_PUMP_DIR'</span>;</span><br></pre></td></tr></table></figure><h4 id="TABLE-BASED-IMPORT-AND-EXPORT"><a href="#TABLE-BASED-IMPORT-AND-EXPORT" class="headerlink" title="TABLE BASED IMPORT AND EXPORT"></a>TABLE BASED IMPORT AND EXPORT</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ expdp scott/tiger tables=EMP,DEPT directory=TEST_DIR dumpfile=EMP_DEPT.dmp logfile=expEMP_DEPT.log</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ impdp scott/tiger tables=EMP,DEPT directory=TEST_DIR dumpfile=EMP_DEPT.dmp logfile=impEMP_DEPT.log</span><br><span class="line">CONTENT=&#123;ALL | DATA_ONLY | METADATA_ONLY&#125;</span><br><span class="line"><span class="comment"># All loads all the metadata as well as data from the source dump file.</span></span><br><span class="line"><span class="comment"># DATA_ONLY only loads row data into the tables no database objects are created.</span></span><br><span class="line"><span class="comment"># METADATA_ONLY only creates database objects, no data is inserted.</span></span><br></pre></td></tr></table></figure><h4 id="SCHEMA-BASED-IMPORT-AND-EXPORT"><a href="#SCHEMA-BASED-IMPORT-AND-EXPORT" class="headerlink" title="SCHEMA BASED IMPORT AND EXPORT"></a>SCHEMA BASED IMPORT AND EXPORT</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ expdp scott/tiger schemas=SCOTT directory=TEST_DIR dumpfile=SCOTT.dmp logfile=expSCOTT.log</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ impdp scott/tiger schemas=SCOTT directory=TEST_DIR dumpfile=SCOTT.dmp logfile=impSCOTT.log</span><br><span class="line">CONTENT=&#123;ALL | DATA_ONLY | METADATA_ONLY&#125;</span><br></pre></td></tr></table></figure><h4 id="FULL-DATABASE-IMPORT-AND-EXPORT"><a href="#FULL-DATABASE-IMPORT-AND-EXPORT" class="headerlink" title="FULL DATABASE IMPORT AND EXPORT"></a>FULL DATABASE IMPORT AND EXPORT</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ expdp system/password full=Y directory=TEST_DIR dumpfile=DB10G.dmp logfile=expDB10G.log</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line">$ impdp system/password full=Y directory=TEST_DIR dumpfile=DB10G.dmp logfile=impDB10G.log</span><br><span class="line">CONTENT=&#123;ALL | DATA_ONLY | METADATA_ONLY&#125;</span><br></pre></td></tr></table></figure><h4 id="Datapump-jobs"><a href="#Datapump-jobs" class="headerlink" title="Datapump jobs"></a>Datapump jobs</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dba_datapump_jobs;</span><br></pre></td></tr></table></figure><blockquote><p>Even if you exit the prompt or press <code>ctrl+c</code> at the command prompt or exit from the client side the datapump jobs will continue to run at the server.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- To reattach with the running job enter the following <span class="built_in">command</span>.</span><br><span class="line">$ expdp system/password attach=qq</span><br></pre></td></tr></table></figure><blockquote><p>If the <code>import</code> or <code>export</code> job is to be <strong>stopped temporarily</strong> then type the following command.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- press CTRL+C</span><br><span class="line">Export&gt; STOP_JOB=IMMEDIATE</span><br><span class="line">Are you sure you wish to stop this job ([y]/n): y</span><br></pre></td></tr></table></figure><blockquote><p>In order to resume the job do the following.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line"><span class="variable">$expdp</span> hr/hr ATTACH=qq</span><br><span class="line">Export&gt; CONTINUE_CLIENT</span><br></pre></td></tr></table></figure><h4 id="Datapump-EXCLUDE-INCLUDE-parameters"><a href="#Datapump-EXCLUDE-INCLUDE-parameters" class="headerlink" title="Datapump EXCLUDE/INCLUDE parameters"></a>Datapump EXCLUDE/INCLUDE parameters</h4><blockquote><p>The <code>exclude</code> and <code>include</code> parameters availbale with expdp,impdp can be used as <strong>metadata filters</strong> so that one can specify any objects like <code>tables,indexes,triggers, procedure</code> to be excluded or included during export or import operation</p></blockquote><blockquote><p>syntax:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXCLUDE=[object_type]:[name_clause],[object_type]:[name_clause]</span><br><span class="line">INCLUDE=[object_type]:[name_clause],[object_type]:[name_clause]</span><br><span class="line"></span><br><span class="line">-- examples</span><br><span class="line">expdp SCHEMAS=scott EXCLUDE=SEQUENCE,TABLE:”IN (’EMP’,<span class="string">'DEPT’)”;</span></span><br><span class="line"><span class="string">impdp SCHEMAS=scott INCLUDE=PACKAGE,FUNCTION, PROCEDURE,TABLE:”=’EMP’”</span></span><br></pre></td></tr></table></figure><blockquote><p>btw, use other way <code>xx.par</code> to store these parameters:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- Parameter file:exp.par</span><br><span class="line">DIRECTORY = my_dir</span><br><span class="line">DUMPFILE = exp_tab.dmp</span><br><span class="line">LOGFILE = exp_tab.log</span><br><span class="line">SCHEMAS = scott</span><br><span class="line">INCLUDE = TABLE:”IN (’EMP’, ‘DEPT’)”</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expdp system/manager parfile=exp.par</span><br></pre></td></tr></table></figure><h3 id="Advantages-of-Datapump"><a href="#Advantages-of-Datapump" class="headerlink" title="Advantages of Datapump"></a>Advantages of Datapump</h3><blockquote><ul><li>Data Pump Export and Import operations are processed in the database as a Data Pump job, which is much more efficient that the client-side execution of original Export and Import. </li><li>Data Pump operations can take advantage of the server’s parallel processes to read or write multiple data streams simultaneously.</li><li>Data Pump differs from original Export and Import in that all jobs run primarily on the server using server processes. These server processes access files for the Data Pump jobs using directory objects that identify the location of the files. The directory objects enforce a security model that can be used by DBAs to control access to these files.</li><li>Datapump has a very powerful interactive command-line mode which allows the user to monitor and control Data Pump Export and Import operations.Datapump allows you to disconnect and reconnect to the session</li><li>Because Data Pump jobs run entirely on the server, you can start an export or import job, detach from it, and later reconnect to the job to monitor its progress.</li><li>Data Pump gives you the ability to pass data between two databases over a network (via a database link), without creating a dump file on disk. </li><li>Datapump uses the Direct Path data access method (which permits the server to bypass SQL and go right to the data blocks on disk) has been rewritten to be much more efficient and now supports Data Pump Import and Export.</li><li>Another amazing feature is that you can “PAUSE” and “RESUME” data pump jobs on demand.</li></ul></blockquote><h3 id="What’s-the-difference"><a href="#What’s-the-difference" class="headerlink" title="What’s the difference"></a>What’s the difference</h3><blockquote><ul><li>Datapump operates on a group of files called <strong>dump file sets</strong>. However, normal export operates on <strong>a single file</strong>.</li><li>Datapump access files in the <strong>server</strong> (using <strong>ORACLE directories</strong>). Traditional export can access files in <strong>client</strong> and server both (not using ORACLE directories).</li><li>Exports <code>(exp/imp)</code> represent database metadata information as <code>DDLs</code> in the dump file, but in datapump, it represents in <code>XML</code> document format.</li><li>Datapump has parallel execution but in <code>exp/imp</code> <strong>single stream</strong> execution.</li><li>Datapump does not support <code>sequential media</code> like <strong>tapes</strong>, but traditional export supports.</li></ul></blockquote><blockquote><p>Resources:<br><a href="http://www.orafaq.com/wiki/Datapump" target="_blank" rel="noopener">http://www.orafaq.com/wiki/Datapump</a><br><a href="http://its-all-about-oracle.blogspot.com/2013/06/expimp-vs-datapump-expdpimpdp.html" target="_blank" rel="noopener">http://its-all-about-oracle.blogspot.com/2013/06/expimp-vs-datapump-expdpimpdp.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - ASM(Automatic Storage Management)</title>
      <link href="/2016/10/14/database/oracle-kt-asm/"/>
      <url>/2016/10/14/database/oracle-kt-asm/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>Oracle ASM</code> is a volume manager and a file system for Oracle database files that supports <code>single-instance</code> Oracle Database and <code>Oracle Real Application Clusters</code> (<strong>Oracle RAC</strong>) configurations. <code>Oracle ASM</code> is Oracle’s recommended storage management solution that provides an alternative to conventional volume managers, file systems, and raw devices.</p></blockquote><a id="more"></a><blockquote><p>Oracle ASM uses <strong>disk groups</strong> to store data files, an Oracle ASM disk group is a collection of disks that Oracle ASM manages as a unit.<br>Within a disk group, Oracle ASM exposes a file system interface for Oracle database files. The content of files that are stored in <code>a disk group</code> is evenly distributed to eliminate hot spots and to provide uniform performance across the disks. </p></blockquote><h3 id="Oracle-ASM-Instances"><a href="#Oracle-ASM-Instances" class="headerlink" title="Oracle ASM Instances"></a>Oracle ASM Instances</h3><blockquote><p>An <code>Oracle ASM instance</code> is built on the same technology as an Oracle Database instance. An Oracle ASM instance has a <code>System Global Area</code> (<strong>SGA</strong>) and background processes that are similar to those of Oracle Database. </p></blockquote><blockquote><p>However, because Oracle ASM performs fewer tasks than a database, an Oracle ASM <strong>SGA</strong> is much smaller than a database <strong>SGA</strong>. In addition, Oracle ASM has a minimal performance effect on a server. Oracle ASM instances mount disk groups to make Oracle ASM files available to database instances; Oracle ASM instances do not mount databases. </p></blockquote><blockquote><p>See the below structures:<br>Example - <strong>Oracle ASM Cluster with RAC</strong></p></blockquote><p><img src="/../../../../ref/oracle-asm-rac.gif" alt="oracle-asm-rac"></p><blockquote><p>PS. <code>Oracle ASM cluster</code> in an Oracle <code>RAC</code> environment where Oracle ASM provides a clustered pool of storage. There is one Oracle ASM instance for each node serving multiple <code>Oracle RAC</code> or <code>single-instance</code> databases in the cluster. All of the databases are consolidated and share the same <strong>two Oracle ASM disk groups</strong>.</p></blockquote><blockquote><p>Example - <strong>Oracle ASM Cluster with single instance</strong></p></blockquote><p><img src="/../../../../ref/oracle-asm-single.gif" alt="oracle-asm-single"></p><blockquote><p>PS. <code>A clustered storage pool</code> can be shared by multiple <code>single-instance</code> Oracle Databases. In this case, multiple databases share common disk groups. A shared Oracle ASM storage pool is achieved by using Oracle Clusterware. However, in such environments an Oracle RAC license is not required.</p></blockquote><h3 id="Oracle-ASM-Disk-Groups"><a href="#Oracle-ASM-Disk-Groups" class="headerlink" title="Oracle ASM Disk Groups"></a>Oracle ASM Disk Groups</h3><blockquote><p><code>A disk group</code> consists of multiple disks and is the <strong>fundamental</strong> object that Oracle ASM manages. Each disk group contains the metadata that is required for the management of space in the disk group. Disk group components include disks, files, and allocation units.</p></blockquote><blockquote><p>Files are allocated from disk groups. Any Oracle ASM file is completely contained within a single disk group. However, a disk group might contain files belonging to several databases and a single database can use files from multiple disk groups. For most installations you need only a small number of disk groups, usually two, and rarely more than three. </p></blockquote><h3 id="Oracle-ASM-Disks"><a href="#Oracle-ASM-Disks" class="headerlink" title="Oracle ASM Disks"></a>Oracle ASM Disks</h3><blockquote><p><code>Oracle ASM disks</code> are the storage devices that are provisioned to Oracle ASM disk groups. Examples of Oracle ASM disks include:</p></blockquote><blockquote><ul><li>A disk or partition from a storage array</li><li>An entire disk or the partitions of a disk</li><li>Logical volumes</li><li>Network-attached files (<strong>NFS</strong>)</li></ul></blockquote><blockquote><p>Oracle ASM spreads the files proportionally across all of the disks in the disk group. This allocation pattern maintains every disk at the same capacity level and ensures that all of the disks in a disk group have the same <code>I/O</code> load. Because Oracle ASM <strong>load balances</strong> among all of the disks in a disk group, different Oracle ASM disks should not <strong>share the same physical drive</strong>.</p></blockquote><h3 id="Oracle-ASM-Files"><a href="#Oracle-ASM-Files" class="headerlink" title="Oracle ASM Files"></a>Oracle ASM Files</h3><blockquote><p>Files that are stored in Oracle ASM disk groups are called <code>Oracle ASM files</code>. Each Oracle ASM file is contained within a <strong>single</strong> Oracle ASM disk group. Oracle Database communicates with Oracle ASM in terms of files.<br>This is similar to the way Oracle Database uses files on any file system. You can store the various file types in Oracle ASM disk groups.</p></blockquote><h3 id="How-to-Use-ASM"><a href="#How-to-Use-ASM" class="headerlink" title="How to Use ASM"></a>How to Use ASM</h3><h4 id="Start-amp-Stop"><a href="#Start-amp-Stop" class="headerlink" title="Start &amp; Stop"></a>Start &amp; Stop</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start</span></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_SID=+ASM</span><br><span class="line">$ sqlplus <span class="string">"/ as sysdba"</span></span><br><span class="line">SQL&gt; startup</span><br><span class="line">ASM instance started</span><br><span class="line">Total System Global Area   83886080 bytes</span><br><span class="line">Fixed Size                  1217836 bytes</span><br><span class="line">Variable Size              57502420 bytes</span><br><span class="line">ASM Cache                  25165824 bytes</span><br><span class="line">ASM diskgroups mounted</span><br><span class="line"></span><br><span class="line"><span class="comment"># stop</span></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_SID=+ASM</span><br><span class="line">$ sqlplus <span class="string">"/ as sysdba"</span></span><br><span class="line">SQL&gt; shutdown immediate</span><br></pre></td></tr></table></figure><h4 id="Adding-a-diskgroup"><a href="#Adding-a-diskgroup" class="headerlink" title="Adding a diskgroup"></a>Adding a diskgroup</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; create diskgroup orag2 external redundancy disk 'ORCL:VOL5';</span><br><span class="line">Diskgroup created.</span><br><span class="line"></span><br><span class="line">SQL&gt; select group_number,disk_number,mode_status,name from v$asm_disk;</span><br><span class="line">GROUP_NUMBER DISK_NUMBER MODE_STATUS    NAME</span><br><span class="line"><span class="comment">------------ ----------- -------------- -------------------------------------</span></span><br><span class="line">           0           5 ONLINE</span><br><span class="line">           1           0 ONLINE         VOL1</span><br><span class="line">           1           1 ONLINE         VOL2</span><br><span class="line">           1           2 ONLINE         VOL3</span><br><span class="line">           1           3 ONLINE         VOL4</span><br><span class="line">           2           0 ONLINE         VOL5</span><br><span class="line">6 rows selected.</span><br></pre></td></tr></table></figure><h4 id="Recreating-a-diskgroup"><a href="#Recreating-a-diskgroup" class="headerlink" title="Recreating a diskgroup"></a>Recreating a diskgroup</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/dev/rdsk/c1t4d0s4 bs=8192 count=12800</span><br><span class="line"><span class="comment"># When done, restart ASM and create the diskgroup from scratch.</span></span><br></pre></td></tr></table></figure><h4 id="Rebalancing"><a href="#Rebalancing" class="headerlink" title="Rebalancing"></a>Rebalancing</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The rebalancing speed is controlled by the ASM_POWER_LIMIT initialization parameter.</span></span><br><span class="line"><span class="comment"># Setting it to 0 will disable disk rebalancing.</span></span><br><span class="line"><span class="comment"># To force rebalancing of a diskgroup:</span></span><br><span class="line">ALTER DISKGROUP data REBALANCE POWER 11 WAIT;</span><br></pre></td></tr></table></figure><h4 id="Coverting-to-ASM"><a href="#Coverting-to-ASM" class="headerlink" title="Coverting to ASM"></a>Coverting to ASM</h4><blockquote><p><strong>One can use <code>Rman</code> to convert a datafile, tablespace or entire database from/to <code>ASM</code>.</strong><br><strong>Here are the steps required to migrate an entire database to <code>ASM</code></strong></p></blockquote><h5 id="Convert-a-database-to-ASM"><a href="#Convert-a-database-to-ASM" class="headerlink" title="Convert a database to ASM"></a>Convert a database to ASM</h5><blockquote><p>Ensure the database is using an <code>SPFILE</code> and not a <code>PFILE</code> (it’s about time after all!).<br>Set parameters on the target database.<br>For example, if we set both <code>DB_CREATE_FILE_DEST</code> and <code>DB_RECOVERY_FILE_DEST</code> we should get mirrored controlfiles and duplexed log files by default:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set DB_CREATE_FILE_DEST = '+DATA';</span><br><span class="line">SQL&gt; alter system set DB_RECOVERY_FILE_DEST_SIZE = 17G;</span><br><span class="line">SQL&gt; alter system set DB_RECOVERY_FILE_DEST = '+RECOVER';</span><br><span class="line">SQL&gt; alter system set CONTROL_FILES = '+DATA';</span><br></pre></td></tr></table></figure><blockquote><p>Start the database in <code>NOMOUNT</code> mode and <strong>restore the controlfile</strong> into the new location from the old location:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; connect target /</span><br><span class="line">RMAN&gt; STARTUP NOMOUNT</span><br><span class="line">RMAN&gt; RESTORE CONTROLFILE FROM 'old_control_file_name';</span><br></pre></td></tr></table></figure><blockquote><p>Mount the database and copy the database into the <code>ASM disk group</code>:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; ALTER DATABASE MOUNT;</span><br><span class="line">RMAN&gt; CONFIGURE DEVICE TYPE DISK PARALLELISM 8;</span><br><span class="line">RMAN&gt; BACKUP AS COPY DATABASE FORMAT '+DATA';</span><br></pre></td></tr></table></figure><blockquote><p>Switch <strong>all datafiles</strong> to the new <code>ASM</code> location and open the database:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RMAN&gt; SWITCH DATABASE TO COPY;</span><br><span class="line">RMAN&gt; ALTER DATABASE OPEN;</span><br></pre></td></tr></table></figure><blockquote><p>Add <strong>new tempfiles</strong> and drop the <strong>old tempfiles</strong>:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter tablespace temp add tempfile;</span><br><span class="line">SQL&gt; alter database tempfile '...' DROP;</span><br><span class="line">SQL&gt; select * from dba_temp_files;</span><br></pre></td></tr></table></figure><blockquote><p>Optionally, move <code>SPFILE</code> into <code>ASM</code>:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; CREATE SPFILE '+DATA' FROM PFILE;</span><br></pre></td></tr></table></figure><blockquote><p>Move <strong>redo log files</strong> into <code>ASM</code> - for each group:</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; ALTER DATABASE DROP LOGFILE GROUP 1;</span><br><span class="line">SQL&gt; ALTER DATABASE ADD LOGFILE GROUP 1 SIZE 100M;</span><br></pre></td></tr></table></figure><h5 id="Convert-a-tablespace-to-ASM"><a href="#Convert-a-tablespace-to-ASM" class="headerlink" title="Convert a tablespace to ASM"></a>Convert a tablespace to ASM</h5><blockquote><p>Ensure the database in in <code>archive log mode</code>, and from <code>rman</code>:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">connect target;</span><br><span class="line">sql <span class="string">"alter tablespace TSNAME offline"</span>;</span><br><span class="line">backup as copy tablespace TSNAME format <span class="string">'+DATA'</span>;</span><br><span class="line">switch tablespace TSNAME to copy;</span><br><span class="line">sql <span class="string">"alter tablespace TSNAME online"</span>;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure><h5 id="Convert-a-datafile-to-ASM"><a href="#Convert-a-datafile-to-ASM" class="headerlink" title="Convert a datafile to ASM"></a>Convert a datafile to ASM</h5><blockquote><p>Ensure the database in in <code>archive log mode</code>, and from <code>rman</code>:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">connect target;</span><br><span class="line">sql <span class="string">"alter database datafile '...' offline"</span>;</span><br><span class="line">backup as copy datafile <span class="string">'...'</span> format <span class="string">'+DATA'</span>;</span><br><span class="line">switch datafile <span class="string">'..'</span> to copy;</span><br><span class="line">sql <span class="string">"alter database datafile '...' online"</span>;</span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure><h4 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">V$ASM_DISK <span class="comment">-- ASM disks</span></span><br><span class="line">V$ASM_DISK_STAT <span class="comment">-- cached view of V$ASM_DISK for faster access (used by Enterprise Manager)</span></span><br><span class="line">V$ASM_DISKGROUP <span class="comment">-- ASM diskgroups</span></span><br><span class="line">V$ASM_DISKGROUP_STAT <span class="comment">-- cached view of V$ASM_DISKGROUP for faster access (used by Enterprise Manager)</span></span><br><span class="line">V$ASM_OPERATION <span class="comment">-- status of ongoing disk operations (like rebalancing)</span></span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="https://docs.oracle.com/cd/E11882_01/server.112/e18951/asmcon.htm#OSTMG94057" target="_blank" rel="noopener">https://docs.oracle.com/cd/E11882_01/server.112/e18951/asmcon.htm#OSTMG94057</a><br><a href="http://www.orafaq.com/wiki/Automatic_Storage_Management" target="_blank" rel="noopener">http://www.orafaq.com/wiki/Automatic_Storage_Management</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Database Structure</title>
      <link href="/2016/10/14/database/oracle-kt-database-structure/"/>
      <url>/2016/10/14/database/oracle-kt-database-structure/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Total four parts, <code>Tablespaces, Datafiles</code>, <code>Database Blocks, Extents, Segments</code>, <code>Database Schema Objects</code> and <code>Database Logs</code></p></blockquote><a id="more"></a><h3 id="Tablespace-amp-Datafile"><a href="#Tablespace-amp-Datafile" class="headerlink" title="Tablespace &amp; Datafile"></a>Tablespace &amp; Datafile</h3><blockquote><p>Oracle Database stores logically in <code>tablespaces</code> and physically in <code>datadfiles</code> associated with the corresponding tablespace.<br><img src="/../../../ref/oracle-tablespace-datafile.gif" alt="tablespaces-datafiles"></p></blockquote><h4 id="Select-database-free-space"><a href="#Select-database-free-space" class="headerlink" title="Select database free space"></a>Select database free space</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tablespace_name,file_id,block_id,<span class="keyword">bytes</span>,blocks <span class="keyword">from</span> dba_free_space;</span><br></pre></td></tr></table></figure><h4 id="How-to-Allocate-More-Space-for-a-Database"><a href="#How-to-Allocate-More-Space-for-a-Database" class="headerlink" title="How to Allocate More Space for a Database"></a>How to Allocate More Space for a Database</h4><blockquote><p>Enlarge a database in three ways: </p></blockquote><h5 id="Add-a-datafile-to-a-tablespace"><a href="#Add-a-datafile-to-a-tablespace" class="headerlink" title="Add a datafile to a tablespace"></a>Add a datafile to a tablespace</h5><blockquote><p><img src="/../../../ref/oracle-add-datafile-to-tbs.gif" alt="datafile"></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- add new datafile</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">tablespace</span> app_data <span class="keyword">add</span> <span class="keyword">datafile</span></span><br><span class="line"><span class="string">'/oracle-datafile-path/app03.dbf'</span> <span class="keyword">size</span> <span class="number">50</span>m;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- add new datafile and autoextend datafile</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">tablespace</span> app_data <span class="keyword">add</span> <span class="keyword">datafile</span></span><br><span class="line"><span class="string">'/oracle-datafile-path/app04.dbf'</span> <span class="keyword">size</span> <span class="number">50</span>m</span><br><span class="line"><span class="keyword">autoextend</span> <span class="keyword">on</span> <span class="keyword">next</span> <span class="number">5</span>m <span class="keyword">maxsize</span> <span class="number">100</span>m;</span><br></pre></td></tr></table></figure><h5 id="Add-a-new-tablespace"><a href="#Add-a-new-tablespace" class="headerlink" title="Add a new tablespace"></a>Add a new tablespace</h5><blockquote><p><img src="/../../../ref/oracle-add-new-tbs.gif" alt="tbs"></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create new tablespace and using disk space auto mamagement</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> <span class="string">"app_data02"</span> </span><br><span class="line"><span class="keyword">logging</span></span><br><span class="line"><span class="keyword">datafile</span> <span class="string">'/oracle-datafile-path/app02.ora'</span> <span class="keyword">size</span> <span class="number">5</span>m</span><br><span class="line"><span class="keyword">extent</span>    <span class="keyword">management</span> <span class="keyword">local</span> <span class="keyword">segment</span> <span class="keyword">space</span> <span class="keyword">management</span> <span class="keyword">auto</span></span><br></pre></td></tr></table></figure><h5 id="Increase-the-size-of-a-datafile"><a href="#Increase-the-size-of-a-datafile" class="headerlink" title="Increase the size of a datafile"></a>Increase the size of a datafile</h5><blockquote><p><img src="/../../../ref/oracle-increase-datafile-size.gif" alt="increase-size"></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- allow already exisit datafile autoextend</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">datafile</span> <span class="string">'/oracle-datafile-path/app03.dbf'</span></span><br><span class="line"><span class="keyword">autoextend</span> <span class="keyword">on</span> <span class="keyword">next</span> <span class="number">5</span>m <span class="keyword">maxsize</span> <span class="number">100</span>m;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- manually resize already exisit datafile</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> <span class="keyword">datafile</span> <span class="string">'/oracle-datafile-path/app02.dbf'</span></span><br><span class="line"><span class="keyword">resize</span> <span class="number">100</span>m;</span><br></pre></td></tr></table></figure><h3 id="Database-Blocks-Extents-Segments"><a href="#Database-Blocks-Extents-Segments" class="headerlink" title="Database Blocks, Extents, Segments"></a>Database Blocks, Extents, Segments</h3><blockquote><p>From logical side to divide, <code>Blocks &lt; Extents &lt; Segments &lt; Tablespaces</code><br><img src="/../../../ref/oracle-structure.jpg" alt="structure"></p></blockquote><h4 id="Data-Block"><a href="#Data-Block" class="headerlink" title="Data Block"></a>Data Block</h4><blockquote><p>Oracle Database manages the storage space in the datafiles of a database in units called <strong><code>data blocks</code></strong>. A data block is the smallest unit of data used by a database. In contrast, at the physical, operating system level, all data is stored in bytes. Each operating system has a <code>block size</code>. Oracle Database requests data in multiples of Oracle Database data blocks, not operating system blocks.</p></blockquote><blockquote><p>The standard block size is specified by the <code>DB_BLOCK_SIZE</code> initialization parameter, default value is <code>8192 bytes</code>.</p></blockquote><h4 id="Extents"><a href="#Extents" class="headerlink" title="Extents"></a>Extents</h4><blockquote><p>An <code>extent</code> is a logical unit of database storage space allocation made up of a number of contiguous data blocks. One or more extents in turn make up a <code>segment</code>. When the existing space in a segment is completely used, Oracle Database allocates <code>a new extent</code> for the <code>segment</code>.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Related system tables: `DBA_EXTENTS`, `USER_EXTENTS`.</span><br></pre></td></tr></table></figure><h4 id="Segments"><a href="#Segments" class="headerlink" title="Segments"></a>Segments</h4><blockquote><p>A <code>segment</code> is a set of extents that contains all the data for a specific logical storage structure within a tablespace. For example, for each table, Oracle Database allocates one or more extents to form that table’s data segment, and for each index, Oracle Database allocates one or more extents to form its index segment.<br>Inculde the specific data objects: <code>Table</code>, <code>Index</code>, <code>Cluster Table</code>, and <code>user segments</code>, <code>undo segments</code> and all the types <code>segements</code>.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Related system tables: `DBA_SEGMENTS`, `USER_SEGMENTS`.</span><br></pre></td></tr></table></figure><h4 id="Tablespaces"><a href="#Tablespaces" class="headerlink" title="Tablespaces"></a>Tablespaces</h4><blockquote><p>A database is divided into one or more logical storage units called <strong><code>tablespaces</code></strong>. Tablespaces are divided into logical units of storage called <code>segments</code>, which are further divided into <code>extents</code>. Extents are a collection of contiguous <code>blocks</code>.</p></blockquote><blockquote><p>When create default tablespace, contains <code>SYSTEM TABLESPACE</code>, <code>SYSAUX TABLESPACE</code>, <code>UNDO TABLESPACE</code>, <code>USERS TABLESPACE</code> and <code>TEMP TABLESPACE</code>.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Related views: `V$TABLESPACE`, `V$DATAFILE`, `V$TEMPFILE`.</span><br></pre></td></tr></table></figure><h3 id="Database-Schema-Objects"><a href="#Database-Schema-Objects" class="headerlink" title="Database Schema Objects"></a>Database Schema Objects</h3><blockquote><p>A <code>schema</code> is a collection of logical structures of data, or schema objects. A <code>schema</code> is owned by a database user and has the same name as that user. Each user owns a single schema. Schema objects can be created and manipulated with SQL and include the following types of objects:</p></blockquote><blockquote><p><strong><code>Tables</code></strong>, <strong><code>Views</code></strong>, <strong><code>Materialized Views</code></strong>, <strong><code>Indexes</code></strong>, <strong><code>Sequence</code></strong>, <strong><code>Synonyms</code></strong>, <strong><code>Clusters</code></strong>, <strong><code>Constraints</code></strong>, <strong><code>Tiggers</code></strong>, <strong><code>Database links</code></strong></p></blockquote><h4 id="Tables"><a href="#Tables" class="headerlink" title="Tables"></a>Tables</h4><blockquote><p>Tables is very basic and simple. You know how to operate table <code>CURD</code>, and tables row, column, etc. Certainly, Tables has a lot of others properties, and divide <code>Partitioned Tables</code>, <code>Nested Tables</code>, <code>Temporary Tables</code>. etc.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">( </span><br><span class="line">  column1 datatype [ <span class="literal">NULL</span> | <span class="keyword">NOT</span> <span class="literal">NULL</span> ],</span><br><span class="line">  ...</span><br><span class="line">  column_n datatype [ <span class="literal">NULL</span> | <span class="keyword">NOT</span> <span class="literal">NULL</span> ]</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create as</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> new_table</span><br><span class="line">  <span class="keyword">AS</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> old_table);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- primary key - create / alter / drop / enable</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">(</span><br><span class="line">  column1 datatype <span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> constraint_name PRIMARY <span class="keyword">KEY</span> (column1)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name PRIMARY <span class="keyword">KEY</span> (column1, column2, ... column_n);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">DISABLE</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ENABLE</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter table - multiple / modify / dorp column / rename</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">  <span class="keyword">ADD</span> column_name <span class="keyword">column</span>-definition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">  <span class="keyword">MODIFY</span> column_name column_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">  <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">  <span class="keyword">RENAME</span> <span class="keyword">TO</span> new_table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop table</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [schema_name].table_name</span><br><span class="line">[ <span class="keyword">CASCADE</span> <span class="keyword">CONSTRAINTS</span> ]</span><br><span class="line">[ <span class="keyword">PURGE</span> ];</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT211" target="_blank" rel="noopener">Tables Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/tables.htm#i1008063" target="_blank" rel="noopener">Tables Manage click here</a></p></blockquote><h4 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h4><blockquote><p>It’s a virtual table that doesn’t physically exist, rather it’s created by a query joining one or more other tables.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create view</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">  [<span class="keyword">WHERE</span> conditions];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- update view</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">  <span class="keyword">WHERE</span> conditions;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop view</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- dml statements and join views - same as table operation</span></span><br><span class="line"><span class="keyword">UPDATE</span> emp_dept</span><br><span class="line">     <span class="keyword">SET</span> loc = <span class="string">'BOSTON'</span></span><br><span class="line">     <span class="keyword">WHERE</span> ename = <span class="string">'SMITH'</span>;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT311" target="_blank" rel="noopener">Views Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/views001.htm#ADMIN11774" target="_blank" rel="noopener">Views Manage click here</a></p></blockquote><h4 id="Materialized-Views"><a href="#Materialized-Views" class="headerlink" title="Materialized Views"></a>Materialized Views</h4><blockquote><p><code>Materialized views</code> are schema objects that can be used to summarize, compute, replicate, and distribute data. They are suitable in various computing environments such as data warehousing, decision support, and distributed or mobile computing:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Creating Materialized Aggregate Views</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">LOG</span> <span class="keyword">ON</span> times</span><br><span class="line">   <span class="keyword">WITH</span> <span class="keyword">ROWID</span>, <span class="keyword">SEQUENCE</span> (time_id, calendar_year)</span><br><span class="line">   <span class="keyword">INCLUDING</span> <span class="keyword">NEW</span> <span class="keyword">VALUES</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> <span class="keyword">LOG</span> <span class="keyword">ON</span> products</span><br><span class="line">   <span class="keyword">WITH</span> <span class="keyword">ROWID</span>, <span class="keyword">SEQUENCE</span> (prod_id)</span><br><span class="line">   <span class="keyword">INCLUDING</span> <span class="keyword">NEW</span> <span class="keyword">VALUES</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MATERIALIZED</span> <span class="keyword">VIEW</span> sales_mv</span><br><span class="line">   <span class="keyword">BUILD</span> <span class="keyword">IMMEDIATE</span></span><br><span class="line">   <span class="keyword">REFRESH</span> <span class="keyword">FAST</span> <span class="keyword">ON</span> <span class="keyword">COMMIT</span></span><br><span class="line">   <span class="keyword">AS</span> <span class="keyword">SELECT</span> t.calendar_year, p.prod_id, </span><br><span class="line">      <span class="keyword">SUM</span>(s.amount_sold) <span class="keyword">AS</span> sum_sales</span><br><span class="line">      <span class="keyword">FROM</span> times t, products p, sales s</span><br><span class="line">      <span class="keyword">WHERE</span> t.time_id = s.time_id <span class="keyword">AND</span> p.prod_id = s.prod_id</span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> t.calendar_year, p.prod_id;</span><br></pre></td></tr></table></figure><blockquote><p>And the detail usage will talk about in the later article~<br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT411" target="_blank" rel="noopener">Materialized Views Overview click here</a><br><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_6002.htm" target="_blank" rel="noopener">Materialized Views Examples click here</a></p></blockquote><h4 id="Indexes"><a href="#Indexes" class="headerlink" title="Indexes"></a>Indexes</h4><blockquote><p><code>Indexes</code> are optional structures associated with <code>tables</code> and <code>clusters</code>. You can create many <code>indexes</code> for a <code>table</code> as long as the combination of <code>columns</code> differs for each <code>index</code>. You can create more than one <code>index</code> using the same <code>columns</code> if you specify distinctly different combinations of the <code>columns</code>.</p></blockquote><blockquote><p>Oracle Database provides several indexing schemes, <code>B-tree</code>, <code>Hash cluster</code>, <code>Bitmap</code>, etc., By default, Oracle creates <code>B-tree</code> indexes.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- syntax</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span>] <span class="keyword">INDEX</span> index_name</span><br><span class="line">  <span class="keyword">ON</span> table_name (column1, column2, ... column_n)</span><br><span class="line">  [ <span class="keyword">COMPUTE</span> <span class="keyword">STATISTICS</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create a function-based index</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span>] <span class="keyword">INDEX</span> index_name</span><br><span class="line">  <span class="keyword">ON</span> table_name (function1, function2, ... function_n)</span><br><span class="line">  [ <span class="keyword">COMPUTE</span> <span class="keyword">STATISTICS</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- rename index</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line">  <span class="keyword">RENAME</span> <span class="keyword">TO</span> new_index_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- make index invisible / visible</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> <span class="keyword">index</span> <span class="keyword">INVISIBLE</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> <span class="keyword">index</span> <span class="keyword">VISIBLE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- collect statistics on index</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line">  <span class="keyword">REBUILD</span> <span class="keyword">COMPUTE</span> <span class="keyword">STATISTICS</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- monitoring index usage - enable / disable</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> <span class="keyword">index</span> <span class="keyword">MONITORING</span> <span class="keyword">USAGE</span>; <span class="comment">--enable</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> <span class="keyword">index</span> <span class="keyword">NOMONITORING</span> <span class="keyword">USAGE</span>; <span class="comment">--disable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- monitoring space use of indexes</span></span><br><span class="line"><span class="keyword">SELECT</span> PCT_USED <span class="keyword">FROM</span> INDEX_STATS <span class="keyword">WHERE</span> <span class="keyword">NAME</span> = <span class="string">'index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop index</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT811" target="_blank" rel="noopener">Indexes Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/indexes.htm#i1007132" target="_blank" rel="noopener">Indexes Manage click here</a></p></blockquote><h4 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h4><blockquote><p><code>Sequences</code> are database objects from which multiple users can generate <strong>unique</strong> integers. The sequence generator generates sequential numbers, which can help to generate <code>unique primary keys</code> automatically, and to coordinate keys across <code>multiple rows</code> or <code>tables</code>.</p></blockquote><blockquote><p>Special attention, <strong>Uses and Restrictions of <code>NEXTVAL</code> and <code>CURRVAL</code></strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># cann&apos;t be used in these places:</span><br><span class="line">A subquery</span><br><span class="line">A view query or materialized view query</span><br><span class="line">A SELECT statement with the DISTINCT operator</span><br><span class="line">A SELECT statement with a GROUP BY or ORDER BY clause</span><br><span class="line">A SELECT statement that is combined with another SELECT statement with the UNION, INTERSECT, or MINUS set operator</span><br><span class="line">The WHERE clause of a SELECT statement</span><br><span class="line">DEFAULT value of a column in a CREATE TABLE or ALTER TABLE statement</span><br><span class="line">The condition of a CHECK constraint</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create syntax - alter same as create, replace CREATE to ALTER</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> sequence_name</span><br><span class="line">  <span class="keyword">MINVALUE</span> <span class="keyword">value</span></span><br><span class="line">  MAXVALUE <span class="keyword">value</span></span><br><span class="line">  <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="keyword">value</span></span><br><span class="line">  <span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="keyword">value</span></span><br><span class="line">  <span class="keyword">CACHE</span> <span class="keyword">value</span>;</span><br><span class="line"><span class="comment">-- drop</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">SEQUENCE</span> sequence_name;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT611" target="_blank" rel="noopener">Sequence Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/views002.htm#ADMIN11792" target="_blank" rel="noopener">Sequence Manage click here</a></p></blockquote><h4 id="Synonyms"><a href="#Synonyms" class="headerlink" title="Synonyms"></a>Synonyms</h4><blockquote><p>A <code>synonym</code> is an alias for a schema object. Synonyms can provide a level of security by masking the name and owner of an object and by providing location transparency for remote objects of a distributed database. Also, they are convenient to use and reduce the complexity of SQL statements for database users.</p></blockquote><blockquote><p>You can create both <code>public</code> and <code>private</code> synonyms. A <code>public synonym</code> is owned by the special user group named <code>PUBLIC</code> and is accessible to every user in a database. A <code>private synonym</code> is contained in the schema of a specific user and available only to the user and to grantees for the underlying object.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- I think the sql statement is very clear to express</span></span><br><span class="line"><span class="comment">-- create syntax</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>] [<span class="keyword">PUBLIC</span>] <span class="keyword">SYNONYM</span> [<span class="keyword">schema</span> .] synonym_name</span><br><span class="line">  <span class="keyword">FOR</span> [<span class="keyword">schema</span> .] object_name [@ dblink];</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PUBLIC</span> <span class="keyword">SYNONYM</span> public_emp <span class="keyword">FOR</span> jward.emp</span><br><span class="line"></span><br><span class="line"><span class="comment">-- synonyms in dml statements</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* If you have only the SELECT privilege on the jward.emp table, </span></span><br><span class="line"><span class="comment">* and the synonym jward.employee is created for jward.emp, </span></span><br><span class="line"><span class="comment">* you can query the jward.employee synonym, </span></span><br><span class="line"><span class="comment">* but you cannot insert rows using the jward.employee synonym.</span></span><br><span class="line"><span class="comment">* And if a synonym named employee refers to a table or view,</span></span><br><span class="line"><span class="comment">* then the following statement is valid:</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (empno, ename, job)</span><br><span class="line">    <span class="keyword">VALUES</span> (emp_sequence.NEXTVAL, <span class="string">'SMITH'</span>, <span class="string">'CLERK'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop</span></span><br><span class="line"><span class="keyword">DROP</span> [<span class="keyword">PUBLIC</span>] <span class="keyword">SYNONYM</span> [<span class="keyword">schema</span> .] synonym_name [<span class="keyword">force</span>];</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PUBLIC</span> <span class="keyword">SYNONYM</span> public_emp;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT711" target="_blank" rel="noopener">Synonyms Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/views003.htm#ADMIN11805" target="_blank" rel="noopener">Synonyms Manage click here</a></p></blockquote><h4 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h4><blockquote><p>Totally contains <code>PRIMARY KEY CONSTRAINT</code>, <code>UNIQUE CONSTRAINT</code>, <code>FOREIGN KEY CONSTRAINT</code>, <code>NOT NULL CONSTRAINT</code> and <code>CHECK CONSTRAINT</code>, etc.</p></blockquote><h5 id="PRIMARY-KEY-CONSTRAINT"><a href="#PRIMARY-KEY-CONSTRAINT" class="headerlink" title="PRIMARY KEY CONSTRAINT"></a>PRIMARY KEY CONSTRAINT</h5><blockquote><p>A <code>primary</code> key constraint designates a column as the primary key of a table or view. A <strong>composite primary key</strong> designates a combination of columns as the <code>primary</code> key. When you define a primary key constraint inline, you need only the <code>PRIMARY KEY</code> keywords. When you define a primary key constraint out of line, you must also specify one or more columns. You must define a composite primary key out of line.</p></blockquote><blockquote><p>A primary key constraint combines a <code>NOT NULL</code> and <code>UNIQUE</code> constraint in one declaration.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- syntax</span></span><br><span class="line"><span class="comment">-- create</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">column</span> datatype <span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> constraint_name PRIMARY <span class="keyword">KEY</span> (<span class="keyword">column</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name PRIMARY <span class="keyword">KEY</span> (column1, column2, ... column_n);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- enable / disable</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ENABLE</span>/<span class="keyword">DISABLE</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br></pre></td></tr></table></figure><h5 id="UNIQUE-CONSTRAINT"><a href="#UNIQUE-CONSTRAINT" class="headerlink" title="UNIQUE CONSTRAINT"></a>UNIQUE CONSTRAINT</h5><blockquote><p>A <code>unique</code> constraint designates a column as a unique key. A <strong>composite unique key</strong> designates a combination of columns as the <code>unique</code> key. When you define a unique constraint inline, you need only the <code>UNIQUE</code> keyword. When you define a unique constraint out of line, you must also specify one or more columns. You must define a composite unique key out of line.</p></blockquote><blockquote><p>To satisfy a unique constraint, no two rows in the table can have the same value for the unique key. However, the unique key made up of a single column can contain nulls. To satisfy a composite unique key, no two rows in the table or view can have the same combination of values in the key columns. Any row that contains nulls in all key columns automatically satisfies the constraint. However, two rows that contain nulls for one or more key columns and the same combination of values for the other key columns violate the constraint.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- syntax it's same as primary key</span></span><br><span class="line"><span class="comment">-- create</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">(</span><br><span class="line">  column1 datatype [ <span class="literal">NULL</span> | <span class="keyword">NOT</span> <span class="literal">NULL</span> ],</span><br><span class="line">  column2 datatype [ <span class="literal">NULL</span> | <span class="keyword">NOT</span> <span class="literal">NULL</span> ],</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> constraint_name <span class="keyword">UNIQUE</span> (uc_col1, uc_col2, ... uc_col_n)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name <span class="keyword">UNIQUE</span> (column1, column2, ... column_n);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- enable / disable</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ENABLE</span>/<span class="keyword">DISABLE</span> <span class="keyword">CONSTRAINT</span> constraint_name;</span><br></pre></td></tr></table></figure><h5 id="FOREIGN-KEY-CONSTRAINT"><a href="#FOREIGN-KEY-CONSTRAINT" class="headerlink" title="FOREIGN KEY CONSTRAINT"></a>FOREIGN KEY CONSTRAINT</h5><blockquote><p>A <code>foreign key</code> constraint (also called a referential integrity constraint) designates a column as the foreign key and establishes a relationship between that foreign key and a specified primary or unique key, called the <strong>referenced key</strong>. A <strong>composite foreign key</strong> designates a combination of columns as the foreign key.</p></blockquote><blockquote><p>You can define a foreign key constraint on a single key column either inline or out of line. You must specify a composite foreign key and a foreign key on an attribute out of line.</p></blockquote><blockquote><p>To satisfy a composite foreign key constraint, the composite foreign key must refer to a composite unique key or a composite primary key in the parent table or view, or the value of at least one of the columns of the foreign key must be null.</p></blockquote><blockquote><p><code>Specifc Attention ON DELETE Clause</code><br>The ON DELETE clause lets you determine how Oracle Database automatically maintains referential integrity if you remove a referenced primary or unique key value. If you omit this clause, then Oracle does not allow you to delete referenced key values in the parent table that have dependent rows in the child table.</p></blockquote><blockquote><ul><li>Specify <code>CASCADE</code> if you want Oracle to remove dependent foreign key values.</li></ul></blockquote><blockquote><ul><li>Specify <code>SET NULL</code> if you want Oracle to convert dependent foreign key values to <code>NULL</code>. You cannot specify this clause for a virtual column, because the values in a virtual column cannot be updated directly. Rather, the values from which the virtual column are derived must be updated.</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- syntax</span></span><br><span class="line"><span class="comment">-- create</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">(</span><br><span class="line">  column1 datatype <span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  column2 datatype <span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> fk_column</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (column1, column2, ... column_n)</span><br><span class="line">    <span class="keyword">REFERENCES</span> parent_table (column1, column2, ... column_n)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alter</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> constraint_name</span><br><span class="line">   <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (column1, column2, ... column_n)</span><br><span class="line">   <span class="keyword">REFERENCES</span> parent_table (column1, column2, ... column_n);</span><br></pre></td></tr></table></figure><h5 id="NOT-NULL-CONSTRAINT"><a href="#NOT-NULL-CONSTRAINT" class="headerlink" title="NOT NULL CONSTRAINT"></a>NOT NULL CONSTRAINT</h5><blockquote><p>A <code>NOT NULL</code> constraint prohibits a column from containing nulls. The <code>NULL</code> keyword by itself does not actually define an integrity constraint, but you can specify it to explicitly permit a column to contain nulls. You must define <code>NOT NULL</code> and <code>NULL</code> using inline specification. If you specify neither <code>NOT NULL</code> nor <code>NULL</code>, then the default is <code>NULL</code>.<br><code>NOT NULL</code> constraints are the only constraints you can specify inline on <code>XMLType and</code>VARRAY<code>columns.To satisfy a</code>NOT NULL` constraint, every row in the table must <strong>contain a value</strong> for the column.</p></blockquote><blockquote><ul><li>You cannot specify <code>NULL</code> or <code>NOT NULL</code> in a <strong>view</strong> constraint.</li></ul></blockquote><blockquote><ul><li>You cannot specify <code>NULL</code> or <code>NOT NULL</code> for an attribute of an object. Instead, use a <code>CHECK</code> constraint with the <code>IS [NOT] NULL</code> condition.</li></ul></blockquote><h5 id="CHECK-CONSTRAINT"><a href="#CHECK-CONSTRAINT" class="headerlink" title="CHECK CONSTRAINT"></a>CHECK CONSTRAINT</h5><blockquote><p>A <code>check</code> constraint lets you specify a condition that each row in the table must <strong>satisfy</strong>. To satisfy the constraint, each row in the table must make the condition either <code>TRUE</code> or unknown (due to a null). When Oracle evaluates a check constraint condition for a particular row, any column names in the condition refer to the column values in that row.</p></blockquote><blockquote><p>The syntax for inline and out-of-line specification of check constraints is the same. However, inline specification can refer only to the column (or the attributes of the column if it is an object column) currently being defined, whereas out-of-line specification can refer to multiple columns or attributes.</p></blockquote><blockquote><p><code>Restrictions on Check Constraints</code></p></blockquote><blockquote><ul><li>You cannot specify a <code>check constraint</code> for a <strong>view</strong>. However, you can define the view using the <code>WITH CHECK OPTION</code> clause, which is equivalent to specifying a check constraint for the view.</li><li>The condition of a check constraint can refer to any column in the table, but it cannot refer to columns of other tables.</li></ul></blockquote><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28286/clauses002.htm#SQLRF52163" target="_blank" rel="noopener">Constraints Detail click here</a><br><a href="http://docs.oracle.com/cd/B28359_01/server.111/b28310/general005.htm#ADMIN11537" target="_blank" rel="noopener">Constraints Manage click here</a></p></blockquote><h4 id="Tiggers"><a href="#Tiggers" class="headerlink" title="Tiggers"></a>Tiggers</h4><blockquote><p>Database <code>triggers</code> are procedures that are stored in the database and activated (“<strong>fired</strong>“) when specific conditions occur, such as adding a row to a table. You can use triggers to supplement the standard capabilities of the database to provide a highly customized database management system.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*create trigger statement it can be defined as firing</span></span><br><span class="line"><span class="comment">* BEFORE or AFTER the triggering event, or INSTEAD OF it.</span></span><br><span class="line"><span class="comment">* AFTER / BEFORE [DML] Statements</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- create an AFTER DELETE trigger</span></span><br><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">OR</span> <span class="keyword">REPLACE</span> ] <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">DELETE</span></span><br><span class="line">   <span class="keyword">ON</span> table_name</span><br><span class="line">   [ <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   <span class="comment">-- variable declarations</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="comment">-- trigger code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXCEPTION</span></span><br><span class="line">   <span class="keyword">WHEN</span> ...</span><br><span class="line">   <span class="comment">-- exception handling</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- trigger enable / disable</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TRIGGER</span> trigger_name <span class="keyword">ENABLE</span>; <span class="comment">--single</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ENABLE</span> <span class="keyword">ALL</span> <span class="keyword">TRIGGERS</span>; <span class="comment">--all</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TRIGGER</span> trigger_name <span class="keyword">DISABLE</span>; <span class="comment">--single</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DISABLE</span> <span class="keyword">ALL</span> <span class="keyword">TRIGGERS</span>; <span class="comment">--all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop trigger</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> trigger_name;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/general004.htm#ADMIN11534" target="_blank" rel="noopener">Enabling and Disabling Triggers Detail click here</a></p></blockquote><h4 id="Clusters"><a href="#Clusters" class="headerlink" title="Clusters"></a>Clusters</h4><blockquote><p>A <code>cluster</code> provides an optional method of storing table data. A <code>cluster</code> is made up of a group of tables that share the same data blocks. The tables are grouped together because they share common columns and are often used together. </p></blockquote><blockquote><p><code>primary benefits:</code></p></blockquote><blockquote><ul><li>Disk I/O is reduced and access time improves for joins of clustered tables.</li></ul></blockquote><blockquote><ul><li>The <code>cluster key</code> is the <strong>column</strong>, or <strong>group of columns</strong>, that the clustered tables have in common. You specify the columns of the cluster key when creating the cluster. You subsequently specify the same columns when creating every table added to the cluster. Each cluster key value is stored only once each in the cluster and the cluster index, no matter how many rows of different tables contain the value.</li></ul></blockquote><blockquote><p>And the detail usage will talk about in the later article~<br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/schema.htm#CNCPT608" target="_blank" rel="noopener">Clusters Overview click here</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/clustrs.htm#i1006586" target="_blank" rel="noopener">Clusters Manage click here</a></p></blockquote><h4 id="Database-links"><a href="#Database-links" class="headerlink" title="Database links"></a>Database links</h4><blockquote><p>A <code>database link</code> is a schema object in one database that enables you to access objects on another database. The other database need not be an Oracle Database system. However, to access non-Oracle systems you must use Oracle Heterogeneous Services.</p></blockquote><blockquote><p>By the type, It’s contain <code>private</code>, <code>public</code>, and <code>global</code> database links.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">SHARED</span>] [<span class="keyword">PUBLIC</span>] <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> &lt;link_name&gt;</span><br><span class="line"><span class="keyword">CONNECT</span> <span class="keyword">TO</span> <span class="keyword">CURRENT_USER</span></span><br><span class="line"><span class="keyword">USING</span> <span class="string">'&lt;service_name&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create tnsnames entry for conn_link</span></span><br><span class="line">conn_link =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS_LIST =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = perrito2)(PORT = 1521))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVICE_NAME = orabase)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">conn uwclass/uwclass</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> conn_user</span><br><span class="line"><span class="keyword">USING</span> <span class="string">'conn_link'</span>;</span><br><span class="line"></span><br><span class="line">desc user_db_links</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> linesize <span class="number">121</span></span><br><span class="line"><span class="keyword">col</span> db_link <span class="keyword">format</span> a20</span><br><span class="line"><span class="keyword">col</span> username <span class="keyword">format</span> a20</span><br><span class="line"><span class="keyword">col</span> <span class="keyword">password</span> <span class="keyword">format</span> a20</span><br><span class="line"><span class="keyword">col</span> host <span class="keyword">format</span> a20</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_db_links;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> all_db_links;</span><br><span class="line"><span class="keyword">SELECT</span> table_name, tablespace_name <span class="keyword">FROM</span> user_tables@conn_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- close db link</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SESSION</span> <span class="keyword">CLOSE</span> <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> &lt;link_name&gt;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SESSION</span> <span class="keyword">CLOSE</span> <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> curr_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- drop db link</span></span><br><span class="line"><span class="keyword">DROP</span> [<span class="keyword">PUBLIC</span>] <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> &lt;link_name&gt;;</span><br><span class="line"><span class="keyword">DROP</span> [<span class="keyword">PUBLIC</span>] <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> test_link;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- test db link</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">ALTER</span> <span class="keyword">SESSION</span> <span class="keyword">CLOSE</span> <span class="keyword">DATABASE</span> <span class="keyword">LINK</span> remove_db;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">SELECT</span> table_name</span><br><span class="line">  <span class="keyword">INTO</span> i</span><br><span class="line">  <span class="keyword">FROM</span> all_tables@remote_db</span><br><span class="line">  <span class="keyword">WHERE</span> <span class="keyword">rownum</span> = <span class="number">1</span>;</span><br><span class="line">EXCEPTION</span><br><span class="line">  WHEN OTHERS THEN</span><br><span class="line">    RAISE_APPLICATION_ERROR(-20999, 'No Connection');</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/ds_concepts002.htm#ADMIN12083" target="_blank" rel="noopener">Database links Overview click here</a><br><a href="http://psoug.org/reference/db_link.html" target="_blank" rel="noopener">Database link pl/sql</a></p></blockquote><h3 id="Database-logs"><a href="#Database-logs" class="headerlink" title="Database logs"></a>Database logs</h3><h4 id="Redo-logs"><a href="#Redo-logs" class="headerlink" title="Redo logs"></a>Redo logs</h4><blockquote><p><code>Redo logs</code> contain a record of changes that were made to datafiles. Redo logs are stored in redo log groups, and you must have <strong>at least two redo log groups</strong> for your database. After the redo log files in a group have filled up, the log writer process (<code>LGWR</code>) switches the writing of redo records to a new redo log group.</p></blockquote><blockquote><p>And specific point:</p><ul><li>Record of how to reproduce a change</li><li>Used for Rolling forward database changes</li><li>Stored in redo log files</li><li>Protect against data loss.</li></ul></blockquote><h5 id="How-to-detect"><a href="#How-to-detect" class="headerlink" title="How to detect"></a>How to detect</h5><blockquote><p>To find sessions generating lots of redo, you can use either of the following methods. Both methods examine the amount of undo generated. When a transaction generates undo, it will automatically generate redo as well. </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Query V$SESS_IO. </span></span><br><span class="line"><span class="comment">* This view contains the column BLOCK_CHANGES which indicates </span></span><br><span class="line"><span class="comment">* how much blocks have been changed by the session. </span></span><br><span class="line"><span class="comment">* High values indicate a session generating lots of redo.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sid, s.serial<span class="comment">#, s.username, s.program, i.block_changes</span></span><br><span class="line"><span class="keyword">FROM</span> v$<span class="keyword">session</span> s, v$sess_io i</span><br><span class="line"><span class="keyword">WHERE</span> s.sid = i.sid</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">5</span> <span class="keyword">desc</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Query V$TRANSACTION.</span></span><br><span class="line"><span class="comment">* These view contains information about the amount of undo blocks </span></span><br><span class="line"><span class="comment">* and undo records accessed by the transaction </span></span><br><span class="line"><span class="comment">* (as found in the USED_UBLK and USED_UREC columns).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sid, s.serial<span class="comment">#, s.username, s.program, t.used_ublk, t.used_urec</span></span><br><span class="line"><span class="keyword">FROM</span> v$<span class="keyword">session</span> s, v$<span class="keyword">transaction</span> t</span><br><span class="line"><span class="keyword">WHERE</span> s.taddr = t.addr</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">5</span> <span class="keyword">desc</span>, <span class="number">6</span> <span class="keyword">desc</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>;</span><br></pre></td></tr></table></figure><h4 id="Archive-logs"><a href="#Archive-logs" class="headerlink" title="Archive logs"></a>Archive logs</h4><blockquote><p>Oracle Database can automatically save the inactive group of redo log files to one or more offline destinations, known collectively as the <code>archived redo log</code> (also called the <strong>archive log</strong>). The process of turning redo log files into archived redo log files is called <strong>archiving</strong>.</p></blockquote><h5 id="How-to-detect-archive-mode"><a href="#How-to-detect-archive-mode" class="headerlink" title="How to detect archive mode:"></a>How to detect archive mode:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlplus / as sysdba</span><br><span class="line">SQL&gt; archive <span class="built_in">log</span> list</span><br><span class="line">Database <span class="built_in">log</span> mode              No Archive Mode</span><br><span class="line">Automatic archival             Disabled</span><br><span class="line">Archive destination            USE_DB_RECOVERY_FILE_DEST</span><br><span class="line">Oldest online <span class="built_in">log</span> sequence     25</span><br><span class="line">Current <span class="built_in">log</span> sequence           27</span><br><span class="line"></span><br><span class="line">SQL&gt; show parameter recovery_file_dest</span><br><span class="line">NAME                                 TYPE        VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">db_recovery_file_dest                string      /u01/app/oracle/flash_recovery</span><br><span class="line">                                                 _area</span><br><span class="line">db_recovery_file_dest_size           big <span class="built_in">integer</span> 3852M</span><br></pre></td></tr></table></figure><h5 id="How-to-enable-disable-archive"><a href="#How-to-enable-disable-archive" class="headerlink" title="How to enable / disable archive"></a>How to enable / disable archive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># first shutdown database</span></span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line"><span class="comment"># then startup mount</span></span><br><span class="line">SQL&gt; startup mount</span><br><span class="line"><span class="comment"># alter database archive mode</span></span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">SQL&gt; archive <span class="built_in">log</span> list</span><br><span class="line">Database <span class="built_in">log</span> mode              Archive Mode</span><br><span class="line">Automatic archival             Enabled</span><br><span class="line">Archive destination            /u02/app/oracle/oradata/orcl/arch</span><br><span class="line">Oldest online <span class="built_in">log</span> sequence     25</span><br><span class="line">Next <span class="built_in">log</span> sequence to archive   27</span><br><span class="line">Current <span class="built_in">log</span> sequence           27</span><br><span class="line"><span class="comment"># switch log file location</span></span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; host </span><br><span class="line">$ ls /u02/app/oracle/oradata/orcl/arch</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable archive is almost same as enable</span></span><br><span class="line"><span class="comment"># just change this one:</span></span><br><span class="line">SQL&gt; alter database noarchivelog;</span><br></pre></td></tr></table></figure><h4 id="Undo-logs"><a href="#Undo-logs" class="headerlink" title="Undo logs"></a>Undo logs</h4><blockquote><p><code>Undo tablespaces</code> are special tablespaces used solely for storing undo information.<br>You cannot create any other <code>segment types</code> (for example, <code>tables or indexes</code>) in <code>undo tablespaces</code>. Each database contains <strong>zero or more</strong> undo tablespaces. In automatic undo management mode, each Oracle instance is assigned <strong>one (and only one)</strong> undo tablespace.<br>Undo data is managed within an undo tablespace using undo segments that are automatically created and maintained by Oracle.</p></blockquote><blockquote><p>And undo records are used to：</p><ul><li>Roll back transactions when a ROLLBACK statement is issued</li><li>Recover the database</li><li>Provide read consistency</li><li>Analyze data as of an earlier point in time by using Oracle Flashback Query</li><li>Recover from logical corruptions using Oracle Flashback features </li></ul></blockquote><blockquote><p>but, It’s different with redo:</p><ul><li>Record of how to undo a change.</li><li>Used for Rollback, read-consistency</li><li>Stored in Undo Segments</li><li>Protect against inconsistent reads in multiuser systems</li></ul></blockquote><h5 id="How-to-detect-1"><a href="#How-to-detect-1" class="headerlink" title="How to detect"></a>How to detect</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* V$TRANSACTION linked with V$SESSION will show current used undo blocks for ongoing transactions.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> a.sid, a.username, b.used_urec, b.used_ublk</span><br><span class="line"><span class="keyword">FROM</span> v$<span class="keyword">session</span> a, v$<span class="keyword">transaction</span> b</span><br><span class="line"><span class="keyword">WHERE</span> a.saddr = b.ses_addr</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> b.used_ublk <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* V$SESSTAT provides another view, which uses the undo kind of view, </span></span><br><span class="line"><span class="comment">* but we must avoid getting lost in the maze of Oracle statistics and focusing on just one: </span></span><br><span class="line"><span class="comment">* Undo change vector size, which will accumulate the bytes of undo used during the session lifetime.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> a.sid, b.name, a.value</span><br><span class="line"><span class="keyword">FROM</span> v$sesstat a, v$statname b</span><br><span class="line"><span class="keyword">WHERE</span> a.statistic<span class="comment"># = b.statistic#</span></span><br><span class="line"><span class="keyword">AND</span> a.statistic<span class="comment"># = 176&lt;– Which stands for undo change vector size</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.value <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><h4 id="Logs-and-Directories"><a href="#Logs-and-Directories" class="headerlink" title="Logs and Directories"></a>Logs and Directories</h4><h5 id="How-to-detect-log-in-sql-statement"><a href="#How-to-detect-log-in-sql-statement" class="headerlink" title="How to detect log in sql statement"></a>How to detect log in sql statement</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Displays all redo log groups for the database and indicates which need to be archived.</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP</span><span class="comment">#, THREAD#, SEQUENCE#, MEMBERS, ARCHIVED, STATUS FROM SYS.V$LOG;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Shows if the database is in ARCHIVELOG or NOARCHIVELOG mode </span></span><br><span class="line"><span class="comment">-- and if MANUAL (archiving mode) has been specified.</span></span><br><span class="line"><span class="keyword">SELECT</span> LOG_MODE <span class="keyword">FROM</span> SYS.V$<span class="keyword">DATABASE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Displays information about the state of the various archive processes for an instance.</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> SYS.V$ARCHIVE_PROCESSES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Displays historical archived log information from the control file. </span></span><br><span class="line"><span class="comment">-- If you use a recovery catalog, the RC_ARCHIVED_LOG view contains similar information.</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> SYS.V$ARCHIVED_LOG;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Describes the current instance, all archive destinations, </span></span><br><span class="line"><span class="comment">-- and the current value, mode, and status of these destinations.</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> SYS.V$ARCHIVE_DEST;</span><br></pre></td></tr></table></figure><h5 id="How-to-list-oracle-directories"><a href="#How-to-list-oracle-directories" class="headerlink" title="How to list oracle directories"></a>How to list oracle directories</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- list all directories in the database.</span></span><br><span class="line"><span class="keyword">select</span> owner, directory_name, directory_path <span class="keyword">from</span> dba_directories;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- list logfiles member</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">member</span> <span class="keyword">from</span> v$<span class="keyword">logfile</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://psoug.org/index.htm" target="_blank" rel="noopener">http://psoug.org/index.htm</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/physical.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B28359_01/server.111/b28318/physical.htm</a><br><a href="http://database.51cto.com/art/200910/158936.htm" target="_blank" rel="noopener">http://database.51cto.com/art/200910/158936.htm</a><br><a href="https://docs.oracle.com/cd/B28359_01/server.111/b28318/logical.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B28359_01/server.111/b28318/logical.htm</a><br><a href="http://www.jianshu.com/p/4d388f148737" target="_blank" rel="noopener">http://www.jianshu.com/p/4d388f148737</a><br><a href="https://oraclenz.wordpress.com/2008/06/22/differences-between-undo-and-redo/" target="_blank" rel="noopener">https://oraclenz.wordpress.com/2008/06/22/differences-between-undo-and-redo/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - How to Read a Query Plan</title>
      <link href="/2016/10/13/database/oracle-kt-how-to-read-a-query-plan/"/>
      <url>/2016/10/13/database/oracle-kt-how-to-read-a-query-plan/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Goal: know how to generate and read a basic query plan.<br>Understand key phrases, such as <strong>Full Table Scan</strong> and <strong>Nested Loops</strong> should jump out as red flags. Be able to generate &amp; analyze a SQL query plan</p></blockquote><a id="more"></a><blockquote><p>When you fire an SQL query to Oracle, Oracle database internally creates a <strong>query execution plan</strong> in order to fetch the desired data from the physical tables. The query execution plan is nothing but a set of methods on how the database will access the data from the tables. This query execution plan is crucial as different execution plans will need different cost and time for the query execution.</p></blockquote><blockquote><p>How the Execution Plan is created actually depends on what type of query optimizer is being used in your Oracle database. There are two different optimizer options – <strong>Rule based (RBO)</strong> and <strong>Cost based (CBO)</strong> Optimizer. For Oracle 10g, <strong>CBO</strong> is the default optimizer. Cost Based optimizer enforces Oracle to generate the optimization plan by taking all the related table statistics into consideration. On the other hand, <strong>RBO</strong> uses a fixed set of <strong>pre-defined rules</strong> to generate the query plan. Obviously such fixed set of rules may not always be able to create the plan that is most efficient in nature. This is because an efficient plan will depend heavily on the nature and volume of table’s data. Because of this reason, <strong>CBO</strong> is preferred over <strong>RBO</strong>.</p></blockquote><h3 id="How-to-read-excution-plan-basic"><a href="#How-to-read-excution-plan-basic" class="headerlink" title="How to read excution plan - basic"></a>How to read excution plan - basic</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PLAN_TABLE_OUTPUT </span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(DBMS_XPLAN.DISPLAY(<span class="literal">NULL</span>, <span class="string">'statement_id'</span>,<span class="string">'BASIC'</span>));</span><br></pre></td></tr></table></figure><blockquote><p>See the below example, read detail execution four scan way:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create simple table - product</span></span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> (</span><br><span class="line"><span class="keyword">ID</span> <span class="built_in">number</span>(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">varchar2</span>(<span class="number">100</span>)</span><br><span class="line">DESCRIPTION <span class="built_in">varchar2</span>(<span class="number">255</span>)</span><br><span class="line">SERVICE <span class="built_in">varchar2</span>(<span class="number">30</span>)</span><br><span class="line">PART_NUM <span class="built_in">varchar2</span>(<span class="number">50</span>)</span><br><span class="line">LOAD_DATE <span class="built_in">date</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- insert data 15000 records without index</span></span><br></pre></td></tr></table></figure><h3 id="Full-Table-Scan"><a href="#Full-Table-Scan" class="headerlink" title="Full Table Scan"></a>Full Table Scan</h3><blockquote><ul><li>Whole table is read upto high water mark</li><li>Uses multiblock input/output</li><li>Buffer from FTS operation is stored in LRU end of buffer cache</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- explain plan</span></span><br><span class="line">SQL&gt; explain plan for select * from product;</span><br><span class="line">Explained.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- query plan</span></span><br><span class="line">SQL&gt; select * from table(dbms_xplan.display);</span><br><span class="line">PLAN_TABLE_OUTPUT</span><br><span class="line"><span class="comment">----------------------------------------------------------</span></span><br><span class="line">Plan hash value: 3917577207</span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line">| Id  | Operation          | Name   |</span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line">|   0 | <span class="keyword">SELECT</span> <span class="keyword">STATEMENT</span>   |        |</span><br><span class="line">|   <span class="number">1</span> |  <span class="keyword">TABLE</span> <span class="keyword">ACCESS</span> <span class="keyword">FULL</span> | PRODUCT|</span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- use RBO instead of CBO statistic </span></span><br><span class="line"><span class="keyword">SQL</span>&gt; <span class="keyword">Analyze</span> <span class="keyword">table</span> product <span class="keyword">compute</span> <span class="keyword">statistics</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- query plan</span></span><br><span class="line">SQL&gt; select * from table(dbms_xplan.display);</span><br><span class="line"></span><br><span class="line">PLAN_TABLE_OUTPUT</span><br><span class="line"><span class="comment">-----------------------------------------------------</span></span><br><span class="line">Plan hash value: 3917577207</span><br><span class="line"><span class="comment">-----------------------------------------------------</span></span><br><span class="line">| Id  | Operation          | Name    | Rows  | Bytes |</span><br><span class="line"><span class="comment">-----------------------------------------------------</span></span><br><span class="line">|   0 | <span class="keyword">SELECT</span> <span class="keyword">STATEMENT</span>   |         | <span class="number">15856</span> |  <span class="number">1254</span>K|</span><br><span class="line">|   <span class="number">1</span> |  <span class="keyword">TABLE</span> <span class="keyword">ACCESS</span> <span class="keyword">FULL</span> | PRODUCT | <span class="number">15856</span> |  <span class="number">1254</span>K|</span><br><span class="line"><span class="comment">-----------------------------------------------------</span></span><br></pre></td></tr></table></figure><h3 id="Index-Unique-Scan"><a href="#Index-Unique-Scan" class="headerlink" title="Index Unique Scan"></a>Index Unique Scan</h3><blockquote><ul><li>Single block input/output</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create index for test</span></span><br><span class="line">SQL&gt; create unique index idx_prod_id on product (id) compute statistics;</span><br><span class="line">Index created.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- explain plan</span></span><br><span class="line">SQL&gt; explain plan for select id from product where id = 100;</span><br><span class="line">Explained.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- query plan</span></span><br><span class="line">SQL&gt; select * from table(dbms_xplan.display);</span><br><span class="line"></span><br><span class="line">PLAN_TABLE_OUTPUT</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line">Plan hash value: 2424962071</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line">| Id  | Operation          | Name        | Rows  | Bytes |</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line">|   0 | <span class="keyword">SELECT</span> <span class="keyword">STATEMENT</span>   |             |     <span class="number">1</span> |     <span class="number">4</span> |</span><br><span class="line">|*  <span class="number">1</span> |  <span class="keyword">INDEX</span> <span class="keyword">UNIQUE</span> <span class="keyword">SCAN</span> | IDX_PROD_ID |     <span class="number">1</span> |     <span class="number">4</span> |</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br></pre></td></tr></table></figure><h3 id="Index-Fast-Full-Scan"><a href="#Index-Fast-Full-Scan" class="headerlink" title="Index Fast Full Scan"></a>Index Fast Full Scan</h3><blockquote><ul><li>Multi block i/o possible</li><li>Returned rows may not be in sorted order</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- explain plan</span></span><br><span class="line">SQL&gt; explain plan for select id from product where id&gt;10;</span><br><span class="line">Explained.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- query plan</span></span><br><span class="line">SQL&gt; select * from table(dbms_xplan.display);</span><br><span class="line"></span><br><span class="line">PLAN_TABLE_OUTPUT</span><br><span class="line"><span class="comment">------------------------------------------------</span></span><br><span class="line">Plan hash value: 2179322443</span><br><span class="line"><span class="comment">--------------------------------------------------------</span></span><br><span class="line">| Id  | Operation            | Name       | Rows |Bytes |</span><br><span class="line"><span class="comment">--------------------------------------------------------</span></span><br><span class="line">|   0 | <span class="keyword">SELECT</span> <span class="keyword">STATEMENT</span>     |            | <span class="number">15849</span>|<span class="number">63396</span> |</span><br><span class="line">|*  <span class="number">1</span> |  <span class="keyword">INDEX</span> <span class="keyword">FAST</span> <span class="keyword">FULL</span> <span class="keyword">SCAN</span>| IDX_PROD_ID| <span class="number">15849</span>|<span class="number">63396</span> |</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br></pre></td></tr></table></figure><h3 id="Index-Full-Scan"><a href="#Index-Full-Scan" class="headerlink" title="Index Full Scan"></a>Index Full Scan</h3><blockquote><ul><li>Single block i/o</li><li>Returned rows generally will be in sorted order</li></ul></blockquote><blockquote><p>Resources:<br><a href="https://dwbi.org/database/oracle/38-oracle-query-plan-a-10-minutes-guide" target="_blank" rel="noopener">https://dwbi.org/database/oracle/38-oracle-query-plan-a-10-minutes-guide</a><br><a href="https://dwbi.org/database/oracle/39-query-execution-plan-part2.html" target="_blank" rel="noopener">https://dwbi.org/database/oracle/39-query-execution-plan-part2.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sublime Text 快捷键备忘</title>
      <link href="/2016/10/10/tools/sublime-text-shortcuts/"/>
      <url>/2016/10/10/tools/sublime-text-shortcuts/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Sublime 火了可不止两三年，如果是前端开发，或者是写脚本，可真是神器。只可惜我这做后端开发的接触这个倒挺早，却一直没有深入。<br>比较常见的就不写了~</p></blockquote><a id="more"></a> <h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Alt：调出菜单</span><br><span class="line">Ctrl + Shift + P：调出命令板（Command Palette）</span><br><span class="line">Ctrl + `：调出控制台</span><br><span class="line">Ctrl + X：删除当前行</span><br><span class="line">Ctrl + M：跳转到对应括号</span><br><span class="line">Ctrl + U：软撤销，撤销光标位置</span><br><span class="line">Ctrl + /：注释当前行</span><br><span class="line">Ctrl + Shift + /：当前位置插入注释</span><br><span class="line">Ctrl + F2：设置/删除标记</span><br><span class="line">Ctrl + Alt + /：块注释，并Focus到首行，写注释说明用的</span><br><span class="line">Ctrl + Shift + A：选择当前标签前后，修改标签用的</span><br></pre></td></tr></table></figure><h3 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + Enter：在当前行下面新增一行然后跳至该行</span><br><span class="line">Ctrl + Shift + Enter：在当前行上面增加一行并跳至该行</span><br><span class="line">Ctrl + ←/→：进行逐词移动</span><br><span class="line">Ctrl + Shift + ←/→进行逐词选择</span><br><span class="line">Ctrl + ↑/↓移动当前显示区域</span><br><span class="line">Ctrl + Shift + ↑/↓移动当前行</span><br></pre></td></tr></table></figure><h3 id="Selecting"><a href="#Selecting" class="headerlink" title="Selecting"></a>Selecting</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + D：选择当前光标所在的词并高亮该词所有出现的位置，再次Ctrl + D选择该词出现的下一个位置，在多重选词的过程中，使用Ctrl + K进行跳过，使用Ctrl + U进行回退，使用Esc退出多重编辑</span><br><span class="line">Ctrl + L：选择行，重复可依次增加选择下一行</span><br><span class="line">Ctrl + Shift + L：将当前选中区域打散</span><br><span class="line">Ctrl + J：把当前选中区域合并为一行</span><br><span class="line">Ctrl + M：在起始括号和结尾括号间切换</span><br><span class="line">Ctrl + Shift + M：快速选择括号间的内容</span><br><span class="line">Ctrl + Shift + J：快速选择同缩进的内容</span><br><span class="line">Ctrl + Shift + Space：快速选择当前作用域（Scope）的内容</span><br><span class="line">Ctrl + KU 改为大写</span><br><span class="line">Ctrl + KL 改为小写</span><br></pre></td></tr></table></figure><h3 id="Finding-amp-Replacing"><a href="#Finding-amp-Replacing" class="headerlink" title="Finding&amp;Replacing"></a>Finding&amp;Replacing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+P：搜索项目中的文件</span><br><span class="line">F3：跳至当前关键字下一个位置</span><br><span class="line">Shift + F3：跳到当前关键字上一个位置</span><br><span class="line">Alt + F3：选中当前关键字出现的所有位置</span><br><span class="line">Ctrl + F/H：进行标准查找/替换，之后：</span><br><span class="line">Alt + C：切换大小写敏感（Case-sensitive）模式</span><br><span class="line">Alt + W：切换整字匹配（Whole matching）模式</span><br><span class="line">Alt + R：切换正则匹配（Regex matching）模式</span><br><span class="line">Ctrl + Shift + H：替换当前关键字</span><br><span class="line">Ctrl + Alt + Enter：替换所有关键字匹配</span><br><span class="line">Ctrl + Shift + F：多文件搜索&amp;替换</span><br><span class="line">Ctrl + Shift + V：粘贴并格式化</span><br></pre></td></tr></table></figure><h3 id="Jumping"><a href="#Jumping" class="headerlink" title="Jumping"></a>Jumping</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + P：跳转到指定文件，输入文件名后可以：</span><br><span class="line">    @ 符号跳转：输入@symbol跳转到symbol符号所在的位置</span><br><span class="line">    # 关键字跳转：输入#keyword跳转到keyword所在的位置</span><br><span class="line">    : 行号跳转：输入:12跳转到文件的第12行。</span><br><span class="line">Ctrl + R：跳转到指定符号</span><br><span class="line">Ctrl + G：跳转到指定行号</span><br></pre></td></tr></table></figure><h3 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + Shift + N：创建一个新窗口</span><br><span class="line">Ctrl + N：在当前窗口创建一个新标签</span><br><span class="line">Ctrl + W：关闭当前标签，当窗口内没有标签时会关闭该窗口</span><br><span class="line">Ctrl + Shift + W：关闭所有打开文件</span><br><span class="line">Ctrl + Shift + T：恢复刚刚关闭的标签</span><br><span class="line">Ctrl + K + B：开关侧栏</span><br></pre></td></tr></table></figure><h3 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">F11：切换普通全屏</span><br><span class="line">Shift + F11：切换无干扰全屏</span><br><span class="line">Alt + Shift + 2：进行左右分屏</span><br><span class="line">Alt + Shift + 8：进行上下分屏</span><br><span class="line">Alt + Shift + 5：进行上下左右分屏</span><br><span class="line">分屏之后，使用Ctrl + 数字键跳转到指定屏，使用Ctrl + Shift + 数字键将当前屏移动到指定屏</span><br></pre></td></tr></table></figure><h3 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h3><blockquote><p>启用Package Control <code>Menu – View – Show Console</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import urllib2,os;pf=&apos;Package Control.sublime-package&apos;;ipp=sublime.installed_packages_path();os.makedirs(ipp) if n</span><br></pre></td></tr></table></figure><blockquote><p>install plugin <code>Ctrl+Shift+P</code> input <code>install Pacakge - Enter</code></p></blockquote><h5 id="ZenCoding"><a href="#ZenCoding" class="headerlink" title="ZenCoding"></a>ZenCoding</h5><blockquote><p>不得不用的一款前端开发方面的插件，Write less , show more.安装后可直接使用，Tab键触发，Alt+Shift+W是个代码机器。</p></blockquote><h5 id="Alignment"><a href="#Alignment" class="headerlink" title="Alignment"></a>Alignment</h5><blockquote><p>代码对齐，如写几个变量，选中这几行，Ctrl+Alt+A，哇，齐了。</p></blockquote><h5 id="Prefixr"><a href="#Prefixr" class="headerlink" title="Prefixr"></a>Prefixr</h5><blockquote><p>写 CSS可自动添加 -webkit 等私有词缀，Ctrl+Alt+X触发。</p></blockquote><h5 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h5><blockquote><p>Html格式化，右键Auto-Format Tags on Ducument。</p></blockquote><h5 id="Clipboard-History"><a href="#Clipboard-History" class="headerlink" title="Clipboard History"></a>Clipboard History</h5><blockquote><p>剪贴板历史记录，显示更多历史复制，Ctrl+Shift+V触发。</p></blockquote><h5 id="SideBarEnhancements"><a href="#SideBarEnhancements" class="headerlink" title="SideBarEnhancements"></a>SideBarEnhancements</h5><blockquote><p>侧栏右键功能增强，非常实用</p></blockquote><h5 id="Theme-–-Soda"><a href="#Theme-–-Soda" class="headerlink" title="Theme – Soda"></a>Theme – Soda</h5><blockquote><p>完美的编码主题，用过的都说好，Setting user里面添加”theme”: “Soda Dark.sublime-theme”</p></blockquote><h5 id="GBK-to-UTF8"><a href="#GBK-to-UTF8" class="headerlink" title="GBK to UTF8"></a>GBK to UTF8</h5><blockquote><p>将文件编码从GBK转黄成UTF8，菜单 – File里面找</p></blockquote><h5 id="SFTP"><a href="#SFTP" class="headerlink" title="SFTP"></a>SFTP</h5><blockquote><p>直接编辑 FTP 或 SFTP 服务器上的文件，绝对FTP浮云</p></blockquote><h5 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a>WordPress</h5><blockquote><p>集成一些WordPress的函数，对于像我这种经常要写WP模版和插件的人特别有用</p></blockquote><h5 id="PHPTidy"><a href="#PHPTidy" class="headerlink" title="PHPTidy"></a>PHPTidy</h5><blockquote><p>整理排版PHP代码</p></blockquote><h5 id="YUI-Compressor"><a href="#YUI-Compressor" class="headerlink" title="YUI Compressor"></a>YUI Compressor</h5><blockquote><p>压缩JS和CSS文件</p></blockquote><p>Resources:<br><a href="http://www.jianshu.com/p/7833f29c5aae" target="_blank" rel="noopener">http://www.jianshu.com/p/7833f29c5aae</a><br><a href="http://www.daqianduan.com/4820.html" target="_blank" rel="noopener">http://www.daqianduan.com/4820.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shortcut </tag>
            
            <tag> Sublime </tag>
            
            <tag> Editor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Use Keepalived Switching Master-Slave Solution</title>
      <link href="/2016/09/29/web/use-keepalived-switching-master-slave-solution/"/>
      <url>/2016/09/29/web/use-keepalived-switching-master-slave-solution/</url>
      
        <content type="html"><![CDATA[<h3 id="Keepalived-Overview"><a href="#Keepalived-Overview" class="headerlink" title="Keepalived Overview"></a>Keepalived Overview</h3><blockquote><p>Keepalived is a lightweight and high availability framework solution in Linux, It is seem as <code>HeartBeat</code>, <code>RoseHA</code>, has similar function that implement the service and the high availability of the network, but there are difference that <strong>HeartBeat</strong> is very professional and functional, but the deployment is very complex.</p></blockquote><blockquote><p>So Compare with <strong>HeartBeat</strong>, <strong>Keepalived</strong> is mainly through the virtual routing redundancy protocol(<strong>VRRP</strong>) to achive high availability, and the installation and configuraion is very simple.</p></blockquote><blockquote><p><strong>Keepalived</strong> has three modules, <strong>core</strong>, <strong>check</strong> and <strong>vrrp</strong></p></blockquote><a id="more"></a><h3 id="Install-Keepalived"><a href="#Install-Keepalived" class="headerlink" title="Install Keepalived"></a>Install Keepalived</h3><blockquote><p>you can download the latest verion in the offical site: <a href="http://www.keepalived.org" target="_blank" rel="noopener">http://www.keepalived.org</a>, Currently, the latest version is <code>1.3.2</code>.<br>the other way, just install by <code>yum</code> or <code>apt-get</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download&amp;unpack</span></span><br><span class="line">yum install openssl-devel</span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget http://www.keepalived.org/software/keepalived-1.3.2.tar.gz</span><br><span class="line">tar xzf keepalived-1.3.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># make&amp;make install</span></span><br><span class="line"><span class="built_in">cd</span> keepalived-1.3.2</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy configuration file</span></span><br><span class="line">cp /usr/<span class="built_in">local</span>/etc/rc.d/init.d/keepalived /etc/init.d/</span><br><span class="line">cp /usr/<span class="built_in">local</span>/etc/sysconfig/keepalived /etc/sysconfig/</span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod&amp;chkconfig</span></span><br><span class="line">chmod +x /etc/init.d/keepalived</span><br><span class="line">chkconfig --add keepalived</span><br><span class="line">chkconfig keepalived on</span><br><span class="line"></span><br><span class="line">mkdir /etc/keepalived</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/sbin/keepalived /usr/sbin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># simple way to install stable version</span></span><br><span class="line">yum install -y keepalived</span><br><span class="line"></span><br><span class="line"><span class="comment"># maybe add firewall rule</span></span><br><span class="line">iptables -I INPUT -i eth0 -d 192.168.193.0/8 -p vrrp -j ACCEPT</span><br><span class="line">iptables -I OUTPUT -o eth0 -d 192.168.193.0/8 -p vrrp -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line"><span class="comment"># use</span></span><br><span class="line">service keepalived start</span><br><span class="line">service keepalived reload</span><br></pre></td></tr></table></figure><h3 id="Keepalived-sketch"><a href="#Keepalived-sketch" class="headerlink" title="Keepalived sketch"></a>Keepalived sketch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                   +-------------+</span><br><span class="line">                   |    router   |</span><br><span class="line">                   +-------------+</span><br><span class="line">                          |</span><br><span class="line">                          +</span><br><span class="line">    MASTER            keepalived          BACKUP</span><br><span class="line">192.168.193.225    192.168.193.202    192.168.193.226</span><br><span class="line">+-------------+    +-------------+    +-------------+</span><br><span class="line">| instance01  |----|  virtualIP  |----|  instance02 |</span><br><span class="line">+-------------+    +-------------+    +-------------+</span><br><span class="line">                          |</span><br><span class="line">       +------------------+------------------+</span><br><span class="line">       |                  |                  |</span><br><span class="line">+-------------+    +-------------+    +-------------+</span><br><span class="line">|    web01    |    |    web02    |    |    web03    |</span><br><span class="line">+-------------+    +-------------+    +-------------+</span><br></pre></td></tr></table></figure><h3 id="Keepalived-Nginx"><a href="#Keepalived-Nginx" class="headerlink" title="Keepalived + Nginx"></a>Keepalived + Nginx</h3><h4 id="Monitor-Nginx"><a href="#Monitor-Nginx" class="headerlink" title="Monitor Nginx"></a>Monitor Nginx</h4><blockquote><p>Check the nginx status, when the process is not working try to start nginx, if it fail then stop keepalived.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#/etc/keepalived/check_nginx.sh</span></span><br><span class="line">counter=$(ps -C nginx --no-heading|wc -l)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;counter&#125;</span>"</span> = <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    /usr/<span class="built_in">local</span>/bin/nginx</span><br><span class="line">    sleep 2</span><br><span class="line">    counter=$(ps -C nginx --no-heading|wc -l)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;counter&#125;</span>"</span> = <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">        /etc/init.d/keepalived stop</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h4 id="Configure-keepalived"><a href="#Configure-keepalived" class="headerlink" title="Configure keepalived"></a>Configure keepalived</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">        admin@example.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from daily_notice@example.com</span><br><span class="line">    smtp_server mail.example.com</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line"># execute instance service script</span><br><span class="line">    script &quot;/etc/keepalived/check_nginx.sh&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -5</span><br><span class="line">    fall 3  </span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line"># state: MASTER|BACKUP</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    # instance ip addr</span><br><span class="line">    mcast_src_ip 192.168.193.225</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    # priority: MASTER &gt; BACKUP</span><br><span class="line">    priority 101</span><br><span class="line">    advert_int 2</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.193.202</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">    # configure monitor module</span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Test-amp-Result"><a href="#Test-amp-Result" class="headerlink" title="Test &amp; Result"></a>Test &amp; Result</h4><blockquote><p>please check the server message from <code>/var/log/messages</code></p></blockquote><h3 id="Keepalived-HAProxy"><a href="#Keepalived-HAProxy" class="headerlink" title="Keepalived + HAProxy"></a>Keepalived + HAProxy</h3><blockquote><p>Baisclly it is seem as nginx configuration, show the below sketck and monitor script:</p></blockquote><p><img src="/../../../../ref/hapka.png" alt="ha-sketch"></p><h4 id="HAProxy-configuration"><a href="#HAProxy-configuration" class="headerlink" title="HAProxy configuration"></a>HAProxy configuration</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/haproxy.conf</span></span><br><span class="line">global</span><br><span class="line">    daemon</span><br><span class="line">    <span class="built_in">log</span> 127.0.0.1 local0 debug</span><br><span class="line">    maxconn 50000</span><br><span class="line">    nbproc 1</span><br><span class="line"></span><br><span class="line">defaults</span><br><span class="line">    mode http</span><br><span class="line">    timeout connect 5s</span><br><span class="line">    timeout client 25s</span><br><span class="line">    timeout server 25s</span><br><span class="line">    timeout queue 10s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Handle Incoming HTTP Connection Requests on the virtual IP address controlled by Keepalived</span></span><br><span class="line">listen  http-incoming</span><br><span class="line">    mode http</span><br><span class="line">    <span class="built_in">bind</span> 192.168.193.202:80</span><br><span class="line"><span class="comment"># Use each server in turn, according to its weight value</span></span><br><span class="line">    balance roundrobin</span><br><span class="line"><span class="comment"># Verify that service is available</span></span><br><span class="line">    option httpchk OPTIONS * HTTP/1.1\r\nHost:\ www</span><br><span class="line"><span class="comment"># Insert X-Forwarded-For header</span></span><br><span class="line">    option forwardfor</span><br><span class="line"><span class="comment"># Define the back-end servers, which can handle up to 512 concurrent connections each</span></span><br><span class="line">    server websvr1 192.168.193.225:80 weight 1 maxconn 512 check</span><br><span class="line">    server websvr2 192.168.193.226:80 weight 1 maxconn 512 check</span><br></pre></td></tr></table></figure><blockquote><p>And the <strong>keepalived</strong> configuration is same as the <a href="#Configure-keepalived">previous profile</a>.</p></blockquote><h3 id="Keepalived-Redis"><a href="#Keepalived-Redis" class="headerlink" title="Keepalived + Redis"></a>Keepalived + Redis</h3><blockquote><p>Currently, use the <strong>Redis Sentinel</strong> completely solved the master failover incident, but also use the <em>Keepalived</em> to solve the switching master-slave.</p></blockquote><blockquote><p>First, we should write some scripts to monitor redis status:</p></blockquote><h4 id="Redis-scripts"><a href="#Redis-scripts" class="headerlink" title="Redis scripts"></a>Redis scripts</h4><h5 id="check-redis-server-is-alive"><a href="#check-redis-server-is-alive" class="headerlink" title="check redis server is alive"></a>check redis server is alive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###/etc/keepalived/scripts/redis_check.sh</span></span><br><span class="line">ALIVE=`/usr/bin/redis-cli PING`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$ALIVE</span>"</span> == <span class="string">"PONG"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$ALIVE</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$ALIVE</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h5 id="check-redis-server-switching-master"><a href="#check-redis-server-switching-master" class="headerlink" title="check redis server switching master"></a>check redis server switching master</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###/etc/keepalived/scripts/redis_master.sh</span></span><br><span class="line">REDISCLI=<span class="string">"redis-cli"</span></span><br><span class="line">LOGFILE=<span class="string">"/etc/keepalived/log/redis-state.log"</span></span><br><span class="line">pid=$$</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver]"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver] Run 'SLAVEOF 10.20.112.27 6379'"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="variable">$REDISCLI</span> SLAVEOF 10.20.112.27 6379 &gt;&gt; <span class="variable">$LOGFILE</span>  2&gt;&amp;1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver] wait 10 sec for data sync from old master"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">sleep 10 </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver] data rsync from old mater ok..."</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master] Run slaveof no one,close master/slave"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="variable">$REDISCLI</span> SLAVEOF NO ONE &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master] wait other slave connect...."</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br></pre></td></tr></table></figure><h5 id="redis-backup-script-from-master-before-failover"><a href="#redis-backup-script-from-master-before-failover" class="headerlink" title="redis backup script from master before failover"></a>redis backup script from master before failover</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">###/etc/keepalived/scripts/redis_backup.sh</span></span><br><span class="line"><span class="comment">###/etc/keepalived/scripts/redis_fault.sh</span></span><br><span class="line"><span class="comment">###/etc/keepalived/scripts/redis_stop.sh</span></span><br><span class="line">REDISCLI=<span class="string">"redis-cli"</span></span><br><span class="line">LOGFILE=<span class="string">"/etc/keepalived/log/redis-state.log"</span></span><br><span class="line">pid=$$</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master]"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master] Being slave state..."</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master] wait 10 sec for data sync from old master"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">sleep 10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[master] data rsync from old mater ok..."</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver] Run 'SLAVEOF 10.20.112.27 6379'"</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="variable">$REDISCLI</span> SLAVEOF 10.20.112.27 6379 &gt;&gt; <span class="variable">$LOGFILE</span>  2&gt;&amp;1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date +'%Y-%m-%d:%H:%M:%S'`|<span class="variable">$pid</span>|state:[slaver] slave connect to 10.20.112.27 ok..."</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br></pre></td></tr></table></figure><h4 id="Configure-Keepalived"><a href="#Configure-Keepalived" class="headerlink" title="Configure Keepalived"></a>Configure Keepalived</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;</span><br><span class="line">        admin@example.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from daily_notice@example.com</span><br><span class="line">    smtp_server mail.example.com</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_redis &#123; </span><br><span class="line">        script &quot;/etc/keepalived/scripts/redis_check.sh&quot;</span><br><span class="line">        weight -20</span><br><span class="line">        interval 2                                     </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123; </span><br><span class="line">        state backup                            </span><br><span class="line">        interface eth0                          </span><br><span class="line">        virtual_router_id 51</span><br><span class="line">        nopreempt</span><br><span class="line">        priority 200      </span><br><span class="line">        advert_int 5                      </span><br><span class="line">        track_script &#123; </span><br><span class="line">            chk_redis                     </span><br><span class="line">        &#125; </span><br><span class="line">        virtual_ipaddress &#123; </span><br><span class="line">             192.168.193.202                        </span><br><span class="line">        &#125;</span><br><span class="line">        notify_master /etc/keepalived/scripts/redis_master.sh</span><br><span class="line">        notify_backup /etc/keepalived/scripts/redis_backup.sh</span><br><span class="line">        notify_fault  /etc/keepalived/scripts/redis_fault.sh</span><br><span class="line">        notify_stop   /etc/keepalived/scripts/redis_stop.sh </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>And the detail information please check the below resoures –&gt;</p></blockquote><blockquote><p>Resources:<br><a href="https://docs.oracle.com/cd/E37670_01/E41138/html/section_sm3_svy_4r.html" target="_blank" rel="noopener">https://docs.oracle.com/cd/E37670_01/E41138/html/section_sm3_svy_4r.html</a><br><a href="http://seanlook.com/2015/05/18/nginx-keepalived-ha/" target="_blank" rel="noopener">http://seanlook.com/2015/05/18/nginx-keepalived-ha/</a><br><a href="https://www.centos.bz/2012/02/nginx-keepalived-high-availability/" target="_blank" rel="noopener">https://www.centos.bz/2012/02/nginx-keepalived-high-availability/</a><br><a href="https://my.oschina.net/guol/blog/182491" target="_blank" rel="noopener">https://my.oschina.net/guol/blog/182491</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Redis </tag>
            
            <tag> Nginx </tag>
            
            <tag> HAProxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Database Administrations</title>
      <link href="/2016/09/27/database/oracle-kt-database-administrations/"/>
      <url>/2016/09/27/database/oracle-kt-database-administrations/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This part mainly talk about these points:</p></blockquote><blockquote><ul><li><strong>Import and export of database</strong></li><li><strong>Start and Stop database</strong></li><li><strong>Starting and stopping Nodes in the RAC</strong></li><li><strong>Manage available sessions</strong></li></ul></blockquote><a id="more"></a><h3 id="Import-and-export-of-database"><a href="#Import-and-export-of-database" class="headerlink" title="Import and export of database"></a>Import and export of database</h3><blockquote><p>Oracle’s <code>export</code> (<strong>exp</strong>) and <code>import</code> (<strong>imp</strong>) utilities are used to perform logical database backup and recovery. When exporting, database objects are dumped to <strong>a binary file</strong> which can then be imported into another Oracle database.<br>This <code>exp/imp</code> is different from <code>expdp/impdp</code> in <code>Data Pump</code>, The detail about datapump will talk in other article.<br>The <code>export/import</code> utilities are commonly used to perform the following tasks:</p></blockquote><blockquote><ul><li>Backup and recovery (small databases only, say &lt; <code>+50GB</code>, if bigger, use <code>RMAN</code> instead)</li><li>Move data between Oracle databases on different platforms (for example from Solaris to Windows)</li><li>Reorganization of data / eliminate database fragmentation (<code>export</code>, <code>drop</code> and <code>re-import</code> tables)</li><li>Upgrade databases from extremely old versions of Oracle (when in-place upgrades are not supported by the Database Upgrade Assistant any more)</li><li>Detect database corruption. Ensure that all the data can be read</li><li>Transporting tablespaces between databases</li></ul></blockquote><h4 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h4><blockquote><p>Look for the <code>imp</code> and <code>exp</code> executables in your <code>$ORACLE_HOME/bin</code> directory. One can run them interactively, using command line parameters, or using parameter files. Look at the <code>imp/exp</code> parameters before starting. These parameters can be listed by executing the following commands: <code>exp help=yes</code> or <code>imp help=yes</code>.<br>The following examples demonstrate how the <code>imp/exp</code> utilities can be used:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">exp scott/tiger file=emp.dmp log=emp.log tables=emp rows=yes indexes=no</span><br><span class="line">exp scott/tiger file=emp.dmp tables=(emp,dept)</span><br><span class="line"></span><br><span class="line">imp scott/tiger file=emp.dmp full=yes</span><br><span class="line">imp scott/tiger file=emp.dmp fromuser=scott touser=scott tables=dept</span><br><span class="line"></span><br><span class="line"><span class="comment">-- using a parameter file:</span></span><br><span class="line">exp userid=scott/tiger@orcl parfile=export.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">--where export.txt contains:</span></span><br><span class="line">BUFFER=10000000</span><br><span class="line">FILE=account.dmp</span><br><span class="line">FULL=n</span><br><span class="line">OWNER=scott</span><br><span class="line">GRANTS=y</span><br><span class="line">COMPRESS=y</span><br></pre></td></tr></table></figure><h4 id="Export-with-query"><a href="#Export-with-query" class="headerlink" title="Export with query"></a>Export with query</h4><blockquote><p>From Oracle 8i one can use the <code>QUERY=</code> export parameter to selectively unload a subset of the data from a table. You may need to escape special chars on the command line.<br>For example: <code>query=\&quot;where deptno=10\&quot;</code>. Look at these examples:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exp scott/tiger tables=emp query="where deptno=10"</span><br><span class="line">exp scott/tiger file=abc.dmp tables=abc query=\"where sex=\'f\'\" rows=yes</span><br></pre></td></tr></table></figure><h4 id="Other-Questions"><a href="#Other-Questions" class="headerlink" title="Other Questions"></a>Other Questions</h4><blockquote><p>Before one imports rows into <strong>already populated tables</strong>, one needs to <strong>truncate</strong> or <strong>drop</strong> these tables to get rid of the old data. If not, the new data will be <strong>appended to the existing tables</strong>. One must always <code>DROP</code> existing Sequences before re-importing. If the sequences are not dropped, they will generate numbers inconsistent with the rest of the database.<br>Note: It is also advisable to <strong>drop indexes</strong> before importing to speed up the import process. Indexes can easily be recreated after the data was successfully imported.</p></blockquote><h3 id="Start-and-Stop-database"><a href="#Start-and-Stop-database" class="headerlink" title="Start and Stop database"></a>Start and Stop database</h3><h4 id="Start-database"><a href="#Start-database" class="headerlink" title="Start database"></a>Start database</h4><blockquote><p>Ensure oracle other service such as <code>lsnrctl</code>, <code>srvctl</code>, <code>crsctl</code> is work.<br>Oracle start has thress modes, step by step start oracle:</p><ul><li><strong>NOMOUNT</strong><br>PS. This mode just <strong>create instance</strong>, does not <strong>mount database</strong>, And just create memory structures and service processess for oracle instance, It can not open any data file.<br>In this mode, only access the dictionary views related <strong>SGA</strong>, contains <code>VPARAMETER</code>, <code>VSGA</code>, <code>VPROCESS</code>, <code>VSESSION</code> etc. Because these views is get from SGA area.<br>What you can do:<blockquote><p><strong>create new database</strong><br><strong>rebuild control files</strong></p></blockquote></li></ul></blockquote><blockquote><ul><li><strong>MOUNT</strong><br>PS. This mode will mount database, but database status is closed, so client user can’t operate the database.<br>In this mode, only access the dictionary views related <strong>Control files</strong>, contains <code>VTHREAD</code>, <code>VCONTROLFILE, VDATABASE</code>, <code>VDATAFILE</code>, <code>V$LOGFILE</code> etc. Because these views is get from Control files.<br>What you can do:<blockquote><p><strong>Rename datafile</strong><br><strong>Add/Del/Rename rebuild log files</strong><br><strong>Execute database recover completely</strong><br><strong>Change database to Archive mode</strong></p></blockquote></li></ul></blockquote><blockquote><ul><li><strong>OPEN</strong><br>PS. Normal mode to start database. If occurred any error, please use <code>STARTUP FORCE</code></li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">SQL&gt; HELP STARTUP</span><br><span class="line">[FORCE] [RESTRICT] [PFILE=filename] [QUIET] [ MOUNT [dbname] |</span><br><span class="line">[ OPEN [open_db_options] [dbname] ] | NOMOUNT ]</span><br></pre></td></tr></table></figure><h4 id="Stop-database"><a href="#Stop-database" class="headerlink" title="Stop database"></a>Stop database</h4><blockquote><p>Shutdown the database has four methods: </p><ul><li><strong>NORMAL</strong><br>This mode will forbid new client create connection, the current executing transtracion is still doing.</li></ul></blockquote><blockquote><ul><li><strong>IMMEDIATE</strong><br>This mode will not wait users active disconnection and will enforce the transtractions</li></ul></blockquote><blockquote><ul><li><strong>TRANSACTIONAL</strong><br>This mode will wait users not commit transactions to commit.</li></ul></blockquote><blockquote><ul><li><strong>ABORT</strong><br>This mode will ignore everything. Be careful~</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">SQL&gt; HELP SHUTDOWN</span><br><span class="line">SHUTDOWN [ABORT|IMMEDIATE|NORMAL|TRANSACTIONAL [LOCAL]]</span><br></pre></td></tr></table></figure><h3 id="Starting-and-stopping-Nodes-in-the-RAC"><a href="#Starting-and-stopping-Nodes-in-the-RAC" class="headerlink" title="Starting and stopping Nodes in the RAC"></a>Starting and stopping Nodes in the RAC</h3><h4 id="Start-Node"><a href="#Start-Node" class="headerlink" title="Start Node"></a>Start Node</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check status of instance</span></span><br><span class="line">$ <span class="variable">$CRS_HOME</span>/bin/crs_stat</span><br><span class="line"></span><br><span class="line"><span class="comment"># seen cases when CRS says OFFLINE but pmon is still running so double checking here</span></span><br><span class="line">$ ps -ef | grep &lt;instance_name&gt; | grep pmon</span><br><span class="line"></span><br><span class="line"><span class="comment"># start one of the instance on one of the nodes if not running</span></span><br><span class="line">$ srvctl start database -d &lt;database name&gt; -i &lt;instance name&gt;</span><br></pre></td></tr></table></figure><h4 id="Stop-Node"><a href="#Stop-Node" class="headerlink" title="Stop Node"></a>Stop Node</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># verify instance running</span></span><br><span class="line">$ ps -ef | grep &lt;instance_name&gt; | grep pmon</span><br><span class="line"></span><br><span class="line"><span class="comment"># shutdown one of the instance on one of the nodes</span></span><br><span class="line">$ srvctl stop database -d &lt;database name&gt; -i &lt;instance name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># check status of instance to make sure it’s down</span></span><br><span class="line">$ <span class="variable">$CRS_HOME</span>/bin/crs_stat</span><br><span class="line"></span><br><span class="line"><span class="comment"># verify instance not running</span></span><br><span class="line">$ ps -ef | grep &lt;instance_name&gt; | grep pmon</span><br></pre></td></tr></table></figure><h3 id="Manage-available-sessions"><a href="#Manage-available-sessions" class="headerlink" title="Manage available sessions"></a>Manage available sessions</h3><h4 id="Enabling-and-Disabling-Restricted-Session"><a href="#Enabling-and-Disabling-Restricted-Session" class="headerlink" title="Enabling and Disabling Restricted Session"></a>Enabling and Disabling Restricted Session</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> logins <span class="keyword">from</span> v$<span class="keyword">instance</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">enable</span> <span class="keyword">restricted</span> <span class="keyword">session</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">disable</span> <span class="keyword">restricted</span> <span class="keyword">session</span>;</span><br></pre></td></tr></table></figure><h4 id="Disconnect-session"><a href="#Disconnect-session" class="headerlink" title="Disconnect session"></a>Disconnect session</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SID</span>, <span class="built_in">SERIAL</span><span class="comment">#, STATUS</span></span><br><span class="line">  <span class="keyword">FROM</span> V$<span class="keyword">SESSION</span></span><br><span class="line">  <span class="keyword">WHERE</span> USERNAME = <span class="string">'AWSUSER'</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">disconnect</span> <span class="keyword">session</span>;</span><br></pre></td></tr></table></figure><h4 id="Kill-session"><a href="#Kill-session" class="headerlink" title="Kill session"></a>Kill session</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">kill</span> <span class="keyword">session</span> <span class="string">' sid, serial#'</span> <span class="keyword">IMMEDIATE</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://docs.oracle.com/cd/B28359_01/server.111/b28319/exp_imp.htm#i1023983" target="_blank" rel="noopener">http://docs.oracle.com/cd/B28359_01/server.111/b28319/exp_imp.htm#i1023983</a><br><a href="http://www.orafaq.com/wiki/Import_Export_FAQ" target="_blank" rel="noopener">http://www.orafaq.com/wiki/Import_Export_FAQ</a><br><a href="https://docs.oracle.com/cd/E11882_01/rac.112/e41960/admin.htm#RACAD812" target="_blank" rel="noopener">https://docs.oracle.com/cd/E11882_01/rac.112/e41960/admin.htm#RACAD812</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自建Ngrok服务器 - 内网穿透</title>
      <link href="/2016/09/24/vps/ngrok-server/"/>
      <url>/2016/09/24/vps/ngrok-server/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>Secure tunnels to localhost</strong><br>I want to expose a local server behind a NAT or firewall to the internet~<br>Offical Site: <a href="https://ngrok.com/" target="_blank" rel="noopener">https://ngrok.com/</a></p></blockquote><a id="more"></a><h3 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h3><h4 id="Download-code"><a href="#Download-code" class="headerlink" title="Download code"></a>Download code</h4><blockquote><p>可以直接在官网上下载OS对应的<code>package</code>, <code>unzip /path/to/ngrok.zip</code>, <code>$ ./ngrok help</code><br>当然从<code>git</code>源码下载也ok.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/inconshreveable/ngrok.git</span><br><span class="line"><span class="built_in">cd</span> ngrok</span><br></pre></td></tr></table></figure><h4 id="Configure-dns"><a href="#Configure-dns" class="headerlink" title="Configure dns"></a>Configure dns</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ngrok.yourdomain.com     -------&gt; A记录到你的VPS IP</span><br><span class="line">*.ngrok.yourdomain.com   -------&gt;  CNAME到ngrok.yourdomain.com</span><br></pre></td></tr></table></figure><h4 id="Generate-CA"><a href="#Generate-CA" class="headerlink" title="Generate CA"></a>Generate CA</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NGROK_DOMAIN=<span class="string">"grok.yourdomain.com"</span></span><br><span class="line"></span><br><span class="line">openssl genrsa -out rootCA.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj <span class="string">"/CN=<span class="variable">$NGROK_DOMAIN</span>"</span> -days 36500 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 2048</span><br><span class="line">openssl req -new -key device.key -subj <span class="string">"/CN=<span class="variable">$NGROK_DOMAIN</span>"</span> -out device.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> device.csr -days 36500 -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt </span><br><span class="line">cp rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt assets/server/tls/snakeoil.crt </span><br><span class="line">cp device.key assets/server/tls/snakeoil.key</span><br></pre></td></tr></table></figure><h3 id="Make"><a href="#Make" class="headerlink" title="Make"></a>Make</h3><h4 id="Server-sample"><a href="#Server-sample" class="headerlink" title="Server sample"></a>Server sample</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端运行在Linux下，我们不需要任何操作</span></span><br><span class="line"><span class="comment"># 发布server版</span></span><br><span class="line">make release-server</span><br><span class="line"><span class="comment"># make release-xxx会把asset文件里面的东西打包成一个可执行文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行服务端</span></span><br><span class="line"><span class="comment"># 帮助信息</span></span><br><span class="line">./ngrokd -h</span><br><span class="line">Usage of ./ngrokd:</span><br><span class="line">  -domain string</span><br><span class="line">        Domain <span class="built_in">where</span> the tunnels are hosted (default <span class="string">"ngrok.com"</span>)</span><br><span class="line">  -httpAddr string</span><br><span class="line">        Public address <span class="keyword">for</span> HTTP connections, empty string to <span class="built_in">disable</span> (default <span class="string">":80"</span>)</span><br><span class="line">  -httpsAddr string</span><br><span class="line">        Public address listening <span class="keyword">for</span> HTTPS connections, emptry string to <span class="built_in">disable</span> (default <span class="string">":443"</span>)</span><br><span class="line">  -<span class="built_in">log</span> string</span><br><span class="line">        Write <span class="built_in">log</span> messages to this file. <span class="string">'stdout'</span> and <span class="string">'none'</span> have special meanings (default <span class="string">"stdout"</span>)</span><br><span class="line">  -<span class="built_in">log</span>-level string</span><br><span class="line">        The level of messages to <span class="built_in">log</span>. One of: DEBUG, INFO, WARNING, ERROR (default <span class="string">"DEBUG"</span>)</span><br><span class="line">  -tlsCrt string</span><br><span class="line">        Path to a TLS certificate file</span><br><span class="line">  -tlsKey string</span><br><span class="line">        Path to a TLS key file</span><br><span class="line">  -tunnelAddr string</span><br><span class="line">        Public address listening <span class="keyword">for</span> ngrok client (default <span class="string">":4443"</span>)</span><br><span class="line"></span><br><span class="line">./ngrokd -domain=<span class="variable">$NGROK_DOMAIN</span></span><br><span class="line"><span class="comment"># 可以指定端口</span></span><br><span class="line">./ngrokd -domain=<span class="variable">$NGROK_DOMAIN</span> -httpAddr=<span class="string">":8080"</span> -httpsAddr=<span class="string">":8081"</span></span><br></pre></td></tr></table></figure><h4 id="Client-sample"><a href="#Client-sample" class="headerlink" title="Client sample"></a>Client sample</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设我要在mac上运行客户端，需要在编译命令前加上一些参数</span></span><br><span class="line">GOOS=darwin GOARCH=amd64 make release-client</span><br><span class="line"><span class="comment"># 编译好后scp到本地</span></span><br><span class="line">scp xxx xxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面开始本地配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">vim ngrok.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一下两行</span></span><br><span class="line"><span class="comment"># 第一行是将要绑定的域名+4443端口</span></span><br><span class="line"></span><br><span class="line">server_addr: <span class="string">"ngrok.yourdomain.com:4443"</span></span><br><span class="line">trust_host_root_certs: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 帮助信息</span></span><br><span class="line">./ngrok -h</span><br><span class="line">Examples:</span><br><span class="line">    ngrok 80</span><br><span class="line">    ngrok -subdomain=example 8080</span><br><span class="line">    ngrok -proto=tcp 22</span><br><span class="line">    ngrok -hostname=<span class="string">"example.com"</span> -httpauth=<span class="string">"user:password"</span> 10.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8080就是我们要转发的端口了</span></span><br><span class="line">./ngrok -config=./ngrok.cfg 8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定协议和端口，不指定默认是 http+https</span></span><br><span class="line">./ngrok -config=./ngrok.cfg -proto=tcp 22</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定子域名，不指定就会随机生成</span></span><br><span class="line">./ngrok -config=./ngrok.cfg -subdomain=<span class="built_in">test</span> 8080</span><br></pre></td></tr></table></figure><h3 id="How-to-run"><a href="#How-to-run" class="headerlink" title="How to run"></a>How to run</h3><p><code>http://127.0.0.1:4040</code>外部转发页面，<code>ngrok</code>查看运行状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加自启动服务</span></span><br><span class="line">vim /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加以下命令，注意使用绝对路径</span></span><br><span class="line"><span class="comment"># 服务端</span></span><br><span class="line">nohup /path/to/ngrokd -domain=ngrok.phpgao.com -<span class="built_in">log</span>=<span class="string">"/tmp/ngrok.log"</span> &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line">nohup ./ngrok -config ngrok.cfg -<span class="built_in">log</span> stdout -<span class="built_in">log</span>-level=<span class="string">"INFO"</span> -subdomain=<span class="built_in">test</span> 8080 &gt;/tmp/ngrok.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="https://blog.phpgao.com/ngrok_how_to.html" target="_blank" rel="noopener">https://blog.phpgao.com/ngrok_how_to.html</a><br><a href="https://blog.phpgao.com/ssh-reverse-tunnel.html" target="_blank" rel="noopener">https://blog.phpgao.com/ssh-reverse-tunnel.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ngrok </tag>
            
            <tag> Vps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Use Redis Service Instead of Asp.Net Session Provider</title>
      <link href="/2016/09/21/web/redis-service-instead-of-aspnet-session-provider/"/>
      <url>/2016/09/21/web/redis-service-instead-of-aspnet-session-provider/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>Asp.Net</code> Session Provider can’t realize <code>Master-Slave</code> switching function, but the stable release of <code>Redis Sentinel</code> is shippedd since <code>Redis 2.8</code>. Certainly, the sentinel function is support <code>Monitoring</code>, <code>Notification</code>, <code>Automatic failover</code> and <code>Configuration provider</code>.</p></blockquote><blockquote><p>If you want to know the extra information about <code>Redis Sentinel</code>, –&gt; <strong><a href="http://redis.io/topics/sentinel" target="_blank" rel="noopener">click here</a></strong></p></blockquote><a id="more"></a><h3 id="Aspnet-Redis-Provider"><a href="#Aspnet-Redis-Provider" class="headerlink" title="Aspnet Redis Provider"></a>Aspnet Redis Provider</h3><h4 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h4><blockquote><p>Go back to session provider, I found an solution in github, the open source <strong><a href="https://github.com/Azure/aspnet-redis-providers" target="_blank" rel="noopener">see here</a></strong></p></blockquote><blockquote><ul><li>If you just use redis make the session provider, this solution is completely instead of the Asp.Net session provider.</li><li>But if you want <code>master-slave</code> switching or mutltiple instance used in redis master-slave swtiching, I fork the project and checkout a new branch, the code –&gt; <strong><a href="https://github.com/itabas016/aspnet-redis-providers" target="_blank" rel="noopener">see here</a></strong></li></ul></blockquote><blockquote><p>BTW, How to install redis and redis sentinel please <strong><a href="../../../../2016/09/20/tools/chocolate-intall-redis-windows/">see here</a></strong>, And the detail <code>Redis Sentinel</code> configuration for windows please <strong><a href="https://github.com/itabas016/TutorialsPoint/blob/master/redis/sentinel.md" target="_blank" rel="noopener">see here</a></strong> </p></blockquote><p><img src="/../../../screenshots/redis-master-slave-sentinel.png" alt="redis-master-slave-sentinel"></p><h4 id="Configuration-for-Application"><a href="#Configuration-for-Application" class="headerlink" title="Configuration for Application"></a>Configuration for Application</h4><blockquote><p>PS. The sample <code>web.config</code> configuration for <code>Redis Single</code></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sessionState</span> <span class="attr">mode</span>=<span class="string">"Custom"</span> <span class="attr">customProvider</span>=<span class="string">"MySessionStateStore"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;add name="MySessionStateStore"</span></span><br><span class="line"><span class="comment">           host = "127.0.0.1" [String]</span></span><br><span class="line"><span class="comment">        port = "" [number]</span></span><br><span class="line"><span class="comment">        accessKey = "" [String]</span></span><br><span class="line"><span class="comment">        ssl = "false" [true|false]</span></span><br><span class="line"><span class="comment">        throwOnError = "true" [true|false]</span></span><br><span class="line"><span class="comment">        retryTimeoutInMilliseconds = "0" [number]</span></span><br><span class="line"><span class="comment">        databaseId = "0" [number]</span></span><br><span class="line"><span class="comment">        applicationName = "" [String]</span></span><br><span class="line"><span class="comment">        connectionTimeoutInMilliseconds = "5000" [number]</span></span><br><span class="line"><span class="comment">        operationTimeoutInMilliseconds = "5000" [number]</span></span><br><span class="line"><span class="comment">    /&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"MySessionStateStore"</span> <span class="attr">type</span>=<span class="string">"Microsoft.Web.Redis.RedisSessionStateProvider"</span> <span class="attr">host</span>=<span class="string">"127.0.0.1"</span> <span class="attr">accessKey</span>=<span class="string">""</span> <span class="attr">ssl</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sessionState</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>PS. The other sample <code>web.config</code> configuration for <code>Redis Sentinel</code></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"RedisConnection"</span> <span class="attr">connectionString</span>=<span class="string">"192.168.192.215:26379,192.168.192.205:26379,serviceName=mymaster,ssl=false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sessionState</span> <span class="attr">mode</span>=<span class="string">"Custom"</span> <span class="attr">customProvider</span>=<span class="string">"MySessionStateStore"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">"MySessionStateStore"</span> <span class="attr">type</span>=<span class="string">"Microsoft.Web.Redis.RedisSessionStateProvider"</span></span></span><br><span class="line"><span class="tag"><span class="attr">connectionString</span>=<span class="string">"RedisConnection"</span> <span class="attr">operationTimeoutInMilliseconds</span>=<span class="string">"5000"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sessionState</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h4><blockquote><p>Above this, I think a question about <code>redis master ip</code> when redis master instance is crash, how is it switched?<br>The answer in the <code>Redis Sentinel</code> configuration, because I input the redis sentinel <code>ip</code> and <code>port</code> in the <code>web config</code>, base on the <strong>quorum argument</strong>.</p></blockquote><blockquote><p>So, if I don’t change the source code, I can’t get the <code>master ip</code> when master instance crashed, but it’s other way to get the IP, <code>Keepalived</code>, It will generate the <code>virtual IP</code>, and you can bind your redis instances ip, Ahha It’s only support on linux, so this solution is not suitable for me.</p></blockquote><blockquote><p>And the detail configuration and How to realize it, please <strong><a href="../../../../2016/09/29/web/use-keepalived-switching-master-slave-solution/">see this article</a></strong> </p></blockquote><blockquote><p>Resources:<br><a href="http://lib.csdn.net/article/redis/18114" target="_blank" rel="noopener">http://lib.csdn.net/article/redis/18114</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Asp.Net </tag>
            
            <tag> State Server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows Install Redis Service by Chocolate</title>
      <link href="/2016/09/20/tools/chocolate-intall-redis-windows/"/>
      <url>/2016/09/20/tools/chocolate-intall-redis-windows/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Recently, a company’s project that use <code>Redis</code> hot standby intead of <code>Asp.Net</code> state service provider.<br>So I look around a lot of technical resources and find a solution: <strong><a href="https://github.com/Azure/aspnet-redis-providers" target="_blank" rel="noopener">aspnet-redis-providers</a></strong></p></blockquote><blockquote><p>And the detail see that article <strong><a href="http://io.itabas.com/2016/09/21/redis-service-instead-of-aspnet-session-provider/" target="_blank" rel="noopener">Use Redis service instead of Asp.Net session provider</a></strong></p></blockquote><blockquote><p>This article talk about <strong>How to install redis in windows</strong></p></blockquote><a id="more"></a><h3 id="Chocolate-Install-Redis"><a href="#Chocolate-Install-Redis" class="headerlink" title="Chocolate Install Redis"></a>Chocolate Install Redis</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install choco</span></span><br><span class="line">@powershell <span class="literal">-NoProfile</span> <span class="literal">-ExecutionPolicy</span> Bypass <span class="literal">-Command</span> <span class="string">"iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))"</span> &amp;&amp; SET <span class="string">"PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># install redis-<span class="number">64</span></span><br><span class="line">choco install redis-<span class="number">64</span></span><br></pre></td></tr></table></figure><h3 id="Redis-Configuration"><a href="#Redis-Configuration" class="headerlink" title="Redis Configuration"></a>Redis Configuration</h3><h4 id="Install-Redis-Service"><a href="#Install-Redis-Service" class="headerlink" title="Install Redis Service"></a>Install Redis Service</h4><blockquote><p>Sample - <a href="https://github.com/itabas016/TutorialsPoint/tree/master/redis/redis-windows.conf" target="_blank" rel="noopener"><code>redis.windows.conf</code></a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># default port <span class="number">6379</span></span><br><span class="line">redis-server --service-install redis.windows.conf --loglevel verbose</span><br><span class="line"># port <span class="number">6380</span></span><br><span class="line">redis-server --service-install --service-name Redis6380 --port <span class="number">6380</span></span><br></pre></td></tr></table></figure><h4 id="Uninstall-Redis-Service"><a href="#Uninstall-Redis-Service" class="headerlink" title="Uninstall Redis Service"></a>Uninstall Redis Service</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --service-uninstall --service-name Redis6380 --port <span class="number">6380</span></span><br></pre></td></tr></table></figure><h4 id="Redis-Service-Operation"><a href="#Redis-Service-Operation" class="headerlink" title="Redis Service Operation"></a>Redis Service Operation</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="built_in">start</span></span><br><span class="line">redis-server --service-<span class="built_in">start</span></span><br><span class="line"></span><br><span class="line"># stop</span><br><span class="line">redis-server --service-stop</span><br></pre></td></tr></table></figure><h3 id="Redis-Sentinel-Configuration"><a href="#Redis-Sentinel-Configuration" class="headerlink" title="Redis Sentinel Configuration"></a>Redis Sentinel Configuration</h3><blockquote><p>Sample - <a href="https://github.com/itabas016/TutorialsPoint/tree/master/redis/windows-sentinel.conf" target="_blank" rel="noopener"><code>redis.sentinel.conf</code></a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --service-install --service-name redisSentinel sentinel.conf --sentinel</span><br></pre></td></tr></table></figure><blockquote><p>And the more <code>Redis</code> please see the <strong><a href="https://github.com/itabas016/TutorialsPoint/tree/master/redis" target="_blank" rel="noopener">Redis Tutorials</a></strong>~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle - Basic SQL, Store Procedures(Functions, Packages)</title>
      <link href="/2016/09/14/database/oracle-kt-object-operation/"/>
      <url>/2016/09/14/database/oracle-kt-object-operation/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>Goals:</strong></p></blockquote><blockquote><p>Have a grasp of both SQL <strong>DML (Data Manipulation Language)</strong> and <strong>DDL (Data Definition Language)</strong>.<br><strong>DML</strong> covers items such as <code>Select</code>, <code>Update</code>, <code>Insert</code> and <code>Delete</code>.<br>You should understand all the major clauses such as <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>ORDER BY</code>.  Should be comfortable with <strong>sub queries</strong> and <strong>joins</strong>.<br><strong>DDL</strong> covers items such as <code>CREATE TABLE</code> and <code>ALTER TABLE</code><br>You should understand how to create and modify tables and indexes and know the difference between deleting records, truncating a table, or dropping it! And… don’t forget views!</p></blockquote><blockquote><p><em>The detail about <strong>DML&amp;DDL</strong> click <a href="/../../../../2016/09/03/database/oracle-statements/">here</a></em></p></blockquote><a id="more"></a><h3 id="Special-clause-in-DML"><a href="#Special-clause-in-DML" class="headerlink" title="Special clause in DML"></a>Special clause in DML</h3><h4 id="Special-clause"><a href="#Special-clause" class="headerlink" title="Special clause"></a>Special clause</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- group by syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n, </span><br><span class="line">       aggregate_function (aggregate_expression)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions]</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> expression1, expression2, ... expression_n;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- having syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> expression1, expression2, ... expression_n, </span><br><span class="line">       aggregate_function (aggregate_expression)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions]</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> expression1, expression2, ... expression_n</span><br><span class="line"><span class="keyword">HAVING</span> having_condition;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- order by syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> expressions</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">tables</span></span><br><span class="line">[<span class="keyword">WHERE</span> conditions]</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> expression [ <span class="keyword">ASC</span> | <span class="keyword">DESC</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- complex example</span></span><br><span class="line"><span class="keyword">SELECT</span> DEPTNO, <span class="keyword">COUNT</span>(*), <span class="keyword">SUM</span>(SAL) <span class="keyword">FROM</span> EMP</span><br><span class="line"><span class="keyword">WHERE</span> JOB = <span class="string">'CLERK'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPTNO</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">SUM</span>(SAL) &gt;=<span class="number">500</span> <span class="keyword">AND</span> <span class="keyword">COUNT</span>(*) &lt;&gt; <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="Subqueries"><a href="#Subqueries" class="headerlink" title="Subqueries"></a>Subqueries</h4><blockquote><p>see the below related clause examples:</p></blockquote><h5 id="WHERE-clause"><a href="#WHERE-clause" class="headerlink" title="WHERE clause"></a>WHERE clause</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> all_tables tabs</span><br><span class="line"><span class="keyword">WHERE</span> tabs.table_name <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cols.table_name</span><br><span class="line">                          <span class="keyword">FROM</span> all_tab_columns cols</span><br><span class="line">                          <span class="keyword">WHERE</span> cols.column_name = <span class="string">'SUPPLIER_ID'</span>);</span><br></pre></td></tr></table></figure><h5 id="FROM-clause"><a href="#FROM-clause" class="headerlink" title="FROM clause"></a>FROM clause</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> suppliers.name, subquery1.total_amt</span><br><span class="line"><span class="keyword">FROM</span> suppliers,</span><br><span class="line"> (<span class="keyword">SELECT</span> supplier_id, <span class="keyword">SUM</span>(orders.amount) <span class="keyword">AS</span> total_amt</span><br><span class="line">  <span class="keyword">FROM</span> orders</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> supplier_id) subquery1</span><br><span class="line"><span class="keyword">WHERE</span> subquery1.supplier_id = suppliers.supplier_id;</span><br></pre></td></tr></table></figure><h5 id="SELECT-clause"><a href="#SELECT-clause" class="headerlink" title="SELECT clause"></a>SELECT clause</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tbls.owner, tbls.table_name,</span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(column_name) <span class="keyword">AS</span> total_columns</span><br><span class="line">   <span class="keyword">FROM</span> all_tab_columns cols</span><br><span class="line">   <span class="keyword">WHERE</span> cols.owner = tbls.owner</span><br><span class="line">   <span class="keyword">AND</span> cols.table_name = tbls.table_name) subquery2</span><br><span class="line"><span class="keyword">FROM</span> all_tables tbls;</span><br></pre></td></tr></table></figure><h4 id="Joins"><a href="#Joins" class="headerlink" title="Joins"></a>Joins</h4><blockquote><ul><li>Oracle <strong>INNER JOIN</strong> (or sometimes called <strong>SIMPLE JOIN</strong>)</li><li>Oracle <strong>LEFT OUTER JOIN</strong> (or sometimes called <strong>LEFT JOIN</strong>)</li><li>Oracle <strong>RIGHT OUTER JOIN</strong> (or sometimes called <strong>RIGHT JOIN</strong>)</li><li>Oracle <strong>FULL OUTER JOIN</strong> (or sometimes called <strong>FULL JOIN</strong>)</li></ul></blockquote><h5 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h5><p><img src="/../../../../ref/inner_join.gif" alt="inner-join"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line"><span class="keyword">FROM</span> table1 </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column = table2.column;</span><br></pre></td></tr></table></figure><h5 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h5><p><img src="/../../../../ref/left_outer_join.gif" alt="left-join"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">LEFT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column = table2.column;</span><br></pre></td></tr></table></figure><h5 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h5><p><img src="/../../../../ref/right_outer_join.gif" alt="right-join"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">RIGHT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column = table2.column;</span><br></pre></td></tr></table></figure><h5 id="FULL-JOIN"><a href="#FULL-JOIN" class="headerlink" title="FULL JOIN"></a>FULL JOIN</h5><p><img src="/../../../../ref/full_outer_join.gif" alt="full-join"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">columns</span></span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">FULL</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> table2</span><br><span class="line"><span class="keyword">ON</span> table1.column = table2.column;</span><br></pre></td></tr></table></figure><h3 id="Store-Procedures"><a href="#Store-Procedures" class="headerlink" title="Store Procedures"></a>Store Procedures</h3><blockquote><p> PL/SQL is a third generation language that has the expected procedural and namespace constructs, and its tight integration with SQL makes it possible to build complex and powerful applications. Because PL/SQL is executed in the database, you can include SQL statements in your code without having to establish a separate connection.</p></blockquote><blockquote><p>The main types of program units you can create with PL/SQL and store in the database are <strong>standalone procedures</strong> and <strong>functions</strong>, and <strong>packages</strong>. Once stored in the database, these PL/SQL components, collectively known as <strong>stored procedures</strong>, can be used as building blocks for several different applications.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Creating Procedures and Functions syntax</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> procedure_name(arg1 data_type, ...) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  ....</span><br><span class="line"><span class="keyword">END</span> procedure_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> function_name(arg1 data_type, ...) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  ....</span><br><span class="line"><span class="keyword">END</span> function_name;</span><br></pre></td></tr></table></figure><blockquote><p><strong>Procedures</strong> and <strong>functions</strong> that are defined within a package are known as <strong>packaged subprograms</strong>. Procedures and functions that are nested within other subprograms or within a PL/SQL block are called <strong>local subprograms</strong>; they exist only inside the enclosing block and cannot be referenced externally.</p></blockquote><blockquote><p>Packages usually have two parts: <strong>a specification</strong> and <strong>a body</strong>.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The standard package specification</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PACKAGE</span> package_name <span class="keyword">AS</span></span><br><span class="line">  <span class="keyword">type</span> definitions <span class="keyword">for</span> <span class="keyword">records</span>, <span class="keyword">index</span>-<span class="keyword">by</span> <span class="keyword">tables</span></span><br><span class="line">  constants</span><br><span class="line">  <span class="keyword">exceptions</span></span><br><span class="line">  <span class="keyword">global</span> <span class="keyword">variable</span> declarations</span><br><span class="line">  <span class="keyword">procedure</span> procedure_1(arg1, ...);</span><br><span class="line">  ...</span><br><span class="line">  function function_1(arg1,...) return datat_ype;</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">END</span> package_name;</span><br></pre></td></tr></table></figure><blockquote><p>The <strong>package body</strong> contains the code that implements these subprograms, the code for all private subprograms that can only be invoked from within the package, and the queries for the cursors. You can change the implementation details inside the package body without invalidating the calling applications.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">PACKAGE</span> <span class="keyword">BODY</span> package_name <span class="keyword">AS</span></span><br><span class="line">  <span class="keyword">PROCEDURE</span> procedure_1(arg1,...) <span class="keyword">IS</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">EXCEPTION</span> </span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">END</span> procedure_1;</span><br><span class="line">  ...</span><br><span class="line">  FUNCTION function_1(arg1,...)  RETURN data_type IS result_variable data_type</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">RETURN</span> result_variable;</span><br><span class="line">    EXCEPTION</span><br><span class="line">      ...</span><br><span class="line">  <span class="keyword">END</span> function_1;</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">END</span> package_name;</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/queries007.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B19306_01/server.102/b14200/queries007.htm</a><br><a href="https://docs.oracle.com/cd/B28359_01/appdev.111/b28843/tdddg_procedures.htm" target="_blank" rel="noopener">https://docs.oracle.com/cd/B28359_01/appdev.111/b28843/tdddg_procedures.htm</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> KT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 搭建OpenVPN</title>
      <link href="/2016/09/11/raspberry/raspberry-pi3-openvpn/"/>
      <url>/2016/09/11/raspberry/raspberry-pi3-openvpn/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>OpenVPN</code>采用<code>OpenSSL</code>加密，并且可以选择<code>443</code>端口。</p></blockquote><a id="more"></a><h3 id="Install-Server"><a href="#Install-Server" class="headerlink" title="Install Server"></a>Install Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openvpn    </span><br><span class="line">cp -r /usr/share/doc/openvpn/examples/easy-rsa/ /etc/openvpn/</span><br></pre></td></tr></table></figure><h3 id="Generate-CA"><a href="#Generate-CA" class="headerlink" title="Generate CA"></a>Generate CA</h3><h4 id="Configure-parameters"><a href="#Configure-parameters" class="headerlink" title="Configure parameters"></a>Configure parameters</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa/2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify ./vars parameters</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase this to 2048 if you</span></span><br><span class="line"><span class="comment"># are paranoid.  This will slow</span></span><br><span class="line"><span class="comment"># down TLS negotiation performance</span></span><br><span class="line"><span class="comment"># as well as the one-time DH parms</span></span><br><span class="line"><span class="comment"># generation process.</span></span><br><span class="line"><span class="built_in">export</span> KEY_SIZE=2048</span><br><span class="line"><span class="comment"># In how many days should the root CA key expire?</span></span><br><span class="line"><span class="built_in">export</span> CA_EXPIRE=3650</span><br><span class="line"><span class="comment"># In how many days should certificates expire?</span></span><br><span class="line"><span class="built_in">export</span> KEY_EXPIRE=3650</span><br><span class="line"><span class="comment"># These are the default values for fields</span></span><br><span class="line"><span class="comment"># which will be placed in the certificate.</span></span><br><span class="line"><span class="comment"># Don't leave any of these fields blank.</span></span><br><span class="line"><span class="built_in">export</span> KEY_COUNTRY=<span class="string">"TW"</span></span><br><span class="line"><span class="built_in">export</span> KEY_PROVINCE=<span class="string">"Taiwan"</span></span><br><span class="line"><span class="built_in">export</span> KEY_CITY=<span class="string">"Taipei"</span></span><br><span class="line"><span class="built_in">export</span> KEY_ORG=<span class="string">"TakoBear"</span></span><br><span class="line"><span class="built_in">export</span> KEY_EMAIL=<span class="string">"me@myhost.mydomain"</span></span><br><span class="line"><span class="built_in">export</span> KEY_EMAIL=mail@host.domain</span><br><span class="line"><span class="built_in">export</span> KEY_CN=changeme</span><br><span class="line"><span class="built_in">export</span> KEY_NAME=changeme</span><br><span class="line"><span class="built_in">export</span> KEY_OU=changeme</span><br><span class="line"><span class="built_in">export</span> PKCS11_MODULE_PATH=changeme</span><br><span class="line"><span class="built_in">export</span> PKCS11_PIN=1234</span><br></pre></td></tr></table></figure><h4 id="Generate-CA-step-by-step"><a href="#Generate-CA-step-by-step" class="headerlink" title="Generate CA step by step"></a>Generate CA step by step</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ./vars</span><br><span class="line">./clean-all</span><br><span class="line">./build-ca</span><br><span class="line">./build-key-server server</span><br><span class="line">./build-key client</span><br><span class="line">./build-dh</span><br></pre></td></tr></table></figure><h4 id="Copy-CA-Keys-for-Client"><a href="#Copy-CA-Keys-for-Client" class="headerlink" title="Copy CA Keys for Client"></a>Copy CA Keys for Client</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa/2.0/keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy ca.crt client.crt client.key to local</span></span><br></pre></td></tr></table></figure><h3 id="Configure-OpenVPN-Server"><a href="#Configure-OpenVPN-Server" class="headerlink" title="Configure OpenVPN Server"></a>Configure OpenVPN Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> xxx.xxx.xxx.xxx    </span><br><span class="line">port 1194<span class="comment">#default port is 1194    </span></span><br><span class="line">proto tcp<span class="comment">#default protcol is UDP    </span></span><br><span class="line">dev tun</span><br><span class="line">ca /etc/openvpn/easy-rsa/2.0/keys/ca.crt</span><br><span class="line">cert /etc/openvpn/easy-rsa/2.0/keys/server.crt</span><br><span class="line">key /etc/openvpn/easy-rsa/2.0/keys/server.key      </span><br><span class="line">dh  /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem    </span><br><span class="line">server 10.8.0.0 255.255.255.0    </span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line">push <span class="string">"redirect-gateway def1"</span>    </span><br><span class="line">push <span class="string">"dhcp-option DNS 8.8.8.8"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 8.8.4.4"</span>    </span><br><span class="line">client-to-client</span><br><span class="line">keepalive 10 120</span><br><span class="line">comp-lzo    </span><br><span class="line">max-clients 50    </span><br><span class="line">user nobody</span><br><span class="line">group nogroup    </span><br><span class="line">persist-key</span><br><span class="line">persist-tun    </span><br><span class="line">status openvpn-status.log    </span><br><span class="line"><span class="built_in">log</span>-append  openvpn.log    </span><br><span class="line">verb 3    </span><br><span class="line">mute 20</span><br></pre></td></tr></table></figure><h3 id="Start-OpenVPN"><a href="#Start-OpenVPN" class="headerlink" title="Start OpenVPN"></a>Start OpenVPN</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/openvpn start</span><br></pre></td></tr></table></figure><h3 id="Install-Client"><a href="#Install-Client" class="headerlink" title="Install Client"></a>Install Client</h3><blockquote><p>Download URL: <a href="http://openvpn.se/download.html" target="_blank" rel="noopener">http://openvpn.se/download.html</a></p></blockquote><h4 id="Client-configuration-sample"><a href="#Client-configuration-sample" class="headerlink" title="Client configuration sample"></a>Client configuration sample</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vpn.ovpn</span></span><br><span class="line"></span><br><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto tcp</span><br><span class="line">remote example.org 1194    <span class="comment"># change example.org to your server ip</span></span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">ca &amp;quot;C:\\Program Files\\OpenVPN\\easy-rsa\\keys\\ca.crt&amp;quot;</span><br><span class="line">cert &amp;quot;C:\\Program Files\\OpenVPN\\easy-rsa\\keys\\client.crt&amp;quot;</span><br><span class="line">key &amp;quot;C:\\Program Files\\OpenVPN\\easy-rsa\\keys\\client.key&amp;quot;</span><br><span class="line">remote-cert-tls server</span><br><span class="line">comp-lzo</span><br><span class="line">verb 3</span><br><span class="line">mute 20</span><br></pre></td></tr></table></figure><h4 id="Support-ipv4"><a href="#Support-ipv4" class="headerlink" title="Support ipv4"></a>Support ipv4</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/sysctl.conf</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># reload</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h4 id="Conigure-iptables"><a href="#Conigure-iptables" class="headerlink" title="Conigure iptables"></a>Conigure iptables</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br><span class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o venet0 -j MASQUERADE</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT</span><br><span class="line">iptables -t nat -A PREROUTING -p udp -m udp --dport 53 -j DNAT --to-destination 8.8.8.8</span><br><span class="line">iptables -A INPUT -p udp --dport 1194 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 10.8.0.0/24 -p all -j ACCEPT</span><br><span class="line">iptables -A FORWARD -d 10.8.0.0/24 -j ACCEPT</span><br><span class="line">iptables -A INPUT -i tun+ -j ACCEPT</span><br><span class="line">iptables -A FORWARD -i tun+ -j ACCEPT</span><br><span class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j SNAT --to-source xxx.xxx.xxx.xxx</span><br><span class="line"></span><br><span class="line"># quick save</span><br><span class="line">iptables-save &amp;gt; /etc/network/iptables</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://www.zhengyali.com/?p=52" target="_blank" rel="noopener">http://www.zhengyali.com/?p=52</a><br><a href="http://shumeipai.net/thread-578-1-1.html?_dsign=e5591959" target="_blank" rel="noopener">http://shumeipai.net/thread-578-1-1.html?_dsign=e5591959</a><br><a href="http://buzzdao.myds.me:1111/setup-l2tp-pptp-openvpn-on-ubuntu.html" target="_blank" rel="noopener">http://buzzdao.myds.me:1111/setup-l2tp-pptp-openvpn-on-ubuntu.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> OpenVpn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry &amp; Linux Crontab Example</title>
      <link href="/2016/09/10/raspberry/raspberry-linux-crontab-examples/"/>
      <url>/2016/09/10/raspberry/raspberry-linux-crontab-examples/</url>
      
        <content type="html"><![CDATA[<h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># m h  dom mon dow   command</span><br><span class="line"># * * * * *  command to execute</span><br><span class="line"># ┬ ┬ ┬ ┬ ┬</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># │ │ │ │ └───── day of week (0 - 7) (0 to 6 are Sun to Sat or use names; 7 is Sunday, the same as 0)</span><br><span class="line"># │ │ │ └────────── month (1 - 12)</span><br><span class="line"># │ │ └─────────────── day of month (1 - 31)</span><br><span class="line"># │ └──────────────────── hour (0 - 23)</span><br><span class="line"># └───────────────────────── min (0 - 59)</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h4 id="Scheduling-a-Job-For-a-Specific-Time"><a href="#Scheduling-a-Job-For-a-Specific-Time" class="headerlink" title="Scheduling a Job For a Specific Time"></a>Scheduling a Job For a Specific Time</h4><blockquote><p>The basic usage of cron is to execute a job in a specific time as shown below. This will execute the Full backup shell script (full-backup) on 10th June 08:30 AM.</p></blockquote><blockquote><p>Please note that the time field uses 24 hours format. So, for 8 AM use 8, and for 8 PM use 20.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">30 08 10 06 * /home/ramesh/full-backup`</span><br><span class="line"># * 30 – 30th Minute</span><br><span class="line"># * 08 – 08 AM</span><br><span class="line"># * 10 – 10th Day</span><br><span class="line"># * 06 – 6th Month (June)</span><br><span class="line"># * * – Every day of the week</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Job-For-More-Than-One-Instance-e-g-Twice-a-Day"><a href="#Schedule-a-Job-For-More-Than-One-Instance-e-g-Twice-a-Day" class="headerlink" title="Schedule a Job For More Than One Instance (e.g. Twice a Day)"></a>Schedule a Job For More Than One Instance (e.g. Twice a Day)</h4><blockquote><p>The following script take a incremental backup twice a day every day.</p></blockquote><blockquote><p>This example executes the specified incremental backup shell script (incremental-backup) at 11:00 and 16:00 on every day. The comma separated value in a field specifies that the command needs to be executed in all the mentioned time.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00 11,16 * * * /home/ramesh/bin/incremental-backup</span><br><span class="line"># * 00 – 0th Minute (Top of the hour)</span><br><span class="line"># * 11,16 – 11 AM and 4 PM</span><br><span class="line"># * * – Every day</span><br><span class="line"># * * – Every month</span><br><span class="line"># * * – Every day of the week</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Job-for-Specific-Range-of-Time-e-g-Only-on-Weekdays"><a href="#Schedule-a-Job-for-Specific-Range-of-Time-e-g-Only-on-Weekdays" class="headerlink" title="Schedule a Job for Specific Range of Time (e.g. Only on Weekdays)"></a>Schedule a Job for Specific Range of Time (e.g. Only on Weekdays)</h4><blockquote><p>If you wanted a job to be scheduled for every hour with in a specific range of time then use the following.<br>Cron Job everyday during working hoursThis example checks the status of the database everyday (including weekends) during the working hours 9 a.m – 6 p.m</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00 09-18 * * * /home/ramesh/bin/check-db-status</span><br><span class="line"># * 00 – 0th Minute (Top of the hour)</span><br><span class="line"># * 09-18 – 9 am, 10 am,11 am, 12 am, 1 pm, 2 pm, 3 pm, 4 pm, 5 pm, 6 pm</span><br><span class="line"># * * – Every day</span><br><span class="line"># * * – Every month</span><br><span class="line"># * * – Every day of the week</span><br></pre></td></tr></table></figure><h4 id="Cron-Job-every-weekday-during-working-hours"><a href="#Cron-Job-every-weekday-during-working-hours" class="headerlink" title="Cron Job every weekday during working hours"></a>Cron Job every weekday during working hours</h4><blockquote><p>This example checks the status of the database every weekday (i.e excluding Sat and Sun) during the working hours 9 a.m – 6 p.m.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00 09-18 * * 1-5 /home/ramesh/bin/check-db-status</span><br><span class="line"># * 00 – 0th Minute (Top of the hour)</span><br><span class="line"># * 09-18 – 9 am, 10 am,11 am, 12 am, 1 pm, 2 pm, 3 pm, 4 pm, 5 pm, 6 pm</span><br><span class="line"># * * – Every day</span><br><span class="line"># * * – Every month</span><br><span class="line"># * 1-5 -Mon, Tue, Wed, Thu and Fri (Every Weekday)</span><br></pre></td></tr></table></figure><h4 id="How-to-View-Crontab-Entries"><a href="#How-to-View-Crontab-Entries" class="headerlink" title="How to View Crontab Entries?"></a>How to View Crontab Entries?</h4><blockquote><p>View Current Logged-In User’s Crontab entries<br>To view your crontab entries type <code>crontab -l</code> from your unix account as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ramesh@dev-db$ crontab -l</span><br><span class="line">@yearly /home/ramesh/annual-maintenance</span><br><span class="line">*/10 * * * * /home/ramesh/check-disk-space</span><br><span class="line"></span><br><span class="line">#Note: This displays crontab of the current logged in user</span><br></pre></td></tr></table></figure><blockquote><p>View Root Crontab entriesLogin as root user <code>(su – root)</code> and do <code>crontab -l</code> as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@dev-db# crontab -l</span><br><span class="line">no crontab for root</span><br></pre></td></tr></table></figure><blockquote><p>Crontab HowTo: View Other Linux User’s Crontabs entriesTo view crontab entries of other Linux users, login to root and use <code>-u {username} -l</code> as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@dev-db# crontab -u sathiya -l</span><br><span class="line">@monthly /home/sathiya/monthly-backup</span><br><span class="line">00 09-18 * * * /home/sathiya/check-db-status</span><br></pre></td></tr></table></figure><h4 id="How-to-Edit-Crontab-Entries"><a href="#How-to-Edit-Crontab-Entries" class="headerlink" title="How to Edit Crontab Entries?"></a>How to Edit Crontab Entries?</h4><blockquote><p>Edit Current Logged-In User’s Crontab entriesTo edit a crontab entries, use <code>crontab -e</code> as shown below. By default this will edit the current logged-in users crontab.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ramesh@dev-db$ crontab -e</span><br><span class="line">@yearly /home/ramesh/centos/bin/annual-maintenance</span><br><span class="line">*/10 * * * * /home/ramesh/debian/bin/check-disk-space</span><br><span class="line">~</span><br><span class="line">&quot;/tmp/crontab.XXXXyjWkHw&quot; 2L, 83C</span><br><span class="line"></span><br><span class="line">#Note: This will open the crontab file in Vim editor for editing.</span><br><span class="line">Please note cron created a temporary /tmp/crontab.XX...</span><br></pre></td></tr></table></figure><blockquote><p>When you save the above temporary file with <code>:wq</code>, it will save the crontab and display the following message indicating the crontab is successfully modified.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~</span><br><span class="line">&quot;crontab.XXXXyjWkHw&quot; 2L, 83C written</span><br><span class="line">crontab: installing new crontab</span><br></pre></td></tr></table></figure><blockquote><p>Edit Root Crontab entriesLogin as root user <code>(su – root)</code> and do <code>crontab -e</code> as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@dev-db# crontab -e</span><br></pre></td></tr></table></figure><blockquote><p>Edit Other Linux User’s Crontab File entriesTo edit crontab entries of other Linux users, login to root and use <code>-u {username} -e</code> as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@dev-db# crontab -u sathiya -e</span><br><span class="line">@monthly /home/sathiya/fedora/bin/monthly-backup</span><br><span class="line">00 09-18 * * * /home/sathiya/ubuntu/bin/check-db-status</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">&quot;/tmp/crontab.XXXXyjWkHw&quot; 2L, 83C</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Job-for-Every-Minute-Using-Cron"><a href="#Schedule-a-Job-for-Every-Minute-Using-Cron" class="headerlink" title="Schedule a Job for Every Minute Using Cron."></a>Schedule a Job for Every Minute Using Cron.</h4><blockquote><p>Ideally you may not have a requirement to schedule a job every minute. But understanding this example will will help you understand the other examples mentioned below in this article.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * CMD</span><br></pre></td></tr></table></figure><blockquote><p>The <code>*</code> means all the possible unit — i.e every minute of every hour through out the year. More than using this * directly, you will find it very useful in the following cases.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* When you specify */5 in minute field means every 5 minutes.</span><br><span class="line">* When you specify 0-10/2 in minute field mean every 2 minutes in the first 10 minute.</span><br><span class="line">* Thus the above convention can be used for all the other 4 fields.</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Background-Cron-Job-For-Every-10-Minutes"><a href="#Schedule-a-Background-Cron-Job-For-Every-10-Minutes" class="headerlink" title="Schedule a Background Cron Job For Every 10 Minutes."></a>Schedule a Background Cron Job For Every 10 Minutes.</h4><blockquote><p>Use the following, if you want to check the disk space every 10 minutes.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * /home/ramesh/check-disk-space</span><br></pre></td></tr></table></figure><blockquote><p>It executes the specified command check-disk-space every 10 minutes through out the year. But you may have a requirement of executing the command only during office hours or vice versa. The above examples shows how to do those things.</p></blockquote><blockquote><p>Instead of specifying values in the 5 fields, we can specify it using a single keyword as mentioned below.</p></blockquote><blockquote><p>There are special cases in which instead of the above 5 fields you can use @ followed by a keyword — such as reboot, midnight, yearly, hourly.<br>Table: Cron special keywords and its meaning<br>Keyword -Equivalent<br><code>@yearly</code> - <code>0 0 1 1 *</code><br><code>@daily</code>  - <code>0 0 * * *</code><br><code>@hourly</code> - <code>0 * * * *</code><br><code>@reboot</code> - <code>Run at startup.</code></p></blockquote><h4 id="Schedule-a-Job-For-First-Minute-of-Every-Year-using-yearly"><a href="#Schedule-a-Job-For-First-Minute-of-Every-Year-using-yearly" class="headerlink" title="Schedule a Job For First Minute of Every Year using @yearly"></a>Schedule a Job For First Minute of Every Year using <code>@yearly</code></h4><blockquote><p>If you want a job to be executed on the first minute of every year, then you can use the @yearly cron keyword as shown below.</p></blockquote><blockquote><p>This will execute the system annual maintenance using annual-maintenance shell script at 00:00 on Jan 1st for every year.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@yearly /home/ramesh/red-hat/bin/annual-maintenance</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Cron-Job-Beginning-of-Every-Month-using-monthly"><a href="#Schedule-a-Cron-Job-Beginning-of-Every-Month-using-monthly" class="headerlink" title="Schedule a Cron Job Beginning of Every Month using @monthly"></a>Schedule a Cron Job Beginning of Every Month using <code>@monthly</code></h4><blockquote><p>It is as similar as the @yearly as above. But executes the command monthly once using @monthly cron keyword.</p></blockquote><blockquote><p>This will execute the shell script tape-backup at 00:00 on 1st of every month.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@monthly /home/ramesh/suse/bin/tape-backup</span><br></pre></td></tr></table></figure><h4 id="Schedule-a-Background-Job-Every-Day-using-daily"><a href="#Schedule-a-Background-Job-Every-Day-using-daily" class="headerlink" title="Schedule a Background Job Every Day using @daily"></a>Schedule a Background Job Every Day using <code>@daily</code></h4><blockquote><p>Using the @daily cron keyword, this will do a daily log file cleanup using cleanup-logs shell scriptat 00:00 on every day.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@daily /home/ramesh/arch-linux/bin/cleanup-logs &quot;day started&quot;</span><br></pre></td></tr></table></figure><h4 id="How-to-Execute-a-Linux-Command-After-Every-Reboot-using-reboot"><a href="#How-to-Execute-a-Linux-Command-After-Every-Reboot-using-reboot" class="headerlink" title="How to Execute a Linux Command After Every Reboot using @reboot?"></a>How to Execute a Linux Command After Every Reboot using <code>@reboot</code>?</h4><blockquote><p>Using the <code>@reboot</code> cron keyword, this will execute the specified command once after the machine got booted every time.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot CMD</span><br></pre></td></tr></table></figure><h4 id="How-to-Disable-Redirect-the-Crontab-Mail-Output-using-MAIL-keyword"><a href="#How-to-Disable-Redirect-the-Crontab-Mail-Output-using-MAIL-keyword" class="headerlink" title="How to Disable/Redirect the Crontab Mail Output using MAIL keyword?"></a>How to Disable/Redirect the Crontab Mail Output using MAIL keyword?</h4><blockquote><p>By default crontab sends the job output to the user who scheduled the job. If you want to redirect the output to a specific user, add or update the MAIL variable in the crontab as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ramesh@dev-db$ crontab -l</span><br><span class="line">MAIL=&quot;ramesh&quot;</span><br><span class="line"></span><br><span class="line">@yearly /home/ramesh/annual-maintenance</span><br><span class="line">*/10 * * * * /home/ramesh/check-disk-space</span><br><span class="line"></span><br><span class="line">#Note: Crontab of the current logged in user with MAIL variable</span><br></pre></td></tr></table></figure><blockquote><p>If you wanted the mail not to be sent to anywhere, i.e to stop the crontab output to be emailed, add or update the MAIL variable in the crontab as shown below. MAIL=””</p></blockquote><h4 id="How-to-Execute-a-Linux-Cron-Jobs-Every-Second-Using-Crontab"><a href="#How-to-Execute-a-Linux-Cron-Jobs-Every-Second-Using-Crontab" class="headerlink" title="How to Execute a Linux Cron Jobs Every Second Using Crontab."></a>How to Execute a Linux Cron Jobs Every Second Using Crontab.</h4><blockquote><p>You cannot schedule a every-second cronjob. Because in cron the minimum unit you can specify is minute. In a typical scenario, there is no reason for most of us to run any job every second in the system.</p></blockquote><h4 id="Specify-PATH-Variable-in-the-Crontab"><a href="#Specify-PATH-Variable-in-the-Crontab" class="headerlink" title="Specify PATH Variable in the Crontab"></a>Specify PATH Variable in the Crontab</h4><blockquote><p>All the above examples we specified absolute path of the Linux command or the shell-script that needs to be executed.</p></blockquote><blockquote><p>For example, instead of specifying <code>/home/ramesh/tape-backup</code>, if you want to just specify tape-backup, then add the path <code>/home/ramesh</code> to the PATH variable in the crontab as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ramesh@dev-db$ crontab -l</span><br><span class="line"></span><br><span class="line">PATH=/bin:/sbin:/usr/bin:/usr/sbin:/home/ramesh</span><br><span class="line"></span><br><span class="line">@yearly annual-maintenance</span><br><span class="line">*/10 * * * * check-disk-space</span><br><span class="line"></span><br><span class="line">Note: Crontab of the current logged in user with PATH variable</span><br></pre></td></tr></table></figure><h4 id="Installing-Crontab-From-a-Cron-File"><a href="#Installing-Crontab-From-a-Cron-File" class="headerlink" title="Installing Crontab From a Cron File"></a>Installing Crontab From a Cron File</h4><blockquote><p>Instead of directly editing the crontab file, you can also add all the entries to a cron-file first. Once you have all thoese entries in the file, you can upload or install them to the cron as shown below.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ramesh@dev-db$ crontab -l</span><br><span class="line">no crontab for ramesh</span><br><span class="line"></span><br><span class="line">$ cat cron-file.txt</span><br><span class="line">@yearly /home/ramesh/annual-maintenance</span><br><span class="line">*/10 * * * * /home/ramesh/check-disk-space</span><br><span class="line"></span><br><span class="line">ramesh@dev-db$ crontab cron-file.txt</span><br><span class="line"></span><br><span class="line">ramesh@dev-db$ crontab -l</span><br><span class="line">@yearly /home/ramesh/annual-maintenance</span><br><span class="line">*/10 * * * * /home/ramesh/check-disk-space</span><br><span class="line"></span><br><span class="line">#Note: This will install the cron-file.txt to your crontab, </span><br><span class="line">#which will also remove your old cron entries. </span><br><span class="line">#So, please be careful while uploading cron entries from a cron-file.txt.</span><br></pre></td></tr></table></figure><p>Resources:<br><a href="http://www.thegeekstuff.com/tag/productivity-tips-for-geeks/" target="_blank" rel="noopener">http://www.thegeekstuff.com/tag/productivity-tips-for-geeks/</a></p>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>外网访问树莓派</title>
      <link href="/2016/09/08/raspberry/access-raspberry/"/>
      <url>/2016/09/08/raspberry/access-raspberry/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在网上搜了下，大概有这么几种方法，当然你要是有公网的IP, 并且80端口是开启的便能直接ssh了，只不过大多数运营商都不会暴露这些…</p></blockquote><a id="more"></a><h3 id="公网IP直接访问"><a href="#公网IP直接访问" class="headerlink" title="公网IP直接访问"></a>公网IP直接访问</h3><blockquote><p>一般通过路由器(不管是一级路由还是N级路由)拿到的IP都是运营商提供的内网IP, 比如</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.0 - 10.255.255.255</span><br><span class="line">172.16.0.0 - 172.31.255.255</span><br><span class="line">192.168.0.0 - 192.168.255.255</span><br></pre></td></tr></table></figure><h4 id="获取外网IP"><a href="#获取外网IP" class="headerlink" title="获取外网IP"></a>获取外网IP</h4><blockquote><p>参考IP查询网址：</p></blockquote><blockquote><p><a href="http://www.ip138.com/" target="_blank" rel="noopener">http://www.ip138.com/</a><br><a href="http://ip.qq.com/" target="_blank" rel="noopener">http://ip.qq.com/</a><br><a href="http://jsonip.com/" target="_blank" rel="noopener">http://jsonip.com/</a><br><a href="http://www.net.cn/static/customercare/yourip.asp/" target="_blank" rel="noopener">http://www.net.cn/static/customercare/yourip.asp/</a><br><a href="http://www.infosniper.net/" target="_blank" rel="noopener">http://www.infosniper.net/</a><br><a href="http://bgp.he.net/" target="_blank" rel="noopener">http://bgp.he.net/</a></p></blockquote><blockquote><p>如果外网IP不固定会变化，可以通过脚本来邮件发送，虽然这种方法比较笨，不过临时用用是可行的。</p></blockquote><p>脚本可参照<a href="https://github.com/itabas016/PythonTrip/blob/master/sublime/extenral_ip.py" target="_blank" rel="noopener"><code>get_extenal_ip.py</code></a></p><h4 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h4><blockquote><p>在路由器端做端口映射，如果是二级或三级路由，并且需要有上级路由的权限，不然此方法不通。</p></blockquote><blockquote><p>Resource: <a href="http://www.jianshu.com/p/981520f10ed3" target="_blank" rel="noopener">http://www.jianshu.com/p/981520f10ed3</a></p></blockquote><blockquote><p>这样通过<code>IP+Port</code>访问<code>Raspberry</code>就行了。</p></blockquote><h3 id="Vpn"><a href="#Vpn" class="headerlink" title="Vpn"></a>Vpn</h3><blockquote><p>顾名思义就是让Raspberry与你当前的Client处于同一个网段，然后通过内网ssh.</p></blockquote><blockquote><p>所以要在<code>vps</code>上搭建<code>VPN</code>, 然后树莓派和控制端都连上<code>VPN</code></p></blockquote><h3 id="SSH内网穿透"><a href="#SSH内网穿透" class="headerlink" title="SSH内网穿透"></a>SSH内网穿透</h3><blockquote><p>原理是这样的假设<code>vps</code>地址是<code>10.10.10.10</code>，树莓派通过<code>ssh</code>连接到<code>vps</code>，同时将<code>vps</code>上某个端口比如<code>8888</code>映射到树莓派的<code>ssh</code>端口比如<code>22</code>，这样在<code>vps</code>上访问8888端口就相当于访问树莓派的<code>22</code>端口。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -f -N -R 8888:localhost:22 username@10.10.10.10</span><br></pre></td></tr></table></figure><h4 id="Autossh"><a href="#Autossh" class="headerlink" title="Autossh"></a>Autossh</h4><blockquote><p><code>autossh</code>可以使断开的<code>ssh</code>重连。</p></blockquote><h5 id="Add-ssh-public-key"><a href="#Add-ssh-public-key" class="headerlink" title="Add ssh public key"></a>Add ssh public key</h5><h5 id="Configure-auto-connect-when-crash"><a href="#Configure-auto-connect-when-crash" class="headerlink" title="Configure auto connect when crash"></a>Configure auto connect when crash</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id username@10.10.10.10</span><br></pre></td></tr></table></figure><h5 id="Start-autossh"><a href="#Start-autossh" class="headerlink" title="Start autossh"></a>Start autossh</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ autossh -M 5678 -fNR 8888:localhost:22 username@10.10.10.10</span><br></pre></td></tr></table></figure><h5 id="Auto-Start-autossh"><a href="#Auto-Start-autossh" class="headerlink" title="Auto Start autossh"></a>Auto Start autossh</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/rc.local | grep autossh</span><br><span class="line">su pi -c <span class="string">"autossh -M 5678 -fNR 8888:localhost:22 username@10.10.10.10"</span></span><br></pre></td></tr></table></figure><blockquote><p>Resources: <a href="https://github.com/ma6174/blog/issues/7" target="_blank" rel="noopener">https://github.com/ma6174/blog/issues/7</a></p></blockquote><h4 id="Dynamic-DNS"><a href="#Dynamic-DNS" class="headerlink" title="Dynamic DNS"></a>Dynamic DNS</h4><blockquote><p>常用的<a href="http://hsk.oray.com/" target="_blank" rel="noopener">花生壳</a>动态域名, 当然还有很多其他免费的<code>DNS</code>运营商。</p></blockquote><blockquote><p><a href="http://www.noip.com/" target="_blank" rel="noopener">http://www.noip.com/</a><br><a href="https://duckdns.org/" target="_blank" rel="noopener">https://duckdns.org/</a><br><a href="http://www.dnsdynamic.org/" target="_blank" rel="noopener">http://www.dnsdynamic.org/</a><br><a href="http://www.dynu.com/" target="_blank" rel="noopener">http://www.dynu.com/</a><br><a href="http://www.changeip.com/dns.php" target="_blank" rel="noopener">http://www.changeip.com/dns.php</a><br>……</p></blockquote><blockquote><p>注册一个免费的壳域名，在路由器端<code>DNS</code>解析输入申请的壳域名账号及密码，配置完成。所有的工作都交给了壳域名来操作。</p></blockquote><blockquote><p>如果还做了端口映射，请用壳域名+映射端口来<code>ssh</code></p></blockquote><blockquote><p>Resource:<br><a href="http://hsk.oray.com/get/?icn=hsk_get&amp;ici=hsk_home-grid#topology" target="_blank" rel="noopener">http://hsk.oray.com/get/?icn=hsk_get&amp;ici=hsk_home-grid#topology</a><br><a href="http://hsk.oray.com/news/4168.html" target="_blank" rel="noopener">http://hsk.oray.com/news/4168.html</a></p></blockquote><h4 id="Ngrok"><a href="#Ngrok" class="headerlink" title="Ngrok"></a><a href="https://ngrok.com/" target="_blank" rel="noopener">Ngrok</a></h4><blockquote><p><code>ngrok</code>目前是非常流行的反向代理服务，可以进行内网穿透，支持80端口以及自定义<code>tcp</code>端口转发。<br>这样即使你的树莓派没有公网IP也可以使用SSH远程登陆。</p></blockquote><blockquote><p>Offical Website: <a href="https://ngrok.com/" target="_blank" rel="noopener">https://ngrok.com/</a><br>Open Source: <a href="https://github.com/inconshreveable/ngrok" target="_blank" rel="noopener">https://github.com/inconshreveable/ngrok</a></p></blockquote><h5 id="Download-amp-Install"><a href="#Download-amp-Install" class="headerlink" title="Download &amp; Install"></a>Download &amp; Install</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/proj/ngrok &amp;&amp; <span class="built_in">cd</span> ~/proj/ngrok</span><br><span class="line">wget http://7xl5gf.com1.z0.glb.clouddn.com/assets/natapp/download/ngrok_linux_arm.zip</span><br><span class="line">unzip ngrok_linux_arm.zip</span><br><span class="line">chmod 755 ngrok</span><br></pre></td></tr></table></figure><blockquote><p>添加configuration</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nano ngrok.cfg</span></span><br><span class="line"></span><br><span class="line">server_addr: <span class="string">"ngrok.natapp.cn:4443"</span> </span><br><span class="line">trust_host_root_certs: <span class="literal">false</span></span><br><span class="line"><span class="comment"># because client no ssl, so this value isfalse</span></span><br></pre></td></tr></table></figure><h5 id="Net-port-Mapping"><a href="#Net-port-Mapping" class="headerlink" title="Net port Mapping"></a>Net port Mapping</h5><blockquote><p><strong><code>http &amp; https 80 port</code></strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ngrok -config ngrok.cfg -subdomain **example** 80 -subdomain</span><br></pre></td></tr></table></figure><blockquote><p><strong><code>TCP port mapping</code></strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ngrok -proto=tcp -config ngrok.cfg 22</span><br></pre></td></tr></table></figure><blockquote><p>TCP port didn’t support subdomain, it’s need configure tcp parameter manmually.</p></blockquote><blockquote><p><strong><code>Mutiple ports mapping</code></strong></p></blockquote><pre><code class="bash"><span class="comment"># nano ./ngrok.cfg</span>tunnels:    http:    proto:    http: 80    subdomain: example    ssh:    proto:    tcp: 22    remote_port: 55699<span class="comment"># start</span>./ngrok -config=ngrok.cfg start http ssh</code></pre><blockquote><p>详细配置参照这篇文章<a href="http://io.itabas.com/2016/09/24/vps/ngrok-server/" target="_blank" rel="noopener">自建ngrok server进行内网穿透</a></p></blockquote><blockquote><p>Resources:<br><a href="https://www.rpicn.org/documentation/remote-access/access-over-internet/ngrok/" target="_blank" rel="noopener">https://www.rpicn.org/documentation/remote-access/access-over-internet/ngrok/</a><br><a href="https://blog.phpgao.com/ngrok_how_to.html" target="_blank" rel="noopener">https://blog.phpgao.com/ngrok_how_to.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> Ngrok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SS加速的解决方案</title>
      <link href="/2016/09/06/vps/ss-speeder/"/>
      <url>/2016/09/06/vps/ss-speeder/</url>
      
        <content type="html"><![CDATA[<blockquote><p>根据vps的特点选择适合自己的加速方案，Openvz和Kvm以及Xen (<strong><a href="#more">如何检测Vps架构↓↓↓</a></strong>) 不同架构处理方式也是不同。</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#91yun check script</span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/code/master/vm_check.sh &amp;&amp; bash vm_check.sh</span><br></pre></td></tr></table></figure><h3 id="net-speeder"><a href="#net-speeder" class="headerlink" title="net-speeder"></a><a href="https://github.com/snooda/net-speeder" target="_blank" rel="noopener">net-speeder</a></h3><blockquote><p>在高延迟不稳定链路上优化单线程下载速度</p></blockquote><blockquote><p>开启了net-speeder的服务器上对外ping时看到的是4倍，实际网络上是2倍流量。另外两倍是内部dup出来的，不占用带宽。 另外，内部dup包并非是偷懒未判断。。。是为了更快触发快速重传的。 </p></blockquote><blockquote><p>net-speeder不依赖ttl的大小，ttl的大小跟流量无比例关系。不存在windows的ttl大，发包就多的情况。</p></blockquote><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><blockquote><p>一键安装script</p></blockquote><h5 id="ubuntu-debian"><a href="#ubuntu-debian" class="headerlink" title="ubuntu/debian"></a>ubuntu/debian</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell wget --no-check-certificate https://raw.githubusercontent.com/tennfy/debian_netspeeder_tennfy/master/debian_netspeeder_tennfy.sh chmod a+x debian_netspeeder_tennfy.sh bash debian_netspeeder_tennfy.sh</span><br></pre></td></tr></table></figure><h5 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://gist.github.com/LazyZhu/dc3f2f84c336a08fd6a5/rawd8aa4bcf955409e28a262ccf52921a65fe49da99/net_speeder_lazyinstall.sh sh net_speeder_lazyinstall.sh</span><br></pre></td></tr></table></figure><blockquote><p>source code <code>make</code> and <code>make install</code></p></blockquote><blockquote><p><strong>net-speed</strong> <a href="https://github.com/snooda/net-speeder" target="_blank" rel="noopener">opensource</a></p></blockquote><h4 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h4><p><code>cp ./net_speeder /usr/bin</code></p><blockquote><p>#comments:<br><code>parameter: net_speeder netdisk rule (bpf)</code><br><code>net_speeder venet0 &quot;ip&quot;</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/net_speeder venet0 <span class="string">"ip"</span></span><br><span class="line"><span class="comment"># add netspeed to </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'nohup /usr/bin/net_speeder venet0 "ip" &gt;/dev/null 2&gt;&amp;1 &amp;'</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure><h3 id="kcptun"><a href="#kcptun" class="headerlink" title="kcptun"></a><a href="https://github.com/xtaci/kcptun" target="_blank" rel="noopener">kcptun</a></h3><blockquote><p>Kcptun是一个非常简单和快速的，基于 KCP 协议的 UDP 隧道，它可以将 TCP 流转换为 KCP+UDP 流。而 KCP 是一个快速可靠协议，能以比 TCP 浪费10%-20%的带宽的代价，换取平均延迟降低 30%-40%，且最大延迟降低三倍的传输效果。<br>Kcptun是 KCP 协议的一个简单应用，可以用于任意 TCP 网络程序的传输承载，以提高网络流畅度，降低掉线情况。由于 Kcptun 使用 Go 语言编写，内存占用低（经测试，在64M内存服务器上稳定运行），而且适用于所有平台，甚至 Arm 平台。</p></blockquote><h4 id="Installation-1"><a href="#Installation-1" class="headerlink" title="Installation"></a>Installation</h4><blockquote><p><strong><a href="https://blog.kuoruan.com/110.html" target="_blank" rel="noopener">一键安装script</a></strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/kuoruan/kcptun_installer/master/kcptun.sh</span><br><span class="line">chmod +x ./kcptun.sh</span><br><span class="line">./kcptun.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configure kcptun server port:</span></span><br><span class="line">please input kcptun server port [1-65535]: (default 29900)</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure speed ip:</span></span><br><span class="line">please input speed ip [0.0.0.0 ~ 255.255.255.255]: (default 127.0.0.1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure speed port:</span></span><br><span class="line">please input speed port [1-65535]: (default 12948)</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure kcptun password:</span></span><br><span class="line">please input kcptun password: (default it<span class="string">'s a secrect)</span></span><br></pre></td></tr></table></figure><h3 id="finalspeed"><a href="#finalspeed" class="headerlink" title="finalspeed"></a><a href="https://github.com/91yun/finalspeed" target="_blank" rel="noopener">finalspeed</a></h3><blockquote><p>FinalSpeed是高速双边加速软件,可加速所有基于tcp协议的网络服务,在高丢包和高延迟环境下,仍可达到90%的物理带宽利用率,即使高峰时段也能轻松跑满带宽.<br>适用与Openvz, 并且占用内存大</p></blockquote><h4 id="Installation-2"><a href="#Installation-2" class="headerlink" title="Installation"></a>Installation</h4><blockquote><p>一键安装script</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/finalspeed/master/install_fs.sh &amp;&amp; bash install_fs.sh</span><br></pre></td></tr></table></figure><blockquote><p>一键卸载script</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/finalspeed/master/install_fs.sh &amp;&amp; bash install_fs.sh uninstall</span><br></pre></td></tr></table></figure><h4 id="How-to-use-1"><a href="#How-to-use-1" class="headerlink" title="How to use"></a>How to use</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># install path: /fs/</span><br><span class="line"># log path: /fs/server.log</span><br><span class="line"></span><br><span class="line"># start</span><br><span class="line">/etc/init.d/finalspeed start</span><br><span class="line"></span><br><span class="line"># stop</span><br><span class="line">/etc/init.d/finalspeed stop</span><br><span class="line"></span><br><span class="line"># check status&amp;log</span><br><span class="line">/etc/init.d/finalspeed status</span><br></pre></td></tr></table></figure><h5 id="windows-client-download"><a href="#windows-client-download" class="headerlink" title="windows client download"></a><a href="https://github.com/91yun/finalspeed/raw/master/finalspeed_install1.0.exe" target="_blank" rel="noopener">windows client download</a></h5><h5 id="linux-amp-os-x-client-download"><a href="#linux-amp-os-x-client-download" class="headerlink" title="linux &amp; os x client download"></a><a href="https://raw.githubusercontent.com/91yun/finalspeed/master/finalspeed_client.zip" target="_blank" rel="noopener">linux &amp; os x client download</a></h5><p>Resource: <a href="https://www.91yun.org/archives/615" target="_blank" rel="noopener">https://www.91yun.org/archives/615</a></p>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Vps </tag>
            
            <tag> SS </tag>
            
            <tag> SS加速 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle Statements - DDL, DML, DCL, TCL</title>
      <link href="/2016/09/03/database/oracle-statements/"/>
      <url>/2016/09/03/database/oracle-statements/</url>
      
        <content type="html"><![CDATA[<h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a><code>DDL</code></h3><blockquote><p><strong>Data Definition Language (DDL)</strong><br>statements are used to define the database structure or schema. Some examples:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> - <span class="keyword">to</span> <span class="keyword">create</span> objects <span class="keyword">in</span> the <span class="keyword">database</span></span><br><span class="line"><span class="keyword">ALTER</span> - alters the structure <span class="keyword">of</span> the <span class="keyword">database</span></span><br><span class="line"><span class="keyword">DROP</span> - <span class="keyword">delete</span> objects <span class="keyword">from</span> the <span class="keyword">database</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> - remove <span class="keyword">all</span> <span class="keyword">records</span> <span class="keyword">from</span> a <span class="keyword">table</span>, <span class="keyword">including</span> <span class="keyword">all</span> spaces allocated <span class="keyword">for</span> the <span class="keyword">records</span> <span class="keyword">are</span> removed</span><br><span class="line"><span class="keyword">COMMENT</span> - <span class="keyword">add</span> comments <span class="keyword">to</span> the <span class="keyword">data</span> dictionary</span><br><span class="line"><span class="keyword">RENAME</span> - <span class="keyword">rename</span> an <span class="keyword">object</span></span><br></pre></td></tr></table></figure><h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a><code>DML</code></h3><blockquote><p><strong>Data Manipulation Language (DML)</strong><br>statements are used for managing data within schema objects. Some examples:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> - retrieve <span class="keyword">data</span> <span class="keyword">from</span> the a <span class="keyword">database</span></span><br><span class="line"><span class="keyword">INSERT</span> - <span class="keyword">insert</span> <span class="keyword">data</span> <span class="keyword">into</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">UPDATE</span> - updates existing <span class="keyword">data</span> <span class="keyword">within</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">DELETE</span> - deletes <span class="keyword">all</span> <span class="keyword">records</span> <span class="keyword">from</span> a <span class="keyword">table</span>, the <span class="keyword">space</span> <span class="keyword">for</span> the <span class="keyword">records</span> remain</span><br><span class="line"><span class="keyword">MERGE</span> - <span class="keyword">UPSERT</span> operation (<span class="keyword">insert</span> <span class="keyword">or</span> <span class="keyword">update</span>)</span><br><span class="line"><span class="keyword">CALL</span> - <span class="keyword">call</span> a PL/<span class="keyword">SQL</span> <span class="keyword">or</span> <span class="keyword">Java</span> subprogram</span><br><span class="line"><span class="keyword">EXPLAIN</span> PLAN - <span class="keyword">explain</span> <span class="keyword">access</span> <span class="keyword">path</span> <span class="keyword">to</span> <span class="keyword">data</span></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">TABLE</span> - control concurrency</span><br></pre></td></tr></table></figure><h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a><code>DCL</code></h3><blockquote><p><strong>Data Control Language (DCL)</strong><br>Some examples:</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> - gives <span class="keyword">user</span><span class="string">'s access privileges to database</span></span><br><span class="line"><span class="string">REVOKE - withdraw access privileges given with the GRANT command</span></span><br></pre></td></tr></table></figure><h3 id="TCL"><a href="#TCL" class="headerlink" title="TCL"></a><code>TCL</code></h3><blockquote><p><strong>Transaction Control (TCL)</strong><br>statements are used to manage the changes made by DML statements. It allows statements to be grouped together into logical transactions.</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span> - <span class="keyword">save</span> <span class="keyword">work</span> done</span><br><span class="line"><span class="keyword">SAVEPOINT</span> - identify a point <span class="keyword">in</span> a <span class="keyword">transaction</span> <span class="keyword">to</span> which you can later roll back</span><br><span class="line"><span class="keyword">ROLLBACK</span> - <span class="keyword">restore</span> <span class="keyword">database</span> <span class="keyword">to</span> original since the <span class="keyword">last</span> <span class="keyword">COMMIT</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">TRANSACTION</span> - <span class="keyword">Change</span> <span class="keyword">transaction</span> options <span class="keyword">like</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">and</span> what <span class="keyword">rollback</span> <span class="keyword">segment</span> <span class="keyword">to</span> <span class="keyword">use</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Load Balance - HAProxy Configure Reverse Proxy With HTTP Authentication</title>
      <link href="/2016/08/25/web/haproxy-configure-reverse-proxy-with-http-authentication/"/>
      <url>/2016/08/25/web/haproxy-configure-reverse-proxy-with-http-authentication/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近在做另一个项目的performance测试，前端是用的HAProxy做负载均衡，以前都是用Nginx, HAProxy不是怎么熟，所以趁此机会把HAProxy梳理一遍。相对于后端，两台webserver, 分别有几块不同的performance测试：<br>纯http访问，不涉及UI表单的匿名访问;<br>另一种UI part涉及 Http Authentication表单的提交。</p></blockquote><a id="more"></a><blockquote><p><strong>see the frist HA configuration:</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HA version</span></span><br><span class="line">HA-Proxy version 1.4.19 2012/01/07</span><br><span class="line">Copyright 2000-2011 Willy Tarreau &lt;w@1wt.eu&gt;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">        <span class="comment">#maxconn         32768</span></span><br><span class="line">        user            nobody</span><br><span class="line">        group           nobody</span><br><span class="line">        daemon</span><br><span class="line">        nbproc          8</span><br><span class="line">defaults</span><br><span class="line">        stats           <span class="built_in">enable</span></span><br><span class="line">        stats           realm Haproxy\ Statistics</span><br><span class="line">        stats           uri /haproxy?stats</span><br><span class="line">        stats           auth username:password</span><br><span class="line">listen perf-psm</span><br><span class="line">        <span class="built_in">bind</span>            192.168.192.203:80</span><br><span class="line">        mode            http</span><br><span class="line">        balance         roundrobin</span><br><span class="line">        maxconn         327680</span><br><span class="line">        clitimeout      60000</span><br><span class="line">        srvtimeout      60000</span><br><span class="line">        contimeout      5000</span><br><span class="line">        retries         3</span><br><span class="line">        server          ibs03  192.168.192.207:80 weight 3 check</span><br><span class="line">        server          ibs04  192.168.192.208:80 weight 3 check</span><br><span class="line">        option          forwardfor</span><br><span class="line">        option          httpclose </span><br><span class="line">        option          redispatch</span><br><span class="line">        option          splice-request</span><br><span class="line">        option          splice-response</span><br></pre></td></tr></table></figure><blockquote><p>PS. HA version is too old, so used the diffence way to configure.<br>The detail HA forward configuration see <strong><a href="http://serverfault.com/questions/127491/haproxy-forward-to-a-different-web-server-based-on-uri" target="_blank" rel="noopener">here</a></strong> <strong>&lt;–</strong> </p></blockquote><blockquote><p>重点说一下包含<code>HTTP Authentication</code>的HA配置，这一部分查了很多资料才解决<strong>http keeplive</strong>的问题。<br>并且这一部分的Authentication分<strong>Basic</strong>和<strong>Windows</strong>两种方式首先先看一下配置：</p></blockquote><p><img src="/../../../../screenshots/haproxy-iis.png" alt="haproxy-iis"></p><blockquote><p>Above screenshots, it is depend on windows authentication, enable provides contains Negotiate and NTLM</p></blockquote><blockquote><p><strong>see the windows authentication configuration:</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add userlist for HA</span></span><br><span class="line">userlist authusers</span><br><span class="line">        group engdomain users entriqeng</span><br><span class="line">        user entriqeng insecure-password entriqeng</span><br><span class="line"></span><br><span class="line"><span class="comment"># add ACL fiter for HA</span></span><br><span class="line">listen perf-psm</span><br><span class="line"><span class="comment">#option httpclose</span></span><br><span class="line">acl AuthOkay_Negotiate http_auth(authusers)</span><br><span class="line">http-request auth realm getuiauth <span class="keyword">if</span> AuthOkay_Negotiate</span><br></pre></td></tr></table></figure><blockquote><p>If used windows <strong>basic authentication</strong>, please modify these code block:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">listen perf-psm</span><br><span class="line"><span class="comment">#option httpclose</span></span><br><span class="line">Acl AuthOkay_Basic http_auth(authusers)</span><br><span class="line">http-request auth realm getuiauth_Basic <span class="keyword">if</span> !AuthOkay_Basic</span><br></pre></td></tr></table></figure><blockquote><p>Special attention, <code>option httpclose</code> because this version is <code>1.4.19</code> is didn’t support <code>http-keep-alive</code>, so when used windows authentication, must comment this.<br>And the detail answer please click <strong><a href="http://stackoverflow.com/questions/28162452/how-to-make-ha-proxy-keepalive" target="_blank" rel="noopener">here</a></strong> <strong>&lt;–</strong><br>BTW, the detail <strong>ACL</strong> used way please click <strong><a href="http://www.techrawr.com/2009/09/18/using-the-acl-in-haproxy-for-load-balancing-named-virtual-hosts/" target="_blank" rel="noopener">here</a></strong> <strong>&lt;–</strong></p></blockquote><blockquote><p>Of course, the detail way and analysis check the forward charecters, please use the <strong>fiddler</strong>.</p></blockquote><blockquote><p><strong>sample track</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BASIC:</span><br><span class="line">Authorization: Basic ZW5nZG9tYWluXGVudHJpcWVuZzplbnRyaXFlbmc=</span><br><span class="line"></span><br><span class="line">NTLM:</span><br><span class="line">Authorization: Negotiate TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAFAs4OAAAADw==</span><br><span class="line">WWW-Authenticate: Negotiate </span><br><span class="line">TlRMTVNTUAACAAAAEgASADgAAAAFgomi/ndd97GuRJAAAAAAAAAAAK4ArgBKAAAABgGxHQAAAA9FAE4ARwBEAE8ATQBBAEkATgACABIARQBOAEcARABPAE0AQQBJAE4AAQAUAFAARQBSAEYALQBJAEIAUwAwADMABAAaAGUAbgBnAGQAbwBtAGEAaQBuAC4AYwBvAG0AAwAwAHAAZQByAGYALQBpAGIAcwAwADMAL........</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HAProxy </tag>
            
            <tag> Load Balance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to activate visual studio by command</title>
      <link href="/2016/06/27/tools/how-to-activate-visual-studio-by-command/"/>
      <url>/2016/06/27/tools/how-to-activate-visual-studio-by-command/</url>
      
        <content type="html"><![CDATA[<blockquote><p>vm agent 太多时候需要批量执行， 其实就一个<code>bat</code>脚本就可搞定。</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\Program Files (x86)\Microsoft Visual Studio <span class="number">14</span>.<span class="number">0</span>\Common7\IDE</span><br><span class="line">StorePID.exe xxxxx-xxxxx-xxxxx-xxxxx-xxxxx <span class="number">07060</span></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><blockquote><p>ps：最后5位是vs的MPC code, 根据不同的vs version 找到相对应的MPC code~</p></blockquote><p>Resource:<br><a href="https://msdn.microsoft.com/en-us/library/mt270173.aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/mt270173.aspx</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Visual Studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>An error occurred whild msbuild windows service</title>
      <link href="/2016/06/27/web/An-error-occurred-whild-msbuild-windows-service/"/>
      <url>/2016/06/27/web/An-error-occurred-whild-msbuild-windows-service/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这段时间在迁移旧项目到teamcity，在package *.vdproj project时遇到了这个错<code>An error occurred while validating. HRESULT = &#39;8000000A&#39;</code><br>查了很多方法才解决这个问题</p></blockquote><blockquote><p>stackoverflow上给出的权威解答是这样的：</p></blockquote><a id="more"></a><blockquote><p>Unfortunately we couldn’t address all cases of the command line issue for this release as we’re still investigating the appropriate way to address them. What we do have is a workaround that we believe will work for almost all of them.<br>If you are still suffering this issue then you can try to change the DWORD value for the following registry value to 0:<br><code>HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\12.0_Config\MSBuild\EnableOutOfProcBuild (VS2013)</code> or <code>HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\14.0_Config\MSBuild\EnableOutOfProcBuild (VS2015)</code><br>If this doesn’t exist you can create it as a DWORD.</p></blockquote><blockquote><p>但是我的agent vm 有很多台，于是写了个script</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#add_registy_procbuild_ps.ps1</span></span><br><span class="line"><span class="variable">$ProcBuildRegistryPath</span> = <span class="string">"HKCU:\Software\Microsoft\VisualStudio\14.0_Config\MSBuild"</span></span><br><span class="line"><span class="variable">$ProcBuildRegistryName</span> = <span class="string">"EnableOutOfProcBuild"</span></span><br><span class="line"><span class="variable">$ProcBuildValue</span> = <span class="string">"0"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"Add DWORD paramter for Proc build registry..."</span></span><br><span class="line"><span class="keyword">IF</span>(!(<span class="built_in">Test-Path</span> <span class="variable">$ProcBuildRegistryPath</span>)) &#123;</span><br><span class="line">     <span class="string">"Add:"</span></span><br><span class="line">     <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$ProcBuildRegistryPath</span> <span class="literal">-Force</span> | <span class="built_in">Out-Null</span></span><br><span class="line">          <span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="variable">$ProcBuildRegistryPath</span> <span class="literal">-Name</span> <span class="variable">$ProcBuildRegistryName</span> <span class="literal">-Value</span> <span class="variable">$ProcBuildValue</span> `</span><br><span class="line">               <span class="literal">-PropertyType</span> DWORD <span class="literal">-Force</span> | <span class="built_in">Out-Null</span> &#125;</span><br><span class="line"><span class="keyword">ELSE</span> &#123;</span><br><span class="line">     <span class="string">"Modify:"</span></span><br><span class="line">     <span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="variable">$ProcBuildRegistryPath</span> <span class="literal">-Name</span> <span class="variable">$ProcBuildRegistryName</span> <span class="literal">-Value</span> <span class="variable">$ProcBuildValue</span> `</span><br><span class="line">          <span class="literal">-PropertyType</span> DWORD <span class="literal">-Force</span> | <span class="built_in">Out-Null</span> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>then execute this script in cmd</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -ExecutionPolicy ByPass -File \\172.16.xx.xx\c$\script\add_registy_procbuild_ps.ps1</span><br></pre></td></tr></table></figure><blockquote><p>Good Job, 完美解决~</p></blockquote><p>Resource:<br><a href="http://stackoverflow.com/questions/8648428/an-error-occurred-while-validating-hresult-8000000a" target="_blank" rel="noopener">http://stackoverflow.com/questions/8648428/an-error-occurred-while-validating-hresult-8000000a</a></p>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Powershell </tag>
            
            <tag> MSbuild </tag>
            
            <tag> CI </tag>
            
            <tag> Teamcity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 服务部署</title>
      <link href="/2016/06/16/raspberry/raspberry-pi3-service/"/>
      <url>/2016/06/16/raspberry/raspberry-pi3-service/</url>
      
        <content type="html"><![CDATA[<p>其实网上教程是挺多的，这里只列出我自己所用到的几个，<code>samba</code>,<code>nginx</code>,<code>aria2</code>,<code>git</code>…</p><a id="more"></a><h2 id="Samba"><a href="#Samba" class="headerlink" title="Samba"></a>Samba</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install samba samba-common-bin -y</span><br><span class="line"></span><br><span class="line">$ sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.orig</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify conf</span></span><br><span class="line">$ sudo vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure><p>修改以下内容：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[share] </span><br><span class="line">comment = Guest access shares </span><br><span class="line">path = /home/pi/shares </span><br><span class="line">browseable = yes </span><br><span class="line">writable = yes </span><br><span class="line">#read <span class="keyword">only</span> = yes </span><br><span class="line">guest ok = yes </span><br><span class="line">public = yes </span><br><span class="line"></span><br><span class="line">[NAS] </span><br><span class="line">comment = NAS folder </span><br><span class="line">path = /home/pi/nas/ </span><br><span class="line">browseable = yes </span><br><span class="line">writable = yes </span><br><span class="line">valid users = pi</span><br></pre></td></tr></table></figure><p>restart service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service samba restart</span><br><span class="line">or</span><br><span class="line">$ sudo service smbd restart</span><br></pre></td></tr></table></figure><h2 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web Server"></a>Web Server</h2><p>常见的lightweight web server有<code>Nginx|Haproxy|Apache|lighttppd + PHP|Flask + Mysql|Sqlite</code>.<br>下面以nginx为例</p><h3 id="Install-and-Configure-Nginx-Php"><a href="#Install-and-Configure-Nginx-Php" class="headerlink" title="Install and Configure Nginx+Php"></a>Install and Configure Nginx+Php</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nginx</span><br><span class="line">$ sudo apt-get install php5-fpm</span><br></pre></td></tr></table></figure><p>修改nginx配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p>注意nginx所运行的user和wwwroot目录的文件所有者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 8080;</span><br><span class="line"><span class="comment">## listen for ipv4; this line is default and implied</span></span><br><span class="line">server_name <span class="variable">$domain_name</span>;</span><br><span class="line">root /var/www;</span><br><span class="line">index index.html index.htm index.php;</span><br><span class="line">access_log /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line">    error_log /var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line"></span><br><span class="line">    location ~\.php$ &#123;</span><br><span class="line">                fastcgi_pass unix:/var/run/php5-fpm.sock;</span><br><span class="line">                fastcgi_split_path_info ^(.+\.php)(/.*)$;</span><br><span class="line">                fastcgi_index index.php;</span><br><span class="line">                fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">                fastcgi_param HTTPS off;</span><br><span class="line">                try_files <span class="variable">$uri</span> =404;</span><br><span class="line">                include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>restart nginx server, create test php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关于nginx的详细配置可以参见blog内nginx其他文章。</p><h3 id="Configure-MySQL-and-phpMyAdmin"><a href="#Configure-MySQL-and-phpMyAdmin" class="headerlink" title="Configure MySQL and phpMyAdmin"></a>Configure MySQL and phpMyAdmin</h3><p>Install <code>MySQL</code>, <code>phpMyAdmin</code>, and <code>php5-mysql</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install mysql-server mysql-client php5-mysql phpmyadmin</span><br></pre></td></tr></table></figure><p>Make a link of phpMyAdmin from /usr/share/phpmyadmin to /var/www/phpmyadmin.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ln -s /usr/share/phpmyadmin /var/www/phpmyadmin</span><br></pre></td></tr></table></figure><p>上述只是简单配置。详情可参考<a href="https://www.raspberrypi.org/documentation/remote-access/web-server/nginx.md" target="_blank" rel="noopener">SETTING UP AN NGINX WEB SERVER ON A RASPBERRY PI</a></p><p>另外nginx+flask也可以尝试一下，详细参考文档看这里<a href="https://www.raspberrypi.org/learning/python-web-server-with-flask/worksheet/" target="_blank" rel="noopener">BUILD A PYTHON-POWERED WEB SERVER WITH FLASK</a></p><h2 id="Aria2-Download"><a href="#Aria2-Download" class="headerlink" title="Aria2 Download"></a>Aria2 Download</h2><h3 id="Install-aria2-use-apt-package-manager"><a href="#Install-aria2-use-apt-package-manager" class="headerlink" title="Install aria2 use apt package manager"></a>Install aria2 use apt package manager</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install aria2</span><br></pre></td></tr></table></figure><h3 id="Prepare-configuration"><a href="#Prepare-configuration" class="headerlink" title="Prepare configuration"></a>Prepare configuration</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make aria2 folder</span></span><br><span class="line">$ sudo mkdir /etc/aria2</span><br><span class="line"></span><br><span class="line"><span class="comment"># make aria2 session file and configuration file</span></span><br><span class="line">$ sudo touch /etc/aria2/aria2.session</span><br><span class="line">$ sudo vim /etc/aria2/aria2.conf</span><br></pre></td></tr></table></figure><h3 id="Configure-aria2-configuration"><a href="#Configure-aria2-configuration" class="headerlink" title="Configure aria2 configuration"></a>Configure aria2 configuration</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Aria2 configuration ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># download path, using harddisk base on samba</span></span><br><span class="line">dir=/media/pi/ITABAS/download</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable disk cache, 0 is disable,default is 16M(aria2 version&gt;=1.16)</span></span><br><span class="line"><span class="comment"># 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M</span></span><br><span class="line">disk-cache=32M</span><br><span class="line"><span class="comment"># enable continue process when process crash</span></span><br><span class="line"><span class="comment"># 断点续传</span></span><br><span class="line"><span class="built_in">continue</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># File pre allocation method can effectively reduce disk fragmentation,</span></span><br><span class="line"><span class="comment"># recommend value prealloc</span></span><br><span class="line"><span class="comment"># If external disk system is NTFS recommend use falloc</span></span><br><span class="line"><span class="comment"># 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span></span><br><span class="line"><span class="comment"># 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span></span><br><span class="line"><span class="comment"># falloc和trunc则需要文件系统和内核支持</span></span><br><span class="line"><span class="comment"># NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span></span><br><span class="line">file-allocation=falloc</span><br><span class="line"></span><br><span class="line"><span class="comment">## download connection ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># max concurrent download connections(runtime can be modified), default is 5</span></span><br><span class="line"><span class="comment"># 最大同时下载任务数, 运行时可修改, 默认:5</span></span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># max concurrent connections per server(runtime can be modified), default is 1</span></span><br><span class="line"><span class="comment"># 同一服务器连接数, 添加时可指定, 默认:1</span></span><br><span class="line">max-connection-per-server=15</span><br><span class="line"></span><br><span class="line"><span class="comment"># download speed limit(runtime can be modified), default is 0(unlimited)</span></span><br><span class="line"><span class="comment"># 整体下载速度限制, 运行时可修改, 默认:0（不限制）</span></span><br><span class="line">max-overall-download-limit=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># sigle task download speed limit, default is 0(unlimited)</span></span><br><span class="line"><span class="comment"># 单个任务下载速度限制, 默认:0（不限制）</span></span><br><span class="line">max-download-limit=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># upload speed limit(runtime can be modified), default is 0(unlimited)</span></span><br><span class="line"><span class="comment"># 整体上传速度限制, 运行时可修改, 默认:0（不限制）</span></span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># sigle task upload speed limit, default is 0(unlimited)</span></span><br><span class="line"><span class="comment"># 单个任务上传速度限制, 默认:0（不限制）</span></span><br><span class="line">max-upload-limit=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable ipv6, default is false</span></span><br><span class="line"><span class="comment"># 禁用IPv6, 默认:false</span></span><br><span class="line"><span class="built_in">disable</span>-ipv6=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># minimum split file size(can be specified when added) range: 1M - 1024M, default is 20M</span></span><br><span class="line"><span class="comment"># 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M</span></span><br><span class="line"><span class="comment"># 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"></span><br><span class="line"><span class="comment"># sigle task maximum threads, default is 5</span></span><br><span class="line"><span class="comment"># 单个任务最大线程数, 添加时可指定, 默认:5</span></span><br><span class="line">split=10</span><br><span class="line"></span><br><span class="line"><span class="comment">## progress preservation related ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read download session for session file</span></span><br><span class="line"><span class="comment"># 从会话文件中读取下载任务</span></span><br><span class="line">input-file=/etc/aria2/aria2.session</span><br><span class="line"></span><br><span class="line"><span class="comment"># save download session when pause or other actions</span></span><br><span class="line"><span class="comment"># 在Aria2退出时保存错误的、未完成的下载任务到会话文件</span></span><br><span class="line">save-session=/etc/aria2/aria2.session</span><br><span class="line"></span><br><span class="line"><span class="comment"># save session interval(seconds)</span></span><br><span class="line"><span class="comment"># 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span></span><br><span class="line">save-session-interval=60</span><br><span class="line"></span><br><span class="line"><span class="comment">## RPC related ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable rpc funtion, default is false</span></span><br><span class="line"><span class="comment"># 启用RPC, 默认:false</span></span><br><span class="line"><span class="built_in">enable</span>-rpc=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable origin source, default is false</span></span><br><span class="line"><span class="comment"># 允许所有来源, 默认:false</span></span><br><span class="line">rpc-allow-origin-all=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable visit from external ip, default is false</span></span><br><span class="line"><span class="comment"># 允许外部访问, 默认:false</span></span><br><span class="line">rpc-listen-all=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable rpc listen port, default is 6800</span></span><br><span class="line"><span class="comment"># RPC端口, 仅当默认端口被占用时修改</span></span><br><span class="line">rpc-listen-port=6800</span><br><span class="line"></span><br><span class="line"><span class="comment"># rpc authorized token</span></span><br><span class="line"><span class="comment"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span></span><br><span class="line"><span class="comment">#rpc-secret=&lt;TOKEN&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## BT/PT download related ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable BT task when download file follow .torrent extension, default is true</span></span><br><span class="line"><span class="comment"># 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true</span></span><br><span class="line">follow-torrent=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端伪装, PT需要</span></span><br><span class="line">peer-id-prefix=-TR2770-</span><br><span class="line">user-agent=Transmission/2.77</span><br><span class="line"><span class="comment"># 强制保存会话, 即使任务已经完成, 默认:false</span></span><br><span class="line"><span class="comment"># 较新的版本开启后会在任务完成后依然保留.aria2文件</span></span><br><span class="line"><span class="comment">#force-save=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># keep bt task without authorized, default is false</span></span><br><span class="line"><span class="comment"># 继续之前的BT任务时, 无需再次校验, 默认:false</span></span><br><span class="line">bt-seed-unverified=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># save bt metadata file, default is false</span></span><br><span class="line"><span class="comment"># 保存磁力链接元数据为种子文件(.torrent文件), 默认:false</span></span><br><span class="line">bt-save-metadata=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="Check-aria2-is-work"><a href="#Check-aria2-is-work" class="headerlink" title="Check aria2 is work"></a>Check aria2 is work</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo aria2c --conf-path=/etc/aria2/aria2.conf -D</span><br></pre></td></tr></table></figure><h3 id="Create-auto-start-service"><a href="#Create-auto-start-service" class="headerlink" title="Create auto start service"></a>Create auto start service</h3><h4 id="created-init-script"><a href="#created-init-script" class="headerlink" title="created init script"></a>created init script</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/init.d/aria2c</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides: aria2c</span></span><br><span class="line"><span class="comment"># Required-Start:    $network $local_fs $remote_fs</span></span><br><span class="line"><span class="comment"># Required-Stop:     $network $local_fs $remote_fs</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: aria2c RPC init script.</span></span><br><span class="line"><span class="comment"># Description: Starts and stops aria2 RPC services.</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Starting service Aria2..."</span></span><br><span class="line">        sudo -u pi aria2c --conf-path=/etc/aria2/aria2.conf -D</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Start service done."</span></span><br><span class="line">    ;;</span><br><span class="line">    stop)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Stoping service Aria2..."</span></span><br><span class="line">        killall aria2c</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Stop service done."</span></span><br><span class="line">    ;;</span><br><span class="line">    restart)</span><br><span class="line">        <span class="variable">$0</span> stop &amp;&amp; sleep 3 &amp;&amp; <span class="variable">$0</span> start</span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h4 id="executable-script-and-make-auto-start"><a href="#executable-script-and-make-auto-start" class="headerlink" title="executable script and make auto start"></a>executable script and make auto start</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +x /etc/init.d/aria2c</span><br><span class="line">$ sudo apt-get -y install chkconfig</span><br><span class="line">$ sudo chkconfig --add aria2c</span><br><span class="line">$ sudo update-rc.d aria2cRPC defaults</span><br></pre></td></tr></table></figure><h3 id="aria2-UI-frontend"><a href="#aria2-UI-frontend" class="headerlink" title="aria2 UI frontend"></a>aria2 UI frontend</h3><p>Use <a href="https://github.com/ziahamza/webui-aria2" target="_blank" rel="noopener">webui-aria2</a> or <a href="https://binux.github.io/yaaw/" target="_blank" rel="noopener">Yaaw</a> </p><p><strong>PS. base on nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/ziahamza/webui-aria2.git /var/www/html/</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify nginx configuration</span></span><br><span class="line">$ sudo vim /etc/nginx/sites-available/default</span><br><span class="line"></span><br><span class="line"><span class="comment"># add location configuration</span></span><br><span class="line">location webui-aria2 &#123;</span><br><span class="line">                root html;</span><br><span class="line">                index index.html index.htm;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2 id="Git-Local-Server"><a href="#Git-Local-Server" class="headerlink" title="Git Local Server"></a>Git Local Server</h2><p>官方install document已经很详细了。<a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server" target="_blank" rel="noopener">Setting up Git Server</a><br>按步骤一步步来~</p>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> NAS </tag>
            
            <tag> Web Server </tag>
            
            <tag> Git Server </tag>
            
            <tag> Aria2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 配置</title>
      <link href="/2016/06/10/raspberry/raspberry-pi3-config/"/>
      <url>/2016/06/10/raspberry/raspberry-pi3-config/</url>
      
        <content type="html"><![CDATA[<h2 id="Rasp-config"><a href="#Rasp-config" class="headerlink" title="Rasp config"></a>Rasp config</h2><p>直接<code>$sudo raspi-config</code>进入：</p><ul><li><code>Expand Filesystem</code>：将系统扩展到整个SD卡，必须执行，一路敲回车即可</li><li><code>Change User Password</code>：修改密码及账号，若要修改，请牢记</li><li><code>Boot Options</code>：启动选项，选<code>desktop</code>，下次启动将直接进入桌面系统</li><li><code>Wait for Network at Boot</code>：等待网络唤醒，服务器模式</li><li><code>Internationalisation Options</code>：地区和语言设置，选择<code>zh_CN UTF-8</code>，即可切换到中文模式</li><li><code>Enable Camera</code>：CSI摄像头开启或关闭，选择enable则开启</li><li><code>Add to Rastrack</code>：将树莓派加入Rastrack社区</li><li><code>Overclock</code>：超频，一般不超频，若要超频请谨慎操作，并做好散热</li><li><code>Advanced Options</code>：高级选项，包括<code>Overscan</code>, <code>Hostname</code>, <code>Memory Split(内存分配)</code>, <code>SSH</code>等</li><li><code>About raspi-config</code>：本机相关信息。</li></ul><a id="more"></a><h2 id="Update-software-resource"><a href="#Update-software-resource" class="headerlink" title="Update software resource"></a>Update software resource</h2><p>如果不熟悉自带的nano编辑器，请安装编辑利器<code>vim</code>, 修改sources, 不然update太慢了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//install vim</span><br><span class="line">$ sudo apt-get install vim -y</span><br><span class="line"></span><br><span class="line">$ sudo vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="comment">#modify</span></span><br><span class="line">deb http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contrib rpi</span><br><span class="line">deb-src http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contrib rpi</span><br><span class="line"></span><br><span class="line">//update</span><br><span class="line">$ sudo apt-get update</span><br><span class="line"></span><br><span class="line">//upgrade</span><br><span class="line">$ sudo apt-get upgrade -y</span><br></pre></td></tr></table></figure><h2 id="Configure-static-IP-amp-WIFI"><a href="#Configure-static-IP-amp-WIFI" class="headerlink" title="Configure static IP &amp; WIFI"></a>Configure static IP &amp; WIFI</h2><p><em><del>默认是启用DHCP自动获取IP. 修改network配置</del></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/network/interfaces</span><br></pre></td></tr></table></figure><p><em><del>如果设置有线网卡ip</del></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iface eth0 inet static </span><br><span class="line">address 192.168.1.2 <span class="comment"># 设定的静态IP地址 </span></span><br><span class="line">netmask 255.255.255.0 <span class="comment"># 网络掩码 </span></span><br><span class="line">gateway 192.168.1.1 <span class="comment"># 网关</span></span><br></pre></td></tr></table></figure><p><em><del>如果设置无线网卡</del></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iface wlan0 inet static </span><br><span class="line">wpa-ssid Your_Wifi_SSID </span><br><span class="line">wpa-psk Your_Wifi_Password </span><br><span class="line">address 192.168.1.2 <span class="comment"># 设定的静态IP地址 </span></span><br><span class="line">netmask 255.255.255.0 <span class="comment"># 网络掩码 </span></span><br><span class="line">gateway 192.168.1.1 <span class="comment"># 网关 </span></span><br><span class="line">network 192.168.1.1 <span class="comment"># 网络地址</span></span><br><span class="line"><span class="comment">#wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf</span></span><br></pre></td></tr></table></figure><p><strong>PS.以上方法很长时间导致我无法ssh树莓派，迫使吃灰中。最近有空闲下来，重新刷了jessie</strong></p><p><strong>!!!! <code>/etc/network/interface</code>里面明明写的很清楚：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># interfaces(5) file used by ifup(8) and ifdown(8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Please note that this file is written to be used with dhcpcd</span></span><br><span class="line"><span class="comment"># For static IP, consult /etc/dhcpcd.conf and 'man dhcpcd.conf'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include files from /etc/network/interfaces.d:</span></span><br><span class="line"><span class="built_in">source</span>-directory /etc/network/interfaces.d</span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">iface eth0 inet manual</span><br><span class="line"></span><br><span class="line">allow-hotplug wlan0</span><br><span class="line">auto wlan0</span><br><span class="line">iface wlan0 inet manual</span><br><span class="line">    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure><p>于是 查看<code>dhcpcd</code>文档，<code>man dhcpcd.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static value</span><br><span class="line">             Configures a static value.  If you <span class="built_in">set</span> ip_address <span class="keyword">then</span> dhcpcd will not attempt to obtain a lease and</span><br><span class="line">             just use the value <span class="keyword">for</span> the address with an infinite lease time.</span><br><span class="line"></span><br><span class="line">             Here is an example <span class="built_in">which</span> configures a static address, routes and dns.</span><br><span class="line">                   interface eth0</span><br><span class="line">                   static ip_address=192.168.0.10/24</span><br><span class="line">                   static routers=192.168.0.1</span><br><span class="line">                   static domain_name_servers=192.168.0.1</span><br><span class="line"></span><br><span class="line">             Here is an example <span class="keyword">for</span> PPP <span class="built_in">which</span> gives the destination a default route.  It uses the special destination</span><br><span class="line">             keyword to insert the destination address into the value.</span><br><span class="line">                   interface ppp0</span><br><span class="line">                   static ip_address=</span><br><span class="line">                   destination routers</span><br></pre></td></tr></table></figure><p>所以只需在<code>/etc/dhcpcd.conf</code>下面加上以下设置</p><p><strong>PS.目前的策略仍是eth0静态IP, wlan0自动获取IP, wlan1中继</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface eth0</span><br><span class="line">static ip_address=192.168.11.x/24</span><br><span class="line">static routers=192.168.11.1</span><br><span class="line">static domain_name_servers=114.114.114.114 119.29.29.29</span><br><span class="line"><span class="comment"># dns server using telcom dns or dnspod dns</span></span><br></pre></td></tr></table></figure><p>然后配置无线SSID认证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c <span class="string">"wpa_passphrase your_ssid your_password &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf"</span></span><br></pre></td></tr></table></figure><p>最后restart network即可。</p><h2 id="Remote"><a href="#Remote" class="headerlink" title="Remote"></a>Remote</h2><p>因为默认是打开ssh的，所以通过vnc访问rasp需要安装xrdp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install xrdp</span><br></pre></td></tr></table></figure><h2 id="ohters-configuration"><a href="#ohters-configuration" class="headerlink" title="ohters configuration"></a>ohters configuration</h2><p>设置中文，系统却显示乱码，是因为系统缺少中文字库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ttf-wqy-microhei ttf-wqy-zenhei xfonts-wqy</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry Pi3 Tutorial</title>
      <link href="/2016/06/09/raspberry/Raspberry-pi3-tutorial/"/>
      <url>/2016/06/09/raspberry/Raspberry-pi3-tutorial/</url>
      
        <content type="html"><![CDATA[<h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><p>树莓派支持的OS还是挺多的，凭爱好所需。<br>其他操作系统<code>Raspbian</code>, <code>Ubuntu</code>, <code>Arch Linux ARM</code>,<code>Debian Squeeze</code>,<code>Gentoo Linux Google Chrome OS</code>,<code>FreeBSD</code>,<code>Android 4.0(Ice Cream Sandwich)</code>.官方下载地址戳<a href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank" rel="noopener">这里</a></p><a id="more"></a><h3 id="刷入img"><a href="#刷入img" class="headerlink" title="刷入img"></a>刷入img</h3><p>我用的<a href="https://sourceforge.net/projects/win32diskimager/" target="_blank" rel="noopener">win32 DiskManager</a> 16GSD卡。</p><h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>没有配显示屏，可以用ssh直接登入。<br>树莓派默认是开启SSH，port 22，所以在当前的局域网络找到IP <code>arp -a</code>，就可以登入了。 当然网上也有其他的办法, portscan等什么工具的。<br><img src="/../../../screenshots/rasp-win-arp.png" alt="rasp-arp"></p><p>另一种方式可以用VNC登入，详细可以参照raspberry config <a href="Raspberry-pi3-config">配置篇</a>。</p><h3 id="开启ROOT-user"><a href="#开启ROOT-user" class="headerlink" title="开启ROOT user"></a>开启ROOT user</h3><p>raspberry 默认的user是<code>pi</code>, 默认password是<code>raspberry</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// config root user name &amp; password, btw, password will input twice </span><br><span class="line">$ sudo passwd root</span><br><span class="line"></span><br><span class="line">// active root</span><br><span class="line">$ sudo passwd --unlock root</span><br></pre></td></tr></table></figure><p><code>reboot</code>即可生效。</p>]]></content>
      
      
      <categories>
          
          <category> Raspberry </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry </tag>
            
            <tag> 树莓派 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx搭建Google反向代理</title>
      <link href="/2016/01/17/vps/vps-nignx-reverse-proxy-google/"/>
      <url>/2016/01/17/vps/vps-nignx-reverse-proxy-google/</url>
      
        <content type="html"><![CDATA[<blockquote><p>其实很简单，拥有一台<code>Vps</code>, 一个<code>domain</code>, 还有一个<code>SSL</code>, 剩下的操作就是反向代理+证书。<br>PS. 风险有可能自己的<code>vps</code>会英勇牺牲<del>，慎重</del></p></blockquote><a id="more"></a><h3 id="Simple-reverse-way"><a href="#Simple-reverse-way" class="headerlink" title="Simple reverse way"></a>Simple reverse way</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify nginx conf</span></span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen          80;</span><br><span class="line">    server_name     yourdomain.me;  <span class="comment">#your domain</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass          http://www.google.com/;  <span class="comment">#reverse domain</span></span><br><span class="line">        proxy_redirect      off;</span><br><span class="line">        proxy_set_header    X-Real-IP       <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header    X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>just browse <a href="http://yourdomain.me" target="_blank" rel="noopener">http://yourdomain.me</a>就ok了。</p></blockquote><h3 id="Reverse-proxy-by-SSL"><a href="#Reverse-proxy-by-SSL" class="headerlink" title="Reverse proxy by SSL"></a>Reverse proxy by SSL</h3><blockquote><p>First, 开启<code>Nginx SSL</code>支持, 可以在<a href="https://www.namecheap.com" target="_blank" rel="noopener">Namecheap</a>, <a href="https://www.startssl.com/" target="_blank" rel="noopener">startssl</a>, 申请免费的<code>SSL</code>证书</p></blockquote><h4 id="Manage-SSL"><a href="#Manage-SSL" class="headerlink" title="Manage SSL"></a>Manage SSL</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /root/ssl &amp;&amp; <span class="built_in">cd</span> /root/ssl</span><br></pre></td></tr></table></figure><h4 id="Generate-crt-and-key"><a href="#Generate-crt-and-key" class="headerlink" title="Generate crt and key"></a>Generate crt and key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -newkey rsa:2048 -nodes -out example.com.csr -keyout example.com.key -subj <span class="string">"/C=US/ST=CA/L=Los Angeles/O=Example Inc./OU=Web Security/CN=example.com"</span></span><br></pre></td></tr></table></figure><h4 id="Post-csr-file-to-SSL-CA-Parter"><a href="#Post-csr-file-to-SSL-CA-Parter" class="headerlink" title="Post csr file to SSL CA Parter"></a>Post csr file to SSL CA Parter</h4><blockquote><p>验证好域名以后会颁发给你一个<code>.crt</code>文件，我们命名为 <code>example.com.crt</code></p></blockquote><h4 id="Configure-Google-Reverse"><a href="#Configure-Google-Reverse" class="headerlink" title="Configure Google Reverse"></a>Configure Google Reverse</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/nginx/sites-enabled/google.conf</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name example.com;</span><br><span class="line"><span class="built_in">return</span> 301 https://example.com<span class="variable">$request_uri</span>;</span><br><span class="line"><span class="comment"># http to https</span></span><br><span class="line">    location / &#123;</span><br><span class="line">          rewrite ^/(.*)$ https://&lt;yourdomain.name&gt;<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 443 ssl;</span><br><span class="line">server_name example;</span><br><span class="line"> </span><br><span class="line">ssl on;</span><br><span class="line">ssl_certificate /root/ssl/example.com.crt;</span><br><span class="line">ssl_certificate_key /root/ssl/example.com.key;</span><br><span class="line"></span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_ciphers EECDH+aRSA+AES;</span><br><span class="line">        keepalive_timeout 70;</span><br><span class="line">        ssl_session_cache shared:SSL:10m;</span><br><span class="line">        ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">resolver 8.8.8.8;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">google on;</span><br><span class="line">google_scholar <span class="string">"scholar.google.com"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Advance-reverse-proxy"><a href="#Advance-reverse-proxy" class="headerlink" title="Advance reverse proxy"></a>Advance reverse proxy</h3><blockquote><p>在<code>reverse proxy</code>是替换原网页信息，需要引入第三方扩展模块：<a href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module" target="_blank" rel="noopener"><code>substitutions</code></a><br>除此之外还有一个便捷配置<code>reverse proxy</code>的模块<a href="https://github.com/cuber/ngx_http_google_filter_module" target="_blank" rel="noopener"><code>ngx_http_google_filter_module</code></a></p></blockquote><h4 id="Use-subs-filter-module-to-optimize-page-request"><a href="#Use-subs-filter-module-to-optimize-page-request" class="headerlink" title="Use subs_filter module to optimize page request"></a>Use subs_filter module to optimize page request</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download source code</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/yaoweibin/ngx_http_substitutions_filter_module.git</span><br><span class="line"></span><br><span class="line">&lt;!-- this block I think unnecessary</span><br><span class="line"><span class="comment"># add thirdparty modules</span></span><br><span class="line"><span class="comment"># cd nginx-1.9.3</span></span><br><span class="line"><span class="comment"># ./configure \</span></span><br><span class="line">&gt; --with-cc-opt=<span class="string">'-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2'</span> --with-ld-opt=<span class="string">'-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now'</span> --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_spdy_module --with-http_sub_module --with-http_xslt_module --with-mail --with-mail_ssl_module \</span><br><span class="line">&gt; --add-module=../ngx_http_substitutions_filter_module \</span><br><span class="line">&gt; --add-module=../ngx_http_google_filter_module</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># need recompile make &amp; make intall nginx </span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --with-ipv6 --add-module=/path/to/ngx_http_substitutions_filter_module</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h5 id="How-to-use-subs-filter"><a href="#How-to-use-subs-filter" class="headerlink" title="How to use subs_filter"></a>How to use subs_filter</h5><blockquote><ul><li><code>subs_filter $1 $2</code>    </li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#replace `$1` to `$2`, support regex expression</span></span><br><span class="line"></span><br><span class="line">subs_filter www.google.com yourdomain.me;</span><br><span class="line">subs_filter st(\d*).example.com <span class="variable">$1</span>.example.com ir;</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>subs_filter_types mime-type [mime-types]</code></li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mean repace file type, defaut is text/html</span></span><br></pre></td></tr></table></figure><h5 id="nginx-conf-by-subs-filter-sample"><a href="#nginx-conf-by-subs-filter-sample" class="headerlink" title="nginx conf by subs_filter sample"></a>nginx conf by <code>subs_filter</code> sample</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_pass https://www.google.com/;</span><br><span class="line">    proxy_set_header Host www.google.com;</span><br><span class="line">    proxy_set_header User-Agent <span class="variable">$http_user_agent</span>;</span><br><span class="line">    proxy_set_header Referer http://www.google.com;</span><br><span class="line">    proxy_set_header Accept-Encoding <span class="string">""</span>;</span><br><span class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto https;</span><br></pre></td></tr></table></figure><h4 id="Use-proxy-cache-module-to-speed-request"><a href="#Use-proxy-cache-module-to-speed-request" class="headerlink" title="Use proxy_cache module to speed request"></a>Use proxy_cache module to speed request</h4><blockquote><p>增加<code>proxy module</code>参数</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http layer</span></span><br><span class="line">proxy_connect_timeout      5;</span><br><span class="line">proxy_read_timeout         60;</span><br><span class="line">proxy_send_timeout         5;</span><br><span class="line">proxy_buffer_size          16k;</span><br><span class="line">proxy_buffers              4 64k;</span><br><span class="line">proxy_busy_buffers_size    128k;</span><br><span class="line">proxy_temp_file_write_size 128k;</span><br><span class="line">proxy_temp_path            /home/cache/temp;</span><br><span class="line">proxy_cache_path           /home/cache/g4w levels=1:2 keys_zone=cache_g4w:3m inactive=7d max_size=5g; </span><br><span class="line"><span class="comment">#7d means delete in 7days inactive, 5g means cache size</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Location layer</span></span><br><span class="line">proxy_cache_key <span class="string">"<span class="variable">$scheme</span>://<span class="variable">$host</span><span class="variable">$request_uri</span>"</span>;<span class="comment">#cache key rule, will auto clear</span></span><br><span class="line">proxy_cache cache_g4w;<span class="comment">#cache section name, must same as previous define</span></span><br><span class="line">proxy_cache_valid  200 304 3h;<span class="comment">#200 304 status will cache 3 hours</span></span><br><span class="line">proxy_cache_valid 301 3d;<span class="comment">#301 status will cache 3 days</span></span><br><span class="line">proxy_cache_valid any 1m;<span class="comment">#any other status will cache 1 minute</span></span><br><span class="line">proxy_cache_use_stale invalid_header error timeout http_502;  </span><br><span class="line"><span class="comment">#when backend occurred error, 502 status or timeout, will start expire cache strategy</span></span><br></pre></td></tr></table></figure><h4 id="Check-is-work"><a href="#Check-is-work" class="headerlink" title="Check is work"></a>Check is work</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx -t</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl restart nginx</span></span><br><span class="line"><span class="comment"># server restart</span></span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><blockquote><p>Resources；<br><a href="https://www.nginx.com/resources/admin-guide/reverse-proxy/" target="_blank" rel="noopener">https://www.nginx.com/resources/admin-guide/reverse-proxy/</a><br><a href="https://zhgcao.github.io/2016/06/09/nginx-reverse-proxy-google/" target="_blank" rel="noopener">https://zhgcao.github.io/2016/06/09/nginx-reverse-proxy-google/</a><br><a href="https://ttt.tt/162/" target="_blank" rel="noopener">https://ttt.tt/162/</a><br><a href="https://hack0nair.me/2014-10-25-how-to-setup-reverse-proxy-by-nginx/" target="_blank" rel="noopener">https://hack0nair.me/2014-10-25-how-to-setup-reverse-proxy-by-nginx/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vps </tag>
            
            <tag> Nginx </tag>
            
            <tag> Google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vps搭建Minecraft Server</title>
      <link href="/2016/01/14/vps/vps-minecraft-server/"/>
      <url>/2016/01/14/vps/vps-minecraft-server/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://minecraft.net/" target="_blank" rel="noopener"><code>Minecraft</code></a>这是一款沙盒游戏，玩家可以再三维世界里用方块建造建筑物，中文译为<strong>我的世界</strong>。<br>听说这款游戏热度特别高，可以自搭私服，拉伙伴一起玩。就用现成的<code>VPS</code>尝试搭建一个<code>server</code>.</p></blockquote><a id="more"></a><h3 id="Install-JDK"><a href="#Install-JDK" class="headerlink" title="Install JDK"></a>Install JDK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">yum -y install java-1.6.0-openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># Debian:</span></span><br><span class="line">sudo apt-get install python-software-properties</span><br><span class="line">sudo add-apt-repository ppa:ferramroberto/java</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install sun-java6-jdk</span><br></pre></td></tr></table></figure><h3 id="Install-Screen"><a href="#Install-Screen" class="headerlink" title="Install Screen"></a>Install Screen</h3><blockquote><p>Because we can’t keep connection long time by SSH, so we need <code>Screen</code> tool to keep touch with the Minecraft server.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">yum -y install screen</span><br><span class="line"></span><br><span class="line"><span class="comment"># Debian</span></span><br><span class="line">apt-get install screen</span><br></pre></td></tr></table></figure><h3 id="Download-Server-client"><a href="#Download-Server-client" class="headerlink" title="Download Server client"></a>Download Server client</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> / </span><br><span class="line">mkdir Minecraft </span><br><span class="line"><span class="built_in">cd</span> Minecraft </span><br><span class="line">wget http://s3.amazonaws.com/Minecraft.Download/versions/1.8.7/minecraft_server.1.8.7.jar</span><br></pre></td></tr></table></figure><h3 id="Configure-Server"><a href="#Configure-Server" class="headerlink" title="Configure Server"></a>Configure Server</h3><blockquote><p><code>Xmx</code> is mean the max used memory, <code>Xms</code> is mean the min used memory, so the min memory is better &gt; 256M, because is hard to start server when the value is below 256M.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">screen -S Minecraft</span><br><span class="line"><span class="built_in">cd</span> /Minecraft</span><br><span class="line">java -Xmx768M -Xms256M -jar minecraft_server.1.8.7.jar nogui</span><br><span class="line"><span class="comment">#java -Xmx256M -Xms256M -jar minecraft_server.1.8.7.jar nogui</span></span><br></pre></td></tr></table></figure><h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><blockquote><p>input <code>ip + 25565</code></p></blockquote><p>PS. 用<code>vps</code>玩了两下server就挂了，低配的server不适合自建私服。</p><blockquote><p>Resources:<br><a href="https://www.vmvps.com/how-to-using-vps-to-build-your-own-minecraft-server.html" target="_blank" rel="noopener">https://www.vmvps.com/how-to-using-vps-to-build-your-own-minecraft-server.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Vps </tag>
            
            <tag> Minecraft </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome Vimium plugin</title>
      <link href="/2015/10/28/tools/chrome-vimium-plugin/"/>
      <url>/2015/10/28/tools/chrome-vimium-plugin/</url>
      
        <content type="html"><![CDATA[<p>这款插件火了好久了，其实我linux方面挺菜的，但是不还得要学习才能进步呢。<br>先看介绍—&gt;<code>Vimium - The Hacker&#39;s Browser</code>, 是不是很牛b。全程无鼠标操作是不是酷毙了。hahah…</p><blockquote><p>Vimium is a Chrome extension that provides keyboard-based navigation and control of the web in the spirit of the Vim editor.</p></blockquote><a id="more"></a><p>其实下面这些命令已经完全够用了。详细的参照开源地址<a href="https://github.com/philc/vimium" target="_blank" rel="noopener">vimium</a></p><p>Modifier keys are specified as <code>&lt;c-x&gt;</code>, <code>&lt;m-x&gt;</code>, <code>&lt;a-x&gt;</code> for <code>ctrl+x</code>, <code>meta+x</code>, and <code>alt+x</code> respectively.</p><h3 id="Navigating-the-current-page"><a href="#Navigating-the-current-page" class="headerlink" title="Navigating the current page:"></a>Navigating the current page:</h3><pre><code>?       show the help dialog for a list of all available keysh       scroll leftj       scroll downk       scroll upl       scroll rightgg      scroll to top of the pageG       scroll to bottom of the paged       scroll down half a pageu       scroll up half a pagef       open a link in the current tabF       open a link in a new tabr       reloadgs      view sourcei       enter insert mode -- all commands will be ignored until you hit esc to exityy      copy the current url to the clipboardyf      copy a link url to the clipboardgf      cycle forward to the next frame</code></pre><h3 id="Navigating-to-new-pages"><a href="#Navigating-to-new-pages" class="headerlink" title="Navigating to new pages:"></a>Navigating to new pages:</h3><pre><code>o       Open URL, bookmark, or history entryO       Open URL, bookmark, history entry in a new tabb       Open bookmarkB       Open bookmark in a new tab</code></pre><h3 id="Using-find"><a href="#Using-find" class="headerlink" title="Using find:"></a>Using find:</h3><pre><code>/       enter find mode -- type your search query and hit enter to search or esc to canceln       cycle forward to the next find matchN       cycle backward to the previous find match</code></pre><h3 id="Navigating-your-history"><a href="#Navigating-your-history" class="headerlink" title="Navigating your history:"></a>Navigating your history:</h3><pre><code>H       go back in historyL       go forward in history</code></pre><h3 id="Manipulating-tabs"><a href="#Manipulating-tabs" class="headerlink" title="Manipulating tabs:"></a>Manipulating tabs:</h3><pre><code>J, gT      go one tab leftK, gt      go one tab rightg0         go to the first tabg$         go to the last tabt          create tabx          close current tabX          restore closed tab (i.e. unwind the &apos;x&apos; command)T          search through your open tabs</code></pre><h3 id="Additional-advanced-browsing-commands"><a href="#Additional-advanced-browsing-commands" class="headerlink" title="Additional advanced browsing commands:"></a>Additional advanced browsing commands:</h3><pre><code>]]      Follow the link labeled &apos;next&apos; or &apos;&gt;&apos;. Helpful for browsing paginated sites.[[      Follow the link labeled &apos;previous&apos; or &apos;&lt;&apos;. Helpful for browsing paginated sites.&lt;a-f&gt;   open multiple links in a new tabgi      focus the first (or n-th) text input box on the pagegu      go up one level in the URL hierarchy</code></pre><p>Vimium supports command repetition so, for example, hitting ‘5t’ will open 5 tabs in rapid succession. <code>ESC (or &lt;c-[&gt;)</code> will clear any partial commands in the queue and will also exit insert and find modes.</p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome </tag>
            
            <tag> Vim </tag>
            
            <tag> Shortcut </tag>
            
            <tag> plugin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>科学上网</title>
      <link href="/2015/08/15/vps/ss-vps/"/>
      <url>/2015/08/15/vps/ss-vps/</url>
      
        <content type="html"><![CDATA[<blockquote><p>科学上网请使用socks代理软件，Bandwagonhost推广码<strong><a href="https://bandwagonhost.com/aff.php?aff=4208" target="_blank" rel="noopener">戳这里</a></strong></p></blockquote><a id="more"></a><blockquote><p>当前脚本是python版一键安装， 其他版本参照Resource </p></blockquote><h3 id="SS-Installation"><a href="#SS-Installation" class="headerlink" title="SS Installation"></a>SS Installation</h3><blockquote><p>OS: CentOS 6，7，Debian，Ubuntu<br>Memory：≥128M</p></blockquote><h4 id="Default-Configuration"><a href="#Default-Configuration" class="headerlink" title="Default Configuration"></a>Default Configuration</h4><blockquote><p><code>server port</code>: customize (default 8989)<br><code>client port</code>: 1080<br><code>password</code>: customize (default teddysun.com)<br>#Note: This script default create single user, if configure multiple users,<br>please modify <code>/etc/shadowsocks.json</code>, then restart service.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span><br><span class="line">chmod +x shadowsocks.sh</span><br><span class="line">./shadowsocks.sh 2&gt;&amp;1 | tee shadowsocks.log</span><br></pre></td></tr></table></figure><blockquote><p>output</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Congratulations, shadowsocks install completed!</span><br><span class="line">Your Server IP:your_server_ip</span><br><span class="line">Your Server Port:your_server_port</span><br><span class="line">Your Password:your_password</span><br><span class="line">Your Local IP:127.0.0.1</span><br><span class="line">Your Local Port:1080</span><br><span class="line">Your Encryption Method:aes-256-cfb</span><br><span class="line"></span><br><span class="line">Welcome to visit:https://teddysun.com/342.html</span><br><span class="line">Enjoy it!</span><br></pre></td></tr></table></figure><h4 id="Windows-Client-Download"><a href="#Windows-Client-Download" class="headerlink" title="Windows Client Download"></a>Windows Client Download</h4><blockquote><p><a href="https://github.com/shadowsocks/shadowsocks-windows/releases" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks-windows/releases</a></p></blockquote><h3 id="SS-Deinstallation"><a href="#SS-Deinstallation" class="headerlink" title="SS Deinstallation"></a>SS Deinstallation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shadowsocks.sh uninstall</span><br></pre></td></tr></table></figure><h3 id="Configuration-Sample"><a href="#Configuration-Sample" class="headerlink" title="Configuration Sample"></a>Configuration Sample</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/shadowsocks.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"port_password"</span>:&#123;</span><br><span class="line">         <span class="string">"8989"</span>:<span class="string">"password0"</span>,</span><br><span class="line">         <span class="string">"9001"</span>:<span class="string">"password1"</span>,</span><br><span class="line">         <span class="string">"9002"</span>:<span class="string">"password2"</span>,</span><br><span class="line">         <span class="string">"9003"</span>:<span class="string">"password3"</span>,</span><br><span class="line">         <span class="string">"9004"</span>:<span class="string">"password4"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"timeout"</span>:300,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="string">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#start</span><br><span class="line">/etc/init.d/shadowsocks start</span><br><span class="line">#stop</span><br><span class="line">/etc/init.d/shadowsocks stop</span><br><span class="line">#restart</span><br><span class="line">/etc/init.d/shadowsocks restart</span><br><span class="line">#check status</span><br><span class="line">/etc/init.d/shadowsocks status</span><br></pre></td></tr></table></figure><p>Resources:<br><a href="https://teddysun.com/" target="_blank" rel="noopener">秋水逸冰</a> - <a href="http://teddysun.com/342.html" target="_blank" rel="noopener">Python版一键安装</a><br><a href="https://teddysun.com/" target="_blank" rel="noopener">秋水逸冰</a> - <a href="http://teddysun.com/392.html" target="_blank" rel="noopener">Go版一键安装</a></p>]]></content>
      
      
      <categories>
          
          <category> Vps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Vps </tag>
            
            <tag> SS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git submodule</title>
      <link href="/2014/08/23/tools/git-submodule/"/>
      <url>/2014/08/23/tools/git-submodule/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Normally, <code>git-submodule</code> is benefit as sub project on the third party solution or integration solution. So Let us talk about it.</p></blockquote><a id="more"></a><h3 id="Create-repo-with-submodule"><a href="#Create-repo-with-submodule" class="headerlink" title="Create repo with submodule"></a>Create repo with submodule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### solution 1</span></span><br><span class="line"><span class="comment">## prepare</span></span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">mkdir testproj</span><br><span class="line"><span class="built_in">cd</span> testproj</span><br><span class="line">mkdir test_master_proj test_sub_a_proj test_sub_b_proj</span><br><span class="line"><span class="built_in">cd</span> test_master_proj</span><br><span class="line"></span><br><span class="line"><span class="comment"># create master project</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"# test_master_proj"</span> &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"first commit"</span></span><br><span class="line">git remote add origin git@github.com:itabas016/test_master_proj.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># create sub a project</span></span><br><span class="line"><span class="built_in">cd</span> ../test_sub_a_proj</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"# test_sub_a_proj"</span> &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"first commit for sub a"</span></span><br><span class="line">git remote add origin git@github.com:itabas016/test_sub_a_proj.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># create sub b project</span></span><br><span class="line"><span class="built_in">cd</span> ../test_sub_b_proj</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"# test_sub_b_proj"</span> &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"first commit for sub b"</span></span><br><span class="line">git remote add origin git@github.com:itabas016/test_sub_b_proj.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the third repo for master</span></span><br><span class="line">git submodule add git@github.com:itabas016/test_sub_a_proj.git subA</span><br><span class="line">git submodule add git@github.com:itabas016/test_sub_b_proj.git subB</span><br><span class="line">git status</span><br><span class="line"><span class="comment"># result:</span></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">        new file:   .gitmodules</span><br><span class="line">        new file:   subA</span><br><span class="line">        new file:   subB</span><br><span class="line"></span><br><span class="line"><span class="comment"># push the third submodule to master</span></span><br><span class="line">git commit -m <span class="string">'thirdpart submodule A&amp;B added.'</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### solution 2</span></span><br><span class="line"><span class="comment"># Just use clone</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clone repo</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:itabas016/test_master_proj.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># init sub repo</span></span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># another quick way to clone master with recursive</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive git@github.com:itabas016/test_master_proj.git</span><br></pre></td></tr></table></figure><h3 id="Update-repo-with-submodule"><a href="#Update-repo-with-submodule" class="headerlink" title="Update repo with submodule"></a>Update repo with submodule</h3><blockquote><p>normally, the repo update is used <code>git pull</code>, it will be resolve the conflict automatic. But when update the master repo, you should attent the sub repo whether has update, see the below:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master pull</span></span><br><span class="line">git pull</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># if submodule has changed</span></span><br><span class="line">git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># sometime should be run this command</span></span><br><span class="line">git submodule update --remote</span><br><span class="line"></span><br><span class="line"><span class="comment"># if submodule has other denpendency repo and has updated</span></span><br><span class="line">git submodule foreach <span class="string">"git submodule update"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># same as submodule master branch</span></span><br><span class="line">git submodule update --remote --rescursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># if just update one submodule repo</span></span><br><span class="line"><span class="built_in">cd</span> subA/</span><br><span class="line">git pull</span><br><span class="line"></span><br><span class="line"><span class="comment"># if subA has denpendency with other repo</span></span><br><span class="line">git submodule foreach <span class="string">"git pull"</span> --recursive</span><br></pre></td></tr></table></figure><h3 id="Modify-repo-with-submodule"><a href="#Modify-repo-with-submodule" class="headerlink" title="Modify repo with submodule"></a>Modify repo with submodule</h3><blockquote><p>when execute <code>git submodule update</code> don’t checkout any branch, so the HEAD of submodule is detached state.<br>when modify submodule repo, remember checkout related feature branch. </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../test_sub_a_proj</span><br><span class="line">git checkout master</span><br><span class="line"></span><br><span class="line">[submodule <span class="string">"subA"</span>]</span><br><span class="line">path = subA</span><br><span class="line">url = git@github.com:itabas016/test_sub_a_proj.git</span><br><span class="line">branch = master</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify subA folder</span></span><br><span class="line"><span class="comment"># modify README.md add new line</span></span><br><span class="line"></span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"new comments added."</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line">git add test_sub_a_proj</span><br><span class="line">git commit -m <span class="string">'submodule updated'</span></span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line"><span class="comment"># if modify submodule repo before your change forgot to checkout remote master branch, </span></span><br><span class="line"><span class="comment"># and have a commit in your local. Now we should use `cherry-pick` </span></span><br><span class="line"><span class="comment"># switch submodule from detach state to remote master.</span></span><br><span class="line"></span><br><span class="line">git cherry-pick a</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="Rename-Move-repo-with-submodule"><a href="#Rename-Move-repo-with-submodule" class="headerlink" title="Rename/Move repo with submodule"></a>Rename/Move repo with submodule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use copy instead of move behavior</span></span><br><span class="line">mkdir framework</span><br><span class="line">cp -R subA framework/</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify relatation config</span></span><br><span class="line"><span class="comment"># mainly .gitmodules, .git/config</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s@subA@framework/subA@'</span> .gitmodules</span><br><span class="line">sed -i <span class="string">'s@subA@framework/subA@'</span> framework/subA/.git</span><br><span class="line">mv .git/modules/subA .git/modules/framework/subA</span><br><span class="line">sed -i <span class="string">'s@subA@framework/subA@'</span> .git/modules/framework/subA/config</span><br><span class="line"></span><br><span class="line">git rm --cached subA</span><br><span class="line">git add framework/subA .gitmodules</span><br><span class="line">git submodule sync -- framework/subA</span><br><span class="line"></span><br><span class="line"><span class="comment"># also use the below command:</span></span><br><span class="line"><span class="built_in">cd</span> ../test_master_proj</span><br><span class="line">git rm --cached subA</span><br><span class="line">rm -rf subA</span><br><span class="line">rm -rf .git/modules/subA</span><br><span class="line">nano -w .gitmodules</span><br><span class="line">...remove subA...</span><br><span class="line">nano -w .git/config</span><br><span class="line">...remove subA...</span><br><span class="line">git submodule add git@github.com:itabas016/test_sub_a_proj.git framework/subA -b master</span><br><span class="line">git add .gitmodules</span><br><span class="line">git commit -m <span class="string">'subA moved to framework/subA/.'</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="Delete-repo-with-submodule"><a href="#Delete-repo-with-submodule" class="headerlink" title="Delete repo with submodule"></a>Delete repo with submodule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../test_master_proj</span><br><span class="line">git rm --cached framework/subA</span><br><span class="line">$ rm -rf framework/subA</span><br><span class="line">$ rm -rf .git/modules/framework/subA</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove git record: cached and folder</span></span><br><span class="line">git rm --cached framework/subA</span><br><span class="line">$ rm -rf framework/subA</span><br><span class="line">$ rm -rf .git/modules/framework/subA</span><br><span class="line"></span><br><span class="line"><span class="comment"># update configuration and commit</span></span><br><span class="line">$ git add .gitmodule</span><br><span class="line">$ git commit -m <span class="string">'framework/subA submodule removed.'</span></span><br><span class="line">$ git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="Quick-Tricks"><a href="#Quick-Tricks" class="headerlink" title="Quick Tricks"></a>Quick Tricks</h3><h4 id="Submodule-foreach"><a href="#Submodule-foreach" class="headerlink" title="Submodule foreach"></a>Submodule foreach</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keep all the submodule changes</span></span><br><span class="line">git submodule foreach <span class="string">'git stash'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># switch checkout all the submodule to a new branch</span></span><br><span class="line">git submodule foreach <span class="string">'git checkout -b featureA'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate difference master with all the submodules</span></span><br><span class="line">git diff; git submodule foreach <span class="string">'git diff'</span></span><br></pre></td></tr></table></figure><h4 id="Useful-alias-commands"><a href="#Useful-alias-commands" class="headerlink" title="Useful alias commands"></a>Useful alias commands</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git config alias.sdiff <span class="string">'!'</span><span class="string">"git diff &amp;&amp; git submodule foreach 'git diff'"</span></span><br><span class="line">git config alias.spush <span class="string">'push --recurse-submodules=on-demand'</span></span><br><span class="line">git config alias.supdate <span class="string">'submodule update --remote --merge'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># then run the below commands:</span></span><br><span class="line">git supdate</span><br><span class="line">git spush</span><br></pre></td></tr></table></figure><blockquote><p>Resources:<br><a href="http://easior.is-programmer.com/posts/42541.html" target="_blank" rel="noopener">http://easior.is-programmer.com/posts/42541.html</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="noopener">https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Source Control - Git Tutorial</title>
      <link href="/2013/05/13/tools/git-tutorial/"/>
      <url>/2013/05/13/tools/git-tutorial/</url>
      
        <content type="html"><![CDATA[<blockquote><p>能在刚开始开始时就能解除source control版本管理工具，那真是让你的开发之路清晰不少。正好所在的开发小组敢于大胆的汲取新知识，对于自己也是受益颇多。</p></blockquote><a id="more"></a><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><blockquote><p>git初始化配置，<code>.git/config</code> 属性值在这个文件里。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config username</span></span><br><span class="line">git config –global user.name <span class="string">"Your Name"</span></span><br><span class="line"><span class="comment"># config email</span></span><br><span class="line">git config –global user.email <span class="string">"you@yourdomain.com"</span></span><br></pre></td></tr></table></figure><blockquote><p>生成公钥</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ ls</span><br><span class="line">authorized_keys2  id_dsa       known_hosts</span><br><span class="line">config            id_dsa.pub</span><br><span class="line"></span><br><span class="line">$ ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/Users/schacon/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /Users/schacon/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /Users/schacon/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">43:c5:5b:5f:b1:f1:50:43:ad:20:a6:92:6a:1f:9a:3a schacon@agadorlaptop.local</span><br><span class="line"></span><br><span class="line">$ cat ~/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU</span><br><span class="line">GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3</span><br><span class="line">Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA</span><br><span class="line">t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En</span><br><span class="line">mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx</span><br><span class="line">NrRFi9wrf+M7Q== schacon@agadorlaptop.local</span><br></pre></td></tr></table></figure><blockquote><p>PS. <code>git config --global</code>全局设置，<code>git config --global http.proxy http://127.0.0.1:1080/</code> 设置git走代理。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ git config --h</span><br><span class="line">error: unknown option `h<span class="string">'</span></span><br><span class="line"><span class="string">usage: git config [options]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Config file location</span></span><br><span class="line"><span class="string">    --global              use global config file</span></span><br><span class="line"><span class="string">    --system              use system config file</span></span><br><span class="line"><span class="string">    --local               use repository config file</span></span><br><span class="line"><span class="string">    -f, --file &lt;file&gt;     use given config file</span></span><br><span class="line"><span class="string">    --blob &lt;blob-id&gt;      read config from given blob object</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Action</span></span><br><span class="line"><span class="string">    --get                 get value: name [value-regex]</span></span><br><span class="line"><span class="string">    --get-all             get all values: key [value-regex]</span></span><br><span class="line"><span class="string">    --get-regexp          get values for regexp: name-regex [value-regex]</span></span><br><span class="line"><span class="string">    --get-urlmatch        get value specific for the URL: section[.var] URL</span></span><br><span class="line"><span class="string">    --replace-all         replace all matching variables: name value [value_regex]</span></span><br><span class="line"><span class="string">    --add                 add a new variable: name value</span></span><br><span class="line"><span class="string">    --unset               remove a variable: name [value-regex]</span></span><br><span class="line"><span class="string">    --unset-all           remove all matches: name [value-regex]</span></span><br><span class="line"><span class="string">    --rename-section      rename section: old-name new-name</span></span><br><span class="line"><span class="string">    --remove-section      remove a section: name</span></span><br><span class="line"><span class="string">    -l, --list            list all</span></span><br><span class="line"><span class="string">    -e, --edit            open an editor</span></span><br><span class="line"><span class="string">    --get-color &lt;slot&gt;    find the color configured: [default]</span></span><br><span class="line"><span class="string">    --get-colorbool &lt;slot&gt;</span></span><br><span class="line"><span class="string">                          find the color setting: [stdout-is-tty]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Type</span></span><br><span class="line"><span class="string">    --bool                value is "true" or "false"</span></span><br><span class="line"><span class="string">    --int                 value is decimal number</span></span><br><span class="line"><span class="string">    --bool-or-int         value is --bool or --int</span></span><br><span class="line"><span class="string">    --path                value is a path (file or directory name)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Other</span></span><br><span class="line"><span class="string">    -z, --null            terminate values with NUL byte</span></span><br><span class="line"><span class="string">    --includes            respect include directives on lookup</span></span><br></pre></td></tr></table></figure><h3 id="Basic-command"><a href="#Basic-command" class="headerlink" title="Basic command"></a>Basic command</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">git config初始化属性设置</span><br><span class="line">git init 创建了一个git库，在当前目录中产生一个.git（git仓库） 的子目录。</span><br><span class="line">git add 将当前工作目录中更改或者新增的文件加入到git的索引中.</span><br><span class="line">git commit 提交当前工作目录的修改内容。</span><br><span class="line">git status 查看版本库的状态。</span><br><span class="line">git <span class="built_in">log</span> 查看历史日志，包含每次的版本变化。每次版本变化对应一个commit id。</span><br><span class="line">git merge 把服务器上下载下来的代码和本地代码合并，或者进行分支合并。如果合并有冲突，git会有提示。。</span><br><span class="line">git checkout 切换到分支。</span><br><span class="line">git clean复位</span><br><span class="line">git mv 重命名一个文件、目录或者链接。</span><br><span class="line">git branch 创建分支。</span><br><span class="line">git branch -d 删除分支。</span><br><span class="line">git rebase 一般在将服务器最新内容合并到本地时使用，例如：在版本C时从服务器上获取内容到本地，修改了本地内容，此时想把本地修改的内容提交到服务器上；但发现服务器上的版本已经变为G了，此时就需要先执行Git rebase，将服务器上的最新版本合并到本地。例如： 用下面两幅图解释会比较清楚一些，rebase命令执行后，实际上是将分支点从C移到了G，这样分支也就具有了从C到G的功能。</span><br><span class="line">git reset 库的逆转与恢复。git reset的概念比较复杂。它的命令形式：git reset [--mixed | --soft | --hard] [&lt;commit-ish&gt;] 。</span><br><span class="line">git reverse 还原某次对版本的修改。</span><br><span class="line">git tag 创建、列出、删除或者验证一个标签对象</span><br><span class="line">git <span class="built_in">clone</span> 取出服务器的仓库的代码到本地建立的目录中。</span><br><span class="line">git remote远端仓库</span><br><span class="line">git pull 从服务器的仓库中获取代码，和本地代码合并。与服务器交互，从服务器上下载最新代码，等同于： Git fetch + Git merge。</span><br><span class="line">git push 将本地commit的代码更新到远程版本库中，例如 “git push origin”就会将本地的代码更新到名为orgin的远程版本库中。</span><br><span class="line">git fetch 从服务器的仓库中下载代码。与服务器交互，从服务器上下载最新代码,相当于从远程获取最新版本到本地，不会自动merge，比git pull更安全些。</span><br></pre></td></tr></table></figure><h3 id="Advance-command"><a href="#Advance-command" class="headerlink" title="Advance command"></a>Advance command</h3><h4 id="Git-Submodule"><a href="#Git-Submodule" class="headerlink" title="Git Submodule"></a>Git Submodule</h4><blockquote><p>仓库子模块(git-submodule), 公共代码库一般都是以子仓库的模式存在和维护的。<br>详细的介绍会在后面的文章概述-&gt;<strong><a href="../../../../../2014/08/23/tools/git-submodule/">here</a></strong></p></blockquote><h4 id="Merging-vs-Rebasing"><a href="#Merging-vs-Rebasing" class="headerlink" title="Merging vs Rebasing"></a>Merging vs Rebasing</h4><blockquote><p>git rebase 和 git merge 都是用来合并分支，只不过方式不太相同。git rebase 经常被人认为是一种 Git 巫术，初学者应该避而远之。但如果使用得当，它能省去太多烦恼。在这篇文章中，我们会通过比较找到Git工作流中所有可以使用rebase的机会。</p></blockquote><blockquote><p>See the detail <strong><a href="https://www.atlassian.com/git/tutorials/merging-vs-rebasing/" target="_blank" rel="noopener">here</a></strong><br>译文参见 <strong><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.1-%E4%BB%A3%E7%A0%81%E5%90%88%E5%B9%B6%EF%BC%9AMerge%E3%80%81Rebase%E7%9A%84%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">这里</a></strong></p></blockquote><h4 id="Resetting-Checking-Out-and-Reverting"><a href="#Resetting-Checking-Out-and-Reverting" class="headerlink" title="Resetting, Checking Out, and Reverting"></a>Resetting, Checking Out, and Reverting</h4><blockquote><p>git reset 、 git checkout 和 git revert 都是用来撤销代码仓库中的某些更改，所以我们经常弄混。在这篇文章中，我们比较最常见的用法，分析在什么场景下该用哪个命令。</p></blockquote><blockquote><p>See the detail <strong><a href="https://www.atlassian.com/git/tutorials/resetting-checking-out-and-reverting/" target="_blank" rel="noopener">here</a></strong><br>译文参见<strong><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.2-%E4%BB%A3%E7%A0%81%E5%9B%9E%E6%BB%9A%EF%BC%9AReset%E3%80%81Checkout%E3%80%81Revert%E7%9A%84%E9%80%89%E6%8B%A9" target="_blank" rel="noopener">这里</a></strong></p></blockquote><h4 id="Git-Hooks"><a href="#Git-Hooks" class="headerlink" title="Git Hooks"></a>Git Hooks</h4><blockquote><p>Git 钩子是在 Git 仓库中特定事件发生时自动运行的脚本。它可以让你自定义Git内部的行为，在开始周期中的关键点触发自定义的行为，自动化或者优化你开发工作流中任意部分。</p></blockquote><blockquote><p>See the detail <strong><a href="https://www.atlassian.com/git/tutorials/git-hooks" target="_blank" rel="noopener">here</a></strong><br>译文参见 <strong><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.4-Git%E9%92%A9%E5%AD%90%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81" target="_blank" rel="noopener">这里</a></strong></p></blockquote><h4 id="Refs-and-the-Reflog"><a href="#Refs-and-the-Reflog" class="headerlink" title="Refs and the Reflog"></a>Refs and the Reflog</h4><blockquote><p>提交是 Git 的精髓所在，你无时不刻不在创建和缓存提交、查看以前的提交，或者用各种Git命令在仓库间转移你的提交。在这章中，我们研究提交的各种引用方式，以及涉及到的 Git 命令的工作原理。我们还会学到如何使用 Git 的引用日志查看看似已经删除的提交。</p></blockquote><blockquote><p>See the detail <strong><a href="https://www.atlassian.com/git/tutorials/refs-and-the-reflog" target="_blank" rel="noopener">here</a></strong><br>译文参见 <strong><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.5-Git%E6%8F%90%E4%BA%A4%E5%BC%95%E7%94%A8%E5%92%8C%E5%BC%95%E7%94%A8%E6%97%A5%E5%BF%97" target="_blank" rel="noopener">这里</a></strong></p></blockquote><blockquote><p>Resoures:<br><a href="https://www.atlassian.com/git/tutorials" target="_blank" rel="noopener">https://www.atlassian.com/git/tutorials</a><br><a href="https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E7%94%9F%E6%88%90-SSH-%E5%85%AC%E9%92%A5" target="_blank" rel="noopener">https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E7%94%9F%E6%88%90-SSH-%E5%85%AC%E9%92%A5</a><br><a href="https://www.atlassian.com/git/tutorials/advanced-overview" target="_blank" rel="noopener">https://www.atlassian.com/git/tutorials/advanced-overview</a><br><a href="https://git-scm.com/book/zh/v1/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="noopener">https://git-scm.com/book/zh/v1/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97</a><br><a href="https://github.com/geeeeeeeeek/git-recipes/wiki" target="_blank" rel="noopener">https://github.com/geeeeeeeeek/git-recipes/wiki</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SqlServer还原脚本</title>
      <link href="/2013/03/27/database/sqlserver-database-restore/"/>
      <url>/2013/03/27/database/sqlserver-database-restore/</url>
      
        <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----------------------------------------*/</span></span><br><span class="line"><span class="comment">--@filename: target bak name</span></span><br><span class="line"><span class="comment">--@path: target restore directory end by '/' </span></span><br><span class="line"><span class="comment">/*----------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">path</span> <span class="keyword">nvarchar</span>(<span class="number">200</span>)</span><br><span class="line"><span class="keyword">declare</span> @filename <span class="keyword">nvarchar</span>(<span class="number">400</span>)</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">path</span>=<span class="string">'D:\backup\'</span></span><br><span class="line"><span class="keyword">SET</span> @filename=@<span class="keyword">path</span>+<span class="string">'\MobileSaleStatMain.bak'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span> MobileSaleStatMain <span class="keyword">FROM</span> DISK = @filename</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">replace</span>,</span><br><span class="line">    <span class="keyword">move</span> <span class="string">'MobileSaleStatMain'</span> <span class="keyword">to</span> <span class="string">'D:\MSSQL\Data\MobileSaleStatMain\MobileSaleStatMain.mdf'</span>,</span><br><span class="line">    <span class="keyword">move</span> <span class="string">'MobileSaleStatMain_log'</span>  <span class="keyword">to</span> <span class="string">'D:\MSSQL\Data\MobileSaleStatMain\MobileSaleStatMain_log.ldf'</span>,</span><br><span class="line">    <span class="keyword">recovery</span></span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> [MobileSaleStatMain]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">IF</span>  <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_principals <span class="keyword">WHERE</span> <span class="keyword">name</span> = N<span class="string">'mobilesalestatmain'</span>)</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> [mobilesalestatmain]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> [MobileSaleStatMain]</span><br><span class="line"><span class="keyword">SELECT</span> s.name</span><br><span class="line"> <span class="keyword">FROM</span> sys.schemas s</span><br><span class="line"> <span class="keyword">WHERE</span> s.principal_id = USER_ID(<span class="string">'mobilesalestatmain'</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">--modidy user</span></span><br><span class="line"> <span class="keyword">ALTER</span> AUTHORIZATION <span class="keyword">ON</span> <span class="keyword">SCHEMA</span>::db_owner <span class="keyword">TO</span> dbo;</span><br><span class="line"> GO</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DataBase </tag>
            
            <tag> Script </tag>
            
            <tag> SqlServer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Drop - Delete - Truncate 的区别</title>
      <link href="/2012/08/16/database/different-drop-delete-truncate/"/>
      <url>/2012/08/16/database/different-drop-delete-truncate/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>truncate</code>和<code>delete</code>只删除数据不删除表的结构(定义);<br><code>drop</code>将删除表的结构被依赖的<code>constrain</code>,<code>trigger</code>,<code>index</code>; 依赖于该表的存储过程/函数将保留,但是变为<code>invalid</code>状态.</p></blockquote><ul><li><blockquote><p><code>TRUNCATE</code>在各种表上无论是大的还是小的都非常快。如果有<code>ROLLBACK</code>命令<code>DELETE</code>将被撤销，而<code>TRUNCATE</code>则不会被撤销。</p></blockquote></li><li><blockquote><p><code>TRUNCATE</code>不能进行回滚操作。</p></blockquote></li><li><blockquote><p><code>TRUNCATE</code>不触发任何<code>DELETE</code>触发器。</p></blockquote></li><li><blockquote><p>当表被<code>TRUNCATE</code>后，这个表和索引所占用的空间会恢复到初始大小，而<code>DELETE</code>操作不会减少表或索引所占用的空间。</p></blockquote></li><li><blockquote><p>不能<code>TRUNCATE</code>一个带有外键的表，如果要删除首先要取消外键，然后再删除。</p></blockquote></li><li><blockquote><p><code>DELETE</code>语句执行删除的过程是每次从表中删除一行，并且同时将该行的的删除操作作为事务记录在日志中保存以便进行进行回滚操作。</p></blockquote></li><li><blockquote><p><code>TRUNCATE TABLE</code>则一次性地从表中删除所有的数据页并不把单独的删除操作记录记入日志保存，删除行是不能恢复的。并且在删除的过程中不会激活与表有关的删除触发器。执行速度快。</p></blockquote></li><li><blockquote><p><code>DELETE</code>语句可以通过<code>WHERE</code>对要删除的记录进行选择。而使用TRUNCATE TABLE将删除表中的所有记录。因此，<code>DELETE</code>语句更灵活。如果<code>DELETE</code>不加<code>WHERE</code>子句， <code>DELETE</code>可以返回被删除的记录数，而<code>TRUNCATE TABLE</code>返回的是<code>0</code>。如果一个表中有自增字段，使用<code>TRUNCATE TABLE</code>和没有<code>WHERE</code>子句的<code>DELETE</code>删除所有记录后，这个自增字段将起始值恢复成<code>1</code>.如果你不想这样做的话，可以在<code>DELETE</code>语句中加上永真的<code>WHERE</code>，如<code>WHERE 1</code>或<code>WHERE true</code>。<code>DELETE FROM table1 WHERE 1</code>;</p></blockquote></li></ul><blockquote><p>Question: 有一个拥有1亿条数据的表，只需要保留其中的5条，其他删除，怎么办？</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> <span class="comment">#temp_table from bigggggg_table where caluse....;</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> bigggggg_table;</span><br><span class="line"><span class="keyword">insert</span> bigggggg_table <span class="keyword">select</span> * <span class="keyword">from</span> <span class="comment">#temp_table;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="comment">#temp_table;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DataBase </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SqlServer log shrink (日志库收缩)</title>
      <link href="/2012/07/22/database/sqlserver-log-shrink/"/>
      <url>/2012/07/22/database/sqlserver-log-shrink/</url>
      
        <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]  </span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> MobileStatLog <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> SIMPLE <span class="keyword">WITH</span> NO_WAIT  </span><br><span class="line"><span class="keyword">GO</span> </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> MobileStatLog <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> SIMPLE   <span class="comment">--simple model  </span></span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line"><span class="keyword">USE</span> MobileStatLog</span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line">DBCC SHRINKFILE (N<span class="string">'MobileStatLog_Log'</span> , <span class="number">5</span>, TRUNCATEONLY)  </span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]</span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> MobileStatLog <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span> <span class="keyword">WITH</span> NO_WAIT  </span><br><span class="line"><span class="keyword">GO</span>  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> MobileStatLog <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span>  <span class="comment">--restore for full model </span></span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DataBase </tag>
            
            <tag> Script </tag>
            
            <tag> SqlServer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SqlServer的各种备份脚本</title>
      <link href="/2012/03/27/database/sqlserver-database-backup/"/>
      <url>/2012/03/27/database/sqlserver-database-backup/</url>
      
        <content type="html"><![CDATA[<h3 id="Full-Database-Backup"><a href="#Full-Database-Backup" class="headerlink" title="Full Database Backup"></a>Full Database Backup</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----------------------------------------*/</span></span><br><span class="line"><span class="comment">--@Database: target database name</span></span><br><span class="line"><span class="comment">--@Path: target backup directory end by '/' </span></span><br><span class="line"><span class="comment">/*----------------------------------------*/</span></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">master</span>  </span><br><span class="line"><span class="keyword">go</span>  </span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">Database</span> <span class="keyword">nvarchar</span>(<span class="number">256</span>),@<span class="keyword">Path</span> <span class="keyword">nvarchar</span>(<span class="number">2048</span>)  </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">Database</span>=N<span class="string">'MobileSaleStatMain'</span>,@<span class="keyword">Path</span>=N<span class="string">'D:/backup/'</span>  </span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">sql</span> <span class="keyword">nvarchar</span>(<span class="keyword">max</span>)  </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">sql</span> =N<span class="string">'BACKUP DATABASE '</span>+@<span class="keyword">Database</span>+N<span class="string">'  </span></span><br><span class="line"><span class="string">    TO  DISK = '''</span>+@<span class="keyword">Path</span>+@<span class="keyword">Database</span>+N<span class="string">'_Full_'</span>+<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(<span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">30</span>),<span class="keyword">getdate</span>(),<span class="number">126</span>),<span class="string">'-'</span>,<span class="string">'_'</span>),<span class="string">':'</span>,<span class="string">'_'</span>),<span class="string">'.'</span>,<span class="string">'_'</span>)+N<span class="string">'.bak''  </span></span><br><span class="line"><span class="string">WITH   </span></span><br><span class="line"><span class="string">   NOFORMAT,   </span></span><br><span class="line"><span class="string">   INIT,    </span></span><br><span class="line"><span class="string">   NAME = N''Full Database Backup'',  </span></span><br><span class="line"><span class="string">   SKIP'</span>  </span><br><span class="line">exec (@<span class="keyword">sql</span>)  </span><br><span class="line"><span class="keyword">go</span></span><br></pre></td></tr></table></figure><h3 id="Differential-Database-Backup"><a href="#Differential-Database-Backup" class="headerlink" title="Differential Database Backup"></a>Differential Database Backup</h3><blockquote><p><strong>differential backup base on complete backup, it’s mean you should have a full backup before do this.</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="keyword">master</span>    </span><br><span class="line"><span class="keyword">go</span>    </span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">Database</span> <span class="keyword">nvarchar</span>(<span class="number">256</span>),@<span class="keyword">Path</span> <span class="keyword">nvarchar</span>(<span class="number">2048</span>)    </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">Database</span>=N<span class="string">'MobileSaleStatMain'</span>,@<span class="keyword">Path</span>=N<span class="string">'D:/backup/'</span>    </span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">sql</span> <span class="keyword">nvarchar</span>(<span class="keyword">max</span>)    </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">sql</span> =N<span class="string">'BACKUP DATABASE '</span>+@<span class="keyword">Database</span>+N<span class="string">'    </span></span><br><span class="line"><span class="string">    TO  DISK = '''</span>+@<span class="keyword">Path</span>+@<span class="keyword">Database</span>+N<span class="string">'_DIFF_'</span>+<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(<span class="keyword">convert</span>(<span class="keyword">nvarchar</span>(<span class="number">30</span>),<span class="keyword">getdate</span>(),<span class="number">126</span>),<span class="string">'-'</span>,<span class="string">'_'</span>),<span class="string">':'</span>,<span class="string">'_'</span>),<span class="string">'.'</span>,<span class="string">'_'</span>)+N<span class="string">'.bak''    </span></span><br><span class="line"><span class="string">WITH     </span></span><br><span class="line"><span class="string">   DIFFERENTIAL'</span>    </span><br><span class="line">exec (@<span class="keyword">sql</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DataBase </tag>
            
            <tag> Script </tag>
            
            <tag> SqlServer </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
